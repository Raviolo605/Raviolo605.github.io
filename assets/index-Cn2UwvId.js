import{j as s,u as sg,c as og,R as ag}from"./three-CYeR2gIl.js";import{r as x,R as he,u as Hn,L as Kt,h as Pt,N as ss,e as ig,i as Dc,j as tn,B as lg,k as cg,l as Ge}from"./react-X-gJ4u2N.js";import{s as zc,M as br,T as Vt,S as We,a as Ue,I as $e,b as hn,c as mr,B as He,R as fa,D as dg,d as Dr,e as Uc,f as zr,F as Bc,g as mn,h as ug,i as so,j as Se,k as fr,l as Ci,m as ga,P as fg,n as As,o as gg,p as Ps,U as pa,q as pg,r as _i,t as hg,u as mg,v as xg,C as vs,A as Wt,w as yg,x as bg,y as vt,z as Ei,E as os,G as wg,H as Ya,J as Xa,K as _n,L as ir,N as Ti,O as vg,Q as jg}from"./antd-MA4pboIr.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const kg=(e,t,r,n)=>{const o=[r,{code:t,...n||{}}];if(e?.services?.logger?.forward)return e.services.logger.forward(o,"warn","react-i18next::",!0);wr(o[0])&&(o[0]=`react-i18next:: ${o[0]}`),e?.services?.logger?.warn?e.services.logger.warn(...o):console?.warn&&console.warn(...o)},Ai={},ha=(e,t,r,n)=>{wr(r)&&Ai[r]||(wr(r)&&(Ai[r]=new Date),kg(e,t,r,n))},Hc=(e,t)=>()=>{if(e.isInitialized)t();else{const r=()=>{setTimeout(()=>{e.off("initialized",r)},0),t()};e.on("initialized",r)}},ma=(e,t,r)=>{e.loadNamespaces(t,Hc(e,r))},Pi=(e,t,r,n)=>{if(wr(r)&&(r=[r]),e.options.preload&&e.options.preload.indexOf(t)>-1)return ma(e,r,n);r.forEach(o=>{e.options.ns.indexOf(o)<0&&e.options.ns.push(o)}),e.loadLanguages(t,Hc(e,n))},Ng=(e,t,r={})=>!t.languages||!t.languages.length?(ha(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0):t.hasLoadedNamespace(e,{lng:r.lng,precheck:(n,o)=>{if(r.bindI18n?.indexOf("languageChanging")>-1&&n.services.backendConnector.backend&&n.isLanguageChangingTo&&!o(n.isLanguageChangingTo,e))return!1}}),wr=e=>typeof e=="string",Sg=e=>typeof e=="object"&&e!==null,Cg=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,_g={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},Eg=e=>_g[e],Tg=e=>e.replace(Cg,Eg);let xa={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:Tg};const Ag=(e={})=>{xa={...xa,...e}},Pg=()=>xa;let Vc;const Lg=e=>{Vc=e},Fg=()=>Vc,$g={type:"3rdParty",init(e){Ag(e.options.react),Lg(e)}},Rg=x.createContext();class Ig{constructor(){this.usedNamespaces={}}addUsedNamespaces(t){t.forEach(r=>{this.usedNamespaces[r]||(this.usedNamespaces[r]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const Mg=(e,t)=>{const r=x.useRef();return x.useEffect(()=>{r.current=e},[e,t]),r.current},Wc=(e,t,r,n)=>e.getFixedT(t,r,n),Og=(e,t,r,n)=>x.useCallback(Wc(e,t,r,n),[e,t,r,n]),Dg=(e,t={})=>{const{i18n:r}=t,{i18n:n,defaultNS:o}=x.useContext(Rg)||{},a=r||n||Fg();if(a&&!a.reportNamespaces&&(a.reportNamespaces=new Ig),!a){ha(a,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const v=(k,C)=>wr(C)?C:Sg(C)&&wr(C.defaultValue)?C.defaultValue:Array.isArray(k)?k[k.length-1]:k,j=[v,{},!1];return j.t=v,j.i18n={},j.ready=!1,j}a.options.react?.wait&&ha(a,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const i={...Pg(),...a.options.react,...t},{useSuspense:l,keyPrefix:c}=i;let d=o||a.options?.defaultNS;d=wr(d)?[d]:d||["translation"],a.reportNamespaces.addUsedNamespaces?.(d);const u=(a.isInitialized||a.initializedStoreOnce)&&d.every(v=>Ng(v,a,i)),f=Og(a,t.lng||null,i.nsMode==="fallback"?d:d[0],c),g=()=>f,p=()=>Wc(a,t.lng||null,i.nsMode==="fallback"?d:d[0],c),[h,w]=x.useState(g);let y=d.join();t.lng&&(y=`${t.lng}${y}`);const b=Mg(y),S=x.useRef(!0);x.useEffect(()=>{const{bindI18n:v,bindI18nStore:j}=i;S.current=!0,!u&&!l&&(t.lng?Pi(a,t.lng,d,()=>{S.current&&w(p)}):ma(a,d,()=>{S.current&&w(p)})),u&&b&&b!==y&&S.current&&w(p);const k=()=>{S.current&&w(p)};return v&&a?.on(v,k),j&&a?.store.on(j,k),()=>{S.current=!1,a&&v?.split(" ").forEach(C=>a.off(C,k)),j&&a&&j.split(" ").forEach(C=>a.store.off(C,k))}},[a,y]),x.useEffect(()=>{S.current&&u&&w(g)},[a,c,u]);const m=[h,a,u];if(m.t=h,m.i18n=a,m.ready=u,u||!u&&!l)return m;throw new Promise(v=>{t.lng?Pi(a,t.lng,d,()=>v()):ma(a,d,()=>v())})};function qc(e,t){return function(){return e.apply(t,arguments)}}const{toString:zg}=Object.prototype,{getPrototypeOf:Ja}=Object,{iterator:oo,toStringTag:Kc}=Symbol,ao=(e=>t=>{const r=zg.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Lt=e=>(e=e.toLowerCase(),t=>ao(t)===e),io=e=>t=>typeof t===e,{isArray:rn}=Array,En=io("undefined");function Ug(e){return e!==null&&!En(e)&&e.constructor!==null&&!En(e.constructor)&&ut(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Yc=Lt("ArrayBuffer");function Bg(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&Yc(e.buffer),t}const Hg=io("string"),ut=io("function"),Xc=io("number"),lo=e=>e!==null&&typeof e=="object",Vg=e=>e===!0||e===!1,js=e=>{if(ao(e)!=="object")return!1;const t=Ja(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Kc in e)&&!(oo in e)},Wg=Lt("Date"),qg=Lt("File"),Kg=Lt("Blob"),Yg=Lt("FileList"),Xg=e=>lo(e)&&ut(e.pipe),Jg=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ut(e.append)&&((t=ao(e))==="formdata"||t==="object"&&ut(e.toString)&&e.toString()==="[object FormData]"))},Zg=Lt("URLSearchParams"),[Gg,Qg,ep,tp]=["ReadableStream","Request","Response","Headers"].map(Lt),rp=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Vn(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let n,o;if(typeof e!="object"&&(e=[e]),rn(e))for(n=0,o=e.length;n<o;n++)t.call(null,e[n],n,e);else{const a=r?Object.getOwnPropertyNames(e):Object.keys(e),i=a.length;let l;for(n=0;n<i;n++)l=a[n],t.call(null,e[l],l,e)}}function Jc(e,t){t=t.toLowerCase();const r=Object.keys(e);let n=r.length,o;for(;n-- >0;)if(o=r[n],t===o.toLowerCase())return o;return null}const xr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Zc=e=>!En(e)&&e!==xr;function ya(){const{caseless:e}=Zc(this)&&this||{},t={},r=(n,o)=>{const a=e&&Jc(t,o)||o;js(t[a])&&js(n)?t[a]=ya(t[a],n):js(n)?t[a]=ya({},n):rn(n)?t[a]=n.slice():t[a]=n};for(let n=0,o=arguments.length;n<o;n++)arguments[n]&&Vn(arguments[n],r);return t}const np=(e,t,r,{allOwnKeys:n}={})=>(Vn(t,(o,a)=>{r&&ut(o)?e[a]=qc(o,r):e[a]=o},{allOwnKeys:n}),e),sp=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),op=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},ap=(e,t,r,n)=>{let o,a,i;const l={};if(t=t||{},e==null)return t;do{for(o=Object.getOwnPropertyNames(e),a=o.length;a-- >0;)i=o[a],(!n||n(i,e,t))&&!l[i]&&(t[i]=e[i],l[i]=!0);e=r!==!1&&Ja(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},ip=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return n!==-1&&n===r},lp=e=>{if(!e)return null;if(rn(e))return e;let t=e.length;if(!Xc(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},cp=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&Ja(Uint8Array)),dp=(e,t)=>{const n=(e&&e[oo]).call(e);let o;for(;(o=n.next())&&!o.done;){const a=o.value;t.call(e,a[0],a[1])}},up=(e,t)=>{let r;const n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},fp=Lt("HTMLFormElement"),gp=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,o){return n.toUpperCase()+o}),Li=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),pp=Lt("RegExp"),Gc=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};Vn(r,(o,a)=>{let i;(i=t(o,a,e))!==!1&&(n[a]=i||o)}),Object.defineProperties(e,n)},hp=e=>{Gc(e,(t,r)=>{if(ut(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=e[r];if(ut(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},mp=(e,t)=>{const r={},n=o=>{o.forEach(a=>{r[a]=!0})};return rn(e)?n(e):n(String(e).split(t)),r},xp=()=>{},yp=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function bp(e){return!!(e&&ut(e.append)&&e[Kc]==="FormData"&&e[oo])}const wp=e=>{const t=new Array(10),r=(n,o)=>{if(lo(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[o]=n;const a=rn(n)?[]:{};return Vn(n,(i,l)=>{const c=r(i,o+1);!En(c)&&(a[l]=c)}),t[o]=void 0,a}}return n};return r(e,0)},vp=Lt("AsyncFunction"),jp=e=>e&&(lo(e)||ut(e))&&ut(e.then)&&ut(e.catch),Qc=((e,t)=>e?setImmediate:t?((r,n)=>(xr.addEventListener("message",({source:o,data:a})=>{o===xr&&a===r&&n.length&&n.shift()()},!1),o=>{n.push(o),xr.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",ut(xr.postMessage)),kp=typeof queueMicrotask<"u"?queueMicrotask.bind(xr):typeof process<"u"&&process.nextTick||Qc,Np=e=>e!=null&&ut(e[oo]),X={isArray:rn,isArrayBuffer:Yc,isBuffer:Ug,isFormData:Jg,isArrayBufferView:Bg,isString:Hg,isNumber:Xc,isBoolean:Vg,isObject:lo,isPlainObject:js,isReadableStream:Gg,isRequest:Qg,isResponse:ep,isHeaders:tp,isUndefined:En,isDate:Wg,isFile:qg,isBlob:Kg,isRegExp:pp,isFunction:ut,isStream:Xg,isURLSearchParams:Zg,isTypedArray:cp,isFileList:Yg,forEach:Vn,merge:ya,extend:np,trim:rp,stripBOM:sp,inherits:op,toFlatObject:ap,kindOf:ao,kindOfTest:Lt,endsWith:ip,toArray:lp,forEachEntry:dp,matchAll:up,isHTMLForm:fp,hasOwnProperty:Li,hasOwnProp:Li,reduceDescriptors:Gc,freezeMethods:hp,toObjectSet:mp,toCamelCase:gp,noop:xp,toFiniteNumber:yp,findKey:Jc,global:xr,isContextDefined:Zc,isSpecCompliantForm:bp,toJSONObject:wp,isAsyncFn:vp,isThenable:jp,setImmediate:Qc,asap:kp,isIterable:Np};function Ae(e,t,r,n,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),o&&(this.response=o,this.status=o.status?o.status:null)}X.inherits(Ae,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:X.toJSONObject(this.config),code:this.code,status:this.status}}});const ed=Ae.prototype,td={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{td[e]={value:e}});Object.defineProperties(Ae,td);Object.defineProperty(ed,"isAxiosError",{value:!0});Ae.from=(e,t,r,n,o,a)=>{const i=Object.create(ed);return X.toFlatObject(e,i,function(c){return c!==Error.prototype},l=>l!=="isAxiosError"),Ae.call(i,e.message,t,r,n,o),i.cause=e,i.name=e.name,a&&Object.assign(i,a),i};const Sp=null;function ba(e){return X.isPlainObject(e)||X.isArray(e)}function rd(e){return X.endsWith(e,"[]")?e.slice(0,-2):e}function Fi(e,t,r){return e?e.concat(t).map(function(o,a){return o=rd(o),!r&&a?"["+o+"]":o}).join(r?".":""):t}function Cp(e){return X.isArray(e)&&!e.some(ba)}const _p=X.toFlatObject(X,{},null,function(t){return/^is[A-Z]/.test(t)});function co(e,t,r){if(!X.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=X.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,y){return!X.isUndefined(y[w])});const n=r.metaTokens,o=r.visitor||u,a=r.dots,i=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&X.isSpecCompliantForm(t);if(!X.isFunction(o))throw new TypeError("visitor must be a function");function d(h){if(h===null)return"";if(X.isDate(h))return h.toISOString();if(X.isBoolean(h))return h.toString();if(!c&&X.isBlob(h))throw new Ae("Blob is not supported. Use a Buffer instead.");return X.isArrayBuffer(h)||X.isTypedArray(h)?c&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function u(h,w,y){let b=h;if(h&&!y&&typeof h=="object"){if(X.endsWith(w,"{}"))w=n?w:w.slice(0,-2),h=JSON.stringify(h);else if(X.isArray(h)&&Cp(h)||(X.isFileList(h)||X.endsWith(w,"[]"))&&(b=X.toArray(h)))return w=rd(w),b.forEach(function(m,v){!(X.isUndefined(m)||m===null)&&t.append(i===!0?Fi([w],v,a):i===null?w:w+"[]",d(m))}),!1}return ba(h)?!0:(t.append(Fi(y,w,a),d(h)),!1)}const f=[],g=Object.assign(_p,{defaultVisitor:u,convertValue:d,isVisitable:ba});function p(h,w){if(!X.isUndefined(h)){if(f.indexOf(h)!==-1)throw Error("Circular reference detected in "+w.join("."));f.push(h),X.forEach(h,function(b,S){(!(X.isUndefined(b)||b===null)&&o.call(t,b,X.isString(S)?S.trim():S,w,g))===!0&&p(b,w?w.concat(S):[S])}),f.pop()}}if(!X.isObject(e))throw new TypeError("data must be an object");return p(e),t}function $i(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function Za(e,t){this._pairs=[],e&&co(e,this,t)}const nd=Za.prototype;nd.append=function(t,r){this._pairs.push([t,r])};nd.toString=function(t){const r=t?function(n){return t.call(this,n,$i)}:$i;return this._pairs.map(function(o){return r(o[0])+"="+r(o[1])},"").join("&")};function Ep(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function sd(e,t,r){if(!t)return e;const n=r&&r.encode||Ep;X.isFunction(r)&&(r={serialize:r});const o=r&&r.serialize;let a;if(o?a=o(t,r):a=X.isURLSearchParams(t)?t.toString():new Za(t,r).toString(n),a){const i=e.indexOf("#");i!==-1&&(e=e.slice(0,i)),e+=(e.indexOf("?")===-1?"?":"&")+a}return e}class Ri{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){X.forEach(this.handlers,function(n){n!==null&&t(n)})}}const od={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Tp=typeof URLSearchParams<"u"?URLSearchParams:Za,Ap=typeof FormData<"u"?FormData:null,Pp=typeof Blob<"u"?Blob:null,Lp={isBrowser:!0,classes:{URLSearchParams:Tp,FormData:Ap,Blob:Pp},protocols:["http","https","file","blob","url","data"]},Ga=typeof window<"u"&&typeof document<"u",wa=typeof navigator=="object"&&navigator||void 0,Fp=Ga&&(!wa||["ReactNative","NativeScript","NS"].indexOf(wa.product)<0),$p=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Rp=Ga&&window.location.href||"http://localhost",Ip=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ga,hasStandardBrowserEnv:Fp,hasStandardBrowserWebWorkerEnv:$p,navigator:wa,origin:Rp},Symbol.toStringTag,{value:"Module"})),at={...Ip,...Lp};function Mp(e,t){return co(e,new at.classes.URLSearchParams,Object.assign({visitor:function(r,n,o,a){return at.isNode&&X.isBuffer(r)?(this.append(n,r.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},t))}function Op(e){return X.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Dp(e){const t={},r=Object.keys(e);let n;const o=r.length;let a;for(n=0;n<o;n++)a=r[n],t[a]=e[a];return t}function ad(e){function t(r,n,o,a){let i=r[a++];if(i==="__proto__")return!0;const l=Number.isFinite(+i),c=a>=r.length;return i=!i&&X.isArray(o)?o.length:i,c?(X.hasOwnProp(o,i)?o[i]=[o[i],n]:o[i]=n,!l):((!o[i]||!X.isObject(o[i]))&&(o[i]=[]),t(r,n,o[i],a)&&X.isArray(o[i])&&(o[i]=Dp(o[i])),!l)}if(X.isFormData(e)&&X.isFunction(e.entries)){const r={};return X.forEachEntry(e,(n,o)=>{t(Op(n),o,r,0)}),r}return null}function zp(e,t,r){if(X.isString(e))try{return(t||JSON.parse)(e),X.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(e)}const Wn={transitional:od,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",o=n.indexOf("application/json")>-1,a=X.isObject(t);if(a&&X.isHTMLForm(t)&&(t=new FormData(t)),X.isFormData(t))return o?JSON.stringify(ad(t)):t;if(X.isArrayBuffer(t)||X.isBuffer(t)||X.isStream(t)||X.isFile(t)||X.isBlob(t)||X.isReadableStream(t))return t;if(X.isArrayBufferView(t))return t.buffer;if(X.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let l;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Mp(t,this.formSerializer).toString();if((l=X.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return co(l?{"files[]":t}:t,c&&new c,this.formSerializer)}}return a||o?(r.setContentType("application/json",!1),zp(t)):t}],transformResponse:[function(t){const r=this.transitional||Wn.transitional,n=r&&r.forcedJSONParsing,o=this.responseType==="json";if(X.isResponse(t)||X.isReadableStream(t))return t;if(t&&X.isString(t)&&(n&&!this.responseType||o)){const i=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(t)}catch(l){if(i)throw l.name==="SyntaxError"?Ae.from(l,Ae.ERR_BAD_RESPONSE,this,null,this.response):l}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:at.classes.FormData,Blob:at.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};X.forEach(["delete","get","head","post","put","patch"],e=>{Wn.headers[e]={}});const Up=X.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Bp=e=>{const t={};let r,n,o;return e&&e.split(`
`).forEach(function(i){o=i.indexOf(":"),r=i.substring(0,o).trim().toLowerCase(),n=i.substring(o+1).trim(),!(!r||t[r]&&Up[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},Ii=Symbol("internals");function ln(e){return e&&String(e).trim().toLowerCase()}function ks(e){return e===!1||e==null?e:X.isArray(e)?e.map(ks):String(e)}function Hp(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}const Vp=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Do(e,t,r,n,o){if(X.isFunction(n))return n.call(this,t,r);if(o&&(t=r),!!X.isString(t)){if(X.isString(n))return t.indexOf(n)!==-1;if(X.isRegExp(n))return n.test(t)}}function Wp(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function qp(e,t){const r=X.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(o,a,i){return this[n].call(this,t,o,a,i)},configurable:!0})})}let ft=class{constructor(t){t&&this.set(t)}set(t,r,n){const o=this;function a(l,c,d){const u=ln(c);if(!u)throw new Error("header name must be a non-empty string");const f=X.findKey(o,u);(!f||o[f]===void 0||d===!0||d===void 0&&o[f]!==!1)&&(o[f||c]=ks(l))}const i=(l,c)=>X.forEach(l,(d,u)=>a(d,u,c));if(X.isPlainObject(t)||t instanceof this.constructor)i(t,r);else if(X.isString(t)&&(t=t.trim())&&!Vp(t))i(Bp(t),r);else if(X.isObject(t)&&X.isIterable(t)){let l={},c,d;for(const u of t){if(!X.isArray(u))throw TypeError("Object iterator must return a key-value pair");l[d=u[0]]=(c=l[d])?X.isArray(c)?[...c,u[1]]:[c,u[1]]:u[1]}i(l,r)}else t!=null&&a(r,t,n);return this}get(t,r){if(t=ln(t),t){const n=X.findKey(this,t);if(n){const o=this[n];if(!r)return o;if(r===!0)return Hp(o);if(X.isFunction(r))return r.call(this,o,n);if(X.isRegExp(r))return r.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=ln(t),t){const n=X.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||Do(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let o=!1;function a(i){if(i=ln(i),i){const l=X.findKey(n,i);l&&(!r||Do(n,n[l],l,r))&&(delete n[l],o=!0)}}return X.isArray(t)?t.forEach(a):a(t),o}clear(t){const r=Object.keys(this);let n=r.length,o=!1;for(;n--;){const a=r[n];(!t||Do(this,this[a],a,t,!0))&&(delete this[a],o=!0)}return o}normalize(t){const r=this,n={};return X.forEach(this,(o,a)=>{const i=X.findKey(n,a);if(i){r[i]=ks(o),delete r[a];return}const l=t?Wp(a):String(a).trim();l!==a&&delete r[a],r[l]=ks(o),n[l]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return X.forEach(this,(n,o)=>{n!=null&&n!==!1&&(r[o]=t&&X.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(o=>n.set(o)),n}static accessor(t){const n=(this[Ii]=this[Ii]={accessors:{}}).accessors,o=this.prototype;function a(i){const l=ln(i);n[l]||(qp(o,i),n[l]=!0)}return X.isArray(t)?t.forEach(a):a(t),this}};ft.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);X.reduceDescriptors(ft.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[r]=n}}});X.freezeMethods(ft);function zo(e,t){const r=this||Wn,n=t||r,o=ft.from(n.headers);let a=n.data;return X.forEach(e,function(l){a=l.call(r,a,o.normalize(),t?t.status:void 0)}),o.normalize(),a}function id(e){return!!(e&&e.__CANCEL__)}function nn(e,t,r){Ae.call(this,e??"canceled",Ae.ERR_CANCELED,t,r),this.name="CanceledError"}X.inherits(nn,Ae,{__CANCEL__:!0});function ld(e,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new Ae("Request failed with status code "+r.status,[Ae.ERR_BAD_REQUEST,Ae.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function Kp(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function Yp(e,t){e=e||10;const r=new Array(e),n=new Array(e);let o=0,a=0,i;return t=t!==void 0?t:1e3,function(c){const d=Date.now(),u=n[a];i||(i=d),r[o]=c,n[o]=d;let f=a,g=0;for(;f!==o;)g+=r[f++],f=f%e;if(o=(o+1)%e,o===a&&(a=(a+1)%e),d-i<t)return;const p=u&&d-u;return p?Math.round(g*1e3/p):void 0}}function Xp(e,t){let r=0,n=1e3/t,o,a;const i=(d,u=Date.now())=>{r=u,o=null,a&&(clearTimeout(a),a=null),e.apply(null,d)};return[(...d)=>{const u=Date.now(),f=u-r;f>=n?i(d,u):(o=d,a||(a=setTimeout(()=>{a=null,i(o)},n-f)))},()=>o&&i(o)]}const Ls=(e,t,r=3)=>{let n=0;const o=Yp(50,250);return Xp(a=>{const i=a.loaded,l=a.lengthComputable?a.total:void 0,c=i-n,d=o(c),u=i<=l;n=i;const f={loaded:i,total:l,progress:l?i/l:void 0,bytes:c,rate:d||void 0,estimated:d&&l&&u?(l-i)/d:void 0,event:a,lengthComputable:l!=null,[t?"download":"upload"]:!0};e(f)},r)},Mi=(e,t)=>{const r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},Oi=e=>(...t)=>X.asap(()=>e(...t)),Jp=at.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,at.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(at.origin),at.navigator&&/(msie|trident)/i.test(at.navigator.userAgent)):()=>!0,Zp=at.hasStandardBrowserEnv?{write(e,t,r,n,o,a){const i=[e+"="+encodeURIComponent(t)];X.isNumber(r)&&i.push("expires="+new Date(r).toGMTString()),X.isString(n)&&i.push("path="+n),X.isString(o)&&i.push("domain="+o),a===!0&&i.push("secure"),document.cookie=i.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Gp(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Qp(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function cd(e,t,r){let n=!Gp(t);return e&&(n||r==!1)?Qp(e,t):t}const Di=e=>e instanceof ft?{...e}:e;function Nr(e,t){t=t||{};const r={};function n(d,u,f,g){return X.isPlainObject(d)&&X.isPlainObject(u)?X.merge.call({caseless:g},d,u):X.isPlainObject(u)?X.merge({},u):X.isArray(u)?u.slice():u}function o(d,u,f,g){if(X.isUndefined(u)){if(!X.isUndefined(d))return n(void 0,d,f,g)}else return n(d,u,f,g)}function a(d,u){if(!X.isUndefined(u))return n(void 0,u)}function i(d,u){if(X.isUndefined(u)){if(!X.isUndefined(d))return n(void 0,d)}else return n(void 0,u)}function l(d,u,f){if(f in t)return n(d,u);if(f in e)return n(void 0,d)}const c={url:a,method:a,data:a,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:l,headers:(d,u,f)=>o(Di(d),Di(u),f,!0)};return X.forEach(Object.keys(Object.assign({},e,t)),function(u){const f=c[u]||o,g=f(e[u],t[u],u);X.isUndefined(g)&&f!==l||(r[u]=g)}),r}const dd=e=>{const t=Nr({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:o,xsrfCookieName:a,headers:i,auth:l}=t;t.headers=i=ft.from(i),t.url=sd(cd(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&i.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let c;if(X.isFormData(r)){if(at.hasStandardBrowserEnv||at.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((c=i.getContentType())!==!1){const[d,...u]=c?c.split(";").map(f=>f.trim()).filter(Boolean):[];i.setContentType([d||"multipart/form-data",...u].join("; "))}}if(at.hasStandardBrowserEnv&&(n&&X.isFunction(n)&&(n=n(t)),n||n!==!1&&Jp(t.url))){const d=o&&a&&Zp.read(a);d&&i.set(o,d)}return t},eh=typeof XMLHttpRequest<"u",th=eh&&function(e){return new Promise(function(r,n){const o=dd(e);let a=o.data;const i=ft.from(o.headers).normalize();let{responseType:l,onUploadProgress:c,onDownloadProgress:d}=o,u,f,g,p,h;function w(){p&&p(),h&&h(),o.cancelToken&&o.cancelToken.unsubscribe(u),o.signal&&o.signal.removeEventListener("abort",u)}let y=new XMLHttpRequest;y.open(o.method.toUpperCase(),o.url,!0),y.timeout=o.timeout;function b(){if(!y)return;const m=ft.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),j={data:!l||l==="text"||l==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:m,config:e,request:y};ld(function(C){r(C),w()},function(C){n(C),w()},j),y=null}"onloadend"in y?y.onloadend=b:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(b)},y.onabort=function(){y&&(n(new Ae("Request aborted",Ae.ECONNABORTED,e,y)),y=null)},y.onerror=function(){n(new Ae("Network Error",Ae.ERR_NETWORK,e,y)),y=null},y.ontimeout=function(){let v=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const j=o.transitional||od;o.timeoutErrorMessage&&(v=o.timeoutErrorMessage),n(new Ae(v,j.clarifyTimeoutError?Ae.ETIMEDOUT:Ae.ECONNABORTED,e,y)),y=null},a===void 0&&i.setContentType(null),"setRequestHeader"in y&&X.forEach(i.toJSON(),function(v,j){y.setRequestHeader(j,v)}),X.isUndefined(o.withCredentials)||(y.withCredentials=!!o.withCredentials),l&&l!=="json"&&(y.responseType=o.responseType),d&&([g,h]=Ls(d,!0),y.addEventListener("progress",g)),c&&y.upload&&([f,p]=Ls(c),y.upload.addEventListener("progress",f),y.upload.addEventListener("loadend",p)),(o.cancelToken||o.signal)&&(u=m=>{y&&(n(!m||m.type?new nn(null,e,y):m),y.abort(),y=null)},o.cancelToken&&o.cancelToken.subscribe(u),o.signal&&(o.signal.aborted?u():o.signal.addEventListener("abort",u)));const S=Kp(o.url);if(S&&at.protocols.indexOf(S)===-1){n(new Ae("Unsupported protocol "+S+":",Ae.ERR_BAD_REQUEST,e));return}y.send(a||null)})},rh=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n=new AbortController,o;const a=function(d){if(!o){o=!0,l();const u=d instanceof Error?d:this.reason;n.abort(u instanceof Ae?u:new nn(u instanceof Error?u.message:u))}};let i=t&&setTimeout(()=>{i=null,a(new Ae(`timeout ${t} of ms exceeded`,Ae.ETIMEDOUT))},t);const l=()=>{e&&(i&&clearTimeout(i),i=null,e.forEach(d=>{d.unsubscribe?d.unsubscribe(a):d.removeEventListener("abort",a)}),e=null)};e.forEach(d=>d.addEventListener("abort",a));const{signal:c}=n;return c.unsubscribe=()=>X.asap(l),c}},nh=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let n=0,o;for(;n<r;)o=n+t,yield e.slice(n,o),n=o},sh=async function*(e,t){for await(const r of oh(e))yield*nh(r,t)},oh=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},zi=(e,t,r,n)=>{const o=sh(e,t);let a=0,i,l=c=>{i||(i=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:d,value:u}=await o.next();if(d){l(),c.close();return}let f=u.byteLength;if(r){let g=a+=f;r(g)}c.enqueue(new Uint8Array(u))}catch(d){throw l(d),d}},cancel(c){return l(c),o.return()}},{highWaterMark:2})},uo=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ud=uo&&typeof ReadableStream=="function",ah=uo&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),fd=(e,...t)=>{try{return!!e(...t)}catch{return!1}},ih=ud&&fd(()=>{let e=!1;const t=new Request(at.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),Ui=64*1024,va=ud&&fd(()=>X.isReadableStream(new Response("").body)),Fs={stream:va&&(e=>e.body)};uo&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Fs[t]&&(Fs[t]=X.isFunction(e[t])?r=>r[t]():(r,n)=>{throw new Ae(`Response type '${t}' is not supported`,Ae.ERR_NOT_SUPPORT,n)})})})(new Response);const lh=async e=>{if(e==null)return 0;if(X.isBlob(e))return e.size;if(X.isSpecCompliantForm(e))return(await new Request(at.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(X.isArrayBufferView(e)||X.isArrayBuffer(e))return e.byteLength;if(X.isURLSearchParams(e)&&(e=e+""),X.isString(e))return(await ah(e)).byteLength},ch=async(e,t)=>{const r=X.toFiniteNumber(e.getContentLength());return r??lh(t)},dh=uo&&(async e=>{let{url:t,method:r,data:n,signal:o,cancelToken:a,timeout:i,onDownloadProgress:l,onUploadProgress:c,responseType:d,headers:u,withCredentials:f="same-origin",fetchOptions:g}=dd(e);d=d?(d+"").toLowerCase():"text";let p=rh([o,a&&a.toAbortSignal()],i),h;const w=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let y;try{if(c&&ih&&r!=="get"&&r!=="head"&&(y=await ch(u,n))!==0){let j=new Request(t,{method:"POST",body:n,duplex:"half"}),k;if(X.isFormData(n)&&(k=j.headers.get("content-type"))&&u.setContentType(k),j.body){const[C,A]=Mi(y,Ls(Oi(c)));n=zi(j.body,Ui,C,A)}}X.isString(f)||(f=f?"include":"omit");const b="credentials"in Request.prototype;h=new Request(t,{...g,signal:p,method:r.toUpperCase(),headers:u.normalize().toJSON(),body:n,duplex:"half",credentials:b?f:void 0});let S=await fetch(h,g);const m=va&&(d==="stream"||d==="response");if(va&&(l||m&&w)){const j={};["status","statusText","headers"].forEach(T=>{j[T]=S[T]});const k=X.toFiniteNumber(S.headers.get("content-length")),[C,A]=l&&Mi(k,Ls(Oi(l),!0))||[];S=new Response(zi(S.body,Ui,C,()=>{A&&A(),w&&w()}),j)}d=d||"text";let v=await Fs[X.findKey(Fs,d)||"text"](S,e);return!m&&w&&w(),await new Promise((j,k)=>{ld(j,k,{data:v,headers:ft.from(S.headers),status:S.status,statusText:S.statusText,config:e,request:h})})}catch(b){throw w&&w(),b&&b.name==="TypeError"&&/Load failed|fetch/i.test(b.message)?Object.assign(new Ae("Network Error",Ae.ERR_NETWORK,e,h),{cause:b.cause||b}):Ae.from(b,b&&b.code,e,h)}}),ja={http:Sp,xhr:th,fetch:dh};X.forEach(ja,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const Bi=e=>`- ${e}`,uh=e=>X.isFunction(e)||e===null||e===!1,gd={getAdapter:e=>{e=X.isArray(e)?e:[e];const{length:t}=e;let r,n;const o={};for(let a=0;a<t;a++){r=e[a];let i;if(n=r,!uh(r)&&(n=ja[(i=String(r)).toLowerCase()],n===void 0))throw new Ae(`Unknown adapter '${i}'`);if(n)break;o[i||"#"+a]=n}if(!n){const a=Object.entries(o).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let i=t?a.length>1?`since :
`+a.map(Bi).join(`
`):" "+Bi(a[0]):"as no adapter specified";throw new Ae("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return n},adapters:ja};function Uo(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new nn(null,e)}function Hi(e){return Uo(e),e.headers=ft.from(e.headers),e.data=zo.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),gd.getAdapter(e.adapter||Wn.adapter)(e).then(function(n){return Uo(e),n.data=zo.call(e,e.transformResponse,n),n.headers=ft.from(n.headers),n},function(n){return id(n)||(Uo(e),n&&n.response&&(n.response.data=zo.call(e,e.transformResponse,n.response),n.response.headers=ft.from(n.response.headers))),Promise.reject(n)})}const pd="1.10.0",fo={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{fo[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const Vi={};fo.transitional=function(t,r,n){function o(a,i){return"[Axios v"+pd+"] Transitional option '"+a+"'"+i+(n?". "+n:"")}return(a,i,l)=>{if(t===!1)throw new Ae(o(i," has been removed"+(r?" in "+r:"")),Ae.ERR_DEPRECATED);return r&&!Vi[i]&&(Vi[i]=!0,console.warn(o(i," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(a,i,l):!0}};fo.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function fh(e,t,r){if(typeof e!="object")throw new Ae("options must be an object",Ae.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let o=n.length;for(;o-- >0;){const a=n[o],i=t[a];if(i){const l=e[a],c=l===void 0||i(l,a,e);if(c!==!0)throw new Ae("option "+a+" must be "+c,Ae.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Ae("Unknown option "+a,Ae.ERR_BAD_OPTION)}}const Ns={assertOptions:fh,validators:fo},$t=Ns.validators;let vr=class{constructor(t){this.defaults=t||{},this.interceptors={request:new Ri,response:new Ri}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const a=o.stack?o.stack.replace(/^.+\n/,""):"";try{n.stack?a&&!String(n.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+a):n.stack=a}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=Nr(this.defaults,r);const{transitional:n,paramsSerializer:o,headers:a}=r;n!==void 0&&Ns.assertOptions(n,{silentJSONParsing:$t.transitional($t.boolean),forcedJSONParsing:$t.transitional($t.boolean),clarifyTimeoutError:$t.transitional($t.boolean)},!1),o!=null&&(X.isFunction(o)?r.paramsSerializer={serialize:o}:Ns.assertOptions(o,{encode:$t.function,serialize:$t.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Ns.assertOptions(r,{baseUrl:$t.spelling("baseURL"),withXsrfToken:$t.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let i=a&&X.merge(a.common,a[r.method]);a&&X.forEach(["delete","get","head","post","put","patch","common"],h=>{delete a[h]}),r.headers=ft.concat(i,a);const l=[];let c=!0;this.interceptors.request.forEach(function(w){typeof w.runWhen=="function"&&w.runWhen(r)===!1||(c=c&&w.synchronous,l.unshift(w.fulfilled,w.rejected))});const d=[];this.interceptors.response.forEach(function(w){d.push(w.fulfilled,w.rejected)});let u,f=0,g;if(!c){const h=[Hi.bind(this),void 0];for(h.unshift.apply(h,l),h.push.apply(h,d),g=h.length,u=Promise.resolve(r);f<g;)u=u.then(h[f++],h[f++]);return u}g=l.length;let p=r;for(f=0;f<g;){const h=l[f++],w=l[f++];try{p=h(p)}catch(y){w.call(this,y);break}}try{u=Hi.call(this,p)}catch(h){return Promise.reject(h)}for(f=0,g=d.length;f<g;)u=u.then(d[f++],d[f++]);return u}getUri(t){t=Nr(this.defaults,t);const r=cd(t.baseURL,t.url,t.allowAbsoluteUrls);return sd(r,t.params,t.paramsSerializer)}};X.forEach(["delete","get","head","options"],function(t){vr.prototype[t]=function(r,n){return this.request(Nr(n||{},{method:t,url:r,data:(n||{}).data}))}});X.forEach(["post","put","patch"],function(t){function r(n){return function(a,i,l){return this.request(Nr(l||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:a,data:i}))}}vr.prototype[t]=r(),vr.prototype[t+"Form"]=r(!0)});let gh=class hd{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(a){r=a});const n=this;this.promise.then(o=>{if(!n._listeners)return;let a=n._listeners.length;for(;a-- >0;)n._listeners[a](o);n._listeners=null}),this.promise.then=o=>{let a;const i=new Promise(l=>{n.subscribe(l),a=l}).then(o);return i.cancel=function(){n.unsubscribe(a)},i},t(function(a,i,l){n.reason||(n.reason=new nn(a,i,l),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new hd(function(o){t=o}),cancel:t}}};function ph(e){return function(r){return e.apply(null,r)}}function hh(e){return X.isObject(e)&&e.isAxiosError===!0}const ka={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ka).forEach(([e,t])=>{ka[t]=e});function md(e){const t=new vr(e),r=qc(vr.prototype.request,t);return X.extend(r,vr.prototype,t,{allOwnKeys:!0}),X.extend(r,t,null,{allOwnKeys:!0}),r.create=function(o){return md(Nr(e,o))},r}const Be=md(Wn);Be.Axios=vr;Be.CanceledError=nn;Be.CancelToken=gh;Be.isCancel=id;Be.VERSION=pd;Be.toFormData=co;Be.AxiosError=Ae;Be.Cancel=Be.CanceledError;Be.all=function(t){return Promise.all(t)};Be.spread=ph;Be.isAxiosError=hh;Be.mergeConfig=Nr;Be.AxiosHeaders=ft;Be.formToJSON=e=>ad(X.isHTMLForm(e)?new FormData(e):e);Be.getAdapter=gd.getAdapter;Be.HttpStatusCode=ka;Be.default=Be;const{Axios:ek,AxiosError:tk,CanceledError:rk,isCancel:nk,CancelToken:sk,VERSION:ok,all:ak,Cancel:ik,isAxiosError:lk,spread:ck,toFormData:dk,AxiosHeaders:uk,HttpStatusCode:fk,formToJSON:gk,getAdapter:pk,mergeConfig:hk}=Be;class mh{cache={};apiUrl="/translation";async translate(t,r,n="auto"){const o=`${t}_${n}_${r}`;if(this.cache[o])return this.cache[o];try{const i=(await Be.post(`${this.apiUrl}/translate`,{text:t,target_language:r,source_language:n})).data.translation;return this.cache[o]=i,i}catch(a){return console.warn("Translation failed:",a),t}}clearCache(){this.cache={}}}const xh=new mh,gt=()=>{const{i18n:e}=Dg(),[t,r]=x.useState({}),[n,o]=x.useState(new Set),[a,i]=x.useState(!1),l=x.useRef(new Set);return x.useEffect(()=>{e.isInitialized?i(!0):e.on("initialized",()=>{i(!0)})},[e]),x.useEffect(()=>{if(!a||l.current.size===0)return;const u=Array.from(l.current);l.current.clear(),u.forEach(f=>{o(h=>new Set(h).add(f));const[g,p]=f.split("___");xh.translate(g,p,"en").then(h=>{r(w=>({...w,[f]:h})),o(w=>{const y=new Set(w);return y.delete(f),y})}).catch(h=>{r(w=>({...w,[f]:g})),o(w=>{const y=new Set(w);return y.delete(f),y})})})},[a,t,n]),{t:u=>{if(!a)return u;const f=e.language;if(f==="en"||f==="en-US"||f==="it"||f.startsWith("it"))return u;const g=`${u}___${f}`;return t[g]?t[g]:(n.has(g)||l.current.add(g),u)},i18n:e,changeLanguage:u=>{e.changeLanguage(u),r({}),o(new Set)},currentLanguage:e.language,isReady:a,isLoading:n.size>0}},xd=x.createContext(void 0),nt=()=>{const e=x.useContext(xd);if(e===void 0)throw new Error("useTheme must be used within a ThemeProvider");return e},yh=({children:e})=>{const[t,r]=x.useState(()=>{const a=localStorage.getItem("darkMode");return a!==null?JSON.parse(a):window.matchMedia("(prefers-color-scheme: dark)").matches}),n=()=>{r(a=>!a)};x.useEffect(()=>{t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("darkMode",JSON.stringify(t))},[t]);const o={darkMode:t,toggleDarkMode:n,setDarkMode:r};return s.jsx(xd.Provider,{value:o,children:e})},yd=x.createContext(void 0),it=()=>{const e=x.useContext(yd);if(e===void 0)throw new Error("useUI must be used within a UIProvider");return e},bh=({children:e})=>{const{darkMode:t,toggleDarkMode:r}=nt(),{t:n}=gt(),f={darkMode:t,toggleDarkMode:r,t:n,getBaseClasses:()=>`transition-all duration-200 ${t?"dark":""}`,getCardClasses:()=>"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-850 rounded-lg shadow-sm dark:shadow-gray-900/50 hover:shadow-md dark:hover:shadow-gray-900/70 transition-all duration-200",getInputClasses:()=>"px-4 py-2 bg-white dark:bg-gray-900 text-gray-900 dark:text-white rounded-lg border border-gray-300 dark:border-gray-800 focus:border-blue-500 dark:focus:border-blue-600 focus:outline-none placeholder-gray-500 dark:placeholder-gray-400 transition-all duration-200",getButtonClasses:(g="primary")=>`px-4 py-2 rounded-lg font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 ${{primary:"bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 text-white focus:ring-blue-500",secondary:"bg-gray-200 hover:bg-gray-300 dark:bg-gray-850 dark:hover:bg-gray-800 text-gray-900 dark:text-white focus:ring-gray-500",success:"bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 text-white focus:ring-green-500",danger:"bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 text-white focus:ring-red-500",warning:"bg-yellow-600 hover:bg-yellow-700 dark:bg-yellow-700 dark:hover:bg-yellow-800 text-white focus:ring-yellow-500",ghost:"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-850 focus:ring-gray-500"}[g]}`,getBadgeClasses:(g="primary")=>`inline-flex items-center px-2.5 py-1 text-sm font-medium rounded-full transition-all duration-200 ${{primary:t?"bg-blue-600 text-white hover:bg-blue-700":"bg-blue-100 text-blue-800 hover:bg-blue-200",secondary:t?"bg-gray-600 text-white hover:bg-gray-700":"bg-gray-100 text-gray-800 hover:bg-gray-200",success:t?"bg-green-600 text-white hover:bg-green-700":"bg-green-100 text-green-800 hover:bg-green-200",danger:t?"bg-red-600 text-white hover:bg-red-700":"bg-red-100 text-red-800 hover:bg-red-200",warning:t?"bg-yellow-600 text-white hover:bg-yellow-700":"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",info:t?"bg-cyan-600 text-white hover:bg-cyan-700":"bg-cyan-100 text-cyan-800 hover:bg-cyan-200"}[g]}`,getTextClasses:(g="primary")=>({primary:"text-gray-900 dark:text-white",secondary:"text-gray-700 dark:text-gray-300",muted:"text-gray-500 dark:text-gray-400"})[g],getBorderClasses:()=>"border-gray-200 dark:border-gray-850"};return s.jsx(yd.Provider,{value:f,children:e})},ve=({children:e,variant:t="primary",size:r="base",weight:n="normal",className:o="",translate:a=!0,as:i="span"})=>{const{getTextClasses:l,t:c}=it(),d={xs:"text-xs",sm:"text-sm",base:"text-base",lg:"text-lg",xl:"text-xl","2xl":"text-2xl","3xl":"text-3xl"},u={normal:"font-normal",medium:"font-medium",semibold:"font-semibold",bold:"font-bold"},g=`${l(t)} ${d[r]} ${u[n]} ${o}`,p=a&&typeof e=="string"?c(e):e;return s.jsx(i,{className:g,children:p})},$s=({children:e,variant:t="primary",size:r="md",className:n="",translate:o=!0})=>{const{getBadgeClasses:a,t:i}=it(),l={sm:"px-2 py-1 text-xs",md:"px-2.5 py-1 text-sm",lg:"px-3 py-1.5 text-base"},d=`${a(t)} ${l[r]} ${n}`.replace("px-2.5 py-1 text-sm",l[r]),u=o&&typeof e=="string"?i(e):e;return s.jsx("span",{className:d,children:u})},Qe=({children:e,variant:t="primary",size:r="md",className:n="",onClick:o,disabled:a=!1,type:i="button",translate:l=!0})=>{const{getButtonClasses:c,t:d}=it(),u={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"},f=c(t),g=a?"opacity-50 cursor-not-allowed":"",p=`${f} ${u[r]} ${g} ${n}`.replace("px-4 py-2",u[r]),h=l&&typeof e=="string"?d(e):e;return s.jsx("button",{className:p,onClick:o,disabled:a,type:i,children:h})},wh=({label:e,type:t="text",placeholder:r,value:n,onChange:o,className:a="",disabled:i=!1,required:l=!1,error:c,helper:d,translate:u=!0})=>{const{getInputClasses:f,getTextClasses:g,t:p}=it(),b=`${f()} ${i?"opacity-50 cursor-not-allowed":""} ${c?"border-red-500 focus:ring-red-500":""} ${a}`,S=u&&r?p(r):r,m=u&&e?p(e):e,v=u&&c?p(c):c,j=u&&d?p(d):d;return s.jsxs("div",{className:"w-full",children:[e&&s.jsx("label",{className:`block text-sm font-medium mb-1 ${g("primary")}`,children:m}),s.jsx("input",{type:t,placeholder:S,value:n,onChange:o,className:b,disabled:i,required:l}),c&&s.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:v}),d&&!c&&s.jsx("p",{className:`mt-1 text-sm ${g("muted")}`,children:j})]})},rr=({children:e,variant:t="primary",size:r="md",className:n="",translate:o=!0})=>{const{darkMode:a}=nt(),{t:i}=gt(),l="inline-flex items-center font-medium rounded-full transition-all duration-200",c={sm:"px-2 py-1 text-xs",md:"px-2.5 py-1 text-sm",lg:"px-3 py-1.5 text-base"},d={primary:a?"bg-blue-600 text-white hover:bg-blue-700":"bg-blue-100 text-blue-800 hover:bg-blue-200",success:a?"bg-green-600 text-white hover:bg-green-700":"bg-green-100 text-green-800 hover:bg-green-200",warning:a?"bg-yellow-600 text-white hover:bg-yellow-700":"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",danger:a?"bg-red-600 text-white hover:bg-red-700":"bg-red-100 text-red-800 hover:bg-red-200",info:a?"bg-cyan-600 text-white hover:bg-cyan-700":"bg-cyan-100 text-cyan-800 hover:bg-cyan-200",secondary:a?"bg-gray-600 text-white hover:bg-gray-700":"bg-gray-100 text-gray-800 hover:bg-gray-200"},u=`${l} ${c[r]} ${d[t]} ${n}`,f=o&&typeof e=="string"?i(e):e;return s.jsx("span",{className:u,children:f})},Ne=Be.create({baseURL:"/api",timeout:6e4,headers:{"Content-Type":"application/json"}}),Qa=Be.create({timeout:6e4,headers:{"Content-Type":"application/json"}}),bd=e=>{const t=sessionStorage.getItem("access_token")||localStorage.getItem("access_token")||localStorage.getItem("auth-token");return t&&(e.headers.Authorization=`Bearer ${t}`),e};Ne.interceptors.request.use(bd,e=>Promise.reject(e));Qa.interceptors.request.use(bd,e=>Promise.reject(e));const wd=e=>(e.response?.status===401&&(localStorage.removeItem("auth-token"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),sessionStorage.removeItem("access_token"),sessionStorage.removeItem("refresh_token"),sessionStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e));Ne.interceptors.response.use(e=>e,wd);Qa.interceptors.response.use(e=>e,wd);const je={get:(e,t)=>Ne.get(e,t),post:(e,t,r)=>Ne.post(e,t,r),put:(e,t,r)=>Ne.put(e,t,r),patch:(e,t,r)=>Ne.patch(e,t,r),delete:(e,t)=>Ne.delete(e,t),workflows:{create:e=>Ne.post("/workflow/create",e),list:(e={})=>Ne.post("/workflow/list",e),update:e=>Ne.post("/workflow/update",e),delete:e=>Ne.post("/workflow/delete",{workflow_id:e}),execute:(e,t={})=>Ne.post(`/workflow/${e}/execute`,t),executeV3:(e,t={})=>Qa.post(`/V3_EXECUTION/${e}/execute`,t),resume:(e,t)=>Ne.post("/workflow/resume",{execution_id:e,form_data:t}),submitUserInput:(e,t)=>Ne.post(`/workflow/executions/${e}/submit-input`,{user_values:t}),uploadFile:(e,t)=>Ne.post(`/workflows/${e}/upload-file`,t,{headers:{"Content-Type":"multipart/form-data"}}),uploadMultipleFiles:(e,t)=>Ne.post(`/workflows/${e}/upload-multiple-files`,t,{headers:{"Content-Type":"multipart/form-data"}}),listExecutions:(e={})=>Ne.post("/workflow/executions/list",e),getExecution:e=>Ne.get(`/workflow/executions/${e}`),getExecutionLogs:e=>Ne.get(`/workflow/executions/${e}/logs`),cancelExecution:(e,t)=>Ne.post(`/workflow/executions/${e}/cancel`,{reason:t}),getFieldMapping:(e,t)=>Ne.get(`/workflows/${e}/nodes/${encodeURIComponent(t)}/field-mapping`),upsertFieldMapping:(e,t,r)=>Ne.put(`/workflows/${e}/nodes/${encodeURIComponent(t)}/field-mapping`,{sources:r}),deleteFieldMapping:(e,t)=>Ne.delete(`/workflows/${e}/nodes/${encodeURIComponent(t)}/field-mapping`),getPropagationCandidates:(e,t)=>Ne.get(`/workflows/${e}/nodes/${encodeURIComponent(t)}/propagation-candidates`)},forms:{create:e=>Ne.post("/forms/create",e),list:(e={})=>Ne.post("/forms/list",e),get:e=>Ne.get(`/forms/${e}`),update:e=>Ne.post("/forms/update",e),delete:e=>Ne.post("/forms/delete",{form_id:e}),listAll:()=>Ne.get("/forms/list_all"),getConfig:e=>Ne.get(`/forms/config/${e}`),getFormSchema:e=>Ne.get(`/forms/${e}/schema`),getAvailableFields:()=>Ne.get("/forms/available_fields"),createCustom:e=>Ne.post("/forms/create_custom",e),updateCustom:e=>Ne.post("/forms/update_custom",e),submit:(e,t)=>Ne.post(`/forms/${e}/submit`,{form_data:t})},users:{create:e=>Ne.post("/users/",e),list:(e={})=>Ne.post("/users/list",e),update:e=>Ne.put(`/users/${e.user_id}`,e),delete:e=>Ne.delete(`/users/${e}`)},health:()=>Ne.get("/health")},vh=({isMobile:e})=>{const{t,i18n:r}=gt(),{darkMode:n}=nt(),{getCardClasses:o}=it();if(he.useEffect(()=>{r.language!=="it"&&r.changeLanguage("it")},[r]),r.language!=="it")return s.jsx("div",{className:"p-8 text-center text-lg",children:"Caricamento traduzioni..."});const[a,i]=x.useState([]),[l,c]=x.useState([]),[d,u]=x.useState(!0),[f,g]=x.useState(null),[p,h]=x.useState(1),[w,y]=x.useState(1),[b,S]=x.useState(1),[m,v]=x.useState(1),[j,k]=x.useState(!1),[C,A]=x.useState(null),[T,O]=x.useState(null),[$,D]=x.useState("users"),M=10,[N,L]=x.useState(""),F=x.useRef(L);F.current=L;const _=async()=>{try{u(!0),console.log("🔍 Fetching regular users with search term:",N);const E=await je.users.list();let Q=[];E.data&&Array.isArray(E.data)?Q=E.data:E.data&&E.data.users&&(Q=E.data.users);const re=Q.filter(ue=>ue.role!=="designer"),ce=N.trim()?re.filter(ue=>ue.username.toLowerCase().includes(N.toLowerCase())||ue.email.toLowerCase().includes(N.toLowerCase())||ue.first_name.toLowerCase().includes(N.toLowerCase())||ue.last_name.toLowerCase().includes(N.toLowerCase())||ue.role.toLowerCase().includes(N.toLowerCase())):re;i(ce),y(Math.ceil(ce.length/M)),console.log(`✅ Loaded ${ce.length} regular users`),g(null)}catch(E){console.error("❌ Error loading users:",E);const Q=E&&typeof E=="object"&&"message"in E?E.message:JSON.stringify(E);g("Failed to load users: "+Q),i([])}finally{u(!1)}},I=async()=>{try{u(!0),console.log("🔍 Fetching designers");const E=await je.users.list();let Q=[];E.data&&Array.isArray(E.data)?Q=E.data:E.data&&E.data.users&&(Q=E.data.users);const re=Q.filter(ue=>ue.role==="designer"),ce=N.trim()?re.filter(ue=>ue.username.toLowerCase().includes(N.toLowerCase())||ue.email.toLowerCase().includes(N.toLowerCase())||ue.first_name.toLowerCase().includes(N.toLowerCase())||ue.last_name.toLowerCase().includes(N.toLowerCase())):re;c(ce),v(Math.ceil(ce.length/M)),console.log(`✅ Loaded ${ce.length} designers`),g(null)}catch(E){console.error("❌ Error loading designers:",E);const Q=E&&typeof E=="object"&&"message"in E?E.message:JSON.stringify(E);g("Failed to load designers: "+Q),c([])}finally{u(!1)}};x.useEffect(()=>{const E=setTimeout(()=>{$==="users"?_():I()},300);return()=>clearTimeout(E)},[N,p,b,$]);const R=async E=>{try{await je.users.delete(Number(E)),_(),I(),console.log("✅ User deleted via API")}catch(Q){console.error("API Error:",Q),g(Q?.response?.data?.detail||Q?.message||"Failed to delete user")}},B=(E,Q)=>{O(Q),E.dataTransfer.effectAllowed="move"},H=E=>{E.preventDefault(),E.dataTransfer.dropEffect="move"},ie=(E,Q)=>{if(E.preventDefault(),T===null||T===Q)return;const re=[...a],ce=re.findIndex(fe=>fe.id===T),ue=re.findIndex(fe=>fe.id===Q);if(ce!==-1&&ue!==-1){const[fe]=re.splice(ce,1);re.splice(ue,0,fe),i(re),console.log("✅ User order updated")}O(null)},ge=()=>{O(null)},ee=async E=>{try{C?(await je.users.update({...E,user_id:C.id}),console.log("✅ User updated successfully")):(await je.users.create(E),console.log("✅ User created successfully")),_(),I(),k(!1),A(null),g(null)}catch(Q){console.error("Failed to save user:",Q),g("Failed to save user")}};if(d&&a.length===0)return s.jsx("div",{className:"p-6 bg-gray-50 dark:bg-gray-950 min-h-screen text-gray-900 dark:text-white",children:s.jsxs("div",{className:"animate-pulse",children:[s.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),s.jsx("div",{className:"space-y-3",children:[...Array(4)].map((E,Q)=>s.jsx("div",{className:"h-20 bg-gray-200 rounded"},Q))})]})});if(f)return s.jsx("div",{className:"p-6 bg-gray-50 dark:bg-gray-950 min-h-screen text-red-600 dark:text-red-400",children:f});const J=$==="users"?a:l,G=$==="users"?p:b,oe=$==="users"?w:m,te=$==="users"?h:S;return s.jsxs("div",{className:o()+" p-8",children:[s.jsx(ve,{as:"h1",variant:"primary",size:"3xl",weight:"bold",className:"text-purple-700 dark:text-purple-400 mb-4",children:t("Users")}),s.jsxs("div",{className:"flex gap-2 mb-4 border-b border-gray-300 dark:border-gray-700",children:[s.jsxs("button",{onClick:()=>D("users"),className:`px-4 py-2 font-semibold transition-colors ${$==="users"?"text-purple-700 dark:text-purple-400 border-b-2 border-purple-700 dark:border-purple-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,children:["👤 ",t("Users")," (",a.length,")"]}),s.jsxs("button",{onClick:()=>D("designers"),className:`px-4 py-2 font-semibold transition-colors ${$==="designers"?"text-purple-700 dark:text-purple-400 border-b-2 border-purple-700 dark:border-purple-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,children:["✨ ",t("Designers")," (",l.length,")"]})]}),s.jsxs("div",{className:"relative mb-4",children:[s.jsx("input",{type:"text",value:N,onChange:E=>L(E.target.value),placeholder:t("Search users..."),className:"w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 placeholder-gray-500 dark:placeholder-gray-400 transition-colors"}),s.jsx("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500 w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),N&&s.jsx("button",{onClick:()=>L(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 transition-colors",type:"button",children:"✕"})]}),s.jsxs("button",{onClick:()=>{A(null),k(!0)},className:"bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700 text-white rounded-md px-4 py-2 mb-4 transition-colors flex items-center gap-2",children:[s.jsx("span",{children:"➕"})," ",t("Crea utente")]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full mb-4 bg-white dark:bg-gray-900 border dark:border-gray-850 rounded-lg shadow-sm dark:shadow-gray-900/50",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-purple-100 dark:bg-purple-950/40 border-b dark:border-gray-850",children:[s.jsx("th",{className:"py-2 px-4 text-left text-purple-800 dark:text-purple-200",children:t("Email")}),s.jsx("th",{className:"py-2 px-4 text-left text-purple-800 dark:text-purple-200",children:t("Nome")}),s.jsx("th",{className:"py-2 px-4 text-left text-purple-800 dark:text-purple-200",children:t("Cognome")}),s.jsx("th",{className:"py-2 px-4 text-left text-purple-800 dark:text-purple-200",children:t("Ruolo")}),s.jsx("th",{className:"py-2 px-4 text-left text-purple-800 dark:text-purple-200",children:t("Azioni")})]})}),s.jsx("tbody",{children:J.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:6,className:"text-center py-4 text-gray-500 dark:text-gray-400",children:t($==="users"?"Nessun utente trovato.":"Nessun designer trovato.")})}):J.map(E=>s.jsxs("tr",{draggable:!0,onDragStart:Q=>B(Q,E.id),onDragOver:H,onDrop:Q=>ie(Q,E.id),onDragEnd:ge,className:"cursor-move border-b border-gray-200 dark:border-gray-850 hover:bg-gray-50 dark:hover:bg-gray-850 transition-colors",children:[s.jsx("td",{className:"py-2 px-4 text-gray-900 dark:text-white",children:E.email}),s.jsx("td",{className:"py-2 px-4 text-gray-900 dark:text-white",children:E.first_name}),s.jsx("td",{className:"py-2 px-4 text-gray-900 dark:text-white",children:E.last_name}),s.jsx("td",{className:"py-2 px-4 text-gray-900 dark:text-white",children:E.role}),s.jsxs("td",{className:"py-2 px-4 flex gap-2",children:[s.jsxs("button",{onClick:()=>{A(E),k(!0)},className:"bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 text-white rounded-md px-2 py-1 flex items-center gap-1 transition-colors",title:t("Modifica"),children:[s.jsx("span",{role:"img","aria-label":"modifica",children:"✏️"})," ",t("Modifica")]}),s.jsxs("button",{onClick:()=>R(E.id),className:"bg-red-500 hover:bg-red-600 text-white rounded-md px-2 py-1 flex items-center gap-1 transition-colors",title:t("Cancella"),children:[s.jsx("span",{role:"img","aria-label":"cancella",children:"🗑️"})," ",t("Cancella")]})]})]},E.id))})]})}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("button",{disabled:G===1,onClick:()=>te(E=>Math.max(E-1,1)),className:"bg-purple-500 hover:bg-purple-600 disabled:bg-gray-300 disabled:dark:bg-gray-600 text-white rounded-md px-4 py-2 transition-colors",children:t("Prev")}),s.jsxs("span",{className:"text-gray-900 dark:text-white",children:[t("Page")," ",G," ",t("of")," ",oe]}),s.jsx("button",{disabled:G===oe,onClick:()=>te(E=>Math.min(E+1,oe)),className:"bg-purple-500 hover:bg-purple-600 disabled:bg-gray-300 disabled:dark:bg-gray-600 text-white rounded-md px-4 py-2 transition-colors",children:t("Next")})]}),j&&s.jsx("div",{className:"fixed inset-0 bg-gray-900 dark:bg-black bg-opacity-50 dark:bg-opacity-80 flex justify-center items-center z-50",children:s.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg p-6 w-96 border border-gray-200 dark:border-gray-800 shadow-2xl dark:shadow-gray-950/90",children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsx("h2",{className:"text-xl text-gray-900 dark:text-white",children:t(C?"Edit User":"Add User")})}),s.jsxs("form",{onSubmit:E=>{E.preventDefault();const Q=E.target,re={username:Q.username?.value||"",email:Q.email.value,first_name:Q.first_name.value,last_name:Q.last_name.value,role:Q.role.value};C?re.id=C.id:re.password=Q.password?.value||"",ee(re)},children:[["username","email","first_name","last_name","role"].map(E=>s.jsx("input",{name:E,type:E==="email"?"email":"text",defaultValue:C?.[E]||"",placeholder:t(E.replace("_"," ")),className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-md p-2 mb-2 w-full placeholder-gray-500 dark:placeholder-gray-400",required:!0},E)),!C&&s.jsx("input",{name:"password",type:"password",placeholder:t("Password (min 8 caratteri)"),className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-md p-2 mb-2 w-full placeholder-gray-500 dark:placeholder-gray-400",required:!0,minLength:8}),s.jsxs("div",{className:"flex justify-end",children:[s.jsx("button",{type:"submit",className:"bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded transition-colors",children:t(C?"Update":"Create")}),s.jsx("button",{type:"button",onClick:()=>k(!1),className:"bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 ml-2 rounded transition-colors",children:t("Cancel")})]})]})]})})]})};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jh=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),kh=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,n)=>n?n.toUpperCase():r.toLowerCase()),Wi=e=>{const t=kh(e);return t.charAt(0).toUpperCase()+t.slice(1)},vd=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim(),Nh=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Sh={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ch=x.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:o="",children:a,iconNode:i,...l},c)=>x.createElement("svg",{ref:c,...Sh,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:vd("lucide",o),...!a&&!Nh(l)&&{"aria-hidden":"true"},...l},[...i.map(([d,u])=>x.createElement(d,u)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=(e,t)=>{const r=x.forwardRef(({className:n,...o},a)=>x.createElement(Ch,{ref:a,iconNode:t,className:vd(`lucide-${jh(Wi(e))}`,`lucide-${e}`,n),...o}));return r.displayName=Wi(e),r};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _h=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ht=pt("circle-alert",_h);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eh=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],jd=pt("circle-check-big",Eh);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Th=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],kd=pt("circle-x",Th);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ah=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],cn=pt("clock",Ah);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ph=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],qi=pt("eye",Ph);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lh=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Fh=pt("file-text",Lh);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $h=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Rh=pt("info",$h);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ih=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],Mh=pt("moon",Ih);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oh=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],Ki=pt("play",Oh);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dh=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Yi=pt("search",Dh);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zh=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Uh=pt("settings",zh);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bh=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Hh=pt("sun",Bh);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vh=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Wh=pt("users",Vh);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qh=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],Kh=pt("workflow",qh),Yh=({isMobile:e})=>{const{t,i18n:r,isReady:n}=gt(),{getCardClasses:o}=it(),[a,i]=he.useState(!1);if(he.useEffect(()=>{let c=!1;r.language!=="it"&&!a&&(i(!0),r.changeLanguage("it"),c=!0);const d=u=>{u==="it"&&i(!1)};return r.on("languageChanged",d),()=>{c&&r.off("languageChanged",d)}},[r,a]),!n||r.language!=="it"||a)return s.jsx("div",{className:"p-8 text-center text-lg",children:"Caricamento traduzioni..."});const l=[{id:"1",title:"Create User",description:"Add new user to system",icon:s.jsx(Wh,{className:"w-6 h-6"}),action:"/users",variant:"primary"},{id:"2",title:"New Workflow",description:"Design workflow process",icon:s.jsx(Kh,{className:"w-6 h-6"}),action:"/workflows",variant:"success"},{id:"3",title:"Create Form",description:"Build dynamic form",icon:s.jsx(Fh,{className:"w-6 h-6"}),action:"/forms",variant:"secondary"},{id:"4",title:"System Settings",description:"Configure platform",icon:s.jsx(Uh,{className:"w-6 h-6"}),action:"/settings",variant:"warning"}];return s.jsxs("div",{className:e?"p-2 space-y-4 bg-gray-50 dark:bg-gray-950 min-h-[calc(100vh-48px)]":"p-4 md:p-6 space-y-6 bg-gray-50 dark:bg-gray-950 min-h-[calc(100vh-64px)]",children:[s.jsx("div",{className:e?"flex items-center space-x-2 mb-4":"flex items-center space-x-4 mb-8",children:s.jsx(ve,{as:"h1",variant:"primary",size:e?"xl":"3xl",weight:"bold",className:"text-purple-700 dark:text-purple-400",children:t("Dashboard")})}),s.jsx("div",{className:o(),children:s.jsxs("div",{className:e?"p-3":"p-6",children:[s.jsx(ve,{as:"h3",variant:"primary",size:e?"lg":"xl",weight:"semibold",className:e?"mb-3":"mb-6",children:t("Quick Actions")}),s.jsx("div",{className:e?"grid grid-cols-1 gap-2":"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:l.map(c=>s.jsxs(Qe,{variant:c.variant,size:e?"md":"lg",className:e?"h-auto p-2 flex flex-col items-start text-left space-y-1":"h-auto p-4 flex flex-col items-start text-left space-y-2",onClick:()=>window.location.href=c.action,children:[s.jsx("div",{className:e?"text-xl mb-1":"text-2xl mb-2",children:c.icon}),s.jsx(ve,{variant:"primary",weight:"semibold",size:e?"xs":"sm",children:t(c.title)}),s.jsx(ve,{variant:"secondary",size:"xs",children:t(c.description)})]},c.id))})]})})]})},Nd=x.createContext(void 0),Sd=({children:e})=>{const[t,r]=x.useState(!1);return s.jsx(Nd.Provider,{value:{collapsed:t,setCollapsed:r},children:e})},Cd=()=>{const e=x.useContext(Nd);if(!e)throw new Error("useSidebar must be used within a SidebarProvider");return e};var _d={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Xi=he.createContext&&he.createContext(_d),Xh=["attr","size","title"];function Jh(e,t){if(e==null)return{};var r=Zh(e,t),n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Zh(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Rs(){return Rs=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Rs.apply(this,arguments)}function Ji(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Is(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ji(Object(r),!0).forEach(function(n){Gh(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ji(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gh(e,t,r){return t=Qh(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qh(e){var t=em(e,"string");return typeof t=="symbol"?t:t+""}function em(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ed(e){return e&&e.map((t,r)=>he.createElement(t.tag,Is({key:r},t.attr),Ed(t.child)))}function Gt(e){return t=>he.createElement(tm,Rs({attr:Is({},e.attr)},t),Ed(e.child))}function tm(e){var t=r=>{var{attr:n,size:o,title:a}=e,i=Jh(e,Xh),l=o||r.size||"1em",c;return r.className&&(c=r.className),e.className&&(c=(c?c+" ":"")+e.className),he.createElement("svg",Rs({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,n,i,{className:c,style:Is(Is({color:e.color||r.color},r.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),a&&he.createElement("title",null,a),e.children)};return Xi!==void 0?he.createElement(Xi.Consumer,null,r=>t(r)):t(_d)}function Td(e){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"},child:[]}]})(e)}function Ad(e){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"},child:[]}]})(e)}function Pd(e){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM96 424c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm0-96c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm0-96c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm96-192c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm128 368c0 4.4-3.6 8-8 8H168c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-96c0 4.4-3.6 8-8 8H168c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-96c0 4.4-3.6 8-8 8H168c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16z"},child:[]}]})(e)}function Ld(e){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(e)}function Fd(e){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M512.1 191l-8.2 14.3c-3 5.3-9.4 7.5-15.1 5.4-11.8-4.4-22.6-10.7-32.1-18.6-4.6-3.8-5.8-10.5-2.8-15.7l8.2-14.3c-6.9-8-12.3-17.3-15.9-27.4h-16.5c-6 0-11.2-4.3-12.2-10.3-2-12-2.1-24.6 0-37.1 1-6 6.2-10.4 12.2-10.4h16.5c3.6-10.1 9-19.4 15.9-27.4l-8.2-14.3c-3-5.2-1.9-11.9 2.8-15.7 9.5-7.9 20.4-14.2 32.1-18.6 5.7-2.1 12.1.1 15.1 5.4l8.2 14.3c10.5-1.9 21.2-1.9 31.7 0L552 6.3c3-5.3 9.4-7.5 15.1-5.4 11.8 4.4 22.6 10.7 32.1 18.6 4.6 3.8 5.8 10.5 2.8 15.7l-8.2 14.3c6.9 8 12.3 17.3 15.9 27.4h16.5c6 0 11.2 4.3 12.2 10.3 2 12 2.1 24.6 0 37.1-1 6-6.2 10.4-12.2 10.4h-16.5c-3.6 10.1-9 19.4-15.9 27.4l8.2 14.3c3 5.2 1.9 11.9-2.8 15.7-9.5 7.9-20.4 14.2-32.1 18.6-5.7 2.1-12.1-.1-15.1-5.4l-8.2-14.3c-10.4 1.9-21.2 1.9-31.7 0zm-10.5-58.8c38.5 29.6 82.4-14.3 52.8-52.8-38.5-29.7-82.4 14.3-52.8 52.8zM386.3 286.1l33.7 16.8c10.1 5.8 14.5 18.1 10.5 29.1-8.9 24.2-26.4 46.4-42.6 65.8-7.4 8.9-20.2 11.1-30.3 5.3l-29.1-16.8c-16 13.7-34.6 24.6-54.9 31.7v33.6c0 11.6-8.3 21.6-19.7 23.6-24.6 4.2-50.4 4.4-75.9 0-11.5-2-20-11.9-20-23.6V418c-20.3-7.2-38.9-18-54.9-31.7L74 403c-10 5.8-22.9 3.6-30.3-5.3-16.2-19.4-33.3-41.6-42.2-65.7-4-10.9.4-23.2 10.5-29.1l33.3-16.8c-3.9-20.9-3.9-42.4 0-63.4L12 205.8c-10.1-5.8-14.6-18.1-10.5-29 8.9-24.2 26-46.4 42.2-65.8 7.4-8.9 20.2-11.1 30.3-5.3l29.1 16.8c16-13.7 34.6-24.6 54.9-31.7V57.1c0-11.5 8.2-21.5 19.6-23.5 24.6-4.2 50.5-4.4 76-.1 11.5 2 20 11.9 20 23.6v33.6c20.3 7.2 38.9 18 54.9 31.7l29.1-16.8c10-5.8 22.9-3.6 30.3 5.3 16.2 19.4 33.2 41.6 42.1 65.8 4 10.9.1 23.2-10 29.1l-33.7 16.8c3.9 21 3.9 42.5 0 63.5zm-117.6 21.1c59.2-77-28.7-164.9-105.7-105.7-59.2 77 28.7 164.9 105.7 105.7zm243.4 182.7l-8.2 14.3c-3 5.3-9.4 7.5-15.1 5.4-11.8-4.4-22.6-10.7-32.1-18.6-4.6-3.8-5.8-10.5-2.8-15.7l8.2-14.3c-6.9-8-12.3-17.3-15.9-27.4h-16.5c-6 0-11.2-4.3-12.2-10.3-2-12-2.1-24.6 0-37.1 1-6 6.2-10.4 12.2-10.4h16.5c3.6-10.1 9-19.4 15.9-27.4l-8.2-14.3c-3-5.2-1.9-11.9 2.8-15.7 9.5-7.9 20.4-14.2 32.1-18.6 5.7-2.1 12.1.1 15.1 5.4l8.2 14.3c10.5-1.9 21.2-1.9 31.7 0l8.2-14.3c3-5.3 9.4-7.5 15.1-5.4 11.8 4.4 22.6 10.7 32.1 18.6 4.6 3.8 5.8 10.5 2.8 15.7l-8.2 14.3c6.9 8 12.3 17.3 15.9 27.4h16.5c6 0 11.2 4.3 12.2 10.3 2 12 2.1 24.6 0 37.1-1 6-6.2 10.4-12.2 10.4h-16.5c-3.6 10.1-9 19.4-15.9 27.4l8.2 14.3c3 5.2 1.9 11.9-2.8 15.7-9.5 7.9-20.4 14.2-32.1 18.6-5.7 2.1-12.1-.1-15.1-5.4l-8.2-14.3c-10.4 1.9-21.2 1.9-31.7 0zM501.6 431c38.5 29.6 82.4-14.3 52.8-52.8-38.5-29.6-82.4 14.3-52.8 52.8z"},child:[]}]})(e)}function $d(e){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(e)}function Na(e){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M336 0H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zM144 32h96c8.8 0 16 7.2 16 16s-7.2 16-16 16h-96c-8.8 0-16-7.2-16-16s7.2-16 16-16zm48 128c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm112 236.8c0 10.6-10 19.2-22.4 19.2H102.4C90 416 80 407.4 80 396.8v-19.2c0-31.8 30.1-57.6 67.2-57.6h5c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h5c37.1 0 67.2 25.8 67.2 57.6v19.2z"},child:[]}]})(e)}function Sa(e){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"},child:[]}]})(e)}function Ca(e){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(e)}const rm=({isMobile:e})=>{const t=Hn(),{t:r,i18n:n}=gt(),{darkMode:o}=nt(),{collapsed:a,setCollapsed:i}=Cd();i(!0),he.useEffect(()=>{n.language!=="it"&&n.changeLanguage("it")},[n]);const l=()=>{const p=sessionStorage.getItem("user")||localStorage.getItem("user");if(!p)return!1;try{const h=JSON.parse(p);return h.role==="designer"||h.role==="amministratore"}catch{return!1}},c=[{label:r("Dashboard"),path:"/",icon:s.jsx($d,{})},{label:r("Users"),path:"/users",icon:s.jsx(Ca,{})},{label:r("Workflows"),path:"/workflows",icon:s.jsx(Fd,{})},{label:s.jsxs("span",{children:["Esecuzione",s.jsx("br",{}),"Flussi di Lavoro"]}),path:"/workflow-execution",icon:s.jsx(Sa,{})},{label:r("Forms"),path:"/forms",icon:s.jsx(Pd,{})},{label:r("Settings"),path:"/settings",icon:s.jsx(Ld,{})},{label:r("Profile"),path:"/profile",icon:s.jsx(Na,{})}],d=[{label:r("Users"),path:"/users",icon:s.jsx(Ca,{})},{label:s.jsxs("span",{children:["Esecuzione",s.jsx("br",{}),"Flussi di Lavoro"]}),path:"/workflow-execution",icon:s.jsx(Sa,{})},{label:r("Profile"),path:"/profile",icon:s.jsx(Na,{})}],u=l()?c:d,[f,g]=he.useState(!1);return e?s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"fixed top-3 left-3 z-50 bg-purple-700 text-white rounded p-2 shadow-lg md:hidden",onClick:()=>g(!0),"aria-label":"Apri menu",children:s.jsxs("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),s.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),s.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}),f&&s.jsxs("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-40 flex",children:[s.jsxs("div",{className:"w-64 bg-purple-700 dark:bg-purple-800 h-full p-4 flex flex-col animate-slideInLeft relative",children:[s.jsx("button",{className:"absolute top-2 right-2 text-white text-2xl",onClick:()=>g(!1),"aria-label":"Chiudi menu",children:"×"}),s.jsx("nav",{className:"flex flex-col gap-2 mt-8",children:u.map(({label:p,path:h,icon:w})=>{const y=t.pathname===h;return s.jsxs(Kt,{to:h,className:`flex items-center rounded-md transition whitespace-nowrap
                        ${y?"bg-purple-500 text-white shadow-lg":"text-purple-100 hover:bg-purple-600 hover:text-white"}
                        gap-3 px-3 py-2
                      `,style:{minWidth:0,overflow:"hidden"},onClick:()=>g(!1),children:[s.jsx("span",{className:"text-lg",children:w}),s.jsx("span",{className:"font-medium",children:p})]},h)})}),s.jsx("div",{className:"flex-grow"}),s.jsx("div",{className:"text-center text-xs text-purple-200 mt-4",children:"Secure Portal v1.0"})]}),s.jsx("div",{className:"flex-1",onClick:()=>g(!1)})]})]}):s.jsxs("div",{className:`transition-all duration-200 h-full bg-purple-700 dark:bg-purple-800 p-4 flex flex-col ${a?"w-16":"w-64"}`,style:{minWidth:a?64:256},children:[s.jsx("button",{className:"mb-4 flex items-center justify-center w-8 h-8 rounded hover:bg-purple-600 text-white self-end",onClick:()=>i(!a),"aria-label":r(a?"Espandi sidebar":"Comprimi sidebar"),children:a?s.jsx(Ad,{}):s.jsx(Td,{})}),s.jsx("nav",{className:"flex flex-col gap-2",children:u.map(({label:p,path:h,icon:w})=>{const y=t.pathname===h;return s.jsxs(Kt,{to:h,className:`flex items-center rounded-md transition whitespace-nowrap
                ${y?"bg-purple-500 text-white shadow-lg":"text-purple-100 hover:bg-purple-600 hover:text-white"}
                ${a?"justify-center px-1 py-2 gap-0":"gap-3 px-3 py-2"}
              `,style:{minWidth:0,overflow:"hidden"},children:[s.jsx("span",{className:"text-lg",children:w}),!a&&s.jsx("span",{className:"font-medium",children:p})]},h)})}),s.jsx("div",{className:"flex-grow"}),s.jsx("div",{className:`text-center text-xs text-purple-200 mt-4 ${a?"hidden":""}`,children:"Secure Portal v1.0"})]})},Rd=x.createContext(null),Id=()=>{const e=x.useContext(Rd);if(!e)throw new Error("useAuth must be used within AuthProvider");return e},nm=({children:e})=>{const[t,r]=x.useState(null),[n,o]=x.useState(!0),[a,i]=x.useState(!1),l="access_token",c="refresh_token",d="user",u=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user")},f=()=>{sessionStorage.removeItem(l),sessionStorage.removeItem(c),sessionStorage.removeItem(d)};x.useEffect(()=>{u();const m=(typeof performance<"u"&&"getEntriesByType"in performance?performance.getEntriesByType("navigation"):[])[0]?.type||"navigate";if(!!!sessionStorage.getItem(l)){f(),r(null),i(!1),o(!1);return}if(m!=="reload"){f(),r(null),i(!1),o(!1);return}g()},[]);const g=async()=>{if(!sessionStorage.getItem(l)){o(!1),i(!1);return}try{const m=await Ne.get("/auth/me");r(m.data),i(!0),sessionStorage.setItem(d,JSON.stringify(m.data))}catch(m){console.error("Auth check failed:",m),f(),u(),r(null),i(!1)}finally{o(!1)}},b={user:t,loading:n,isAuthenticated:a,isDesigner:()=>t?.role==="designer",login:async(S,m)=>{const v=await Ne.post("/auth/login",{email:S,password:m}),{access_token:j,refresh_token:k,user:C}=v.data;return u(),sessionStorage.setItem(l,j),k&&sessionStorage.setItem(c,k),sessionStorage.setItem(d,JSON.stringify(C)),r(C),i(!0),C},logout:async()=>{try{await Ne.post("/auth/logout")}catch(S){console.error("Logout error:",S)}finally{f(),u(),r(null),i(!1)}},register:async S=>(await Ne.post("/auth/register",S)).data,checkAuth:g};return s.jsx(Rd.Provider,{value:b,children:e})},or=({isMobile:e})=>{const{darkMode:t,toggleDarkMode:r}=nt(),{t:n,i18n:o}=gt(),{user:a,logout:i,isDesigner:l}=Id(),c=Pt(),d=Hn(),[u,f]=he.useState(!1);he.useEffect(()=>{o.language!=="it"&&o.changeLanguage("it")},[o]);const g=async()=>{await i(),c("/login")},p=[{label:"Dashboard",path:"/dashboard",icon:he.createElement($d)},{label:"Users",path:"/users",icon:he.createElement(Ca)},{label:"Workflows",path:"/workflows",icon:he.createElement(Fd)},{label:"Esecuzione Workflows",path:"/workflow-execution",icon:he.createElement(Sa)},{label:"Forms",path:"/forms",icon:he.createElement(Pd)},{label:"Settings",path:"/settings",icon:he.createElement(Ld)},{label:"Profile",path:"/profile",icon:he.createElement(Na)}],h=t?"/dark_logo.png":"/logoGT.png";return he.createElement("header",{className:"bg-white dark:bg-gray-950 shadow-lg dark:shadow-gray-900/50 border-b dark:border-gray-850"},he.createElement("div",{className:`flex justify-between items-center ${e?"px-3 py-2 min-h-[48px]":"px-8 py-3"}`},he.createElement("span",{className:`flex items-center space-x-2 font-semibold ${e?"text-base":"text-lg"} text-gray-800 dark:text-gray-100`},he.createElement("img",{src:h,alt:"GT Logo",className:e?"h-6 w-6":"h-8 w-8"}),he.createElement("span",{className:e?"text-lg font-bold":"text-2xl font-bold"},"Secure Portal")),!e&&he.createElement("nav",{className:"flex items-center gap-1 flex-1 justify-center mx-4"},p.map(({label:w,path:y,icon:b})=>{const S=d.pathname===y||y==="/dashboard"&&d.pathname==="/";return he.createElement(Kt,{key:y,to:y,className:`flex items-center gap-2 px-3 py-2 rounded-md transition text-sm font-medium whitespace-nowrap ${S?"bg-purple-600 text-white shadow-md":"text-gray-700 dark:text-gray-300 hover:bg-purple-100 dark:hover:bg-gray-850 hover:text-purple-700 dark:hover:text-purple-400"}`},he.createElement("span",{className:"text-base"},b),he.createElement("span",null,w))})),he.createElement("div",{className:e?"flex items-center gap-2":"flex items-center gap-4"},he.createElement("label",{className:"flex items-center cursor-pointer"},he.createElement("div",{className:"relative"},he.createElement("input",{type:"checkbox",className:"sr-only",checked:t,onChange:r}),he.createElement("div",{className:e?"block w-8 h-5 bg-gray-300 rounded-full dark:bg-gray-850":"block w-10 h-6 bg-gray-300 rounded-full dark:bg-gray-850"}),he.createElement("div",{className:`dot absolute left-1 top-1 bg-white dark:bg-gray-300 rounded-full transition ${e?"w-3 h-3":"w-4 h-4"} ${t?e?"translate-x-3":"translate-x-4":""}`})),he.createElement("span",{className:e?"ml-2 text-xs text-gray-700 dark:text-gray-200":"ml-3 text-gray-700 dark:text-gray-200"},t?"Dark":"Light")),!e&&a&&he.createElement("div",{className:"flex items-center gap-2"},he.createElement("span",{className:"text-sm text-gray-700 dark:text-gray-200"},`${a.first_name} ${a.last_name}`),l()&&he.createElement("span",{className:"px-2 py-1 text-xs font-semibold text-white bg-purple-600 rounded"},"Designer")),he.createElement(Kt,{to:"/profile",className:"flex items-center focus:outline-none",title:n("Profile")},he.createElement("img",{src:a?.avatar||"/pic.jpg",alt:"User profile",className:e?"h-7 w-7 rounded-full object-cover border-2 border-gray-300 dark:border-gray-800 hover:border-purple-600 dark:hover:border-purple-500 transition cursor-pointer":"h-9 w-9 rounded-full object-cover border-2 border-gray-300 dark:border-gray-800 hover:border-purple-600 dark:hover:border-purple-500 transition cursor-pointer",onError:w=>w.currentTarget.src="/default-profile.png"})),!e&&a&&he.createElement("button",{onClick:g,className:"px-3 py-1 text-sm text-white bg-red-600 hover:bg-red-700 rounded transition",title:"Logout"},"Logout"),e&&he.createElement("button",{onClick:()=>f(!u),className:"p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-850 rounded-md","aria-label":"Toggle menu"},he.createElement("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},he.createElement("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),he.createElement("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),he.createElement("line",{x1:"3",y1:"18",x2:"21",y2:"18"}))))),e&&u&&he.createElement("div",{className:"border-t border-gray-200 dark:border-gray-850 bg-white dark:bg-gray-950 px-3 py-2"},he.createElement("nav",{className:"flex flex-col gap-1"},p.map(({label:w,path:y,icon:b})=>{const S=d.pathname===y||y==="/dashboard"&&d.pathname==="/";return he.createElement(Kt,{key:y,to:y,onClick:()=>f(!1),className:`flex items-center gap-3 px-3 py-2 rounded-md transition text-sm font-medium ${S?"bg-purple-600 text-white shadow-md":"text-gray-700 dark:text-gray-300 hover:bg-purple-100 dark:hover:bg-gray-850"}`},he.createElement("span",{className:"text-base"},b),he.createElement("span",null,w))}),he.createElement("div",{className:"border-t border-gray-200 dark:border-gray-850 my-2"}),a&&he.createElement("div",{className:"px-3 py-2 text-sm text-gray-700 dark:text-gray-200"},he.createElement("div",{className:"font-medium"},`${a.first_name} ${a.last_name}`),l()&&he.createElement("span",{className:"inline-block mt-1 px-2 py-1 text-xs font-semibold text-white bg-purple-600 rounded"},"Designer")),a&&he.createElement("button",{onClick:()=>{f(!1),g()},className:"w-full text-left px-3 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded transition"},"Logout"))))},sm=()=>{const e=Hn();return x.useEffect(()=>{},[e.pathname]),{safeNavigate:(r,n,o)=>{r(n,o)}}},om=({children:e})=>(sm(),s.jsx(Sd,{children:s.jsxs("div",{className:"flex min-h-screen w-full bg-gray-50 dark:bg-gray-950",children:[s.jsx(rm,{}),s.jsx(am,{children:e})]})})),am=({children:e})=>{const{collapsed:t}=Cd();return s.jsxs("div",{className:"flex-1 min-h-screen transition-all duration-200",style:{marginLeft:t?64:256},children:[s.jsx(or,{}),s.jsx("main",{className:"p-8 bg-gray-50 dark:bg-gray-950",children:e})]})};class Md extends he.Component{constructor(t){super(t),this.state={hasError:!1,error:void 0}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){console.error("ErrorBoundary caught an error:",t,r)}render(){return this.state.hasError?s.jsx("div",{className:"flex items-center justify-center min-h-screen bg-white dark:bg-gray-900",children:s.jsxs("div",{className:"text-center max-w-md",children:[s.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),s.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Qualcosa è andato storto"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Si è verificato un errore imprevisto. Torna alla pagina principale."}),this.state.error&&!1,s.jsx("button",{onClick:()=>window.location.href="/",className:"mt-4 px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition",children:"Torna alla Home"})]})}):this.props.children}}const gr=({requireDesigner:e=!1,children:t})=>{if(!(sessionStorage.getItem("access_token")||localStorage.getItem("access_token")))return s.jsx(ss,{to:"/login",replace:!0});if(e){const n=sessionStorage.getItem("user")||localStorage.getItem("user");if(!n)return s.jsx(ss,{to:"/login",replace:!0});try{const o=JSON.parse(n);if(!(o.role==="designer"||o.role==="amministratore"))return s.jsx(ss,{to:"/workflow-execution",replace:!0})}catch{return s.jsx(ss,{to:"/login",replace:!0})}}return s.jsx(s.Fragment,{children:t})};function Ze(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let r=0,n;r<e.length;r++)(n=Ze(e[r]))!==""&&(t+=(t&&" ")+n);else for(let r in e)e[r]&&(t+=(t&&" ")+r);return t}var im={value:()=>{}};function go(){for(var e=0,t=arguments.length,r={},n;e<t;++e){if(!(n=arguments[e]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new Ss(r)}function Ss(e){this._=e}function lm(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",o=r.indexOf(".");if(o>=0&&(n=r.slice(o+1),r=r.slice(0,o)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}Ss.prototype=go.prototype={constructor:Ss,on:function(e,t){var r=this._,n=lm(e+"",r),o,a=-1,i=n.length;if(arguments.length<2){for(;++a<i;)if((o=(e=n[a]).type)&&(o=cm(r[o],e.name)))return o;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++a<i;)if(o=(e=n[a]).type)r[o]=Zi(r[o],e.name,t);else if(t==null)for(o in r)r[o]=Zi(r[o],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new Ss(e)},call:function(e,t){if((o=arguments.length-2)>0)for(var r=new Array(o),n=0,o,a;n<o;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],n=0,o=a.length;n<o;++n)a[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],o=0,a=n.length;o<a;++o)n[o].value.apply(t,r)}};function cm(e,t){for(var r=0,n=e.length,o;r<n;++r)if((o=e[r]).name===t)return o.value}function Zi(e,t,r){for(var n=0,o=e.length;n<o;++n)if(e[n].name===t){e[n]=im,e=e.slice(0,n).concat(e.slice(n+1));break}return r!=null&&e.push({name:t,value:r}),e}var _a="http://www.w3.org/1999/xhtml";const Gi={svg:"http://www.w3.org/2000/svg",xhtml:_a,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function po(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),Gi.hasOwnProperty(t)?{space:Gi[t],local:e}:e}function dm(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===_a&&t.documentElement.namespaceURI===_a?t.createElement(e):t.createElementNS(r,e)}}function um(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Od(e){var t=po(e);return(t.local?um:dm)(t)}function fm(){}function ei(e){return e==null?fm:function(){return this.querySelector(e)}}function gm(e){typeof e!="function"&&(e=ei(e));for(var t=this._groups,r=t.length,n=new Array(r),o=0;o<r;++o)for(var a=t[o],i=a.length,l=n[o]=new Array(i),c,d,u=0;u<i;++u)(c=a[u])&&(d=e.call(c,c.__data__,u,a))&&("__data__"in c&&(d.__data__=c.__data__),l[u]=d);return new xt(n,this._parents)}function pm(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function hm(){return[]}function Dd(e){return e==null?hm:function(){return this.querySelectorAll(e)}}function mm(e){return function(){return pm(e.apply(this,arguments))}}function xm(e){typeof e=="function"?e=mm(e):e=Dd(e);for(var t=this._groups,r=t.length,n=[],o=[],a=0;a<r;++a)for(var i=t[a],l=i.length,c,d=0;d<l;++d)(c=i[d])&&(n.push(e.call(c,c.__data__,d,i)),o.push(c));return new xt(n,o)}function zd(e){return function(){return this.matches(e)}}function Ud(e){return function(t){return t.matches(e)}}var ym=Array.prototype.find;function bm(e){return function(){return ym.call(this.children,e)}}function wm(){return this.firstElementChild}function vm(e){return this.select(e==null?wm:bm(typeof e=="function"?e:Ud(e)))}var jm=Array.prototype.filter;function km(){return Array.from(this.children)}function Nm(e){return function(){return jm.call(this.children,e)}}function Sm(e){return this.selectAll(e==null?km:Nm(typeof e=="function"?e:Ud(e)))}function Cm(e){typeof e!="function"&&(e=zd(e));for(var t=this._groups,r=t.length,n=new Array(r),o=0;o<r;++o)for(var a=t[o],i=a.length,l=n[o]=[],c,d=0;d<i;++d)(c=a[d])&&e.call(c,c.__data__,d,a)&&l.push(c);return new xt(n,this._parents)}function Bd(e){return new Array(e.length)}function _m(){return new xt(this._enter||this._groups.map(Bd),this._parents)}function Ms(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Ms.prototype={constructor:Ms,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Em(e){return function(){return e}}function Tm(e,t,r,n,o,a){for(var i=0,l,c=t.length,d=a.length;i<d;++i)(l=t[i])?(l.__data__=a[i],n[i]=l):r[i]=new Ms(e,a[i]);for(;i<c;++i)(l=t[i])&&(o[i]=l)}function Am(e,t,r,n,o,a,i){var l,c,d=new Map,u=t.length,f=a.length,g=new Array(u),p;for(l=0;l<u;++l)(c=t[l])&&(g[l]=p=i.call(c,c.__data__,l,t)+"",d.has(p)?o[l]=c:d.set(p,c));for(l=0;l<f;++l)p=i.call(e,a[l],l,a)+"",(c=d.get(p))?(n[l]=c,c.__data__=a[l],d.delete(p)):r[l]=new Ms(e,a[l]);for(l=0;l<u;++l)(c=t[l])&&d.get(g[l])===c&&(o[l]=c)}function Pm(e){return e.__data__}function Lm(e,t){if(!arguments.length)return Array.from(this,Pm);var r=t?Am:Tm,n=this._parents,o=this._groups;typeof e!="function"&&(e=Em(e));for(var a=o.length,i=new Array(a),l=new Array(a),c=new Array(a),d=0;d<a;++d){var u=n[d],f=o[d],g=f.length,p=Fm(e.call(u,u&&u.__data__,d,n)),h=p.length,w=l[d]=new Array(h),y=i[d]=new Array(h),b=c[d]=new Array(g);r(u,f,w,y,b,p,t);for(var S=0,m=0,v,j;S<h;++S)if(v=w[S]){for(S>=m&&(m=S+1);!(j=y[m])&&++m<h;);v._next=j||null}}return i=new xt(i,n),i._enter=l,i._exit=c,i}function Fm(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function $m(){return new xt(this._exit||this._groups.map(Bd),this._parents)}function Rm(e,t,r){var n=this.enter(),o=this,a=this.exit();return typeof e=="function"?(n=e(n),n&&(n=n.selection())):n=n.append(e+""),t!=null&&(o=t(o),o&&(o=o.selection())),r==null?a.remove():r(a),n&&o?n.merge(o).order():o}function Im(e){for(var t=e.selection?e.selection():e,r=this._groups,n=t._groups,o=r.length,a=n.length,i=Math.min(o,a),l=new Array(o),c=0;c<i;++c)for(var d=r[c],u=n[c],f=d.length,g=l[c]=new Array(f),p,h=0;h<f;++h)(p=d[h]||u[h])&&(g[h]=p);for(;c<o;++c)l[c]=r[c];return new xt(l,this._parents)}function Mm(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],o=n.length-1,a=n[o],i;--o>=0;)(i=n[o])&&(a&&i.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(i,a),a=i);return this}function Om(e){e||(e=Dm);function t(f,g){return f&&g?e(f.__data__,g.__data__):!f-!g}for(var r=this._groups,n=r.length,o=new Array(n),a=0;a<n;++a){for(var i=r[a],l=i.length,c=o[a]=new Array(l),d,u=0;u<l;++u)(d=i[u])&&(c[u]=d);c.sort(t)}return new xt(o,this._parents).order()}function Dm(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function zm(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Um(){return Array.from(this)}function Bm(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],o=0,a=n.length;o<a;++o){var i=n[o];if(i)return i}return null}function Hm(){let e=0;for(const t of this)++e;return e}function Vm(){return!this.node()}function Wm(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var o=t[r],a=0,i=o.length,l;a<i;++a)(l=o[a])&&e.call(l,l.__data__,a,o);return this}function qm(e){return function(){this.removeAttribute(e)}}function Km(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ym(e,t){return function(){this.setAttribute(e,t)}}function Xm(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Jm(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function Zm(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function Gm(e,t){var r=po(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?Km:qm:typeof t=="function"?r.local?Zm:Jm:r.local?Xm:Ym)(r,t))}function Hd(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Qm(e){return function(){this.style.removeProperty(e)}}function e0(e,t,r){return function(){this.style.setProperty(e,t,r)}}function t0(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function r0(e,t,r){return arguments.length>1?this.each((t==null?Qm:typeof t=="function"?t0:e0)(e,t,r??"")):Wr(this.node(),e)}function Wr(e,t){return e.style.getPropertyValue(t)||Hd(e).getComputedStyle(e,null).getPropertyValue(t)}function n0(e){return function(){delete this[e]}}function s0(e,t){return function(){this[e]=t}}function o0(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function a0(e,t){return arguments.length>1?this.each((t==null?n0:typeof t=="function"?o0:s0)(e,t)):this.node()[e]}function Vd(e){return e.trim().split(/^|\s+/)}function ti(e){return e.classList||new Wd(e)}function Wd(e){this._node=e,this._names=Vd(e.getAttribute("class")||"")}Wd.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function qd(e,t){for(var r=ti(e),n=-1,o=t.length;++n<o;)r.add(t[n])}function Kd(e,t){for(var r=ti(e),n=-1,o=t.length;++n<o;)r.remove(t[n])}function i0(e){return function(){qd(this,e)}}function l0(e){return function(){Kd(this,e)}}function c0(e,t){return function(){(t.apply(this,arguments)?qd:Kd)(this,e)}}function d0(e,t){var r=Vd(e+"");if(arguments.length<2){for(var n=ti(this.node()),o=-1,a=r.length;++o<a;)if(!n.contains(r[o]))return!1;return!0}return this.each((typeof t=="function"?c0:t?i0:l0)(r,t))}function u0(){this.textContent=""}function f0(e){return function(){this.textContent=e}}function g0(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function p0(e){return arguments.length?this.each(e==null?u0:(typeof e=="function"?g0:f0)(e)):this.node().textContent}function h0(){this.innerHTML=""}function m0(e){return function(){this.innerHTML=e}}function x0(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function y0(e){return arguments.length?this.each(e==null?h0:(typeof e=="function"?x0:m0)(e)):this.node().innerHTML}function b0(){this.nextSibling&&this.parentNode.appendChild(this)}function w0(){return this.each(b0)}function v0(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function j0(){return this.each(v0)}function k0(e){var t=typeof e=="function"?e:Od(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function N0(){return null}function S0(e,t){var r=typeof e=="function"?e:Od(e),n=t==null?N0:typeof t=="function"?t:ei(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}function C0(){var e=this.parentNode;e&&e.removeChild(this)}function _0(){return this.each(C0)}function E0(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function T0(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function A0(e){return this.select(e?T0:E0)}function P0(e){return arguments.length?this.property("__data__",e):this.node().__data__}function L0(e){return function(t){e.call(this,t,this.__data__)}}function F0(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function $0(e){return function(){var t=this.__on;if(t){for(var r=0,n=-1,o=t.length,a;r<o;++r)a=t[r],(!e.type||a.type===e.type)&&a.name===e.name?this.removeEventListener(a.type,a.listener,a.options):t[++n]=a;++n?t.length=n:delete this.__on}}}function R0(e,t,r){return function(){var n=this.__on,o,a=L0(t);if(n){for(var i=0,l=n.length;i<l;++i)if((o=n[i]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=a,o.options=r),o.value=t;return}}this.addEventListener(e.type,a,r),o={type:e.type,name:e.name,value:t,listener:a,options:r},n?n.push(o):this.__on=[o]}}function I0(e,t,r){var n=F0(e+""),o,a=n.length,i;if(arguments.length<2){var l=this.node().__on;if(l){for(var c=0,d=l.length,u;c<d;++c)for(o=0,u=l[c];o<a;++o)if((i=n[o]).type===u.type&&i.name===u.name)return u.value}return}for(l=t?R0:$0,o=0;o<a;++o)this.each(l(n[o],t,r));return this}function Yd(e,t,r){var n=Hd(e),o=n.CustomEvent;typeof o=="function"?o=new o(t,r):(o=n.document.createEvent("Event"),r?(o.initEvent(t,r.bubbles,r.cancelable),o.detail=r.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function M0(e,t){return function(){return Yd(this,e,t)}}function O0(e,t){return function(){return Yd(this,e,t.apply(this,arguments))}}function D0(e,t){return this.each((typeof t=="function"?O0:M0)(e,t))}function*z0(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],o=0,a=n.length,i;o<a;++o)(i=n[o])&&(yield i)}var Xd=[null];function xt(e,t){this._groups=e,this._parents=t}function qn(){return new xt([[document.documentElement]],Xd)}function U0(){return this}xt.prototype=qn.prototype={constructor:xt,select:gm,selectAll:xm,selectChild:vm,selectChildren:Sm,filter:Cm,data:Lm,enter:_m,exit:$m,join:Rm,merge:Im,selection:U0,order:Mm,sort:Om,call:zm,nodes:Um,node:Bm,size:Hm,empty:Vm,each:Wm,attr:Gm,style:r0,property:a0,classed:d0,text:p0,html:y0,raise:w0,lower:j0,append:k0,insert:S0,remove:_0,clone:A0,datum:P0,on:I0,dispatch:D0,[Symbol.iterator]:z0};function mt(e){return typeof e=="string"?new xt([[document.querySelector(e)]],[document.documentElement]):new xt([[e]],Xd)}function B0(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Ct(e,t){if(e=B0(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}const H0={passive:!1},Tn={capture:!0,passive:!1};function Bo(e){e.stopImmediatePropagation()}function Hr(e){e.preventDefault(),e.stopImmediatePropagation()}function Jd(e){var t=e.document.documentElement,r=mt(e).on("dragstart.drag",Hr,Tn);"onselectstart"in t?r.on("selectstart.drag",Hr,Tn):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Zd(e,t){var r=e.document.documentElement,n=mt(e).on("dragstart.drag",null);t&&(n.on("click.drag",Hr,Tn),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}const as=e=>()=>e;function Ea(e,{sourceEvent:t,subject:r,target:n,identifier:o,active:a,x:i,y:l,dx:c,dy:d,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:u}})}Ea.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function V0(e){return!e.ctrlKey&&!e.button}function W0(){return this.parentNode}function q0(e,t){return t??{x:e.x,y:e.y}}function K0(){return navigator.maxTouchPoints||"ontouchstart"in this}function Gd(){var e=V0,t=W0,r=q0,n=K0,o={},a=go("start","drag","end"),i=0,l,c,d,u,f=0;function g(v){v.on("mousedown.drag",p).filter(n).on("touchstart.drag",y).on("touchmove.drag",b,H0).on("touchend.drag touchcancel.drag",S).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(v,j){if(!(u||!e.call(this,v,j))){var k=m(this,t.call(this,v,j),v,j,"mouse");k&&(mt(v.view).on("mousemove.drag",h,Tn).on("mouseup.drag",w,Tn),Jd(v.view),Bo(v),d=!1,l=v.clientX,c=v.clientY,k("start",v))}}function h(v){if(Hr(v),!d){var j=v.clientX-l,k=v.clientY-c;d=j*j+k*k>f}o.mouse("drag",v)}function w(v){mt(v.view).on("mousemove.drag mouseup.drag",null),Zd(v.view,d),Hr(v),o.mouse("end",v)}function y(v,j){if(e.call(this,v,j)){var k=v.changedTouches,C=t.call(this,v,j),A=k.length,T,O;for(T=0;T<A;++T)(O=m(this,C,v,j,k[T].identifier,k[T]))&&(Bo(v),O("start",v,k[T]))}}function b(v){var j=v.changedTouches,k=j.length,C,A;for(C=0;C<k;++C)(A=o[j[C].identifier])&&(Hr(v),A("drag",v,j[C]))}function S(v){var j=v.changedTouches,k=j.length,C,A;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),C=0;C<k;++C)(A=o[j[C].identifier])&&(Bo(v),A("end",v,j[C]))}function m(v,j,k,C,A,T){var O=a.copy(),$=Ct(T||k,j),D,M,N;if((N=r.call(v,new Ea("beforestart",{sourceEvent:k,target:g,identifier:A,active:i,x:$[0],y:$[1],dx:0,dy:0,dispatch:O}),C))!=null)return D=N.x-$[0]||0,M=N.y-$[1]||0,function L(F,_,I){var R=$,B;switch(F){case"start":o[A]=L,B=i++;break;case"end":delete o[A],--i;case"drag":$=Ct(I||_,j),B=i;break}O.call(F,v,new Ea(F,{sourceEvent:_,subject:N,target:g,identifier:A,active:B,x:$[0]+D,y:$[1]+M,dx:$[0]-R[0],dy:$[1]-R[1],dispatch:O}),C)}}return g.filter=function(v){return arguments.length?(e=typeof v=="function"?v:as(!!v),g):e},g.container=function(v){return arguments.length?(t=typeof v=="function"?v:as(v),g):t},g.subject=function(v){return arguments.length?(r=typeof v=="function"?v:as(v),g):r},g.touchable=function(v){return arguments.length?(n=typeof v=="function"?v:as(!!v),g):n},g.on=function(){var v=a.on.apply(a,arguments);return v===a?g:v},g.clickDistance=function(v){return arguments.length?(f=(v=+v)*v,g):Math.sqrt(f)},g}function ri(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function Qd(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function Kn(){}var An=.7,Os=1/An,Vr="\\s*([+-]?\\d+)\\s*",Pn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ot="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Y0=/^#([0-9a-f]{3,8})$/,X0=new RegExp(`^rgb\\(${Vr},${Vr},${Vr}\\)$`),J0=new RegExp(`^rgb\\(${Ot},${Ot},${Ot}\\)$`),Z0=new RegExp(`^rgba\\(${Vr},${Vr},${Vr},${Pn}\\)$`),G0=new RegExp(`^rgba\\(${Ot},${Ot},${Ot},${Pn}\\)$`),Q0=new RegExp(`^hsl\\(${Pn},${Ot},${Ot}\\)$`),ex=new RegExp(`^hsla\\(${Pn},${Ot},${Ot},${Pn}\\)$`),Qi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ri(Kn,Sr,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:el,formatHex:el,formatHex8:tx,formatHsl:rx,formatRgb:tl,toString:tl});function el(){return this.rgb().formatHex()}function tx(){return this.rgb().formatHex8()}function rx(){return eu(this).formatHsl()}function tl(){return this.rgb().formatRgb()}function Sr(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=Y0.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?rl(t):r===3?new dt(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?is(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?is(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=X0.exec(e))?new dt(t[1],t[2],t[3],1):(t=J0.exec(e))?new dt(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Z0.exec(e))?is(t[1],t[2],t[3],t[4]):(t=G0.exec(e))?is(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Q0.exec(e))?ol(t[1],t[2]/100,t[3]/100,1):(t=ex.exec(e))?ol(t[1],t[2]/100,t[3]/100,t[4]):Qi.hasOwnProperty(e)?rl(Qi[e]):e==="transparent"?new dt(NaN,NaN,NaN,0):null}function rl(e){return new dt(e>>16&255,e>>8&255,e&255,1)}function is(e,t,r,n){return n<=0&&(e=t=r=NaN),new dt(e,t,r,n)}function nx(e){return e instanceof Kn||(e=Sr(e)),e?(e=e.rgb(),new dt(e.r,e.g,e.b,e.opacity)):new dt}function Ta(e,t,r,n){return arguments.length===1?nx(e):new dt(e,t,r,n??1)}function dt(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}ri(dt,Ta,Qd(Kn,{brighter(e){return e=e==null?Os:Math.pow(Os,e),new dt(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?An:Math.pow(An,e),new dt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new dt(jr(this.r),jr(this.g),jr(this.b),Ds(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:nl,formatHex:nl,formatHex8:sx,formatRgb:sl,toString:sl}));function nl(){return`#${yr(this.r)}${yr(this.g)}${yr(this.b)}`}function sx(){return`#${yr(this.r)}${yr(this.g)}${yr(this.b)}${yr((isNaN(this.opacity)?1:this.opacity)*255)}`}function sl(){const e=Ds(this.opacity);return`${e===1?"rgb(":"rgba("}${jr(this.r)}, ${jr(this.g)}, ${jr(this.b)}${e===1?")":`, ${e})`}`}function Ds(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function jr(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function yr(e){return e=jr(e),(e<16?"0":"")+e.toString(16)}function ol(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Et(e,t,r,n)}function eu(e){if(e instanceof Et)return new Et(e.h,e.s,e.l,e.opacity);if(e instanceof Kn||(e=Sr(e)),!e)return new Et;if(e instanceof Et)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,o=Math.min(t,r,n),a=Math.max(t,r,n),i=NaN,l=a-o,c=(a+o)/2;return l?(t===a?i=(r-n)/l+(r<n)*6:r===a?i=(n-t)/l+2:i=(t-r)/l+4,l/=c<.5?a+o:2-a-o,i*=60):l=c>0&&c<1?0:i,new Et(i,l,c,e.opacity)}function ox(e,t,r,n){return arguments.length===1?eu(e):new Et(e,t,r,n??1)}function Et(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}ri(Et,ox,Qd(Kn,{brighter(e){return e=e==null?Os:Math.pow(Os,e),new Et(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?An:Math.pow(An,e),new Et(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,o=2*r-n;return new dt(Ho(e>=240?e-240:e+120,o,n),Ho(e,o,n),Ho(e<120?e+240:e-120,o,n),this.opacity)},clamp(){return new Et(al(this.h),ls(this.s),ls(this.l),Ds(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Ds(this.opacity);return`${e===1?"hsl(":"hsla("}${al(this.h)}, ${ls(this.s)*100}%, ${ls(this.l)*100}%${e===1?")":`, ${e})`}`}}));function al(e){return e=(e||0)%360,e<0?e+360:e}function ls(e){return Math.max(0,Math.min(1,e||0))}function Ho(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const ni=e=>()=>e;function ax(e,t){return function(r){return e+r*t}}function ix(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function lx(e){return(e=+e)==1?tu:function(t,r){return r-t?ix(t,r,e):ni(isNaN(t)?r:t)}}function tu(e,t){var r=t-e;return r?ax(e,r):ni(isNaN(e)?t:e)}const zs=function e(t){var r=lx(t);function n(o,a){var i=r((o=Ta(o)).r,(a=Ta(a)).r),l=r(o.g,a.g),c=r(o.b,a.b),d=tu(o.opacity,a.opacity);return function(u){return o.r=i(u),o.g=l(u),o.b=c(u),o.opacity=d(u),o+""}}return n.gamma=e,n}(1);function cx(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),o;return function(a){for(o=0;o<r;++o)n[o]=e[o]*(1-a)+t[o]*a;return n}}function dx(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ux(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,o=new Array(n),a=new Array(r),i;for(i=0;i<n;++i)o[i]=wn(e[i],t[i]);for(;i<r;++i)a[i]=t[i];return function(l){for(i=0;i<n;++i)a[i]=o[i](l);return a}}function fx(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function Rt(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function gx(e,t){var r={},n={},o;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(o in t)o in e?r[o]=wn(e[o],t[o]):n[o]=t[o];return function(a){for(o in r)n[o]=r[o](a);return n}}var Aa=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Vo=new RegExp(Aa.source,"g");function px(e){return function(){return e}}function hx(e){return function(t){return e(t)+""}}function ru(e,t){var r=Aa.lastIndex=Vo.lastIndex=0,n,o,a,i=-1,l=[],c=[];for(e=e+"",t=t+"";(n=Aa.exec(e))&&(o=Vo.exec(t));)(a=o.index)>r&&(a=t.slice(r,a),l[i]?l[i]+=a:l[++i]=a),(n=n[0])===(o=o[0])?l[i]?l[i]+=o:l[++i]=o:(l[++i]=null,c.push({i,x:Rt(n,o)})),r=Vo.lastIndex;return r<t.length&&(a=t.slice(r),l[i]?l[i]+=a:l[++i]=a),l.length<2?c[0]?hx(c[0].x):px(t):(t=c.length,function(d){for(var u=0,f;u<t;++u)l[(f=c[u]).i]=f.x(d);return l.join("")})}function wn(e,t){var r=typeof t,n;return t==null||r==="boolean"?ni(t):(r==="number"?Rt:r==="string"?(n=Sr(t))?(t=n,zs):ru:t instanceof Sr?zs:t instanceof Date?fx:dx(t)?cx:Array.isArray(t)?ux:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?gx:Rt)(e,t)}var il=180/Math.PI,Pa={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function nu(e,t,r,n,o,a){var i,l,c;return(i=Math.sqrt(e*e+t*t))&&(e/=i,t/=i),(c=e*r+t*n)&&(r-=e*c,n-=t*c),(l=Math.sqrt(r*r+n*n))&&(r/=l,n/=l,c/=l),e*n<t*r&&(e=-e,t=-t,c=-c,i=-i),{translateX:o,translateY:a,rotate:Math.atan2(t,e)*il,skewX:Math.atan(c)*il,scaleX:i,scaleY:l}}var cs;function mx(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Pa:nu(t.a,t.b,t.c,t.d,t.e,t.f)}function xx(e){return e==null||(cs||(cs=document.createElementNS("http://www.w3.org/2000/svg","g")),cs.setAttribute("transform",e),!(e=cs.transform.baseVal.consolidate()))?Pa:(e=e.matrix,nu(e.a,e.b,e.c,e.d,e.e,e.f))}function su(e,t,r,n){function o(d){return d.length?d.pop()+" ":""}function a(d,u,f,g,p,h){if(d!==f||u!==g){var w=p.push("translate(",null,t,null,r);h.push({i:w-4,x:Rt(d,f)},{i:w-2,x:Rt(u,g)})}else(f||g)&&p.push("translate("+f+t+g+r)}function i(d,u,f,g){d!==u?(d-u>180?u+=360:u-d>180&&(d+=360),g.push({i:f.push(o(f)+"rotate(",null,n)-2,x:Rt(d,u)})):u&&f.push(o(f)+"rotate("+u+n)}function l(d,u,f,g){d!==u?g.push({i:f.push(o(f)+"skewX(",null,n)-2,x:Rt(d,u)}):u&&f.push(o(f)+"skewX("+u+n)}function c(d,u,f,g,p,h){if(d!==f||u!==g){var w=p.push(o(p)+"scale(",null,",",null,")");h.push({i:w-4,x:Rt(d,f)},{i:w-2,x:Rt(u,g)})}else(f!==1||g!==1)&&p.push(o(p)+"scale("+f+","+g+")")}return function(d,u){var f=[],g=[];return d=e(d),u=e(u),a(d.translateX,d.translateY,u.translateX,u.translateY,f,g),i(d.rotate,u.rotate,f,g),l(d.skewX,u.skewX,f,g),c(d.scaleX,d.scaleY,u.scaleX,u.scaleY,f,g),d=u=null,function(p){for(var h=-1,w=g.length,y;++h<w;)f[(y=g[h]).i]=y.x(p);return f.join("")}}}var yx=su(mx,"px, ","px)","deg)"),bx=su(xx,", ",")",")"),wx=1e-12;function ll(e){return((e=Math.exp(e))+1/e)/2}function vx(e){return((e=Math.exp(e))-1/e)/2}function jx(e){return((e=Math.exp(2*e))-1)/(e+1)}const Cs=function e(t,r,n){function o(a,i){var l=a[0],c=a[1],d=a[2],u=i[0],f=i[1],g=i[2],p=u-l,h=f-c,w=p*p+h*h,y,b;if(w<wx)b=Math.log(g/d)/t,y=function(C){return[l+C*p,c+C*h,d*Math.exp(t*C*b)]};else{var S=Math.sqrt(w),m=(g*g-d*d+n*w)/(2*d*r*S),v=(g*g-d*d-n*w)/(2*g*r*S),j=Math.log(Math.sqrt(m*m+1)-m),k=Math.log(Math.sqrt(v*v+1)-v);b=(k-j)/t,y=function(C){var A=C*b,T=ll(j),O=d/(r*S)*(T*jx(t*A+j)-vx(j));return[l+O*p,c+O*h,d*T/ll(t*A+j)]}}return y.duration=b*1e3*t/Math.SQRT2,y}return o.rho=function(a){var i=Math.max(.001,+a),l=i*i,c=l*l;return e(i,l,c)},o}(Math.SQRT2,2,4);var qr=0,xn=0,dn=0,ou=1e3,Us,yn,Bs=0,Cr=0,ho=0,Ln=typeof performance=="object"&&performance.now?performance:Date,au=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function si(){return Cr||(au(kx),Cr=Ln.now()+ho)}function kx(){Cr=0}function Hs(){this._call=this._time=this._next=null}Hs.prototype=iu.prototype={constructor:Hs,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?si():+r)+(t==null?0:+t),!this._next&&yn!==this&&(yn?yn._next=this:Us=this,yn=this),this._call=e,this._time=r,La()},stop:function(){this._call&&(this._call=null,this._time=1/0,La())}};function iu(e,t,r){var n=new Hs;return n.restart(e,t,r),n}function Nx(){si(),++qr;for(var e=Us,t;e;)(t=Cr-e._time)>=0&&e._call.call(void 0,t),e=e._next;--qr}function cl(){Cr=(Bs=Ln.now())+ho,qr=xn=0;try{Nx()}finally{qr=0,Cx(),Cr=0}}function Sx(){var e=Ln.now(),t=e-Bs;t>ou&&(ho-=t,Bs=e)}function Cx(){for(var e,t=Us,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:Us=r);yn=e,La(n)}function La(e){if(!qr){xn&&(xn=clearTimeout(xn));var t=e-Cr;t>24?(e<1/0&&(xn=setTimeout(cl,e-Ln.now()-ho)),dn&&(dn=clearInterval(dn))):(dn||(Bs=Ln.now(),dn=setInterval(Sx,ou)),qr=1,au(cl))}}function dl(e,t,r){var n=new Hs;return t=t==null?0:+t,n.restart(o=>{n.stop(),e(o+t)},t,r),n}var _x=go("start","end","cancel","interrupt"),Ex=[],lu=0,ul=1,Fa=2,_s=3,fl=4,$a=5,Es=6;function mo(e,t,r,n,o,a){var i=e.__transition;if(!i)e.__transition={};else if(r in i)return;Tx(e,r,{name:t,index:n,group:o,on:_x,tween:Ex,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:lu})}function oi(e,t){var r=Ft(e,t);if(r.state>lu)throw new Error("too late; already scheduled");return r}function Ut(e,t){var r=Ft(e,t);if(r.state>_s)throw new Error("too late; already running");return r}function Ft(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function Tx(e,t,r){var n=e.__transition,o;n[t]=r,r.timer=iu(a,0,r.time);function a(d){r.state=ul,r.timer.restart(i,r.delay,r.time),r.delay<=d&&i(d-r.delay)}function i(d){var u,f,g,p;if(r.state!==ul)return c();for(u in n)if(p=n[u],p.name===r.name){if(p.state===_s)return dl(i);p.state===fl?(p.state=Es,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete n[u]):+u<t&&(p.state=Es,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete n[u])}if(dl(function(){r.state===_s&&(r.state=fl,r.timer.restart(l,r.delay,r.time),l(d))}),r.state=Fa,r.on.call("start",e,e.__data__,r.index,r.group),r.state===Fa){for(r.state=_s,o=new Array(g=r.tween.length),u=0,f=-1;u<g;++u)(p=r.tween[u].value.call(e,e.__data__,r.index,r.group))&&(o[++f]=p);o.length=f+1}}function l(d){for(var u=d<r.duration?r.ease.call(null,d/r.duration):(r.timer.restart(c),r.state=$a,1),f=-1,g=o.length;++f<g;)o[f].call(e,u);r.state===$a&&(r.on.call("end",e,e.__data__,r.index,r.group),c())}function c(){r.state=Es,r.timer.stop(),delete n[t];for(var d in n)return;delete e.__transition}}function Ts(e,t){var r=e.__transition,n,o,a=!0,i;if(r){t=t==null?null:t+"";for(i in r){if((n=r[i]).name!==t){a=!1;continue}o=n.state>Fa&&n.state<$a,n.state=Es,n.timer.stop(),n.on.call(o?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[i]}a&&delete e.__transition}}function Ax(e){return this.each(function(){Ts(this,e)})}function Px(e,t){var r,n;return function(){var o=Ut(this,e),a=o.tween;if(a!==r){n=r=a;for(var i=0,l=n.length;i<l;++i)if(n[i].name===t){n=n.slice(),n.splice(i,1);break}}o.tween=n}}function Lx(e,t,r){var n,o;if(typeof r!="function")throw new Error;return function(){var a=Ut(this,e),i=a.tween;if(i!==n){o=(n=i).slice();for(var l={name:t,value:r},c=0,d=o.length;c<d;++c)if(o[c].name===t){o[c]=l;break}c===d&&o.push(l)}a.tween=o}}function Fx(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n=Ft(this.node(),r).tween,o=0,a=n.length,i;o<a;++o)if((i=n[o]).name===e)return i.value;return null}return this.each((t==null?Px:Lx)(r,e,t))}function ai(e,t,r){var n=e._id;return e.each(function(){var o=Ut(this,n);(o.value||(o.value={}))[t]=r.apply(this,arguments)}),function(o){return Ft(o,n).value[t]}}function cu(e,t){var r;return(typeof t=="number"?Rt:t instanceof Sr?zs:(r=Sr(t))?(t=r,zs):ru)(e,t)}function $x(e){return function(){this.removeAttribute(e)}}function Rx(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ix(e,t,r){var n,o=r+"",a;return function(){var i=this.getAttribute(e);return i===o?null:i===n?a:a=t(n=i,r)}}function Mx(e,t,r){var n,o=r+"",a;return function(){var i=this.getAttributeNS(e.space,e.local);return i===o?null:i===n?a:a=t(n=i,r)}}function Ox(e,t,r){var n,o,a;return function(){var i,l=r(this),c;return l==null?void this.removeAttribute(e):(i=this.getAttribute(e),c=l+"",i===c?null:i===n&&c===o?a:(o=c,a=t(n=i,l)))}}function Dx(e,t,r){var n,o,a;return function(){var i,l=r(this),c;return l==null?void this.removeAttributeNS(e.space,e.local):(i=this.getAttributeNS(e.space,e.local),c=l+"",i===c?null:i===n&&c===o?a:(o=c,a=t(n=i,l)))}}function zx(e,t){var r=po(e),n=r==="transform"?bx:cu;return this.attrTween(e,typeof t=="function"?(r.local?Dx:Ox)(r,n,ai(this,"attr."+e,t)):t==null?(r.local?Rx:$x)(r):(r.local?Mx:Ix)(r,n,t))}function Ux(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function Bx(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function Hx(e,t){var r,n;function o(){var a=t.apply(this,arguments);return a!==n&&(r=(n=a)&&Bx(e,a)),r}return o._value=t,o}function Vx(e,t){var r,n;function o(){var a=t.apply(this,arguments);return a!==n&&(r=(n=a)&&Ux(e,a)),r}return o._value=t,o}function Wx(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var n=po(e);return this.tween(r,(n.local?Hx:Vx)(n,t))}function qx(e,t){return function(){oi(this,e).delay=+t.apply(this,arguments)}}function Kx(e,t){return t=+t,function(){oi(this,e).delay=t}}function Yx(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?qx:Kx)(t,e)):Ft(this.node(),t).delay}function Xx(e,t){return function(){Ut(this,e).duration=+t.apply(this,arguments)}}function Jx(e,t){return t=+t,function(){Ut(this,e).duration=t}}function Zx(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Xx:Jx)(t,e)):Ft(this.node(),t).duration}function Gx(e,t){if(typeof t!="function")throw new Error;return function(){Ut(this,e).ease=t}}function Qx(e){var t=this._id;return arguments.length?this.each(Gx(t,e)):Ft(this.node(),t).ease}function ey(e,t){return function(){var r=t.apply(this,arguments);if(typeof r!="function")throw new Error;Ut(this,e).ease=r}}function ty(e){if(typeof e!="function")throw new Error;return this.each(ey(this._id,e))}function ry(e){typeof e!="function"&&(e=zd(e));for(var t=this._groups,r=t.length,n=new Array(r),o=0;o<r;++o)for(var a=t[o],i=a.length,l=n[o]=[],c,d=0;d<i;++d)(c=a[d])&&e.call(c,c.__data__,d,a)&&l.push(c);return new Jt(n,this._parents,this._name,this._id)}function ny(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,n=t.length,o=r.length,a=Math.min(n,o),i=new Array(n),l=0;l<a;++l)for(var c=t[l],d=r[l],u=c.length,f=i[l]=new Array(u),g,p=0;p<u;++p)(g=c[p]||d[p])&&(f[p]=g);for(;l<n;++l)i[l]=t[l];return new Jt(i,this._parents,this._name,this._id)}function sy(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function oy(e,t,r){var n,o,a=sy(t)?oi:Ut;return function(){var i=a(this,e),l=i.on;l!==n&&(o=(n=l).copy()).on(t,r),i.on=o}}function ay(e,t){var r=this._id;return arguments.length<2?Ft(this.node(),r).on.on(e):this.each(oy(r,e,t))}function iy(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function ly(){return this.on("end.remove",iy(this._id))}function cy(e){var t=this._name,r=this._id;typeof e!="function"&&(e=ei(e));for(var n=this._groups,o=n.length,a=new Array(o),i=0;i<o;++i)for(var l=n[i],c=l.length,d=a[i]=new Array(c),u,f,g=0;g<c;++g)(u=l[g])&&(f=e.call(u,u.__data__,g,l))&&("__data__"in u&&(f.__data__=u.__data__),d[g]=f,mo(d[g],t,r,g,d,Ft(u,r)));return new Jt(a,this._parents,t,r)}function dy(e){var t=this._name,r=this._id;typeof e!="function"&&(e=Dd(e));for(var n=this._groups,o=n.length,a=[],i=[],l=0;l<o;++l)for(var c=n[l],d=c.length,u,f=0;f<d;++f)if(u=c[f]){for(var g=e.call(u,u.__data__,f,c),p,h=Ft(u,r),w=0,y=g.length;w<y;++w)(p=g[w])&&mo(p,t,r,w,g,h);a.push(g),i.push(u)}return new Jt(a,i,t,r)}var uy=qn.prototype.constructor;function fy(){return new uy(this._groups,this._parents)}function gy(e,t){var r,n,o;return function(){var a=Wr(this,e),i=(this.style.removeProperty(e),Wr(this,e));return a===i?null:a===r&&i===n?o:o=t(r=a,n=i)}}function du(e){return function(){this.style.removeProperty(e)}}function py(e,t,r){var n,o=r+"",a;return function(){var i=Wr(this,e);return i===o?null:i===n?a:a=t(n=i,r)}}function hy(e,t,r){var n,o,a;return function(){var i=Wr(this,e),l=r(this),c=l+"";return l==null&&(c=l=(this.style.removeProperty(e),Wr(this,e))),i===c?null:i===n&&c===o?a:(o=c,a=t(n=i,l))}}function my(e,t){var r,n,o,a="style."+t,i="end."+a,l;return function(){var c=Ut(this,e),d=c.on,u=c.value[a]==null?l||(l=du(t)):void 0;(d!==r||o!==u)&&(n=(r=d).copy()).on(i,o=u),c.on=n}}function xy(e,t,r){var n=(e+="")=="transform"?yx:cu;return t==null?this.styleTween(e,gy(e,n)).on("end.style."+e,du(e)):typeof t=="function"?this.styleTween(e,hy(e,n,ai(this,"style."+e,t))).each(my(this._id,e)):this.styleTween(e,py(e,n,t),r).on("end.style."+e,null)}function yy(e,t,r){return function(n){this.style.setProperty(e,t.call(this,n),r)}}function by(e,t,r){var n,o;function a(){var i=t.apply(this,arguments);return i!==o&&(n=(o=i)&&yy(e,i,r)),n}return a._value=t,a}function wy(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,by(e,t,r??""))}function vy(e){return function(){this.textContent=e}}function jy(e){return function(){var t=e(this);this.textContent=t??""}}function ky(e){return this.tween("text",typeof e=="function"?jy(ai(this,"text",e)):vy(e==null?"":e+""))}function Ny(e){return function(t){this.textContent=e.call(this,t)}}function Sy(e){var t,r;function n(){var o=e.apply(this,arguments);return o!==r&&(t=(r=o)&&Ny(o)),t}return n._value=e,n}function Cy(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Sy(e))}function _y(){for(var e=this._name,t=this._id,r=uu(),n=this._groups,o=n.length,a=0;a<o;++a)for(var i=n[a],l=i.length,c,d=0;d<l;++d)if(c=i[d]){var u=Ft(c,t);mo(c,e,r,d,i,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Jt(n,this._parents,e,r)}function Ey(){var e,t,r=this,n=r._id,o=r.size();return new Promise(function(a,i){var l={value:i},c={value:function(){--o===0&&a()}};r.each(function(){var d=Ut(this,n),u=d.on;u!==e&&(t=(e=u).copy(),t._.cancel.push(l),t._.interrupt.push(l),t._.end.push(c)),d.on=t}),o===0&&a()})}var Ty=0;function Jt(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}function uu(){return++Ty}var Bt=qn.prototype;Jt.prototype={constructor:Jt,select:cy,selectAll:dy,selectChild:Bt.selectChild,selectChildren:Bt.selectChildren,filter:ry,merge:ny,selection:fy,transition:_y,call:Bt.call,nodes:Bt.nodes,node:Bt.node,size:Bt.size,empty:Bt.empty,each:Bt.each,on:ay,attr:zx,attrTween:Wx,style:xy,styleTween:wy,text:ky,textTween:Cy,remove:ly,tween:Fx,delay:Yx,duration:Zx,ease:Qx,easeVarying:ty,end:Ey,[Symbol.iterator]:Bt[Symbol.iterator]};function Ay(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Py={time:null,delay:0,duration:250,ease:Ay};function Ly(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}function Fy(e){var t,r;e instanceof Jt?(t=e._id,e=e._name):(t=uu(),(r=Py).time=si(),e=e==null?null:e+"");for(var n=this._groups,o=n.length,a=0;a<o;++a)for(var i=n[a],l=i.length,c,d=0;d<l;++d)(c=i[d])&&mo(c,e,t,d,i,r||Ly(c,t));return new Jt(n,this._parents,e,t)}qn.prototype.interrupt=Ax;qn.prototype.transition=Fy;const ds=e=>()=>e;function $y(e,{sourceEvent:t,target:r,transform:n,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:o}})}function qt(e,t,r){this.k=e,this.x=t,this.y=r}qt.prototype={constructor:qt,scale:function(e){return e===1?this:new qt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new qt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var xo=new qt(1,0,0);fu.prototype=qt.prototype;function fu(e){for(;!e.__zoom;)if(!(e=e.parentNode))return xo;return e.__zoom}function Wo(e){e.stopImmediatePropagation()}function un(e){e.preventDefault(),e.stopImmediatePropagation()}function Ry(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Iy(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function gl(){return this.__zoom||xo}function My(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Oy(){return navigator.maxTouchPoints||"ontouchstart"in this}function Dy(e,t,r){var n=e.invertX(t[0][0])-r[0][0],o=e.invertX(t[1][0])-r[1][0],a=e.invertY(t[0][1])-r[0][1],i=e.invertY(t[1][1])-r[1][1];return e.translate(o>n?(n+o)/2:Math.min(0,n)||Math.max(0,o),i>a?(a+i)/2:Math.min(0,a)||Math.max(0,i))}function gu(){var e=Ry,t=Iy,r=Dy,n=My,o=Oy,a=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],l=250,c=Cs,d=go("start","zoom","end"),u,f,g,p=500,h=150,w=0,y=10;function b(N){N.property("__zoom",gl).on("wheel.zoom",A,{passive:!1}).on("mousedown.zoom",T).on("dblclick.zoom",O).filter(o).on("touchstart.zoom",$).on("touchmove.zoom",D).on("touchend.zoom touchcancel.zoom",M).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}b.transform=function(N,L,F,_){var I=N.selection?N.selection():N;I.property("__zoom",gl),N!==I?j(N,L,F,_):I.interrupt().each(function(){k(this,arguments).event(_).start().zoom(null,typeof L=="function"?L.apply(this,arguments):L).end()})},b.scaleBy=function(N,L,F,_){b.scaleTo(N,function(){var I=this.__zoom.k,R=typeof L=="function"?L.apply(this,arguments):L;return I*R},F,_)},b.scaleTo=function(N,L,F,_){b.transform(N,function(){var I=t.apply(this,arguments),R=this.__zoom,B=F==null?v(I):typeof F=="function"?F.apply(this,arguments):F,H=R.invert(B),ie=typeof L=="function"?L.apply(this,arguments):L;return r(m(S(R,ie),B,H),I,i)},F,_)},b.translateBy=function(N,L,F,_){b.transform(N,function(){return r(this.__zoom.translate(typeof L=="function"?L.apply(this,arguments):L,typeof F=="function"?F.apply(this,arguments):F),t.apply(this,arguments),i)},null,_)},b.translateTo=function(N,L,F,_,I){b.transform(N,function(){var R=t.apply(this,arguments),B=this.__zoom,H=_==null?v(R):typeof _=="function"?_.apply(this,arguments):_;return r(xo.translate(H[0],H[1]).scale(B.k).translate(typeof L=="function"?-L.apply(this,arguments):-L,typeof F=="function"?-F.apply(this,arguments):-F),R,i)},_,I)};function S(N,L){return L=Math.max(a[0],Math.min(a[1],L)),L===N.k?N:new qt(L,N.x,N.y)}function m(N,L,F){var _=L[0]-F[0]*N.k,I=L[1]-F[1]*N.k;return _===N.x&&I===N.y?N:new qt(N.k,_,I)}function v(N){return[(+N[0][0]+ +N[1][0])/2,(+N[0][1]+ +N[1][1])/2]}function j(N,L,F,_){N.on("start.zoom",function(){k(this,arguments).event(_).start()}).on("interrupt.zoom end.zoom",function(){k(this,arguments).event(_).end()}).tween("zoom",function(){var I=this,R=arguments,B=k(I,R).event(_),H=t.apply(I,R),ie=F==null?v(H):typeof F=="function"?F.apply(I,R):F,ge=Math.max(H[1][0]-H[0][0],H[1][1]-H[0][1]),ee=I.__zoom,J=typeof L=="function"?L.apply(I,R):L,G=c(ee.invert(ie).concat(ge/ee.k),J.invert(ie).concat(ge/J.k));return function(oe){if(oe===1)oe=J;else{var te=G(oe),E=ge/te[2];oe=new qt(E,ie[0]-te[0]*E,ie[1]-te[1]*E)}B.zoom(null,oe)}})}function k(N,L,F){return!F&&N.__zooming||new C(N,L)}function C(N,L){this.that=N,this.args=L,this.active=0,this.sourceEvent=null,this.extent=t.apply(N,L),this.taps=0}C.prototype={event:function(N){return N&&(this.sourceEvent=N),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(N,L){return this.mouse&&N!=="mouse"&&(this.mouse[1]=L.invert(this.mouse[0])),this.touch0&&N!=="touch"&&(this.touch0[1]=L.invert(this.touch0[0])),this.touch1&&N!=="touch"&&(this.touch1[1]=L.invert(this.touch1[0])),this.that.__zoom=L,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(N){var L=mt(this.that).datum();d.call(N,this.that,new $y(N,{sourceEvent:this.sourceEvent,target:b,transform:this.that.__zoom,dispatch:d}),L)}};function A(N,...L){if(!e.apply(this,arguments))return;var F=k(this,L).event(N),_=this.__zoom,I=Math.max(a[0],Math.min(a[1],_.k*Math.pow(2,n.apply(this,arguments)))),R=Ct(N);if(F.wheel)(F.mouse[0][0]!==R[0]||F.mouse[0][1]!==R[1])&&(F.mouse[1]=_.invert(F.mouse[0]=R)),clearTimeout(F.wheel);else{if(_.k===I)return;F.mouse=[R,_.invert(R)],Ts(this),F.start()}un(N),F.wheel=setTimeout(B,h),F.zoom("mouse",r(m(S(_,I),F.mouse[0],F.mouse[1]),F.extent,i));function B(){F.wheel=null,F.end()}}function T(N,...L){if(g||!e.apply(this,arguments))return;var F=N.currentTarget,_=k(this,L,!0).event(N),I=mt(N.view).on("mousemove.zoom",ie,!0).on("mouseup.zoom",ge,!0),R=Ct(N,F),B=N.clientX,H=N.clientY;Jd(N.view),Wo(N),_.mouse=[R,this.__zoom.invert(R)],Ts(this),_.start();function ie(ee){if(un(ee),!_.moved){var J=ee.clientX-B,G=ee.clientY-H;_.moved=J*J+G*G>w}_.event(ee).zoom("mouse",r(m(_.that.__zoom,_.mouse[0]=Ct(ee,F),_.mouse[1]),_.extent,i))}function ge(ee){I.on("mousemove.zoom mouseup.zoom",null),Zd(ee.view,_.moved),un(ee),_.event(ee).end()}}function O(N,...L){if(e.apply(this,arguments)){var F=this.__zoom,_=Ct(N.changedTouches?N.changedTouches[0]:N,this),I=F.invert(_),R=F.k*(N.shiftKey?.5:2),B=r(m(S(F,R),_,I),t.apply(this,L),i);un(N),l>0?mt(this).transition().duration(l).call(j,B,_,N):mt(this).call(b.transform,B,_,N)}}function $(N,...L){if(e.apply(this,arguments)){var F=N.touches,_=F.length,I=k(this,L,N.changedTouches.length===_).event(N),R,B,H,ie;for(Wo(N),B=0;B<_;++B)H=F[B],ie=Ct(H,this),ie=[ie,this.__zoom.invert(ie),H.identifier],I.touch0?!I.touch1&&I.touch0[2]!==ie[2]&&(I.touch1=ie,I.taps=0):(I.touch0=ie,R=!0,I.taps=1+!!u);u&&(u=clearTimeout(u)),R&&(I.taps<2&&(f=ie[0],u=setTimeout(function(){u=null},p)),Ts(this),I.start())}}function D(N,...L){if(this.__zooming){var F=k(this,L).event(N),_=N.changedTouches,I=_.length,R,B,H,ie;for(un(N),R=0;R<I;++R)B=_[R],H=Ct(B,this),F.touch0&&F.touch0[2]===B.identifier?F.touch0[0]=H:F.touch1&&F.touch1[2]===B.identifier&&(F.touch1[0]=H);if(B=F.that.__zoom,F.touch1){var ge=F.touch0[0],ee=F.touch0[1],J=F.touch1[0],G=F.touch1[1],oe=(oe=J[0]-ge[0])*oe+(oe=J[1]-ge[1])*oe,te=(te=G[0]-ee[0])*te+(te=G[1]-ee[1])*te;B=S(B,Math.sqrt(oe/te)),H=[(ge[0]+J[0])/2,(ge[1]+J[1])/2],ie=[(ee[0]+G[0])/2,(ee[1]+G[1])/2]}else if(F.touch0)H=F.touch0[0],ie=F.touch0[1];else return;F.zoom("touch",r(m(B,H,ie),F.extent,i))}}function M(N,...L){if(this.__zooming){var F=k(this,L).event(N),_=N.changedTouches,I=_.length,R,B;for(Wo(N),g&&clearTimeout(g),g=setTimeout(function(){g=null},p),R=0;R<I;++R)B=_[R],F.touch0&&F.touch0[2]===B.identifier?delete F.touch0:F.touch1&&F.touch1[2]===B.identifier&&delete F.touch1;if(F.touch1&&!F.touch0&&(F.touch0=F.touch1,delete F.touch1),F.touch0)F.touch0[1]=this.__zoom.invert(F.touch0[0]);else if(F.end(),F.taps===2&&(B=Ct(B,this),Math.hypot(f[0]-B[0],f[1]-B[1])<y)){var H=mt(this).on("dblclick.zoom");H&&H.apply(this,arguments)}}}return b.wheelDelta=function(N){return arguments.length?(n=typeof N=="function"?N:ds(+N),b):n},b.filter=function(N){return arguments.length?(e=typeof N=="function"?N:ds(!!N),b):e},b.touchable=function(N){return arguments.length?(o=typeof N=="function"?N:ds(!!N),b):o},b.extent=function(N){return arguments.length?(t=typeof N=="function"?N:ds([[+N[0][0],+N[0][1]],[+N[1][0],+N[1][1]]]),b):t},b.scaleExtent=function(N){return arguments.length?(a[0]=+N[0],a[1]=+N[1],b):[a[0],a[1]]},b.translateExtent=function(N){return arguments.length?(i[0][0]=+N[0][0],i[1][0]=+N[1][0],i[0][1]=+N[0][1],i[1][1]=+N[1][1],b):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},b.constrain=function(N){return arguments.length?(r=N,b):r},b.duration=function(N){return arguments.length?(l=+N,b):l},b.interpolate=function(N){return arguments.length?(c=N,b):c},b.on=function(){var N=d.on.apply(d,arguments);return N===d?b:N},b.clickDistance=function(N){return arguments.length?(w=(N=+N)*N,b):Math.sqrt(w)},b.tapDistance=function(N){return arguments.length?(y=+N,b):y},b}const Dt={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:r,targetHandle:n})=>`Couldn't create edge for ${e} handle id: "${e==="source"?r:n}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Fn=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],pu=["Enter"," ","Escape"],hu={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:r})=>`Moved selected node ${e}. New position, x: ${t}, y: ${r}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Kr;(function(e){e.Strict="strict",e.Loose="loose"})(Kr||(Kr={}));var kr;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(kr||(kr={}));var $n;(function(e){e.Partial="partial",e.Full="full"})($n||($n={}));const mu={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var ar;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(ar||(ar={}));var Vs;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Vs||(Vs={}));var ye;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(ye||(ye={}));const pl={[ye.Left]:ye.Right,[ye.Right]:ye.Left,[ye.Top]:ye.Bottom,[ye.Bottom]:ye.Top};function xu(e){return e===null?null:e?"valid":"invalid"}const yu=e=>"id"in e&&"source"in e&&"target"in e,zy=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),ii=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Yn=(e,t=[0,0])=>{const{width:r,height:n}=Qt(e),o=e.origin??t,a=r*o[0],i=n*o[1];return{x:e.position.x-a,y:e.position.y-i}},Uy=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const r=e.reduce((n,o)=>{const a=typeof o=="string";let i=!t.nodeLookup&&!a?o:void 0;t.nodeLookup&&(i=a?t.nodeLookup.get(o):ii(o)?o:t.nodeLookup.get(o.id));const l=i?Ws(i,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return yo(n,l)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return bo(r)},Xn=(e,t={})=>{if(e.size===0)return{x:0,y:0,width:0,height:0};let r={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return e.forEach(n=>{if(t.filter===void 0||t.filter(n)){const o=Ws(n);r=yo(r,o)}}),bo(r)},li=(e,t,[r,n,o]=[0,0,1],a=!1,i=!1)=>{const l={...Jn(t,[r,n,o]),width:t.width/o,height:t.height/o},c=[];for(const d of e.values()){const{measured:u,selectable:f=!0,hidden:g=!1}=d;if(i&&!f||g)continue;const p=u.width??d.width??d.initialWidth??null,h=u.height??d.height??d.initialHeight??null,w=Rn(l,Xr(d)),y=(p??0)*(h??0),b=a&&w>0;(!d.internals.handleBounds||b||w>=y||d.dragging)&&c.push(d)}return c},By=(e,t)=>{const r=new Set;return e.forEach(n=>{r.add(n.id)}),t.filter(n=>r.has(n.source)||r.has(n.target))};function Hy(e,t){const r=new Map,n=t?.nodes?new Set(t.nodes.map(o=>o.id)):null;return e.forEach(o=>{o.measured.width&&o.measured.height&&(t?.includeHiddenNodes||!o.hidden)&&(!n||n.has(o.id))&&r.set(o.id,o)}),r}async function Vy({nodes:e,width:t,height:r,panZoom:n,minZoom:o,maxZoom:a},i){if(e.size===0)return Promise.resolve(!0);const l=Hy(e,i),c=Xn(l),d=ci(c,t,r,i?.minZoom??o,i?.maxZoom??a,i?.padding??.1);return await n.setViewport(d,{duration:i?.duration,ease:i?.ease,interpolate:i?.interpolate}),Promise.resolve(!0)}function bu({nodeId:e,nextPosition:t,nodeLookup:r,nodeOrigin:n=[0,0],nodeExtent:o,onError:a}){const i=r.get(e),l=i.parentId?r.get(i.parentId):void 0,{x:c,y:d}=l?l.internals.positionAbsolute:{x:0,y:0},u=i.origin??n;let f=o;if(i.extent==="parent"&&!i.expandParent)if(!l)a?.("005",Dt.error005());else{const p=l.measured.width,h=l.measured.height;p&&h&&(f=[[c,d],[c+p,d+h]])}else l&&Jr(i.extent)&&(f=[[i.extent[0][0]+c,i.extent[0][1]+d],[i.extent[1][0]+c,i.extent[1][1]+d]]);const g=Jr(f)?_r(t,f,i.measured):t;return(i.measured.width===void 0||i.measured.height===void 0)&&a?.("015",Dt.error015()),{position:{x:g.x-c+(i.measured.width??0)*u[0],y:g.y-d+(i.measured.height??0)*u[1]},positionAbsolute:g}}async function Wy({nodesToRemove:e=[],edgesToRemove:t=[],nodes:r,edges:n,onBeforeDelete:o}){const a=new Set(e.map(g=>g.id)),i=[];for(const g of r){if(g.deletable===!1)continue;const p=a.has(g.id),h=!p&&g.parentId&&i.find(w=>w.id===g.parentId);(p||h)&&i.push(g)}const l=new Set(t.map(g=>g.id)),c=n.filter(g=>g.deletable!==!1),u=By(i,c);for(const g of c)l.has(g.id)&&!u.find(h=>h.id===g.id)&&u.push(g);if(!o)return{edges:u,nodes:i};const f=await o({nodes:i,edges:u});return typeof f=="boolean"?f?{edges:u,nodes:i}:{edges:[],nodes:[]}:f}const Yr=(e,t=0,r=1)=>Math.min(Math.max(e,t),r),_r=(e={x:0,y:0},t,r)=>({x:Yr(e.x,t[0][0],t[1][0]-(r?.width??0)),y:Yr(e.y,t[0][1],t[1][1]-(r?.height??0))});function wu(e,t,r){const{width:n,height:o}=Qt(r),{x:a,y:i}=r.internals.positionAbsolute;return _r(e,[[a,i],[a+n,i+o]],t)}const hl=(e,t,r)=>e<t?Yr(Math.abs(e-t),1,t)/t:e>r?-Yr(Math.abs(e-r),1,t)/t:0,vu=(e,t,r=15,n=40)=>{const o=hl(e.x,n,t.width-n)*r,a=hl(e.y,n,t.height-n)*r;return[o,a]},yo=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Ra=({x:e,y:t,width:r,height:n})=>({x:e,y:t,x2:e+r,y2:t+n}),bo=({x:e,y:t,x2:r,y2:n})=>({x:e,y:t,width:r-e,height:n-t}),Xr=(e,t=[0,0])=>{const{x:r,y:n}=ii(e)?e.internals.positionAbsolute:Yn(e,t);return{x:r,y:n,width:e.measured?.width??e.width??e.initialWidth??0,height:e.measured?.height??e.height??e.initialHeight??0}},Ws=(e,t=[0,0])=>{const{x:r,y:n}=ii(e)?e.internals.positionAbsolute:Yn(e,t);return{x:r,y:n,x2:r+(e.measured?.width??e.width??e.initialWidth??0),y2:n+(e.measured?.height??e.height??e.initialHeight??0)}},ju=(e,t)=>bo(yo(Ra(e),Ra(t))),Rn=(e,t)=>{const r=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),n=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(r*n)},ml=e=>At(e.width)&&At(e.height)&&At(e.x)&&At(e.y),At=e=>!isNaN(e)&&isFinite(e),qy=(e,t)=>{},wo=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),Jn=({x:e,y:t},[r,n,o],a=!1,i=[1,1])=>{const l={x:(e-r)/o,y:(t-n)/o};return a?wo(l,i):l},qs=({x:e,y:t},[r,n,o])=>({x:e*o+r,y:t*o+n});function $r(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const r=parseFloat(e);if(!Number.isNaN(r))return Math.floor(r)}if(typeof e=="string"&&e.endsWith("%")){const r=parseFloat(e);if(!Number.isNaN(r))return Math.floor(t*r*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function Ky(e,t,r){if(typeof e=="string"||typeof e=="number"){const n=$r(e,r),o=$r(e,t);return{top:n,right:o,bottom:n,left:o,x:o*2,y:n*2}}if(typeof e=="object"){const n=$r(e.top??e.y??0,r),o=$r(e.bottom??e.y??0,r),a=$r(e.left??e.x??0,t),i=$r(e.right??e.x??0,t);return{top:n,right:i,bottom:o,left:a,x:a+i,y:n+o}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function Yy(e,t,r,n,o,a){const{x:i,y:l}=qs(e,[t,r,n]),{x:c,y:d}=qs({x:e.x+e.width,y:e.y+e.height},[t,r,n]),u=o-c,f=a-d;return{left:Math.floor(i),top:Math.floor(l),right:Math.floor(u),bottom:Math.floor(f)}}const ci=(e,t,r,n,o,a)=>{const i=Ky(a,t,r),l=(t-i.x)/e.width,c=(r-i.y)/e.height,d=Math.min(l,c),u=Yr(d,n,o),f=e.x+e.width/2,g=e.y+e.height/2,p=t/2-f*u,h=r/2-g*u,w=Yy(e,p,h,u,t,r),y={left:Math.min(w.left-i.left,0),top:Math.min(w.top-i.top,0),right:Math.min(w.right-i.right,0),bottom:Math.min(w.bottom-i.bottom,0)};return{x:p-y.left+y.right,y:h-y.top+y.bottom,zoom:u}},Ks=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0;function Jr(e){return e!==void 0&&e!=="parent"}function Qt(e){return{width:e.measured?.width??e.width??e.initialWidth??0,height:e.measured?.height??e.height??e.initialHeight??0}}function ku(e){return(e.measured?.width??e.width??e.initialWidth)!==void 0&&(e.measured?.height??e.height??e.initialHeight)!==void 0}function Nu(e,t={width:0,height:0},r,n,o){const a={...e},i=n.get(r);if(i){const l=i.origin||o;a.x+=i.internals.positionAbsolute.x-(t.width??0)*l[0],a.y+=i.internals.positionAbsolute.y-(t.height??0)*l[1]}return a}function xl(e,t){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}function Xy(){let e,t;return{promise:new Promise((n,o)=>{e=n,t=o}),resolve:e,reject:t}}function Jy(e){return{...hu,...e||{}}}function vn(e,{snapGrid:t=[0,0],snapToGrid:r=!1,transform:n,containerBounds:o}){const{x:a,y:i}=It(e),l=Jn({x:a-(o?.left??0),y:i-(o?.top??0)},n),{x:c,y:d}=r?wo(l,t):l;return{xSnapped:c,ySnapped:d,...l}}const di=e=>({width:e.offsetWidth,height:e.offsetHeight}),Su=e=>e?.getRootNode?.()||window?.document,Zy=["INPUT","SELECT","TEXTAREA"];function Cu(e){const t=e.composedPath?.()?.[0]||e.target;return t?.nodeType!==1?!1:Zy.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const _u=e=>"clientX"in e,It=(e,t)=>{const r=_u(e),n=r?e.clientX:e.touches?.[0].clientX,o=r?e.clientY:e.touches?.[0].clientY;return{x:n-(t?.left??0),y:o-(t?.top??0)}},yl=(e,t,r,n,o)=>{const a=t.querySelectorAll(`.${e}`);return!a||!a.length?null:Array.from(a).map(i=>{const l=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:e,nodeId:o,position:i.getAttribute("data-handlepos"),x:(l.left-r.left)/n,y:(l.top-r.top)/n,...di(i)}})};function Eu({sourceX:e,sourceY:t,targetX:r,targetY:n,sourceControlX:o,sourceControlY:a,targetControlX:i,targetControlY:l}){const c=e*.125+o*.375+i*.375+r*.125,d=t*.125+a*.375+l*.375+n*.125,u=Math.abs(c-e),f=Math.abs(d-t);return[c,d,u,f]}function us(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function bl({pos:e,x1:t,y1:r,x2:n,y2:o,c:a}){switch(e){case ye.Left:return[t-us(t-n,a),r];case ye.Right:return[t+us(n-t,a),r];case ye.Top:return[t,r-us(r-o,a)];case ye.Bottom:return[t,r+us(o-r,a)]}}function Tu({sourceX:e,sourceY:t,sourcePosition:r=ye.Bottom,targetX:n,targetY:o,targetPosition:a=ye.Top,curvature:i=.25}){const[l,c]=bl({pos:r,x1:e,y1:t,x2:n,y2:o,c:i}),[d,u]=bl({pos:a,x1:n,y1:o,x2:e,y2:t,c:i}),[f,g,p,h]=Eu({sourceX:e,sourceY:t,targetX:n,targetY:o,sourceControlX:l,sourceControlY:c,targetControlX:d,targetControlY:u});return[`M${e},${t} C${l},${c} ${d},${u} ${n},${o}`,f,g,p,h]}function Au({sourceX:e,sourceY:t,targetX:r,targetY:n}){const o=Math.abs(r-e)/2,a=r<e?r+o:r-o,i=Math.abs(n-t)/2,l=n<t?n+i:n-i;return[a,l,o,i]}function Gy({sourceNode:e,targetNode:t,selected:r=!1,zIndex:n,elevateOnSelect:o=!1}){if(n!==void 0)return n;const a=o&&r?1e3:0,i=Math.max(e.parentId?e.internals.z:0,t.parentId?t.internals.z:0);return a+i}function Qy({sourceNode:e,targetNode:t,width:r,height:n,transform:o}){const a=yo(Ws(e),Ws(t));a.x===a.x2&&(a.x2+=1),a.y===a.y2&&(a.y2+=1);const i={x:-o[0]/o[2],y:-o[1]/o[2],width:r/o[2],height:n/o[2]};return Rn(i,bo(a))>0}const eb=({source:e,sourceHandle:t,target:r,targetHandle:n})=>`xy-edge__${e}${t||""}-${r}${n||""}`,tb=(e,t)=>t.some(r=>r.source===e.source&&r.target===e.target&&(r.sourceHandle===e.sourceHandle||!r.sourceHandle&&!e.sourceHandle)&&(r.targetHandle===e.targetHandle||!r.targetHandle&&!e.targetHandle)),Pu=(e,t)=>{if(!e.source||!e.target)return t;let r;return yu(e)?r={...e}:r={...e,id:eb(e)},tb(r,t)?t:(r.sourceHandle===null&&delete r.sourceHandle,r.targetHandle===null&&delete r.targetHandle,t.concat(r))};function Lu({sourceX:e,sourceY:t,targetX:r,targetY:n}){const[o,a,i,l]=Au({sourceX:e,sourceY:t,targetX:r,targetY:n});return[`M ${e},${t}L ${r},${n}`,o,a,i,l]}const wl={[ye.Left]:{x:-1,y:0},[ye.Right]:{x:1,y:0},[ye.Top]:{x:0,y:-1},[ye.Bottom]:{x:0,y:1}},rb=({source:e,sourcePosition:t=ye.Bottom,target:r})=>t===ye.Left||t===ye.Right?e.x<r.x?{x:1,y:0}:{x:-1,y:0}:e.y<r.y?{x:0,y:1}:{x:0,y:-1},vl=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function nb({source:e,sourcePosition:t=ye.Bottom,target:r,targetPosition:n=ye.Top,center:o,offset:a}){const i=wl[t],l=wl[n],c={x:e.x+i.x*a,y:e.y+i.y*a},d={x:r.x+l.x*a,y:r.y+l.y*a},u=rb({source:c,sourcePosition:t,target:d}),f=u.x!==0?"x":"y",g=u[f];let p=[],h,w;const y={x:0,y:0},b={x:0,y:0},[S,m,v,j]=Au({sourceX:e.x,sourceY:e.y,targetX:r.x,targetY:r.y});if(i[f]*l[f]===-1){h=o.x??S,w=o.y??m;const C=[{x:h,y:c.y},{x:h,y:d.y}],A=[{x:c.x,y:w},{x:d.x,y:w}];i[f]===g?p=f==="x"?C:A:p=f==="x"?A:C}else{const C=[{x:c.x,y:d.y}],A=[{x:d.x,y:c.y}];if(f==="x"?p=i.x===g?A:C:p=i.y===g?C:A,t===n){const M=Math.abs(e[f]-r[f]);if(M<=a){const N=Math.min(a-1,a-M);i[f]===g?y[f]=(c[f]>e[f]?-1:1)*N:b[f]=(d[f]>r[f]?-1:1)*N}}if(t!==n){const M=f==="x"?"y":"x",N=i[f]===l[M],L=c[M]>d[M],F=c[M]<d[M];(i[f]===1&&(!N&&L||N&&F)||i[f]!==1&&(!N&&F||N&&L))&&(p=f==="x"?C:A)}const T={x:c.x+y.x,y:c.y+y.y},O={x:d.x+b.x,y:d.y+b.y},$=Math.max(Math.abs(T.x-p[0].x),Math.abs(O.x-p[0].x)),D=Math.max(Math.abs(T.y-p[0].y),Math.abs(O.y-p[0].y));$>=D?(h=(T.x+O.x)/2,w=p[0].y):(h=p[0].x,w=(T.y+O.y)/2)}return[[e,{x:c.x+y.x,y:c.y+y.y},...p,{x:d.x+b.x,y:d.y+b.y},r],h,w,v,j]}function sb(e,t,r,n){const o=Math.min(vl(e,t)/2,vl(t,r)/2,n),{x:a,y:i}=t;if(e.x===a&&a===r.x||e.y===i&&i===r.y)return`L${a} ${i}`;if(e.y===i){const d=e.x<r.x?-1:1,u=e.y<r.y?1:-1;return`L ${a+o*d},${i}Q ${a},${i} ${a},${i+o*u}`}const l=e.x<r.x?1:-1,c=e.y<r.y?-1:1;return`L ${a},${i+o*c}Q ${a},${i} ${a+o*l},${i}`}function Ia({sourceX:e,sourceY:t,sourcePosition:r=ye.Bottom,targetX:n,targetY:o,targetPosition:a=ye.Top,borderRadius:i=5,centerX:l,centerY:c,offset:d=20}){const[u,f,g,p,h]=nb({source:{x:e,y:t},sourcePosition:r,target:{x:n,y:o},targetPosition:a,center:{x:l,y:c},offset:d});return[u.reduce((y,b,S)=>{let m="";return S>0&&S<u.length-1?m=sb(u[S-1],b,u[S+1],i):m=`${S===0?"M":"L"}${b.x} ${b.y}`,y+=m,y},""),f,g,p,h]}function jl(e){return e&&!!(e.internals.handleBounds||e.handles?.length)&&!!(e.measured.width||e.width||e.initialWidth)}function ob(e){const{sourceNode:t,targetNode:r}=e;if(!jl(t)||!jl(r))return null;const n=t.internals.handleBounds||kl(t.handles),o=r.internals.handleBounds||kl(r.handles),a=Nl(n?.source??[],e.sourceHandle),i=Nl(e.connectionMode===Kr.Strict?o?.target??[]:(o?.target??[]).concat(o?.source??[]),e.targetHandle);if(!a||!i)return e.onError?.("008",Dt.error008(a?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const l=a?.position||ye.Bottom,c=i?.position||ye.Top,d=In(t,a,l),u=In(r,i,c);return{sourceX:d.x,sourceY:d.y,targetX:u.x,targetY:u.y,sourcePosition:l,targetPosition:c}}function kl(e){if(!e)return null;const t=[],r=[];for(const n of e)n.width=n.width??1,n.height=n.height??1,n.type==="source"?t.push(n):n.type==="target"&&r.push(n);return{source:t,target:r}}function In(e,t,r=ye.Left,n=!1){const o=(t?.x??0)+e.internals.positionAbsolute.x,a=(t?.y??0)+e.internals.positionAbsolute.y,{width:i,height:l}=t??Qt(e);if(n)return{x:o+i/2,y:a+l/2};switch(t?.position??r){case ye.Top:return{x:o+i/2,y:a};case ye.Right:return{x:o+i,y:a+l/2};case ye.Bottom:return{x:o+i/2,y:a+l};case ye.Left:return{x:o,y:a+l/2}}}function Nl(e,t){return e&&(t?e.find(r=>r.id===t):e[0])||null}function Ma(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(n=>`${n}=${e[n]}`).join("&")}`:""}function ab(e,{id:t,defaultColor:r,defaultMarkerStart:n,defaultMarkerEnd:o}){const a=new Set;return e.reduce((i,l)=>([l.markerStart||n,l.markerEnd||o].forEach(c=>{if(c&&typeof c=="object"){const d=Ma(c,t);a.has(d)||(i.push({id:d,color:c.color||r,...c}),a.add(d))}}),i),[]).sort((i,l)=>i.id.localeCompare(l.id))}const ui={nodeOrigin:[0,0],nodeExtent:Fn,elevateNodesOnSelect:!0,defaults:{}},ib={...ui,checkEquality:!0};function fi(e,t){const r={...e};for(const n in t)t[n]!==void 0&&(r[n]=t[n]);return r}function lb(e,t,r){const n=fi(ui,r);for(const o of e.values())if(o.parentId)gi(o,e,t,n);else{const a=Yn(o,n.nodeOrigin),i=Jr(o.extent)?o.extent:n.nodeExtent,l=_r(a,i,Qt(o));o.internals.positionAbsolute=l}}function Oa(e,t,r,n){const o=fi(ib,n);let a=e.length>0;const i=new Map(t),l=o?.elevateNodesOnSelect?1e3:0;t.clear(),r.clear();for(const c of e){let d=i.get(c.id);if(o.checkEquality&&c===d?.internals.userNode)t.set(c.id,d);else{const u=Yn(c,o.nodeOrigin),f=Jr(c.extent)?c.extent:o.nodeExtent,g=_r(u,f,Qt(c));d={...o.defaults,...c,measured:{width:c.measured?.width,height:c.measured?.height},internals:{positionAbsolute:g,handleBounds:c.measured?d?.internals.handleBounds:void 0,z:Fu(c,l),userNode:c}},t.set(c.id,d)}(d.measured===void 0||d.measured.width===void 0||d.measured.height===void 0)&&!d.hidden&&(a=!1),c.parentId&&gi(d,t,r,n)}return a}function cb(e,t){if(!e.parentId)return;const r=t.get(e.parentId);r?r.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function gi(e,t,r,n){const{elevateNodesOnSelect:o,nodeOrigin:a,nodeExtent:i}=fi(ui,n),l=e.parentId,c=t.get(l);if(!c){console.warn(`Parent node ${l} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}cb(e,r);const d=o?1e3:0,{x:u,y:f,z:g}=db(e,c,a,i,d),{positionAbsolute:p}=e.internals,h=u!==p.x||f!==p.y;(h||g!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:h?{x:u,y:f}:p,z:g}})}function Fu(e,t){return(At(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function db(e,t,r,n,o){const{x:a,y:i}=t.internals.positionAbsolute,l=Qt(e),c=Yn(e,r),d=Jr(e.extent)?_r(c,e.extent,l):c;let u=_r({x:a+d.x,y:i+d.y},n,l);e.extent==="parent"&&(u=wu(u,l,t));const f=Fu(e,o),g=t.internals.z??0;return{x:u.x,y:u.y,z:g>=f?g+1:f}}function pi(e,t,r,n=[0,0]){const o=[],a=new Map;for(const i of e){const l=t.get(i.parentId);if(!l)continue;const c=a.get(i.parentId)?.expandedRect??Xr(l),d=ju(c,i.rect);a.set(i.parentId,{expandedRect:d,parent:l})}return a.size>0&&a.forEach(({expandedRect:i,parent:l},c)=>{const d=l.internals.positionAbsolute,u=Qt(l),f=l.origin??n,g=i.x<d.x?Math.round(Math.abs(d.x-i.x)):0,p=i.y<d.y?Math.round(Math.abs(d.y-i.y)):0,h=Math.max(u.width,Math.round(i.width)),w=Math.max(u.height,Math.round(i.height)),y=(h-u.width)*f[0],b=(w-u.height)*f[1];(g>0||p>0||y||b)&&(o.push({id:c,type:"position",position:{x:l.position.x-g+y,y:l.position.y-p+b}}),r.get(c)?.forEach(S=>{e.some(m=>m.id===S.id)||o.push({id:S.id,type:"position",position:{x:S.position.x+g,y:S.position.y+p}})})),(u.width<i.width||u.height<i.height||g||p)&&o.push({id:c,type:"dimensions",setAttributes:!0,dimensions:{width:h+(g?f[0]*g-y:0),height:w+(p?f[1]*p-b:0)}})}),o}function ub(e,t,r,n,o,a){const i=n?.querySelector(".xyflow__viewport");let l=!1;if(!i)return{changes:[],updatedInternals:l};const c=[],d=window.getComputedStyle(i),{m22:u}=new window.DOMMatrixReadOnly(d.transform),f=[];for(const g of e.values()){const p=t.get(g.id);if(!p)continue;if(p.hidden){t.set(p.id,{...p,internals:{...p.internals,handleBounds:void 0}}),l=!0;continue}const h=di(g.nodeElement),w=p.measured.width!==h.width||p.measured.height!==h.height;if(!!(h.width&&h.height&&(w||!p.internals.handleBounds||g.force))){const b=g.nodeElement.getBoundingClientRect(),S=Jr(p.extent)?p.extent:a;let{positionAbsolute:m}=p.internals;p.parentId&&p.extent==="parent"?m=wu(m,h,t.get(p.parentId)):S&&(m=_r(m,S,h));const v={...p,measured:h,internals:{...p.internals,positionAbsolute:m,handleBounds:{source:yl("source",g.nodeElement,b,u,p.id),target:yl("target",g.nodeElement,b,u,p.id)}}};t.set(p.id,v),p.parentId&&gi(v,t,r,{nodeOrigin:o}),l=!0,w&&(c.push({id:p.id,type:"dimensions",dimensions:h}),p.expandParent&&p.parentId&&f.push({id:p.id,parentId:p.parentId,rect:Xr(v,o)}))}}if(f.length>0){const g=pi(f,t,r,o);c.push(...g)}return{changes:c,updatedInternals:l}}async function fb({delta:e,panZoom:t,transform:r,translateExtent:n,width:o,height:a}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const i=await t.setViewportConstrained({x:r[0]+e.x,y:r[1]+e.y,zoom:r[2]},[[0,0],[o,a]],n),l=!!i&&(i.x!==r[0]||i.y!==r[1]||i.k!==r[2]);return Promise.resolve(l)}function Sl(e,t,r,n,o,a){let i=o;const l=n.get(i)||new Map;n.set(i,l.set(r,t)),i=`${o}-${e}`;const c=n.get(i)||new Map;if(n.set(i,c.set(r,t)),a){i=`${o}-${e}-${a}`;const d=n.get(i)||new Map;n.set(i,d.set(r,t))}}function $u(e,t,r){e.clear(),t.clear();for(const n of r){const{source:o,target:a,sourceHandle:i=null,targetHandle:l=null}=n,c={edgeId:n.id,source:o,target:a,sourceHandle:i,targetHandle:l},d=`${o}-${i}--${a}-${l}`,u=`${a}-${l}--${o}-${i}`;Sl("source",c,u,e,o,i),Sl("target",c,d,e,a,l),t.set(n.id,n)}}function Ru(e,t){if(!e.parentId)return!1;const r=t.get(e.parentId);return r?r.selected?!0:Ru(r,t):!1}function Cl(e,t,r){let n=e;do{if(n?.matches?.(t))return!0;if(n===r)return!1;n=n?.parentElement}while(n);return!1}function gb(e,t,r,n){const o=new Map;for(const[a,i]of e)if((i.selected||i.id===n)&&(!i.parentId||!Ru(i,e))&&(i.draggable||t&&typeof i.draggable>"u")){const l=e.get(a);l&&o.set(a,{id:a,position:l.position||{x:0,y:0},distance:{x:r.x-l.internals.positionAbsolute.x,y:r.y-l.internals.positionAbsolute.y},extent:l.extent,parentId:l.parentId,origin:l.origin,expandParent:l.expandParent,internals:{positionAbsolute:l.internals.positionAbsolute||{x:0,y:0}},measured:{width:l.measured.width??0,height:l.measured.height??0}})}return o}function qo({nodeId:e,dragItems:t,nodeLookup:r,dragging:n=!0}){const o=[];for(const[i,l]of t){const c=r.get(i)?.internals.userNode;c&&o.push({...c,position:l.position,dragging:n})}if(!e)return[o[0],o];const a=r.get(e)?.internals.userNode;return[a?{...a,position:t.get(e)?.position||a.position,dragging:n}:o[0],o]}function pb({onNodeMouseDown:e,getStoreItems:t,onDragStart:r,onDrag:n,onDragStop:o}){let a={x:null,y:null},i=0,l=new Map,c=!1,d={x:0,y:0},u=null,f=!1,g=null,p=!1,h=!1;function w({noDragClassName:b,handleSelector:S,domNode:m,isSelectable:v,nodeId:j,nodeClickDistance:k=0}){g=mt(m);function C({x:$,y:D},M){const{nodeLookup:N,nodeExtent:L,snapGrid:F,snapToGrid:_,nodeOrigin:I,onNodeDrag:R,onSelectionDrag:B,onError:H,updateNodePositions:ie}=t();a={x:$,y:D};let ge=!1,ee={x:0,y:0,x2:0,y2:0};if(l.size>1&&L){const J=Xn(l);ee=Ra(J)}for(const[J,G]of l){if(!N.has(J))continue;let oe={x:$-G.distance.x,y:D-G.distance.y};_&&(oe=wo(oe,F));let te=[[L[0][0],L[0][1]],[L[1][0],L[1][1]]];if(l.size>1&&L&&!G.extent){const{positionAbsolute:re}=G.internals,ce=re.x-ee.x+L[0][0],ue=re.x+G.measured.width-ee.x2+L[1][0],fe=re.y-ee.y+L[0][1],Ee=re.y+G.measured.height-ee.y2+L[1][1];te=[[ce,fe],[ue,Ee]]}const{position:E,positionAbsolute:Q}=bu({nodeId:J,nextPosition:oe,nodeLookup:N,nodeExtent:te,nodeOrigin:I,onError:H});ge=ge||G.position.x!==E.x||G.position.y!==E.y,G.position=E,G.internals.positionAbsolute=Q}if(h=h||ge,!!ge&&(ie(l,!0),M&&(n||R||!j&&B))){const[J,G]=qo({nodeId:j,dragItems:l,nodeLookup:N});n?.(M,l,J,G),R?.(M,J,G),j||B?.(M,G)}}async function A(){if(!u)return;const{transform:$,panBy:D,autoPanSpeed:M,autoPanOnNodeDrag:N}=t();if(!N){c=!1,cancelAnimationFrame(i);return}const[L,F]=vu(d,u,M);(L!==0||F!==0)&&(a.x=(a.x??0)-L/$[2],a.y=(a.y??0)-F/$[2],await D({x:L,y:F})&&C(a,null)),i=requestAnimationFrame(A)}function T($){const{nodeLookup:D,multiSelectionActive:M,nodesDraggable:N,transform:L,snapGrid:F,snapToGrid:_,selectNodesOnDrag:I,onNodeDragStart:R,onSelectionDragStart:B,unselectNodesAndEdges:H}=t();f=!0,(!I||!v)&&!M&&j&&(D.get(j)?.selected||H()),v&&I&&j&&e?.(j);const ie=vn($.sourceEvent,{transform:L,snapGrid:F,snapToGrid:_,containerBounds:u});if(a=ie,l=gb(D,N,ie,j),l.size>0&&(r||R||!j&&B)){const[ge,ee]=qo({nodeId:j,dragItems:l,nodeLookup:D});r?.($.sourceEvent,l,ge,ee),R?.($.sourceEvent,ge,ee),j||B?.($.sourceEvent,ee)}}const O=Gd().clickDistance(k).on("start",$=>{const{domNode:D,nodeDragThreshold:M,transform:N,snapGrid:L,snapToGrid:F}=t();u=D?.getBoundingClientRect()||null,p=!1,h=!1,M===0&&T($),a=vn($.sourceEvent,{transform:N,snapGrid:L,snapToGrid:F,containerBounds:u}),d=It($.sourceEvent,u)}).on("drag",$=>{const{autoPanOnNodeDrag:D,transform:M,snapGrid:N,snapToGrid:L,nodeDragThreshold:F,nodeLookup:_}=t(),I=vn($.sourceEvent,{transform:M,snapGrid:N,snapToGrid:L,containerBounds:u});if(($.sourceEvent.type==="touchmove"&&$.sourceEvent.touches.length>1||j&&!_.has(j))&&(p=!0),!p){if(!c&&D&&f&&(c=!0,A()),!f){const R=I.xSnapped-(a.x??0),B=I.ySnapped-(a.y??0);Math.sqrt(R*R+B*B)>F&&T($)}(a.x!==I.xSnapped||a.y!==I.ySnapped)&&l&&f&&(d=It($.sourceEvent,u),C(I,$.sourceEvent))}}).on("end",$=>{if(!(!f||p)&&(c=!1,f=!1,cancelAnimationFrame(i),l.size>0)){const{nodeLookup:D,updateNodePositions:M,onNodeDragStop:N,onSelectionDragStop:L}=t();if(h&&(M(l,!1),h=!1),o||N||!j&&L){const[F,_]=qo({nodeId:j,dragItems:l,nodeLookup:D,dragging:!1});o?.($.sourceEvent,l,F,_),N?.($.sourceEvent,F,_),j||L?.($.sourceEvent,_)}}}).filter($=>{const D=$.target;return!$.button&&(!b||!Cl(D,`.${b}`,m))&&(!S||Cl(D,S,m))});g.call(O)}function y(){g?.on(".drag",null)}return{update:w,destroy:y}}function hb(e,t,r){const n=[],o={x:e.x-r,y:e.y-r,width:r*2,height:r*2};for(const a of t.values())Rn(o,Xr(a))>0&&n.push(a);return n}const mb=250;function xb(e,t,r,n){let o=[],a=1/0;const i=hb(e,r,t+mb);for(const l of i){const c=[...l.internals.handleBounds?.source??[],...l.internals.handleBounds?.target??[]];for(const d of c){if(n.nodeId===d.nodeId&&n.type===d.type&&n.id===d.id)continue;const{x:u,y:f}=In(l,d,d.position,!0),g=Math.sqrt(Math.pow(u-e.x,2)+Math.pow(f-e.y,2));g>t||(g<a?(o=[{...d,x:u,y:f}],a=g):g===a&&o.push({...d,x:u,y:f}))}}if(!o.length)return null;if(o.length>1){const l=n.type==="source"?"target":"source";return o.find(c=>c.type===l)??o[0]}return o[0]}function Iu(e,t,r,n,o,a=!1){const i=n.get(e);if(!i)return null;const l=o==="strict"?i.internals.handleBounds?.[t]:[...i.internals.handleBounds?.source??[],...i.internals.handleBounds?.target??[]],c=(r?l?.find(d=>d.id===r):l?.[0])??null;return c&&a?{...c,...In(i,c,c.position,!0)}:c}function Mu(e,t){return e||(t?.classList.contains("target")?"target":t?.classList.contains("source")?"source":null)}function yb(e,t){let r=null;return t?r=!0:e&&!t&&(r=!1),r}const Ou=()=>!0;function bb(e,{connectionMode:t,connectionRadius:r,handleId:n,nodeId:o,edgeUpdaterType:a,isTarget:i,domNode:l,nodeLookup:c,lib:d,autoPanOnConnect:u,flowId:f,panBy:g,cancelConnection:p,onConnectStart:h,onConnect:w,onConnectEnd:y,isValidConnection:b=Ou,onReconnectEnd:S,updateConnection:m,getTransform:v,getFromHandle:j,autoPanSpeed:k,dragThreshold:C=1}){const A=Su(e.target);let T=0,O;const{x:$,y:D}=It(e),M=A?.elementFromPoint($,D),N=Mu(a,M),L=l?.getBoundingClientRect();let F=!1;if(!L||!N)return;const _=Iu(o,N,n,c,t);if(!_)return;let I=It(e,L),R=!1,B=null,H=!1,ie=null;function ge(){if(!u||!L)return;const[re,ce]=vu(I,L,k);g({x:re,y:ce}),T=requestAnimationFrame(ge)}const ee={..._,nodeId:o,type:N,position:_.position},J=c.get(o);let oe={inProgress:!0,isValid:null,from:In(J,ee,ye.Left,!0),fromHandle:ee,fromPosition:ee.position,fromNode:J,to:I,toHandle:null,toPosition:pl[ee.position],toNode:null};function te(){F=!0,m(oe),h?.(e,{nodeId:o,handleId:n,handleType:N})}C===0&&te();function E(re){if(!F){const{x:Ee,y:De}=It(re),qe=Ee-$,Ke=De-D;if(!(qe*qe+Ke*Ke>C*C))return;te()}if(!j()||!ee){Q(re);return}const ce=v();I=It(re,L),O=xb(Jn(I,ce,!1,[1,1]),r,c,ee),R||(ge(),R=!0);const ue=Du(re,{handle:O,connectionMode:t,fromNodeId:o,fromHandleId:n,fromType:i?"target":"source",isValidConnection:b,doc:A,lib:d,flowId:f,nodeLookup:c});ie=ue.handleDomNode,B=ue.connection,H=yb(!!O,ue.isValid);const fe={...oe,isValid:H,to:ue.toHandle&&H?qs({x:ue.toHandle.x,y:ue.toHandle.y},ce):I,toHandle:ue.toHandle,toPosition:H&&ue.toHandle?ue.toHandle.position:pl[ee.position],toNode:ue.toHandle?c.get(ue.toHandle.nodeId):null};H&&O&&oe.toHandle&&fe.toHandle&&oe.toHandle.type===fe.toHandle.type&&oe.toHandle.nodeId===fe.toHandle.nodeId&&oe.toHandle.id===fe.toHandle.id&&oe.to.x===fe.to.x&&oe.to.y===fe.to.y||(m(fe),oe=fe)}function Q(re){if(F){(O||ie)&&B&&H&&w?.(B);const{inProgress:ce,...ue}=oe,fe={...ue,toPosition:oe.toHandle?oe.toPosition:null};y?.(re,fe),a&&S?.(re,fe)}p(),cancelAnimationFrame(T),R=!1,H=!1,B=null,ie=null,A.removeEventListener("mousemove",E),A.removeEventListener("mouseup",Q),A.removeEventListener("touchmove",E),A.removeEventListener("touchend",Q)}A.addEventListener("mousemove",E),A.addEventListener("mouseup",Q),A.addEventListener("touchmove",E),A.addEventListener("touchend",Q)}function Du(e,{handle:t,connectionMode:r,fromNodeId:n,fromHandleId:o,fromType:a,doc:i,lib:l,flowId:c,isValidConnection:d=Ou,nodeLookup:u}){const f=a==="target",g=t?i.querySelector(`.${l}-flow__handle[data-id="${c}-${t?.nodeId}-${t?.id}-${t?.type}"]`):null,{x:p,y:h}=It(e),w=i.elementFromPoint(p,h),y=w?.classList.contains(`${l}-flow__handle`)?w:g,b={handleDomNode:y,isValid:!1,connection:null,toHandle:null};if(y){const S=Mu(void 0,y),m=y.getAttribute("data-nodeid"),v=y.getAttribute("data-handleid"),j=y.classList.contains("connectable"),k=y.classList.contains("connectableend");if(!m||!S)return b;const C={source:f?m:n,sourceHandle:f?v:o,target:f?n:m,targetHandle:f?o:v};b.connection=C;const T=j&&k&&(r===Kr.Strict?f&&S==="source"||!f&&S==="target":m!==n||v!==o);b.isValid=T&&d(C),b.toHandle=Iu(m,S,v,u,r,!0)}return b}const Da={onPointerDown:bb,isValid:Du};function wb({domNode:e,panZoom:t,getTransform:r,getViewScale:n}){const o=mt(e);function a({translateExtent:l,width:c,height:d,zoomStep:u=10,pannable:f=!0,zoomable:g=!0,inversePan:p=!1}){const h=m=>{const v=r();if(m.sourceEvent.type!=="wheel"||!t)return;const j=-m.sourceEvent.deltaY*(m.sourceEvent.deltaMode===1?.05:m.sourceEvent.deltaMode?1:.002)*u,k=v[2]*Math.pow(2,j);t.scaleTo(k)};let w=[0,0];const y=m=>{(m.sourceEvent.type==="mousedown"||m.sourceEvent.type==="touchstart")&&(w=[m.sourceEvent.clientX??m.sourceEvent.touches[0].clientX,m.sourceEvent.clientY??m.sourceEvent.touches[0].clientY])},b=m=>{const v=r();if(m.sourceEvent.type!=="mousemove"&&m.sourceEvent.type!=="touchmove"||!t)return;const j=[m.sourceEvent.clientX??m.sourceEvent.touches[0].clientX,m.sourceEvent.clientY??m.sourceEvent.touches[0].clientY],k=[j[0]-w[0],j[1]-w[1]];w=j;const C=n()*Math.max(v[2],Math.log(v[2]))*(p?-1:1),A={x:v[0]-k[0]*C,y:v[1]-k[1]*C},T=[[0,0],[c,d]];t.setViewportConstrained({x:A.x,y:A.y,zoom:v[2]},T,l)},S=gu().on("start",y).on("zoom",f?b:null).on("zoom.wheel",g?h:null);o.call(S,{})}function i(){o.on("zoom",null)}return{update:a,destroy:i,pointer:Ct}}const vb=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,vo=e=>({x:e.x,y:e.y,zoom:e.k}),Ko=({x:e,y:t,zoom:r})=>xo.translate(e,t).scale(r),Ur=(e,t)=>e.target.closest(`.${t}`),zu=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),jb=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,Yo=(e,t=0,r=jb,n=()=>{})=>{const o=typeof t=="number"&&t>0;return o||n(),o?e.transition().duration(t).ease(r).on("end",n):e},Uu=e=>{const t=e.ctrlKey&&Ks()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function kb({zoomPanValues:e,noWheelClassName:t,d3Selection:r,d3Zoom:n,panOnScrollMode:o,panOnScrollSpeed:a,zoomOnPinch:i,onPanZoomStart:l,onPanZoom:c,onPanZoomEnd:d}){return u=>{if(Ur(u,t))return!1;u.preventDefault(),u.stopImmediatePropagation();const f=r.property("__zoom").k||1;if(u.ctrlKey&&i){const y=Ct(u),b=Uu(u),S=f*Math.pow(2,b);n.scaleTo(r,S,y,u);return}const g=u.deltaMode===1?20:1;let p=o===kr.Vertical?0:u.deltaX*g,h=o===kr.Horizontal?0:u.deltaY*g;!Ks()&&u.shiftKey&&o!==kr.Vertical&&(p=u.deltaY*g,h=0),n.translateBy(r,-(p/f)*a,-(h/f)*a,{internal:!0});const w=vo(r.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling||(e.isPanScrolling=!0,l?.(u,w)),e.isPanScrolling&&(c?.(u,w),e.panScrollTimeout=setTimeout(()=>{d?.(u,w),e.isPanScrolling=!1},150))}}function Nb({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:r}){return function(n,o){const a=n.type==="wheel",i=!t&&a&&!n.ctrlKey,l=Ur(n,e);if(n.ctrlKey&&a&&l&&n.preventDefault(),i||l)return null;n.preventDefault(),r.call(this,n,o)}}function Sb({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:r}){return n=>{if(n.sourceEvent?.internal)return;const o=vo(n.transform);e.mouseButton=n.sourceEvent?.button||0,e.isZoomingOrPanning=!0,e.prevViewport=o,n.sourceEvent?.type==="mousedown"&&t(!0),r&&r?.(n.sourceEvent,o)}}function Cb({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:r,onTransformChange:n,onPanZoom:o}){return a=>{e.usedRightMouseButton=!!(r&&zu(t,e.mouseButton??0)),a.sourceEvent?.sync||n([a.transform.x,a.transform.y,a.transform.k]),o&&!a.sourceEvent?.internal&&o?.(a.sourceEvent,vo(a.transform))}}function _b({zoomPanValues:e,panOnDrag:t,panOnScroll:r,onDraggingChange:n,onPanZoomEnd:o,onPaneContextMenu:a}){return i=>{if(!i.sourceEvent?.internal&&(e.isZoomingOrPanning=!1,a&&zu(t,e.mouseButton??0)&&!e.usedRightMouseButton&&i.sourceEvent&&a(i.sourceEvent),e.usedRightMouseButton=!1,n(!1),o&&vb(e.prevViewport,i.transform))){const l=vo(i.transform);e.prevViewport=l,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{o?.(i.sourceEvent,l)},r?150:0)}}}function Eb({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:r,panOnDrag:n,panOnScroll:o,zoomOnDoubleClick:a,userSelectionActive:i,noWheelClassName:l,noPanClassName:c,lib:d}){return u=>{const f=e||t,g=r&&u.ctrlKey;if(u.button===1&&u.type==="mousedown"&&(Ur(u,`${d}-flow__node`)||Ur(u,`${d}-flow__edge`)))return!0;if(!n&&!f&&!o&&!a&&!r||i||Ur(u,l)&&u.type==="wheel"||Ur(u,c)&&(u.type!=="wheel"||o&&u.type==="wheel"&&!e)||!r&&u.ctrlKey&&u.type==="wheel")return!1;if(!r&&u.type==="touchstart"&&u.touches?.length>1)return u.preventDefault(),!1;if(!f&&!o&&!g&&u.type==="wheel"||!n&&(u.type==="mousedown"||u.type==="touchstart")||Array.isArray(n)&&!n.includes(u.button)&&u.type==="mousedown")return!1;const p=Array.isArray(n)&&n.includes(u.button)||!u.button||u.button<=1;return(!u.ctrlKey||u.type==="wheel")&&p}}function Tb({domNode:e,minZoom:t,maxZoom:r,paneClickDistance:n,translateExtent:o,viewport:a,onPanZoom:i,onPanZoomStart:l,onPanZoomEnd:c,onDraggingChange:d}){const u={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},f=e.getBoundingClientRect(),g=gu().clickDistance(!At(n)||n<0?0:n).scaleExtent([t,r]).translateExtent(o),p=mt(e).call(g);m({x:a.x,y:a.y,zoom:Yr(a.zoom,t,r)},[[0,0],[f.width,f.height]],o);const h=p.on("wheel.zoom"),w=p.on("dblclick.zoom");g.wheelDelta(Uu);function y(D,M){return p?new Promise(N=>{g?.interpolate(M?.interpolate==="linear"?wn:Cs).transform(Yo(p,M?.duration,M?.ease,()=>N(!0)),D)}):Promise.resolve(!1)}function b({noWheelClassName:D,noPanClassName:M,onPaneContextMenu:N,userSelectionActive:L,panOnScroll:F,panOnDrag:_,panOnScrollMode:I,panOnScrollSpeed:R,preventScrolling:B,zoomOnPinch:H,zoomOnScroll:ie,zoomOnDoubleClick:ge,zoomActivationKeyPressed:ee,lib:J,onTransformChange:G}){L&&!u.isZoomingOrPanning&&S();const te=F&&!ee&&!L?kb({zoomPanValues:u,noWheelClassName:D,d3Selection:p,d3Zoom:g,panOnScrollMode:I,panOnScrollSpeed:R,zoomOnPinch:H,onPanZoomStart:l,onPanZoom:i,onPanZoomEnd:c}):Nb({noWheelClassName:D,preventScrolling:B,d3ZoomHandler:h});if(p.on("wheel.zoom",te,{passive:!1}),!L){const Q=Sb({zoomPanValues:u,onDraggingChange:d,onPanZoomStart:l});g.on("start",Q);const re=Cb({zoomPanValues:u,panOnDrag:_,onPaneContextMenu:!!N,onPanZoom:i,onTransformChange:G});g.on("zoom",re);const ce=_b({zoomPanValues:u,panOnDrag:_,panOnScroll:F,onPaneContextMenu:N,onPanZoomEnd:c,onDraggingChange:d});g.on("end",ce)}const E=Eb({zoomActivationKeyPressed:ee,panOnDrag:_,zoomOnScroll:ie,panOnScroll:F,zoomOnDoubleClick:ge,zoomOnPinch:H,userSelectionActive:L,noPanClassName:M,noWheelClassName:D,lib:J});g.filter(E),ge?p.on("dblclick.zoom",w):p.on("dblclick.zoom",null)}function S(){g.on("zoom",null)}async function m(D,M,N){const L=Ko(D),F=g?.constrain()(L,M,N);return F&&await y(F),new Promise(_=>_(F))}async function v(D,M){const N=Ko(D);return await y(N,M),new Promise(L=>L(N))}function j(D){if(p){const M=Ko(D),N=p.property("__zoom");(N.k!==D.zoom||N.x!==D.x||N.y!==D.y)&&g?.transform(p,M,null,{sync:!0})}}function k(){const D=p?fu(p.node()):{x:0,y:0,k:1};return{x:D.x,y:D.y,zoom:D.k}}function C(D,M){return p?new Promise(N=>{g?.interpolate(M?.interpolate==="linear"?wn:Cs).scaleTo(Yo(p,M?.duration,M?.ease,()=>N(!0)),D)}):Promise.resolve(!1)}function A(D,M){return p?new Promise(N=>{g?.interpolate(M?.interpolate==="linear"?wn:Cs).scaleBy(Yo(p,M?.duration,M?.ease,()=>N(!0)),D)}):Promise.resolve(!1)}function T(D){g?.scaleExtent(D)}function O(D){g?.translateExtent(D)}function $(D){const M=!At(D)||D<0?0:D;g?.clickDistance(M)}return{update:b,destroy:S,setViewport:v,setViewportConstrained:m,getViewport:k,scaleTo:C,scaleBy:A,setScaleExtent:T,setTranslateExtent:O,syncViewport:j,setClickDistance:$}}var Zr;(function(e){e.Line="line",e.Handle="handle"})(Zr||(Zr={}));function Ab({width:e,prevWidth:t,height:r,prevHeight:n,affectsX:o,affectsY:a}){const i=e-t,l=r-n,c=[i>0?1:i<0?-1:0,l>0?1:l<0?-1:0];return i&&o&&(c[0]=c[0]*-1),l&&a&&(c[1]=c[1]*-1),c}function Pb(e){const t=e.includes("right")||e.includes("left"),r=e.includes("bottom")||e.includes("top"),n=e.includes("left"),o=e.includes("top");return{isHorizontal:t,isVertical:r,affectsX:n,affectsY:o}}function nr(e,t){return Math.max(0,t-e)}function sr(e,t){return Math.max(0,e-t)}function fs(e,t,r){return Math.max(0,t-e,e-r)}function _l(e,t){return e?!t:t}function Lb(e,t,r,n,o,a,i,l){let{affectsX:c,affectsY:d}=t;const{isHorizontal:u,isVertical:f}=t,g=u&&f,{xSnapped:p,ySnapped:h}=r,{minWidth:w,maxWidth:y,minHeight:b,maxHeight:S}=n,{x:m,y:v,width:j,height:k,aspectRatio:C}=e;let A=Math.floor(u?p-e.pointerX:0),T=Math.floor(f?h-e.pointerY:0);const O=j+(c?-A:A),$=k+(d?-T:T),D=-a[0]*j,M=-a[1]*k;let N=fs(O,w,y),L=fs($,b,S);if(i){let I=0,R=0;c&&A<0?I=nr(m+A+D,i[0][0]):!c&&A>0&&(I=sr(m+O+D,i[1][0])),d&&T<0?R=nr(v+T+M,i[0][1]):!d&&T>0&&(R=sr(v+$+M,i[1][1])),N=Math.max(N,I),L=Math.max(L,R)}if(l){let I=0,R=0;c&&A>0?I=sr(m+A,l[0][0]):!c&&A<0&&(I=nr(m+O,l[1][0])),d&&T>0?R=sr(v+T,l[0][1]):!d&&T<0&&(R=nr(v+$,l[1][1])),N=Math.max(N,I),L=Math.max(L,R)}if(o){if(u){const I=fs(O/C,b,S)*C;if(N=Math.max(N,I),i){let R=0;!c&&!d||c&&!d&&g?R=sr(v+M+O/C,i[1][1])*C:R=nr(v+M+(c?A:-A)/C,i[0][1])*C,N=Math.max(N,R)}if(l){let R=0;!c&&!d||c&&!d&&g?R=nr(v+O/C,l[1][1])*C:R=sr(v+(c?A:-A)/C,l[0][1])*C,N=Math.max(N,R)}}if(f){const I=fs($*C,w,y)/C;if(L=Math.max(L,I),i){let R=0;!c&&!d||d&&!c&&g?R=sr(m+$*C+D,i[1][0])/C:R=nr(m+(d?T:-T)*C+D,i[0][0])/C,L=Math.max(L,R)}if(l){let R=0;!c&&!d||d&&!c&&g?R=nr(m+$*C,l[1][0])/C:R=sr(m+(d?T:-T)*C,l[0][0])/C,L=Math.max(L,R)}}}T=T+(T<0?L:-L),A=A+(A<0?N:-N),o&&(g?O>$*C?T=(_l(c,d)?-A:A)/C:A=(_l(c,d)?-T:T)*C:u?(T=A/C,d=c):(A=T*C,c=d));const F=c?m+A:m,_=d?v+T:v;return{width:j+(c?-A:A),height:k+(d?-T:T),x:a[0]*A*(c?-1:1)+F,y:a[1]*T*(d?-1:1)+_}}const Bu={width:0,height:0,x:0,y:0},Fb={...Bu,pointerX:0,pointerY:0,aspectRatio:1};function $b(e){return[[0,0],[e.measured.width,e.measured.height]]}function Rb(e,t,r){const n=t.position.x+e.position.x,o=t.position.y+e.position.y,a=e.measured.width??0,i=e.measured.height??0,l=r[0]*a,c=r[1]*i;return[[n-l,o-c],[n+a-l,o+i-c]]}function Ib({domNode:e,nodeId:t,getStoreItems:r,onChange:n,onEnd:o}){const a=mt(e);function i({controlPosition:c,boundaries:d,keepAspectRatio:u,resizeDirection:f,onResizeStart:g,onResize:p,onResizeEnd:h,shouldResize:w}){let y={...Bu},b={...Fb};const S=Pb(c);let m,v=null,j=[],k,C,A;const T=Gd().on("start",O=>{const{nodeLookup:$,transform:D,snapGrid:M,snapToGrid:N,nodeOrigin:L,paneDomNode:F}=r();if(m=$.get(t),!m)return;v=F?.getBoundingClientRect()??null;const{xSnapped:_,ySnapped:I}=vn(O.sourceEvent,{transform:D,snapGrid:M,snapToGrid:N,containerBounds:v});y={width:m.measured.width??0,height:m.measured.height??0,x:m.position.x??0,y:m.position.y??0},b={...y,pointerX:_,pointerY:I,aspectRatio:y.width/y.height},k=void 0,m.parentId&&(m.extent==="parent"||m.expandParent)&&(k=$.get(m.parentId),C=k&&m.extent==="parent"?$b(k):void 0),j=[],A=void 0;for(const[R,B]of $)if(B.parentId===t&&(j.push({id:R,position:{...B.position},extent:B.extent}),B.extent==="parent"||B.expandParent)){const H=Rb(B,m,B.origin??L);A?A=[[Math.min(H[0][0],A[0][0]),Math.min(H[0][1],A[0][1])],[Math.max(H[1][0],A[1][0]),Math.max(H[1][1],A[1][1])]]:A=H}g?.(O,{...y})}).on("drag",O=>{const{transform:$,snapGrid:D,snapToGrid:M,nodeOrigin:N}=r(),L=vn(O.sourceEvent,{transform:$,snapGrid:D,snapToGrid:M,containerBounds:v}),F=[];if(!m)return;const{x:_,y:I,width:R,height:B}=y,H={},ie=m.origin??N,{width:ge,height:ee,x:J,y:G}=Lb(b,S,L,d,u,ie,C,A),oe=ge!==R,te=ee!==B,E=J!==_&&oe,Q=G!==I&&te;if(!E&&!Q&&!oe&&!te)return;if((E||Q||ie[0]===1||ie[1]===1)&&(H.x=E?J:y.x,H.y=Q?G:y.y,y.x=H.x,y.y=H.y,j.length>0)){const fe=J-_,Ee=G-I;for(const De of j)De.position={x:De.position.x-fe+ie[0]*(ge-R),y:De.position.y-Ee+ie[1]*(ee-B)},F.push(De)}if((oe||te)&&(H.width=oe&&(!f||f==="horizontal")?ge:y.width,H.height=te&&(!f||f==="vertical")?ee:y.height,y.width=H.width,y.height=H.height),k&&m.expandParent){const fe=ie[0]*(H.width??0);H.x&&H.x<fe&&(y.x=fe,b.x=b.x-(H.x-fe));const Ee=ie[1]*(H.height??0);H.y&&H.y<Ee&&(y.y=Ee,b.y=b.y-(H.y-Ee))}const re=Ab({width:y.width,prevWidth:R,height:y.height,prevHeight:B,affectsX:S.affectsX,affectsY:S.affectsY}),ce={...y,direction:re};w?.(O,ce)!==!1&&(p?.(O,ce),n(H,F))}).on("end",O=>{h?.(O,{...y}),o?.({...y})});a.call(T)}function l(){a.on(".drag",null)}return{update:i,destroy:l}}const{useDebugValue:Mb}=he,{useSyncExternalStoreWithSelector:Ob}=sg,Db=e=>e;function Hu(e,t=Db,r){const n=Ob(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return Mb(n),n}const El=(e,t)=>{const r=og(e),n=(o,a=t)=>Hu(r,o,a);return Object.assign(n,r),n},zb=(e,t)=>e?El(e,t):El;function Xe(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,o]of e)if(!Object.is(o,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(const n of r)if(!Object.prototype.hasOwnProperty.call(t,n)||!Object.is(e[n],t[n]))return!1;return!0}const jo=x.createContext(null),Ub=jo.Provider,Vu=Dt.error001();function Re(e,t){const r=x.useContext(jo);if(r===null)throw new Error(Vu);return Hu(r,e,t)}function Ye(){const e=x.useContext(jo);if(e===null)throw new Error(Vu);return x.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const Tl={display:"none"},Bb={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Wu="react-flow__node-desc",qu="react-flow__edge-desc",Hb="react-flow__aria-live",Vb=e=>e.ariaLiveMessage,Wb=e=>e.ariaLabelConfig;function qb({rfId:e}){const t=Re(Vb);return s.jsx("div",{id:`${Hb}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:Bb,children:t})}function Kb({rfId:e,disableKeyboardA11y:t}){const r=Re(Wb);return s.jsxs(s.Fragment,{children:[s.jsx("div",{id:`${Wu}-${e}`,style:Tl,children:t?r["node.a11yDescription.default"]:r["node.a11yDescription.keyboardDisabled"]}),s.jsx("div",{id:`${qu}-${e}`,style:Tl,children:r["edge.a11yDescription.default"]}),!t&&s.jsx(qb,{rfId:e})]})}const Gr=x.forwardRef(({position:e="top-left",children:t,className:r,style:n,...o},a)=>{const i=`${e}`.split("-");return s.jsx("div",{className:Ze(["react-flow__panel",r,...i]),style:n,ref:a,...o,children:t})});Gr.displayName="Panel";function Yb({proOptions:e,position:t="bottom-right"}){return e?.hideAttribution?null:s.jsx(Gr,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:s.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const Xb=e=>{const t=[],r=[];for(const[,n]of e.nodeLookup)n.selected&&t.push(n.internals.userNode);for(const[,n]of e.edgeLookup)n.selected&&r.push(n);return{selectedNodes:t,selectedEdges:r}},gs=e=>e.id;function Jb(e,t){return Xe(e.selectedNodes.map(gs),t.selectedNodes.map(gs))&&Xe(e.selectedEdges.map(gs),t.selectedEdges.map(gs))}function Zb({onSelectionChange:e}){const t=Ye(),{selectedNodes:r,selectedEdges:n}=Re(Xb,Jb);return x.useEffect(()=>{const o={nodes:r,edges:n};e?.(o),t.getState().onSelectionChangeHandlers.forEach(a=>a(o))},[r,n,e]),null}const Gb=e=>!!e.onSelectionChangeHandlers;function Qb({onSelectionChange:e}){const t=Re(Gb);return e||t?s.jsx(Zb,{onSelectionChange:e}):null}const Ku=[0,0],ew={x:0,y:0,zoom:1},tw=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","paneClickDistance","ariaLabelConfig"],Al=[...tw,"rfId"],rw=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setPaneClickDistance:e.setPaneClickDistance}),Pl={translateExtent:Fn,nodeOrigin:Ku,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1",paneClickDistance:0};function nw(e){const{setNodes:t,setEdges:r,setMinZoom:n,setMaxZoom:o,setTranslateExtent:a,setNodeExtent:i,reset:l,setDefaultNodesAndEdges:c,setPaneClickDistance:d}=Re(rw,Xe),u=Ye();x.useEffect(()=>(c(e.defaultNodes,e.defaultEdges),()=>{f.current=Pl,l()}),[]);const f=x.useRef(Pl);return x.useEffect(()=>{for(const g of Al){const p=e[g],h=f.current[g];p!==h&&(typeof e[g]>"u"||(g==="nodes"?t(p):g==="edges"?r(p):g==="minZoom"?n(p):g==="maxZoom"?o(p):g==="translateExtent"?a(p):g==="nodeExtent"?i(p):g==="paneClickDistance"?d(p):g==="ariaLabelConfig"?u.setState({ariaLabelConfig:Jy(p)}):g==="fitView"?u.setState({fitViewQueued:p}):g==="fitViewOptions"?u.setState({fitViewOptions:p}):u.setState({[g]:p})))}f.current=e},Al.map(g=>e[g])),null}function Ll(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function sw(e){const[t,r]=x.useState(e==="system"?null:e);return x.useEffect(()=>{if(e!=="system"){r(e);return}const n=Ll(),o=()=>r(n?.matches?"dark":"light");return o(),n?.addEventListener("change",o),()=>{n?.removeEventListener("change",o)}},[e]),t!==null?t:Ll()?.matches?"dark":"light"}const Fl=typeof document<"u"?document:null;function Mn(e=null,t={target:Fl,actInsideInputWithModifier:!0}){const[r,n]=x.useState(!1),o=x.useRef(!1),a=x.useRef(new Set([])),[i,l]=x.useMemo(()=>{if(e!==null){const d=(Array.isArray(e)?e:[e]).filter(f=>typeof f=="string").map(f=>f.replace("+",`
`).replace(`

`,`
+`).split(`
`)),u=d.reduce((f,g)=>f.concat(...g),[]);return[d,u]}return[[],[]]},[e]);return x.useEffect(()=>{const c=t?.target??Fl,d=t?.actInsideInputWithModifier??!0;if(e!==null){const u=p=>{if(o.current=p.ctrlKey||p.metaKey||p.shiftKey||p.altKey,(!o.current||o.current&&!d)&&Cu(p))return!1;const w=Rl(p.code,l);if(a.current.add(p[w]),$l(i,a.current,!1)){const y=p.composedPath?.()?.[0]||p.target,b=y?.nodeName==="BUTTON"||y?.nodeName==="A";t.preventDefault!==!1&&(o.current||!b)&&p.preventDefault(),n(!0)}},f=p=>{const h=Rl(p.code,l);$l(i,a.current,!0)?(n(!1),a.current.clear()):a.current.delete(p[h]),p.key==="Meta"&&a.current.clear(),o.current=!1},g=()=>{a.current.clear(),n(!1)};return c?.addEventListener("keydown",u),c?.addEventListener("keyup",f),window.addEventListener("blur",g),window.addEventListener("contextmenu",g),()=>{c?.removeEventListener("keydown",u),c?.removeEventListener("keyup",f),window.removeEventListener("blur",g),window.removeEventListener("contextmenu",g)}}},[e,n]),r}function $l(e,t,r){return e.filter(n=>r||n.length===t.size).some(n=>n.every(o=>t.has(o)))}function Rl(e,t){return t.includes(e)?"code":"key"}const ow=()=>{const e=Ye();return x.useMemo(()=>({zoomIn:t=>{const{panZoom:r}=e.getState();return r?r.scaleBy(1.2,{duration:t?.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:r}=e.getState();return r?r.scaleBy(1/1.2,{duration:t?.duration}):Promise.resolve(!1)},zoomTo:(t,r)=>{const{panZoom:n}=e.getState();return n?n.scaleTo(t,{duration:r?.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,r)=>{const{transform:[n,o,a],panZoom:i}=e.getState();return i?(await i.setViewport({x:t.x??n,y:t.y??o,zoom:t.zoom??a},r),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,r,n]=e.getState().transform;return{x:t,y:r,zoom:n}},setCenter:async(t,r,n)=>e.getState().setCenter(t,r,n),fitBounds:async(t,r)=>{const{width:n,height:o,minZoom:a,maxZoom:i,panZoom:l}=e.getState(),c=ci(t,n,o,a,i,r?.padding??.1);return l?(await l.setViewport(c,{duration:r?.duration,ease:r?.ease,interpolate:r?.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,r={})=>{const{transform:n,snapGrid:o,snapToGrid:a,domNode:i}=e.getState();if(!i)return t;const{x:l,y:c}=i.getBoundingClientRect(),d={x:t.x-l,y:t.y-c},u=r.snapGrid??o,f=r.snapToGrid??a;return Jn(d,n,f,u)},flowToScreenPosition:t=>{const{transform:r,domNode:n}=e.getState();if(!n)return t;const{x:o,y:a}=n.getBoundingClientRect(),i=qs(t,r);return{x:i.x+o,y:i.y+a}}}),[])};function Yu(e,t){const r=[],n=new Map,o=[];for(const a of e)if(a.type==="add"){o.push(a);continue}else if(a.type==="remove"||a.type==="replace")n.set(a.id,[a]);else{const i=n.get(a.id);i?i.push(a):n.set(a.id,[a])}for(const a of t){const i=n.get(a.id);if(!i){r.push(a);continue}if(i[0].type==="remove")continue;if(i[0].type==="replace"){r.push({...i[0].item});continue}const l={...a};for(const c of i)aw(c,l);r.push(l)}return o.length&&o.forEach(a=>{a.index!==void 0?r.splice(a.index,0,{...a.item}):r.push({...a.item})}),r}function aw(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured??={},t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function Xu(e,t){return Yu(e,t)}function Ju(e,t){return Yu(e,t)}function pr(e,t){return{id:e,type:"select",selected:t}}function Br(e,t=new Set,r=!1){const n=[];for(const[o,a]of e){const i=t.has(o);!(a.selected===void 0&&!i)&&a.selected!==i&&(r&&(a.selected=i),n.push(pr(a.id,i)))}return n}function Il({items:e=[],lookup:t}){const r=[],n=new Map(e.map(o=>[o.id,o]));for(const[o,a]of e.entries()){const i=t.get(a.id),l=i?.internals?.userNode??i;l!==void 0&&l!==a&&r.push({id:a.id,item:a,type:"replace"}),l===void 0&&r.push({item:a,type:"add",index:o})}for(const[o]of t)n.get(o)===void 0&&r.push({id:o,type:"remove"});return r}function Ml(e){return{id:e.id,type:"remove"}}const Ol=e=>zy(e),iw=e=>yu(e);function Zu(e){return x.forwardRef(e)}const lw=typeof window<"u"?x.useLayoutEffect:x.useEffect;function Dl(e){const[t,r]=x.useState(BigInt(0)),[n]=x.useState(()=>cw(()=>r(o=>o+BigInt(1))));return lw(()=>{const o=n.get();o.length&&(e(o),n.reset())},[t]),n}function cw(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:r=>{t.push(r),e()}}}const Gu=x.createContext(null);function dw({children:e}){const t=Ye(),r=x.useCallback(l=>{const{nodes:c=[],setNodes:d,hasDefaultNodes:u,onNodesChange:f,nodeLookup:g,fitViewQueued:p}=t.getState();let h=c;for(const y of l)h=typeof y=="function"?y(h):y;const w=Il({items:h,lookup:g});u&&d(h),w.length>0?f?.(w):p&&window.requestAnimationFrame(()=>{const{fitViewQueued:y,nodes:b,setNodes:S}=t.getState();y&&S(b)})},[]),n=Dl(r),o=x.useCallback(l=>{const{edges:c=[],setEdges:d,hasDefaultEdges:u,onEdgesChange:f,edgeLookup:g}=t.getState();let p=c;for(const h of l)p=typeof h=="function"?h(p):h;u?d(p):f&&f(Il({items:p,lookup:g}))},[]),a=Dl(o),i=x.useMemo(()=>({nodeQueue:n,edgeQueue:a}),[]);return s.jsx(Gu.Provider,{value:i,children:e})}function uw(){const e=x.useContext(Gu);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const fw=e=>!!e.panZoom;function hi(){const e=ow(),t=Ye(),r=uw(),n=Re(fw),o=x.useMemo(()=>{const a=f=>t.getState().nodeLookup.get(f),i=f=>{r.nodeQueue.push(f)},l=f=>{r.edgeQueue.push(f)},c=f=>{const{nodeLookup:g,nodeOrigin:p}=t.getState(),h=Ol(f)?f:g.get(f.id),w=h.parentId?Nu(h.position,h.measured,h.parentId,g,p):h.position,y={...h,position:w,width:h.measured?.width??h.width,height:h.measured?.height??h.height};return Xr(y)},d=(f,g,p={replace:!1})=>{i(h=>h.map(w=>{if(w.id===f){const y=typeof g=="function"?g(w):g;return p.replace&&Ol(y)?y:{...w,...y}}return w}))},u=(f,g,p={replace:!1})=>{l(h=>h.map(w=>{if(w.id===f){const y=typeof g=="function"?g(w):g;return p.replace&&iw(y)?y:{...w,...y}}return w}))};return{getNodes:()=>t.getState().nodes.map(f=>({...f})),getNode:f=>a(f)?.internals.userNode,getInternalNode:a,getEdges:()=>{const{edges:f=[]}=t.getState();return f.map(g=>({...g}))},getEdge:f=>t.getState().edgeLookup.get(f),setNodes:i,setEdges:l,addNodes:f=>{const g=Array.isArray(f)?f:[f];r.nodeQueue.push(p=>[...p,...g])},addEdges:f=>{const g=Array.isArray(f)?f:[f];r.edgeQueue.push(p=>[...p,...g])},toObject:()=>{const{nodes:f=[],edges:g=[],transform:p}=t.getState(),[h,w,y]=p;return{nodes:f.map(b=>({...b})),edges:g.map(b=>({...b})),viewport:{x:h,y:w,zoom:y}}},deleteElements:async({nodes:f=[],edges:g=[]})=>{const{nodes:p,edges:h,onNodesDelete:w,onEdgesDelete:y,triggerNodeChanges:b,triggerEdgeChanges:S,onDelete:m,onBeforeDelete:v}=t.getState(),{nodes:j,edges:k}=await Wy({nodesToRemove:f,edgesToRemove:g,nodes:p,edges:h,onBeforeDelete:v}),C=k.length>0,A=j.length>0;if(C){const T=k.map(Ml);y?.(k),S(T)}if(A){const T=j.map(Ml);w?.(j),b(T)}return(A||C)&&m?.({nodes:j,edges:k}),{deletedNodes:j,deletedEdges:k}},getIntersectingNodes:(f,g=!0,p)=>{const h=ml(f),w=h?f:c(f),y=p!==void 0;return w?(p||t.getState().nodes).filter(b=>{const S=t.getState().nodeLookup.get(b.id);if(S&&!h&&(b.id===f.id||!S.internals.positionAbsolute))return!1;const m=Xr(y?b:S),v=Rn(m,w);return g&&v>0||v>=w.width*w.height}):[]},isNodeIntersecting:(f,g,p=!0)=>{const w=ml(f)?f:c(f);if(!w)return!1;const y=Rn(w,g);return p&&y>0||y>=w.width*w.height},updateNode:d,updateNodeData:(f,g,p={replace:!1})=>{d(f,h=>{const w=typeof g=="function"?g(h):g;return p.replace?{...h,data:w}:{...h,data:{...h.data,...w}}},p)},updateEdge:u,updateEdgeData:(f,g,p={replace:!1})=>{u(f,h=>{const w=typeof g=="function"?g(h):g;return p.replace?{...h,data:w}:{...h,data:{...h.data,...w}}},p)},getNodesBounds:f=>{const{nodeLookup:g,nodeOrigin:p}=t.getState();return Uy(f,{nodeLookup:g,nodeOrigin:p})},getHandleConnections:({type:f,id:g,nodeId:p})=>Array.from(t.getState().connectionLookup.get(`${p}-${f}${g?`-${g}`:""}`)?.values()??[]),getNodeConnections:({type:f,handleId:g,nodeId:p})=>Array.from(t.getState().connectionLookup.get(`${p}${f?g?`-${f}-${g}`:`-${f}`:""}`)?.values()??[]),fitView:async f=>{const g=t.getState().fitViewResolver??Xy();return t.setState({fitViewQueued:!0,fitViewOptions:f,fitViewResolver:g}),r.nodeQueue.push(p=>[...p]),g.promise}}},[]);return x.useMemo(()=>({...o,...e,viewportInitialized:n}),[n])}const zl=e=>e.selected,gw=typeof window<"u"?window:void 0;function pw({deleteKeyCode:e,multiSelectionKeyCode:t}){const r=Ye(),{deleteElements:n}=hi(),o=Mn(e,{actInsideInputWithModifier:!1}),a=Mn(t,{target:gw});x.useEffect(()=>{if(o){const{edges:i,nodes:l}=r.getState();n({nodes:l.filter(zl),edges:i.filter(zl)}),r.setState({nodesSelectionActive:!1})}},[o]),x.useEffect(()=>{r.setState({multiSelectionActive:a})},[a])}function hw(e){const t=Ye();x.useEffect(()=>{const r=()=>{if(!e.current)return!1;const n=di(e.current);(n.height===0||n.width===0)&&t.getState().onError?.("004",Dt.error004()),t.setState({width:n.width||500,height:n.height||500})};if(e.current){r(),window.addEventListener("resize",r);const n=new ResizeObserver(()=>r());return n.observe(e.current),()=>{window.removeEventListener("resize",r),n&&e.current&&n.unobserve(e.current)}}},[])}const ko={position:"absolute",width:"100%",height:"100%",top:0,left:0},mw=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib});function xw({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:r=!0,panOnScroll:n=!1,panOnScrollSpeed:o=.5,panOnScrollMode:a=kr.Free,zoomOnDoubleClick:i=!0,panOnDrag:l=!0,defaultViewport:c,translateExtent:d,minZoom:u,maxZoom:f,zoomActivationKeyCode:g,preventScrolling:p=!0,children:h,noWheelClassName:w,noPanClassName:y,onViewportChange:b,isControlledViewport:S,paneClickDistance:m}){const v=Ye(),j=x.useRef(null),{userSelectionActive:k,lib:C}=Re(mw,Xe),A=Mn(g),T=x.useRef();hw(j);const O=x.useCallback($=>{b?.({x:$[0],y:$[1],zoom:$[2]}),S||v.setState({transform:$})},[b,S]);return x.useEffect(()=>{if(j.current){T.current=Tb({domNode:j.current,minZoom:u,maxZoom:f,translateExtent:d,viewport:c,paneClickDistance:m,onDraggingChange:N=>v.setState({paneDragging:N}),onPanZoomStart:(N,L)=>{const{onViewportChangeStart:F,onMoveStart:_}=v.getState();_?.(N,L),F?.(L)},onPanZoom:(N,L)=>{const{onViewportChange:F,onMove:_}=v.getState();_?.(N,L),F?.(L)},onPanZoomEnd:(N,L)=>{const{onViewportChangeEnd:F,onMoveEnd:_}=v.getState();_?.(N,L),F?.(L)}});const{x:$,y:D,zoom:M}=T.current.getViewport();return v.setState({panZoom:T.current,transform:[$,D,M],domNode:j.current.closest(".react-flow")}),()=>{T.current?.destroy()}}},[]),x.useEffect(()=>{T.current?.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:r,panOnScroll:n,panOnScrollSpeed:o,panOnScrollMode:a,zoomOnDoubleClick:i,panOnDrag:l,zoomActivationKeyPressed:A,preventScrolling:p,noPanClassName:y,userSelectionActive:k,noWheelClassName:w,lib:C,onTransformChange:O})},[e,t,r,n,o,a,i,l,A,p,y,k,w,C,O]),s.jsx("div",{className:"react-flow__renderer",ref:j,style:ko,children:h})}const yw=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function bw(){const{userSelectionActive:e,userSelectionRect:t}=Re(yw,Xe);return e&&t?s.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const Xo=(e,t)=>r=>{r.target===t.current&&e?.(r)},ww=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function vw({isSelecting:e,selectionKeyPressed:t,selectionMode:r=$n.Full,panOnDrag:n,selectionOnDrag:o,onSelectionStart:a,onSelectionEnd:i,onPaneClick:l,onPaneContextMenu:c,onPaneScroll:d,onPaneMouseEnter:u,onPaneMouseMove:f,onPaneMouseLeave:g,children:p}){const h=Ye(),{userSelectionActive:w,elementsSelectable:y,dragging:b,connectionInProgress:S}=Re(ww,Xe),m=y&&(e||w),v=x.useRef(null),j=x.useRef(),k=x.useRef(new Set),C=x.useRef(new Set),A=x.useRef(!1),T=x.useRef(!1),O=_=>{if(A.current||S){A.current=!1;return}l?.(_),h.getState().resetSelectedElements(),h.setState({nodesSelectionActive:!1})},$=_=>{if(Array.isArray(n)&&n?.includes(2)){_.preventDefault();return}c?.(_)},D=d?_=>d(_):void 0,M=_=>{const{resetSelectedElements:I,domNode:R}=h.getState();if(j.current=R?.getBoundingClientRect(),!y||!e||_.button!==0||_.target!==v.current||!j.current)return;_.target?.setPointerCapture?.(_.pointerId),T.current=!0,A.current=!1;const{x:B,y:H}=It(_.nativeEvent,j.current);I(),h.setState({userSelectionRect:{width:0,height:0,startX:B,startY:H,x:B,y:H}}),a?.(_)},N=_=>{const{userSelectionRect:I,transform:R,nodeLookup:B,edgeLookup:H,connectionLookup:ie,triggerNodeChanges:ge,triggerEdgeChanges:ee,defaultEdgeOptions:J}=h.getState();if(!j.current||!I)return;A.current=!0;const{x:G,y:oe}=It(_.nativeEvent,j.current),{startX:te,startY:E}=I,Q={startX:te,startY:E,x:G<te?G:te,y:oe<E?oe:E,width:Math.abs(G-te),height:Math.abs(oe-E)},re=k.current,ce=C.current;k.current=new Set(li(B,Q,R,r===$n.Partial,!0).map(fe=>fe.id)),C.current=new Set;const ue=J?.selectable??!0;for(const fe of k.current){const Ee=ie.get(fe);if(Ee)for(const{edgeId:De}of Ee.values()){const qe=H.get(De);qe&&(qe.selectable??ue)&&C.current.add(De)}}if(!xl(re,k.current)){const fe=Br(B,k.current,!0);ge(fe)}if(!xl(ce,C.current)){const fe=Br(H,C.current);ee(fe)}h.setState({userSelectionRect:Q,userSelectionActive:!0,nodesSelectionActive:!1})},L=_=>{if(_.button!==0||!T.current)return;_.target?.releasePointerCapture?.(_.pointerId);const{userSelectionRect:I}=h.getState();!w&&I&&_.target===v.current&&O?.(_),h.setState({userSelectionActive:!1,userSelectionRect:null,nodesSelectionActive:k.current.size>0}),i?.(_),(t||o)&&(A.current=!1),T.current=!1},F=n===!0||Array.isArray(n)&&n.includes(0);return s.jsxs("div",{className:Ze(["react-flow__pane",{draggable:F,dragging:b,selection:e}]),onClick:m?void 0:Xo(O,v),onContextMenu:Xo($,v),onWheel:Xo(D,v),onPointerEnter:m?void 0:u,onPointerDown:m?M:f,onPointerMove:m?N:f,onPointerUp:m?L:void 0,onPointerLeave:g,ref:v,style:ko,children:[p,s.jsx(bw,{})]})}function za({id:e,store:t,unselect:r=!1,nodeRef:n}){const{addSelectedNodes:o,unselectNodesAndEdges:a,multiSelectionActive:i,nodeLookup:l,onError:c}=t.getState(),d=l.get(e);if(!d){c?.("012",Dt.error012(e));return}t.setState({nodesSelectionActive:!1}),d.selected?(r||d.selected&&i)&&(a({nodes:[d],edges:[]}),requestAnimationFrame(()=>n?.current?.blur())):o([e])}function Qu({nodeRef:e,disabled:t=!1,noDragClassName:r,handleSelector:n,nodeId:o,isSelectable:a,nodeClickDistance:i}){const l=Ye(),[c,d]=x.useState(!1),u=x.useRef();return x.useEffect(()=>{u.current=pb({getStoreItems:()=>l.getState(),onNodeMouseDown:f=>{za({id:f,store:l,nodeRef:e})},onDragStart:()=>{d(!0)},onDragStop:()=>{d(!1)}})},[]),x.useEffect(()=>{if(t)u.current?.destroy();else if(e.current)return u.current?.update({noDragClassName:r,handleSelector:n,domNode:e.current,isSelectable:a,nodeId:o,nodeClickDistance:i}),()=>{u.current?.destroy()}},[r,n,t,a,e,o]),c}const jw=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function ef(){const e=Ye();return x.useCallback(r=>{const{nodeExtent:n,snapToGrid:o,snapGrid:a,nodesDraggable:i,onError:l,updateNodePositions:c,nodeLookup:d,nodeOrigin:u}=e.getState(),f=new Map,g=jw(i),p=o?a[0]:5,h=o?a[1]:5,w=r.direction.x*p*r.factor,y=r.direction.y*h*r.factor;for(const[,b]of d){if(!g(b))continue;let S={x:b.internals.positionAbsolute.x+w,y:b.internals.positionAbsolute.y+y};o&&(S=wo(S,a));const{position:m,positionAbsolute:v}=bu({nodeId:b.id,nextPosition:S,nodeLookup:d,nodeExtent:n,nodeOrigin:u,onError:l});b.position=m,b.internals.positionAbsolute=v,f.set(b.id,b)}c(f)},[])}const mi=x.createContext(null),kw=mi.Provider;mi.Consumer;const tf=()=>x.useContext(mi),Nw=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),Sw=(e,t,r)=>n=>{const{connectionClickStartHandle:o,connectionMode:a,connection:i}=n,{fromHandle:l,toHandle:c,isValid:d}=i,u=c?.nodeId===e&&c?.id===t&&c?.type===r;return{connectingFrom:l?.nodeId===e&&l?.id===t&&l?.type===r,connectingTo:u,clickConnecting:o?.nodeId===e&&o?.id===t&&o?.type===r,isPossibleEndHandle:a===Kr.Strict?l?.type!==r:e!==l?.nodeId||t!==l?.id,connectionInProcess:!!l,clickConnectionInProcess:!!o,valid:u&&d}};function Cw({type:e="source",position:t=ye.Top,isValidConnection:r,isConnectable:n=!0,isConnectableStart:o=!0,isConnectableEnd:a=!0,id:i,onConnect:l,children:c,className:d,onMouseDown:u,onTouchStart:f,...g},p){const h=i||null,w=e==="target",y=Ye(),b=tf(),{connectOnClick:S,noPanClassName:m,rfId:v}=Re(Nw,Xe),{connectingFrom:j,connectingTo:k,clickConnecting:C,isPossibleEndHandle:A,connectionInProcess:T,clickConnectionInProcess:O,valid:$}=Re(Sw(b,h,e),Xe);b||y.getState().onError?.("010",Dt.error010());const D=L=>{const{defaultEdgeOptions:F,onConnect:_,hasDefaultEdges:I}=y.getState(),R={...F,...L};if(I){const{edges:B,setEdges:H}=y.getState();H(Pu(R,B))}_?.(R),l?.(R)},M=L=>{if(!b)return;const F=_u(L.nativeEvent);if(o&&(F&&L.button===0||!F)){const _=y.getState();Da.onPointerDown(L.nativeEvent,{autoPanOnConnect:_.autoPanOnConnect,connectionMode:_.connectionMode,connectionRadius:_.connectionRadius,domNode:_.domNode,nodeLookup:_.nodeLookup,lib:_.lib,isTarget:w,handleId:h,nodeId:b,flowId:_.rfId,panBy:_.panBy,cancelConnection:_.cancelConnection,onConnectStart:_.onConnectStart,onConnectEnd:_.onConnectEnd,updateConnection:_.updateConnection,onConnect:D,isValidConnection:r||_.isValidConnection,getTransform:()=>y.getState().transform,getFromHandle:()=>y.getState().connection.fromHandle,autoPanSpeed:_.autoPanSpeed,dragThreshold:_.connectionDragThreshold})}F?u?.(L):f?.(L)},N=L=>{const{onClickConnectStart:F,onClickConnectEnd:_,connectionClickStartHandle:I,connectionMode:R,isValidConnection:B,lib:H,rfId:ie,nodeLookup:ge,connection:ee}=y.getState();if(!b||!I&&!o)return;if(!I){F?.(L.nativeEvent,{nodeId:b,handleId:h,handleType:e}),y.setState({connectionClickStartHandle:{nodeId:b,type:e,id:h}});return}const J=Su(L.target),G=r||B,{connection:oe,isValid:te}=Da.isValid(L.nativeEvent,{handle:{nodeId:b,id:h,type:e},connectionMode:R,fromNodeId:I.nodeId,fromHandleId:I.id||null,fromType:I.type,isValidConnection:G,flowId:ie,doc:J,lib:H,nodeLookup:ge});te&&oe&&D(oe);const E=structuredClone(ee);delete E.inProgress,E.toPosition=E.toHandle?E.toHandle.position:null,_?.(L,E),y.setState({connectionClickStartHandle:null})};return s.jsx("div",{"data-handleid":h,"data-nodeid":b,"data-handlepos":t,"data-id":`${v}-${b}-${h}-${e}`,className:Ze(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",m,d,{source:!w,target:w,connectable:n,connectablestart:o,connectableend:a,clickconnecting:C,connectingfrom:j,connectingto:k,valid:$,connectionindicator:n&&(!T||A)&&(T||O?a:o)}]),onMouseDown:M,onTouchStart:M,onClick:S?N:void 0,ref:p,...g,children:c})}const zt=x.memo(Zu(Cw));function _w({data:e,isConnectable:t,sourcePosition:r=ye.Bottom}){return s.jsxs(s.Fragment,{children:[e?.label,s.jsx(zt,{type:"source",position:r,isConnectable:t})]})}function Ew({data:e,isConnectable:t,targetPosition:r=ye.Top,sourcePosition:n=ye.Bottom}){return s.jsxs(s.Fragment,{children:[s.jsx(zt,{type:"target",position:r,isConnectable:t}),e?.label,s.jsx(zt,{type:"source",position:n,isConnectable:t})]})}function Tw(){return null}function Aw({data:e,isConnectable:t,targetPosition:r=ye.Top}){return s.jsxs(s.Fragment,{children:[s.jsx(zt,{type:"target",position:r,isConnectable:t}),e?.label]})}const Ys={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},Ul={input:_w,default:Ew,output:Aw,group:Tw};function Pw(e){return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??e.style?.width,height:e.height??e.initialHeight??e.style?.height}:{width:e.width??e.style?.width,height:e.height??e.style?.height}}const Lw=e=>{const{width:t,height:r,x:n,y:o}=Xn(e.nodeLookup,{filter:a=>!!a.selected});return{width:At(t)?t:null,height:At(r)?r:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${n}px,${o}px)`}};function Fw({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:r}){const n=Ye(),{width:o,height:a,transformString:i,userSelectionActive:l}=Re(Lw,Xe),c=ef(),d=x.useRef(null);if(x.useEffect(()=>{r||d.current?.focus({preventScroll:!0})},[r]),Qu({nodeRef:d}),l||!o||!a)return null;const u=e?g=>{const p=n.getState().nodes.filter(h=>h.selected);e(g,p)}:void 0,f=g=>{Object.prototype.hasOwnProperty.call(Ys,g.key)&&(g.preventDefault(),c({direction:Ys[g.key],factor:g.shiftKey?4:1}))};return s.jsx("div",{className:Ze(["react-flow__nodesselection","react-flow__container",t]),style:{transform:i},children:s.jsx("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:u,tabIndex:r?void 0:-1,onKeyDown:r?void 0:f,style:{width:o,height:a}})})}const Bl=typeof window<"u"?window:void 0,$w=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function rf({children:e,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:n,onPaneMouseLeave:o,onPaneContextMenu:a,onPaneScroll:i,paneClickDistance:l,deleteKeyCode:c,selectionKeyCode:d,selectionOnDrag:u,selectionMode:f,onSelectionStart:g,onSelectionEnd:p,multiSelectionKeyCode:h,panActivationKeyCode:w,zoomActivationKeyCode:y,elementsSelectable:b,zoomOnScroll:S,zoomOnPinch:m,panOnScroll:v,panOnScrollSpeed:j,panOnScrollMode:k,zoomOnDoubleClick:C,panOnDrag:A,defaultViewport:T,translateExtent:O,minZoom:$,maxZoom:D,preventScrolling:M,onSelectionContextMenu:N,noWheelClassName:L,noPanClassName:F,disableKeyboardA11y:_,onViewportChange:I,isControlledViewport:R}){const{nodesSelectionActive:B,userSelectionActive:H}=Re($w),ie=Mn(d,{target:Bl}),ge=Mn(w,{target:Bl}),ee=ge||A,J=ge||v,G=u&&ee!==!0,oe=ie||H||G;return pw({deleteKeyCode:c,multiSelectionKeyCode:h}),s.jsx(xw,{onPaneContextMenu:a,elementsSelectable:b,zoomOnScroll:S,zoomOnPinch:m,panOnScroll:J,panOnScrollSpeed:j,panOnScrollMode:k,zoomOnDoubleClick:C,panOnDrag:!ie&&ee,defaultViewport:T,translateExtent:O,minZoom:$,maxZoom:D,zoomActivationKeyCode:y,preventScrolling:M,noWheelClassName:L,noPanClassName:F,onViewportChange:I,isControlledViewport:R,paneClickDistance:l,children:s.jsxs(vw,{onSelectionStart:g,onSelectionEnd:p,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:n,onPaneMouseLeave:o,onPaneContextMenu:a,onPaneScroll:i,panOnDrag:ee,isSelecting:!!oe,selectionMode:f,selectionKeyPressed:ie,selectionOnDrag:G,children:[e,B&&s.jsx(Fw,{onSelectionContextMenu:N,noPanClassName:F,disableKeyboardA11y:_})]})})}rf.displayName="FlowRenderer";const Rw=x.memo(rf),Iw=e=>t=>e?li(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(r=>r.id):Array.from(t.nodeLookup.keys());function Mw(e){return Re(x.useCallback(Iw(e),[e]),Xe)}const Ow=e=>e.updateNodeInternals;function Dw(){const e=Re(Ow),[t]=x.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(r=>{const n=new Map;r.forEach(o=>{const a=o.target.getAttribute("data-id");n.set(a,{id:a,nodeElement:o.target,force:!0})}),e(n)}));return x.useEffect(()=>()=>{t?.disconnect()},[t]),t}function zw({node:e,nodeType:t,hasDimensions:r,resizeObserver:n}){const o=Ye(),a=x.useRef(null),i=x.useRef(null),l=x.useRef(e.sourcePosition),c=x.useRef(e.targetPosition),d=x.useRef(t),u=r&&!!e.internals.handleBounds;return x.useEffect(()=>{a.current&&!e.hidden&&(!u||i.current!==a.current)&&(i.current&&n?.unobserve(i.current),n?.observe(a.current),i.current=a.current)},[u,e.hidden]),x.useEffect(()=>()=>{i.current&&(n?.unobserve(i.current),i.current=null)},[]),x.useEffect(()=>{if(a.current){const f=d.current!==t,g=l.current!==e.sourcePosition,p=c.current!==e.targetPosition;(f||g||p)&&(d.current=t,l.current=e.sourcePosition,c.current=e.targetPosition,o.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:a.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),a}function Uw({id:e,onClick:t,onMouseEnter:r,onMouseMove:n,onMouseLeave:o,onContextMenu:a,onDoubleClick:i,nodesDraggable:l,elementsSelectable:c,nodesConnectable:d,nodesFocusable:u,resizeObserver:f,noDragClassName:g,noPanClassName:p,disableKeyboardA11y:h,rfId:w,nodeTypes:y,nodeClickDistance:b,onError:S}){const{node:m,internals:v,isParent:j}=Re(te=>{const E=te.nodeLookup.get(e),Q=te.parentLookup.has(e);return{node:E,internals:E.internals,isParent:Q}},Xe);let k=m.type||"default",C=y?.[k]||Ul[k];C===void 0&&(S?.("003",Dt.error003(k)),k="default",C=Ul.default);const A=!!(m.draggable||l&&typeof m.draggable>"u"),T=!!(m.selectable||c&&typeof m.selectable>"u"),O=!!(m.connectable||d&&typeof m.connectable>"u"),$=!!(m.focusable||u&&typeof m.focusable>"u"),D=Ye(),M=ku(m),N=zw({node:m,nodeType:k,hasDimensions:M,resizeObserver:f}),L=Qu({nodeRef:N,disabled:m.hidden||!A,noDragClassName:g,handleSelector:m.dragHandle,nodeId:e,isSelectable:T,nodeClickDistance:b}),F=ef();if(m.hidden)return null;const _=Qt(m),I=Pw(m),R=T||A||t||r||n||o,B=r?te=>r(te,{...v.userNode}):void 0,H=n?te=>n(te,{...v.userNode}):void 0,ie=o?te=>o(te,{...v.userNode}):void 0,ge=a?te=>a(te,{...v.userNode}):void 0,ee=i?te=>i(te,{...v.userNode}):void 0,J=te=>{const{selectNodesOnDrag:E,nodeDragThreshold:Q}=D.getState();T&&(!E||!A||Q>0)&&za({id:e,store:D,nodeRef:N}),t&&t(te,{...v.userNode})},G=te=>{if(!(Cu(te.nativeEvent)||h)){if(pu.includes(te.key)&&T){const E=te.key==="Escape";za({id:e,store:D,unselect:E,nodeRef:N})}else if(A&&m.selected&&Object.prototype.hasOwnProperty.call(Ys,te.key)){te.preventDefault();const{ariaLabelConfig:E}=D.getState();D.setState({ariaLiveMessage:E["node.a11yDescription.ariaLiveMessage"]({direction:te.key.replace("Arrow","").toLowerCase(),x:~~v.positionAbsolute.x,y:~~v.positionAbsolute.y})}),F({direction:Ys[te.key],factor:te.shiftKey?4:1})}}},oe=()=>{if(h||!N.current?.matches(":focus-visible"))return;const{transform:te,width:E,height:Q,autoPanOnNodeFocus:re,setCenter:ce}=D.getState();if(!re)return;li(new Map([[e,m]]),{x:0,y:0,width:E,height:Q},te,!0).length>0||ce(m.position.x+_.width/2,m.position.y+_.height/2,{zoom:te[2]})};return s.jsx("div",{className:Ze(["react-flow__node",`react-flow__node-${k}`,{[p]:A},m.className,{selected:m.selected,selectable:T,parent:j,draggable:A,dragging:L}]),ref:N,style:{zIndex:v.z,transform:`translate(${v.positionAbsolute.x}px,${v.positionAbsolute.y}px)`,pointerEvents:R?"all":"none",visibility:M?"visible":"hidden",...m.style,...I},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:B,onMouseMove:H,onMouseLeave:ie,onContextMenu:ge,onClick:J,onDoubleClick:ee,onKeyDown:$?G:void 0,tabIndex:$?0:void 0,onFocus:$?oe:void 0,role:m.ariaRole??($?"group":void 0),"aria-roledescription":"node","aria-describedby":h?void 0:`${Wu}-${w}`,"aria-label":m.ariaLabel,...m.domAttributes,children:s.jsx(kw,{value:e,children:s.jsx(C,{id:e,data:m.data,type:k,positionAbsoluteX:v.positionAbsolute.x,positionAbsoluteY:v.positionAbsolute.y,selected:m.selected??!1,selectable:T,draggable:A,deletable:m.deletable??!0,isConnectable:O,sourcePosition:m.sourcePosition,targetPosition:m.targetPosition,dragging:L,dragHandle:m.dragHandle,zIndex:v.z,parentId:m.parentId,..._})})})}const Bw=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function nf(e){const{nodesDraggable:t,nodesConnectable:r,nodesFocusable:n,elementsSelectable:o,onError:a}=Re(Bw,Xe),i=Mw(e.onlyRenderVisibleElements),l=Dw();return s.jsx("div",{className:"react-flow__nodes",style:ko,children:i.map(c=>s.jsx(Uw,{id:c,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:l,nodesDraggable:t,nodesConnectable:r,nodesFocusable:n,elementsSelectable:o,nodeClickDistance:e.nodeClickDistance,onError:a},c))})}nf.displayName="NodeRenderer";const Hw=x.memo(nf);function Vw(e){return Re(x.useCallback(r=>{if(!e)return r.edges.map(o=>o.id);const n=[];if(r.width&&r.height)for(const o of r.edges){const a=r.nodeLookup.get(o.source),i=r.nodeLookup.get(o.target);a&&i&&Qy({sourceNode:a,targetNode:i,width:r.width,height:r.height,transform:r.transform})&&n.push(o.id)}return n},[e]),Xe)}const Ww=({color:e="none",strokeWidth:t=1})=>s.jsx("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),qw=({color:e="none",strokeWidth:t=1})=>s.jsx("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),Hl={[Vs.Arrow]:Ww,[Vs.ArrowClosed]:qw};function Kw(e){const t=Ye();return x.useMemo(()=>Object.prototype.hasOwnProperty.call(Hl,e)?Hl[e]:(t.getState().onError?.("009",Dt.error009(e)),null),[e])}const Yw=({id:e,type:t,color:r,width:n=12.5,height:o=12.5,markerUnits:a="strokeWidth",strokeWidth:i,orient:l="auto-start-reverse"})=>{const c=Kw(t);return c?s.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${n}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:a,orient:l,refX:"0",refY:"0",children:s.jsx(c,{color:r,strokeWidth:i})}):null},sf=({defaultColor:e,rfId:t})=>{const r=Re(a=>a.edges),n=Re(a=>a.defaultEdgeOptions),o=x.useMemo(()=>ab(r,{id:t,defaultColor:e,defaultMarkerStart:n?.markerStart,defaultMarkerEnd:n?.markerEnd}),[r,n,t,e]);return o.length?s.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:s.jsx("defs",{children:o.map(a=>s.jsx(Yw,{id:a.id,type:a.type,color:a.color,width:a.width,height:a.height,markerUnits:a.markerUnits,strokeWidth:a.strokeWidth,orient:a.orient},a.id))})}):null};sf.displayName="MarkerDefinitions";var Xw=x.memo(sf);function of({x:e,y:t,label:r,labelStyle:n,labelShowBg:o=!0,labelBgStyle:a,labelBgPadding:i=[2,4],labelBgBorderRadius:l=2,children:c,className:d,...u}){const[f,g]=x.useState({x:1,y:0,width:0,height:0}),p=Ze(["react-flow__edge-textwrapper",d]),h=x.useRef(null);return x.useEffect(()=>{if(h.current){const w=h.current.getBBox();g({x:w.x,y:w.y,width:w.width,height:w.height})}},[r]),r?s.jsxs("g",{transform:`translate(${e-f.width/2} ${t-f.height/2})`,className:p,visibility:f.width?"visible":"hidden",...u,children:[o&&s.jsx("rect",{width:f.width+2*i[0],x:-i[0],y:-i[1],height:f.height+2*i[1],className:"react-flow__edge-textbg",style:a,rx:l,ry:l}),s.jsx("text",{className:"react-flow__edge-text",y:f.height/2,dy:"0.3em",ref:h,style:n,children:r}),c]}):null}of.displayName="EdgeText";const Jw=x.memo(of);function No({path:e,labelX:t,labelY:r,label:n,labelStyle:o,labelShowBg:a,labelBgStyle:i,labelBgPadding:l,labelBgBorderRadius:c,interactionWidth:d=20,...u}){return s.jsxs(s.Fragment,{children:[s.jsx("path",{...u,d:e,fill:"none",className:Ze(["react-flow__edge-path",u.className])}),d&&s.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:d,className:"react-flow__edge-interaction"}),n&&At(t)&&At(r)?s.jsx(Jw,{x:t,y:r,label:n,labelStyle:o,labelShowBg:a,labelBgStyle:i,labelBgPadding:l,labelBgBorderRadius:c}):null]})}function Vl({pos:e,x1:t,y1:r,x2:n,y2:o}){return e===ye.Left||e===ye.Right?[.5*(t+n),r]:[t,.5*(r+o)]}function af({sourceX:e,sourceY:t,sourcePosition:r=ye.Bottom,targetX:n,targetY:o,targetPosition:a=ye.Top}){const[i,l]=Vl({pos:r,x1:e,y1:t,x2:n,y2:o}),[c,d]=Vl({pos:a,x1:n,y1:o,x2:e,y2:t}),[u,f,g,p]=Eu({sourceX:e,sourceY:t,targetX:n,targetY:o,sourceControlX:i,sourceControlY:l,targetControlX:c,targetControlY:d});return[`M${e},${t} C${i},${l} ${c},${d} ${n},${o}`,u,f,g,p]}function lf(e){return x.memo(({id:t,sourceX:r,sourceY:n,targetX:o,targetY:a,sourcePosition:i,targetPosition:l,label:c,labelStyle:d,labelShowBg:u,labelBgStyle:f,labelBgPadding:g,labelBgBorderRadius:p,style:h,markerEnd:w,markerStart:y,interactionWidth:b})=>{const[S,m,v]=af({sourceX:r,sourceY:n,sourcePosition:i,targetX:o,targetY:a,targetPosition:l}),j=e.isInternal?void 0:t;return s.jsx(No,{id:j,path:S,labelX:m,labelY:v,label:c,labelStyle:d,labelShowBg:u,labelBgStyle:f,labelBgPadding:g,labelBgBorderRadius:p,style:h,markerEnd:w,markerStart:y,interactionWidth:b})})}const Zw=lf({isInternal:!1}),cf=lf({isInternal:!0});Zw.displayName="SimpleBezierEdge";cf.displayName="SimpleBezierEdgeInternal";function df(e){return x.memo(({id:t,sourceX:r,sourceY:n,targetX:o,targetY:a,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:u,labelBgBorderRadius:f,style:g,sourcePosition:p=ye.Bottom,targetPosition:h=ye.Top,markerEnd:w,markerStart:y,pathOptions:b,interactionWidth:S})=>{const[m,v,j]=Ia({sourceX:r,sourceY:n,sourcePosition:p,targetX:o,targetY:a,targetPosition:h,borderRadius:b?.borderRadius,offset:b?.offset}),k=e.isInternal?void 0:t;return s.jsx(No,{id:k,path:m,labelX:v,labelY:j,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:u,labelBgBorderRadius:f,style:g,markerEnd:w,markerStart:y,interactionWidth:S})})}const uf=df({isInternal:!1}),ff=df({isInternal:!0});uf.displayName="SmoothStepEdge";ff.displayName="SmoothStepEdgeInternal";function gf(e){return x.memo(({id:t,...r})=>{const n=e.isInternal?void 0:t;return s.jsx(uf,{...r,id:n,pathOptions:x.useMemo(()=>({borderRadius:0,offset:r.pathOptions?.offset}),[r.pathOptions?.offset])})})}const Gw=gf({isInternal:!1}),pf=gf({isInternal:!0});Gw.displayName="StepEdge";pf.displayName="StepEdgeInternal";function hf(e){return x.memo(({id:t,sourceX:r,sourceY:n,targetX:o,targetY:a,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:u,labelBgBorderRadius:f,style:g,markerEnd:p,markerStart:h,interactionWidth:w})=>{const[y,b,S]=Lu({sourceX:r,sourceY:n,targetX:o,targetY:a}),m=e.isInternal?void 0:t;return s.jsx(No,{id:m,path:y,labelX:b,labelY:S,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:u,labelBgBorderRadius:f,style:g,markerEnd:p,markerStart:h,interactionWidth:w})})}const Qw=hf({isInternal:!1}),mf=hf({isInternal:!0});Qw.displayName="StraightEdge";mf.displayName="StraightEdgeInternal";function xf(e){return x.memo(({id:t,sourceX:r,sourceY:n,targetX:o,targetY:a,sourcePosition:i=ye.Bottom,targetPosition:l=ye.Top,label:c,labelStyle:d,labelShowBg:u,labelBgStyle:f,labelBgPadding:g,labelBgBorderRadius:p,style:h,markerEnd:w,markerStart:y,pathOptions:b,interactionWidth:S})=>{const[m,v,j]=Tu({sourceX:r,sourceY:n,sourcePosition:i,targetX:o,targetY:a,targetPosition:l,curvature:b?.curvature}),k=e.isInternal?void 0:t;return s.jsx(No,{id:k,path:m,labelX:v,labelY:j,label:c,labelStyle:d,labelShowBg:u,labelBgStyle:f,labelBgPadding:g,labelBgBorderRadius:p,style:h,markerEnd:w,markerStart:y,interactionWidth:S})})}const ev=xf({isInternal:!1}),yf=xf({isInternal:!0});ev.displayName="BezierEdge";yf.displayName="BezierEdgeInternal";const Wl={default:yf,straight:mf,step:pf,smoothstep:ff,simplebezier:cf},ql={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},tv=(e,t,r)=>r===ye.Left?e-t:r===ye.Right?e+t:e,rv=(e,t,r)=>r===ye.Top?e-t:r===ye.Bottom?e+t:e,Kl="react-flow__edgeupdater";function Yl({position:e,centerX:t,centerY:r,radius:n=10,onMouseDown:o,onMouseEnter:a,onMouseOut:i,type:l}){return s.jsx("circle",{onMouseDown:o,onMouseEnter:a,onMouseOut:i,className:Ze([Kl,`${Kl}-${l}`]),cx:tv(t,n,e),cy:rv(r,n,e),r:n,stroke:"transparent",fill:"transparent"})}function nv({isReconnectable:e,reconnectRadius:t,edge:r,sourceX:n,sourceY:o,targetX:a,targetY:i,sourcePosition:l,targetPosition:c,onReconnect:d,onReconnectStart:u,onReconnectEnd:f,setReconnecting:g,setUpdateHover:p}){const h=Ye(),w=(v,j)=>{if(v.button!==0)return;const{autoPanOnConnect:k,domNode:C,isValidConnection:A,connectionMode:T,connectionRadius:O,lib:$,onConnectStart:D,onConnectEnd:M,cancelConnection:N,nodeLookup:L,rfId:F,panBy:_,updateConnection:I}=h.getState(),R=j.type==="target",B=(ge,ee)=>{g(!1),f?.(ge,r,j.type,ee)},H=ge=>d?.(r,ge),ie=(ge,ee)=>{g(!0),u?.(v,r,j.type),D?.(ge,ee)};Da.onPointerDown(v.nativeEvent,{autoPanOnConnect:k,connectionMode:T,connectionRadius:O,domNode:C,handleId:j.id,nodeId:j.nodeId,nodeLookup:L,isTarget:R,edgeUpdaterType:j.type,lib:$,flowId:F,cancelConnection:N,panBy:_,isValidConnection:A,onConnect:H,onConnectStart:ie,onConnectEnd:M,onReconnectEnd:B,updateConnection:I,getTransform:()=>h.getState().transform,getFromHandle:()=>h.getState().connection.fromHandle,dragThreshold:h.getState().connectionDragThreshold})},y=v=>w(v,{nodeId:r.target,id:r.targetHandle??null,type:"target"}),b=v=>w(v,{nodeId:r.source,id:r.sourceHandle??null,type:"source"}),S=()=>p(!0),m=()=>p(!1);return s.jsxs(s.Fragment,{children:[(e===!0||e==="source")&&s.jsx(Yl,{position:l,centerX:n,centerY:o,radius:t,onMouseDown:y,onMouseEnter:S,onMouseOut:m,type:"source"}),(e===!0||e==="target")&&s.jsx(Yl,{position:c,centerX:a,centerY:i,radius:t,onMouseDown:b,onMouseEnter:S,onMouseOut:m,type:"target"})]})}function sv({id:e,edgesFocusable:t,edgesReconnectable:r,elementsSelectable:n,onClick:o,onDoubleClick:a,onContextMenu:i,onMouseEnter:l,onMouseMove:c,onMouseLeave:d,reconnectRadius:u,onReconnect:f,onReconnectStart:g,onReconnectEnd:p,rfId:h,edgeTypes:w,noPanClassName:y,onError:b,disableKeyboardA11y:S}){let m=Re(ce=>ce.edgeLookup.get(e));const v=Re(ce=>ce.defaultEdgeOptions);m=v?{...v,...m}:m;let j=m.type||"default",k=w?.[j]||Wl[j];k===void 0&&(b?.("011",Dt.error011(j)),j="default",k=Wl.default);const C=!!(m.focusable||t&&typeof m.focusable>"u"),A=typeof f<"u"&&(m.reconnectable||r&&typeof m.reconnectable>"u"),T=!!(m.selectable||n&&typeof m.selectable>"u"),O=x.useRef(null),[$,D]=x.useState(!1),[M,N]=x.useState(!1),L=Ye(),{zIndex:F,sourceX:_,sourceY:I,targetX:R,targetY:B,sourcePosition:H,targetPosition:ie}=Re(x.useCallback(ce=>{const ue=ce.nodeLookup.get(m.source),fe=ce.nodeLookup.get(m.target);if(!ue||!fe)return{zIndex:m.zIndex,...ql};const Ee=ob({id:e,sourceNode:ue,targetNode:fe,sourceHandle:m.sourceHandle||null,targetHandle:m.targetHandle||null,connectionMode:ce.connectionMode,onError:b});return{zIndex:Gy({selected:m.selected,zIndex:m.zIndex,sourceNode:ue,targetNode:fe,elevateOnSelect:ce.elevateEdgesOnSelect}),...Ee||ql}},[m.source,m.target,m.sourceHandle,m.targetHandle,m.selected,m.zIndex]),Xe),ge=x.useMemo(()=>m.markerStart?`url('#${Ma(m.markerStart,h)}')`:void 0,[m.markerStart,h]),ee=x.useMemo(()=>m.markerEnd?`url('#${Ma(m.markerEnd,h)}')`:void 0,[m.markerEnd,h]);if(m.hidden||_===null||I===null||R===null||B===null)return null;const J=ce=>{const{addSelectedEdges:ue,unselectNodesAndEdges:fe,multiSelectionActive:Ee}=L.getState();T&&(L.setState({nodesSelectionActive:!1}),m.selected&&Ee?(fe({nodes:[],edges:[m]}),O.current?.blur()):ue([e])),o&&o(ce,m)},G=a?ce=>{a(ce,{...m})}:void 0,oe=i?ce=>{i(ce,{...m})}:void 0,te=l?ce=>{l(ce,{...m})}:void 0,E=c?ce=>{c(ce,{...m})}:void 0,Q=d?ce=>{d(ce,{...m})}:void 0,re=ce=>{if(!S&&pu.includes(ce.key)&&T){const{unselectNodesAndEdges:ue,addSelectedEdges:fe}=L.getState();ce.key==="Escape"?(O.current?.blur(),ue({edges:[m]})):fe([e])}};return s.jsx("svg",{style:{zIndex:F},children:s.jsxs("g",{className:Ze(["react-flow__edge",`react-flow__edge-${j}`,m.className,y,{selected:m.selected,animated:m.animated,inactive:!T&&!o,updating:$,selectable:T}]),onClick:J,onDoubleClick:G,onContextMenu:oe,onMouseEnter:te,onMouseMove:E,onMouseLeave:Q,onKeyDown:C?re:void 0,tabIndex:C?0:void 0,role:m.ariaRole??(C?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":m.ariaLabel===null?void 0:m.ariaLabel||`Edge from ${m.source} to ${m.target}`,"aria-describedby":C?`${qu}-${h}`:void 0,ref:O,...m.domAttributes,children:[!M&&s.jsx(k,{id:e,source:m.source,target:m.target,type:m.type,selected:m.selected,animated:m.animated,selectable:T,deletable:m.deletable??!0,label:m.label,labelStyle:m.labelStyle,labelShowBg:m.labelShowBg,labelBgStyle:m.labelBgStyle,labelBgPadding:m.labelBgPadding,labelBgBorderRadius:m.labelBgBorderRadius,sourceX:_,sourceY:I,targetX:R,targetY:B,sourcePosition:H,targetPosition:ie,data:m.data,style:m.style,sourceHandleId:m.sourceHandle,targetHandleId:m.targetHandle,markerStart:ge,markerEnd:ee,pathOptions:"pathOptions"in m?m.pathOptions:void 0,interactionWidth:m.interactionWidth}),A&&s.jsx(nv,{edge:m,isReconnectable:A,reconnectRadius:u,onReconnect:f,onReconnectStart:g,onReconnectEnd:p,sourceX:_,sourceY:I,targetX:R,targetY:B,sourcePosition:H,targetPosition:ie,setUpdateHover:D,setReconnecting:N})]})})}const ov=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function bf({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:r,edgeTypes:n,noPanClassName:o,onReconnect:a,onEdgeContextMenu:i,onEdgeMouseEnter:l,onEdgeMouseMove:c,onEdgeMouseLeave:d,onEdgeClick:u,reconnectRadius:f,onEdgeDoubleClick:g,onReconnectStart:p,onReconnectEnd:h,disableKeyboardA11y:w}){const{edgesFocusable:y,edgesReconnectable:b,elementsSelectable:S,onError:m}=Re(ov,Xe),v=Vw(t);return s.jsxs("div",{className:"react-flow__edges",children:[s.jsx(Xw,{defaultColor:e,rfId:r}),v.map(j=>s.jsx(sv,{id:j,edgesFocusable:y,edgesReconnectable:b,elementsSelectable:S,noPanClassName:o,onReconnect:a,onContextMenu:i,onMouseEnter:l,onMouseMove:c,onMouseLeave:d,onClick:u,reconnectRadius:f,onDoubleClick:g,onReconnectStart:p,onReconnectEnd:h,rfId:r,onError:m,edgeTypes:n,disableKeyboardA11y:w},j))]})}bf.displayName="EdgeRenderer";const av=x.memo(bf),iv=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function lv({children:e}){const t=Re(iv);return s.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function cv(e){const t=hi(),r=x.useRef(!1);x.useEffect(()=>{!r.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),r.current=!0)},[e,t.viewportInitialized])}const dv=e=>e.panZoom?.syncViewport;function uv(e){const t=Re(dv),r=Ye();return x.useEffect(()=>{e&&(t?.(e),r.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function fv(e){return e.connection.inProgress?{...e.connection,to:Jn(e.connection.to,e.transform)}:{...e.connection}}function gv(e){return fv}function pv(e){const t=gv();return Re(t,Xe)}const hv=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function mv({containerStyle:e,style:t,type:r,component:n}){const{nodesConnectable:o,width:a,height:i,isValid:l,inProgress:c}=Re(hv,Xe);return!(a&&o&&c)?null:s.jsx("svg",{style:e,width:a,height:i,className:"react-flow__connectionline react-flow__container",children:s.jsx("g",{className:Ze(["react-flow__connection",xu(l)]),children:s.jsx(wf,{style:t,type:r,CustomComponent:n,isValid:l})})})}const wf=({style:e,type:t=ar.Bezier,CustomComponent:r,isValid:n})=>{const{inProgress:o,from:a,fromNode:i,fromHandle:l,fromPosition:c,to:d,toNode:u,toHandle:f,toPosition:g}=pv();if(!o)return;if(r)return s.jsx(r,{connectionLineType:t,connectionLineStyle:e,fromNode:i,fromHandle:l,fromX:a.x,fromY:a.y,toX:d.x,toY:d.y,fromPosition:c,toPosition:g,connectionStatus:xu(n),toNode:u,toHandle:f});let p="";const h={sourceX:a.x,sourceY:a.y,sourcePosition:c,targetX:d.x,targetY:d.y,targetPosition:g};switch(t){case ar.Bezier:[p]=Tu(h);break;case ar.SimpleBezier:[p]=af(h);break;case ar.Step:[p]=Ia({...h,borderRadius:0});break;case ar.SmoothStep:[p]=Ia(h);break;default:[p]=Lu(h)}return s.jsx("path",{d:p,fill:"none",className:"react-flow__connection-path",style:e})};wf.displayName="ConnectionLine";const xv={};function Xl(e=xv){x.useRef(e),Ye(),x.useEffect(()=>{},[e])}function yv(){Ye(),x.useRef(!1),x.useEffect(()=>{},[])}function vf({nodeTypes:e,edgeTypes:t,onInit:r,onNodeClick:n,onEdgeClick:o,onNodeDoubleClick:a,onEdgeDoubleClick:i,onNodeMouseEnter:l,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:u,onSelectionContextMenu:f,onSelectionStart:g,onSelectionEnd:p,connectionLineType:h,connectionLineStyle:w,connectionLineComponent:y,connectionLineContainerStyle:b,selectionKeyCode:S,selectionOnDrag:m,selectionMode:v,multiSelectionKeyCode:j,panActivationKeyCode:k,zoomActivationKeyCode:C,deleteKeyCode:A,onlyRenderVisibleElements:T,elementsSelectable:O,defaultViewport:$,translateExtent:D,minZoom:M,maxZoom:N,preventScrolling:L,defaultMarkerColor:F,zoomOnScroll:_,zoomOnPinch:I,panOnScroll:R,panOnScrollSpeed:B,panOnScrollMode:H,zoomOnDoubleClick:ie,panOnDrag:ge,onPaneClick:ee,onPaneMouseEnter:J,onPaneMouseMove:G,onPaneMouseLeave:oe,onPaneScroll:te,onPaneContextMenu:E,paneClickDistance:Q,nodeClickDistance:re,onEdgeContextMenu:ce,onEdgeMouseEnter:ue,onEdgeMouseMove:fe,onEdgeMouseLeave:Ee,reconnectRadius:De,onReconnect:qe,onReconnectStart:Ke,onReconnectEnd:V,noDragClassName:q,noWheelClassName:K,noPanClassName:Y,disableKeyboardA11y:le,nodeExtent:U,rfId:z,viewport:se,onViewportChange:we}){return Xl(e),Xl(t),yv(),cv(r),uv(se),s.jsx(Rw,{onPaneClick:ee,onPaneMouseEnter:J,onPaneMouseMove:G,onPaneMouseLeave:oe,onPaneContextMenu:E,onPaneScroll:te,paneClickDistance:Q,deleteKeyCode:A,selectionKeyCode:S,selectionOnDrag:m,selectionMode:v,onSelectionStart:g,onSelectionEnd:p,multiSelectionKeyCode:j,panActivationKeyCode:k,zoomActivationKeyCode:C,elementsSelectable:O,zoomOnScroll:_,zoomOnPinch:I,zoomOnDoubleClick:ie,panOnScroll:R,panOnScrollSpeed:B,panOnScrollMode:H,panOnDrag:ge,defaultViewport:$,translateExtent:D,minZoom:M,maxZoom:N,onSelectionContextMenu:f,preventScrolling:L,noDragClassName:q,noWheelClassName:K,noPanClassName:Y,disableKeyboardA11y:le,onViewportChange:we,isControlledViewport:!!se,children:s.jsxs(lv,{children:[s.jsx(av,{edgeTypes:t,onEdgeClick:o,onEdgeDoubleClick:i,onReconnect:qe,onReconnectStart:Ke,onReconnectEnd:V,onlyRenderVisibleElements:T,onEdgeContextMenu:ce,onEdgeMouseEnter:ue,onEdgeMouseMove:fe,onEdgeMouseLeave:Ee,reconnectRadius:De,defaultMarkerColor:F,noPanClassName:Y,disableKeyboardA11y:le,rfId:z}),s.jsx(mv,{style:w,type:h,component:y,containerStyle:b}),s.jsx("div",{className:"react-flow__edgelabel-renderer"}),s.jsx(Hw,{nodeTypes:e,onNodeClick:n,onNodeDoubleClick:a,onNodeMouseEnter:l,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:u,nodeClickDistance:re,onlyRenderVisibleElements:T,noPanClassName:Y,noDragClassName:q,disableKeyboardA11y:le,nodeExtent:U,rfId:z}),s.jsx("div",{className:"react-flow__viewport-portal"})]})})}vf.displayName="GraphView";const bv=x.memo(vf),Jl=({nodes:e,edges:t,defaultNodes:r,defaultEdges:n,width:o,height:a,fitView:i,fitViewOptions:l,minZoom:c=.5,maxZoom:d=2,nodeOrigin:u,nodeExtent:f}={})=>{const g=new Map,p=new Map,h=new Map,w=new Map,y=n??t??[],b=r??e??[],S=u??[0,0],m=f??Fn;$u(h,w,y);const v=Oa(b,g,p,{nodeOrigin:S,nodeExtent:m,elevateNodesOnSelect:!1});let j=[0,0,1];if(i&&o&&a){const k=Xn(g,{filter:O=>!!((O.width||O.initialWidth)&&(O.height||O.initialHeight))}),{x:C,y:A,zoom:T}=ci(k,o,a,c,d,l?.padding??.1);j=[C,A,T]}return{rfId:"1",width:0,height:0,transform:j,nodes:b,nodesInitialized:v,nodeLookup:g,parentLookup:p,edges:y,edgeLookup:w,connectionLookup:h,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:r!==void 0,hasDefaultEdges:n!==void 0,panZoom:null,minZoom:c,maxZoom:d,translateExtent:Fn,nodeExtent:m,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Kr.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:S,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:i??!1,fitViewOptions:l,fitViewResolver:null,connection:{...mu},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:qy,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:hu}},wv=({nodes:e,edges:t,defaultNodes:r,defaultEdges:n,width:o,height:a,fitView:i,fitViewOptions:l,minZoom:c,maxZoom:d,nodeOrigin:u,nodeExtent:f})=>zb((g,p)=>{async function h(){const{nodeLookup:w,panZoom:y,fitViewOptions:b,fitViewResolver:S,width:m,height:v,minZoom:j,maxZoom:k}=p();y&&(await Vy({nodes:w,width:m,height:v,panZoom:y,minZoom:j,maxZoom:k},b),S?.resolve(!0),g({fitViewResolver:null}))}return{...Jl({nodes:e,edges:t,width:o,height:a,fitView:i,fitViewOptions:l,minZoom:c,maxZoom:d,nodeOrigin:u,nodeExtent:f,defaultNodes:r,defaultEdges:n}),setNodes:w=>{const{nodeLookup:y,parentLookup:b,nodeOrigin:S,elevateNodesOnSelect:m,fitViewQueued:v}=p(),j=Oa(w,y,b,{nodeOrigin:S,nodeExtent:f,elevateNodesOnSelect:m,checkEquality:!0});v&&j?(h(),g({nodes:w,nodesInitialized:j,fitViewQueued:!1,fitViewOptions:void 0})):g({nodes:w,nodesInitialized:j})},setEdges:w=>{const{connectionLookup:y,edgeLookup:b}=p();$u(y,b,w),g({edges:w})},setDefaultNodesAndEdges:(w,y)=>{if(w){const{setNodes:b}=p();b(w),g({hasDefaultNodes:!0})}if(y){const{setEdges:b}=p();b(y),g({hasDefaultEdges:!0})}},updateNodeInternals:w=>{const{triggerNodeChanges:y,nodeLookup:b,parentLookup:S,domNode:m,nodeOrigin:v,nodeExtent:j,debug:k,fitViewQueued:C}=p(),{changes:A,updatedInternals:T}=ub(w,b,S,m,v,j);T&&(lb(b,S,{nodeOrigin:v,nodeExtent:j}),C?(h(),g({fitViewQueued:!1,fitViewOptions:void 0})):g({}),A?.length>0&&(k&&console.log("React Flow: trigger node changes",A),y?.(A)))},updateNodePositions:(w,y=!1)=>{const b=[],S=[],{nodeLookup:m,triggerNodeChanges:v}=p();for(const[j,k]of w){const C=m.get(j),A=!!(C?.expandParent&&C?.parentId&&k?.position),T={id:j,type:"position",position:A?{x:Math.max(0,k.position.x),y:Math.max(0,k.position.y)}:k.position,dragging:y};A&&C.parentId&&b.push({id:j,parentId:C.parentId,rect:{...k.internals.positionAbsolute,width:k.measured.width??0,height:k.measured.height??0}}),S.push(T)}if(b.length>0){const{parentLookup:j,nodeOrigin:k}=p(),C=pi(b,m,j,k);S.push(...C)}v(S)},triggerNodeChanges:w=>{const{onNodesChange:y,setNodes:b,nodes:S,hasDefaultNodes:m,debug:v}=p();if(w?.length){if(m){const j=Xu(w,S);b(j)}v&&console.log("React Flow: trigger node changes",w),y?.(w)}},triggerEdgeChanges:w=>{const{onEdgesChange:y,setEdges:b,edges:S,hasDefaultEdges:m,debug:v}=p();if(w?.length){if(m){const j=Ju(w,S);b(j)}v&&console.log("React Flow: trigger edge changes",w),y?.(w)}},addSelectedNodes:w=>{const{multiSelectionActive:y,edgeLookup:b,nodeLookup:S,triggerNodeChanges:m,triggerEdgeChanges:v}=p();if(y){const j=w.map(k=>pr(k,!0));m(j);return}m(Br(S,new Set([...w]),!0)),v(Br(b))},addSelectedEdges:w=>{const{multiSelectionActive:y,edgeLookup:b,nodeLookup:S,triggerNodeChanges:m,triggerEdgeChanges:v}=p();if(y){const j=w.map(k=>pr(k,!0));v(j);return}v(Br(b,new Set([...w]))),m(Br(S,new Set,!0))},unselectNodesAndEdges:({nodes:w,edges:y}={})=>{const{edges:b,nodes:S,nodeLookup:m,triggerNodeChanges:v,triggerEdgeChanges:j}=p(),k=w||S,C=y||b,A=k.map(O=>{const $=m.get(O.id);return $&&($.selected=!1),pr(O.id,!1)}),T=C.map(O=>pr(O.id,!1));v(A),j(T)},setMinZoom:w=>{const{panZoom:y,maxZoom:b}=p();y?.setScaleExtent([w,b]),g({minZoom:w})},setMaxZoom:w=>{const{panZoom:y,minZoom:b}=p();y?.setScaleExtent([b,w]),g({maxZoom:w})},setTranslateExtent:w=>{p().panZoom?.setTranslateExtent(w),g({translateExtent:w})},setPaneClickDistance:w=>{p().panZoom?.setClickDistance(w)},resetSelectedElements:()=>{const{edges:w,nodes:y,triggerNodeChanges:b,triggerEdgeChanges:S,elementsSelectable:m}=p();if(!m)return;const v=y.reduce((k,C)=>C.selected?[...k,pr(C.id,!1)]:k,[]),j=w.reduce((k,C)=>C.selected?[...k,pr(C.id,!1)]:k,[]);b(v),S(j)},setNodeExtent:w=>{const{nodes:y,nodeLookup:b,parentLookup:S,nodeOrigin:m,elevateNodesOnSelect:v,nodeExtent:j}=p();w[0][0]===j[0][0]&&w[0][1]===j[0][1]&&w[1][0]===j[1][0]&&w[1][1]===j[1][1]||(Oa(y,b,S,{nodeOrigin:m,nodeExtent:w,elevateNodesOnSelect:v,checkEquality:!1}),g({nodeExtent:w}))},panBy:w=>{const{transform:y,width:b,height:S,panZoom:m,translateExtent:v}=p();return fb({delta:w,panZoom:m,transform:y,translateExtent:v,width:b,height:S})},setCenter:async(w,y,b)=>{const{width:S,height:m,maxZoom:v,panZoom:j}=p();if(!j)return Promise.resolve(!1);const k=typeof b?.zoom<"u"?b.zoom:v;return await j.setViewport({x:S/2-w*k,y:m/2-y*k,zoom:k},{duration:b?.duration,ease:b?.ease,interpolate:b?.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{g({connection:{...mu}})},updateConnection:w=>{g({connection:w})},reset:()=>g({...Jl()})}},Object.is);function vv({initialNodes:e,initialEdges:t,defaultNodes:r,defaultEdges:n,initialWidth:o,initialHeight:a,initialMinZoom:i,initialMaxZoom:l,initialFitViewOptions:c,fitView:d,nodeOrigin:u,nodeExtent:f,children:g}){const[p]=x.useState(()=>wv({nodes:e,edges:t,defaultNodes:r,defaultEdges:n,width:o,height:a,fitView:d,minZoom:i,maxZoom:l,fitViewOptions:c,nodeOrigin:u,nodeExtent:f}));return s.jsx(Ub,{value:p,children:s.jsx(dw,{children:g})})}function jv({children:e,nodes:t,edges:r,defaultNodes:n,defaultEdges:o,width:a,height:i,fitView:l,fitViewOptions:c,minZoom:d,maxZoom:u,nodeOrigin:f,nodeExtent:g}){return x.useContext(jo)?s.jsx(s.Fragment,{children:e}):s.jsx(vv,{initialNodes:t,initialEdges:r,defaultNodes:n,defaultEdges:o,initialWidth:a,initialHeight:i,fitView:l,initialFitViewOptions:c,initialMinZoom:d,initialMaxZoom:u,nodeOrigin:f,nodeExtent:g,children:e})}const kv={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function Nv({nodes:e,edges:t,defaultNodes:r,defaultEdges:n,className:o,nodeTypes:a,edgeTypes:i,onNodeClick:l,onEdgeClick:c,onInit:d,onMove:u,onMoveStart:f,onMoveEnd:g,onConnect:p,onConnectStart:h,onConnectEnd:w,onClickConnectStart:y,onClickConnectEnd:b,onNodeMouseEnter:S,onNodeMouseMove:m,onNodeMouseLeave:v,onNodeContextMenu:j,onNodeDoubleClick:k,onNodeDragStart:C,onNodeDrag:A,onNodeDragStop:T,onNodesDelete:O,onEdgesDelete:$,onDelete:D,onSelectionChange:M,onSelectionDragStart:N,onSelectionDrag:L,onSelectionDragStop:F,onSelectionContextMenu:_,onSelectionStart:I,onSelectionEnd:R,onBeforeDelete:B,connectionMode:H,connectionLineType:ie=ar.Bezier,connectionLineStyle:ge,connectionLineComponent:ee,connectionLineContainerStyle:J,deleteKeyCode:G="Backspace",selectionKeyCode:oe="Shift",selectionOnDrag:te=!1,selectionMode:E=$n.Full,panActivationKeyCode:Q="Space",multiSelectionKeyCode:re=Ks()?"Meta":"Control",zoomActivationKeyCode:ce=Ks()?"Meta":"Control",snapToGrid:ue,snapGrid:fe,onlyRenderVisibleElements:Ee=!1,selectNodesOnDrag:De,nodesDraggable:qe,autoPanOnNodeFocus:Ke,nodesConnectable:V,nodesFocusable:q,nodeOrigin:K=Ku,edgesFocusable:Y,edgesReconnectable:le,elementsSelectable:U=!0,defaultViewport:z=ew,minZoom:se=.5,maxZoom:we=2,translateExtent:ke=Fn,preventScrolling:Fe=!0,nodeExtent:Te,defaultMarkerColor:be="#b1b1b7",zoomOnScroll:Me=!0,zoomOnPinch:Oe=!0,panOnScroll:kt=!1,panOnScrollSpeed:wt=.5,panOnScrollMode:Ie=kr.Free,zoomOnDoubleClick:et=!0,panOnDrag:Ar=!0,onPaneClick:Ao,onPaneMouseEnter:Pr,onPaneMouseMove:sn,onPaneMouseLeave:Zn,onPaneScroll:cr,onPaneContextMenu:Gn,paneClickDistance:er=0,nodeClickDistance:Po=0,children:Qn,onReconnect:es,onReconnectStart:Lo,onReconnectEnd:Nt,onEdgeContextMenu:tr,onEdgeDoubleClick:ts,onEdgeMouseEnter:Fo,onEdgeMouseMove:$o,onEdgeMouseLeave:on,reconnectRadius:dr=10,onNodesChange:Ro,onEdgesChange:Io,noDragClassName:Mo="nodrag",noWheelClassName:rs="nowheel",noPanClassName:an="nopan",fitView:Lr,fitViewOptions:ur,connectOnClick:ns,attributionPosition:P,proOptions:W,defaultEdgeOptions:Z,elevateNodesOnSelect:ne,elevateEdgesOnSelect:ae,disableKeyboardA11y:pe=!1,autoPanOnConnect:de,autoPanOnNodeDrag:Le,autoPanSpeed:Pe,connectionRadius:xe,isValidConnection:_e,onError:st,style:ze,id:ot,nodeDragThreshold:Ve,connectionDragThreshold:ht,viewport:ki,onViewportChange:Fr,width:Xf,height:Jf,colorMode:Zf="light",debug:Gf,onScroll:Ni,ariaLabelConfig:Qf,...eg},tg){const Oo=ot||"1",rg=sw(Zf),ng=x.useCallback(Si=>{Si.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),Ni?.(Si)},[Ni]);return s.jsx("div",{"data-testid":"rf__wrapper",...eg,onScroll:ng,style:{...ze,...kv},ref:tg,className:Ze(["react-flow",o,rg]),id:ot,role:"application",children:s.jsxs(jv,{nodes:e,edges:t,width:Xf,height:Jf,fitView:Lr,fitViewOptions:ur,minZoom:se,maxZoom:we,nodeOrigin:K,nodeExtent:Te,children:[s.jsx(bv,{onInit:d,onNodeClick:l,onEdgeClick:c,onNodeMouseEnter:S,onNodeMouseMove:m,onNodeMouseLeave:v,onNodeContextMenu:j,onNodeDoubleClick:k,nodeTypes:a,edgeTypes:i,connectionLineType:ie,connectionLineStyle:ge,connectionLineComponent:ee,connectionLineContainerStyle:J,selectionKeyCode:oe,selectionOnDrag:te,selectionMode:E,deleteKeyCode:G,multiSelectionKeyCode:re,panActivationKeyCode:Q,zoomActivationKeyCode:ce,onlyRenderVisibleElements:Ee,defaultViewport:z,translateExtent:ke,minZoom:se,maxZoom:we,preventScrolling:Fe,zoomOnScroll:Me,zoomOnPinch:Oe,zoomOnDoubleClick:et,panOnScroll:kt,panOnScrollSpeed:wt,panOnScrollMode:Ie,panOnDrag:Ar,onPaneClick:Ao,onPaneMouseEnter:Pr,onPaneMouseMove:sn,onPaneMouseLeave:Zn,onPaneScroll:cr,onPaneContextMenu:Gn,paneClickDistance:er,nodeClickDistance:Po,onSelectionContextMenu:_,onSelectionStart:I,onSelectionEnd:R,onReconnect:es,onReconnectStart:Lo,onReconnectEnd:Nt,onEdgeContextMenu:tr,onEdgeDoubleClick:ts,onEdgeMouseEnter:Fo,onEdgeMouseMove:$o,onEdgeMouseLeave:on,reconnectRadius:dr,defaultMarkerColor:be,noDragClassName:Mo,noWheelClassName:rs,noPanClassName:an,rfId:Oo,disableKeyboardA11y:pe,nodeExtent:Te,viewport:ki,onViewportChange:Fr}),s.jsx(nw,{nodes:e,edges:t,defaultNodes:r,defaultEdges:n,onConnect:p,onConnectStart:h,onConnectEnd:w,onClickConnectStart:y,onClickConnectEnd:b,nodesDraggable:qe,autoPanOnNodeFocus:Ke,nodesConnectable:V,nodesFocusable:q,edgesFocusable:Y,edgesReconnectable:le,elementsSelectable:U,elevateNodesOnSelect:ne,elevateEdgesOnSelect:ae,minZoom:se,maxZoom:we,nodeExtent:Te,onNodesChange:Ro,onEdgesChange:Io,snapToGrid:ue,snapGrid:fe,connectionMode:H,translateExtent:ke,connectOnClick:ns,defaultEdgeOptions:Z,fitView:Lr,fitViewOptions:ur,onNodesDelete:O,onEdgesDelete:$,onDelete:D,onNodeDragStart:C,onNodeDrag:A,onNodeDragStop:T,onSelectionDrag:L,onSelectionDragStart:N,onSelectionDragStop:F,onMove:u,onMoveStart:f,onMoveEnd:g,noPanClassName:an,nodeOrigin:K,rfId:Oo,autoPanOnConnect:de,autoPanOnNodeDrag:Le,autoPanSpeed:Pe,onError:st,connectionRadius:xe,isValidConnection:_e,selectNodesOnDrag:De,nodeDragThreshold:Ve,connectionDragThreshold:ht,onBeforeDelete:B,paneClickDistance:er,debug:Gf,ariaLabelConfig:Qf}),s.jsx(Qb,{onSelectionChange:M}),Qn,s.jsx(Yb,{proOptions:W,position:P}),s.jsx(Kb,{rfId:Oo,disableKeyboardA11y:pe})]})})}var Sv=Zu(Nv);function Cv(e){const[t,r]=x.useState(e),n=x.useCallback(o=>r(a=>Xu(o,a)),[]);return[t,r,n]}function _v(e){const[t,r]=x.useState(e),n=x.useCallback(o=>r(a=>Ju(o,a)),[]);return[t,r,n]}function Ev({dimensions:e,lineWidth:t,variant:r,className:n}){return s.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:Ze(["react-flow__background-pattern",r,n])})}function Tv({radius:e,className:t}){return s.jsx("circle",{cx:e,cy:e,r:e,className:Ze(["react-flow__background-pattern","dots",t])})}var Yt;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Yt||(Yt={}));const Av={[Yt.Dots]:1,[Yt.Lines]:1,[Yt.Cross]:6},Pv=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function jf({id:e,variant:t=Yt.Dots,gap:r=20,size:n,lineWidth:o=1,offset:a=0,color:i,bgColor:l,style:c,className:d,patternClassName:u}){const f=x.useRef(null),{transform:g,patternId:p}=Re(Pv,Xe),h=n||Av[t],w=t===Yt.Dots,y=t===Yt.Cross,b=Array.isArray(r)?r:[r,r],S=[b[0]*g[2]||1,b[1]*g[2]||1],m=h*g[2],v=Array.isArray(a)?a:[a,a],j=y?[m,m]:S,k=[v[0]*g[2]||1+j[0]/2,v[1]*g[2]||1+j[1]/2],C=`${p}${e||""}`;return s.jsxs("svg",{className:Ze(["react-flow__background",d]),style:{...c,...ko,"--xy-background-color-props":l,"--xy-background-pattern-color-props":i},ref:f,"data-testid":"rf__background",children:[s.jsx("pattern",{id:C,x:g[0]%S[0],y:g[1]%S[1],width:S[0],height:S[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${k[0]},-${k[1]})`,children:w?s.jsx(Tv,{radius:m/2,className:u}):s.jsx(Ev,{dimensions:j,lineWidth:o,variant:t,className:u})}),s.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${C})`})]})}jf.displayName="Background";const Lv=x.memo(jf);function Fv(){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:s.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function $v(){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:s.jsx("path",{d:"M0 0h32v4.2H0z"})})}function Rv(){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:s.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function Iv(){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:s.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function Mv(){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:s.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function ps({children:e,className:t,...r}){return s.jsx("button",{type:"button",className:Ze(["react-flow__controls-button",t]),...r,children:e})}const Ov=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function kf({style:e,showZoom:t=!0,showFitView:r=!0,showInteractive:n=!0,fitViewOptions:o,onZoomIn:a,onZoomOut:i,onFitView:l,onInteractiveChange:c,className:d,children:u,position:f="bottom-left",orientation:g="vertical","aria-label":p}){const h=Ye(),{isInteractive:w,minZoomReached:y,maxZoomReached:b,ariaLabelConfig:S}=Re(Ov,Xe),{zoomIn:m,zoomOut:v,fitView:j}=hi(),k=()=>{m(),a?.()},C=()=>{v(),i?.()},A=()=>{j(o),l?.()},T=()=>{h.setState({nodesDraggable:!w,nodesConnectable:!w,elementsSelectable:!w}),c?.(!w)},O=g==="horizontal"?"horizontal":"vertical";return s.jsxs(Gr,{className:Ze(["react-flow__controls",O,d]),position:f,style:e,"data-testid":"rf__controls","aria-label":p??S["controls.ariaLabel"],children:[t&&s.jsxs(s.Fragment,{children:[s.jsx(ps,{onClick:k,className:"react-flow__controls-zoomin",title:S["controls.zoomIn.ariaLabel"],"aria-label":S["controls.zoomIn.ariaLabel"],disabled:b,children:s.jsx(Fv,{})}),s.jsx(ps,{onClick:C,className:"react-flow__controls-zoomout",title:S["controls.zoomOut.ariaLabel"],"aria-label":S["controls.zoomOut.ariaLabel"],disabled:y,children:s.jsx($v,{})})]}),r&&s.jsx(ps,{className:"react-flow__controls-fitview",onClick:A,title:S["controls.fitView.ariaLabel"],"aria-label":S["controls.fitView.ariaLabel"],children:s.jsx(Rv,{})}),n&&s.jsx(ps,{className:"react-flow__controls-interactive",onClick:T,title:S["controls.interactive.ariaLabel"],"aria-label":S["controls.interactive.ariaLabel"],children:w?s.jsx(Mv,{}):s.jsx(Iv,{})}),u]})}kf.displayName="Controls";const Dv=x.memo(kf);function zv({id:e,x:t,y:r,width:n,height:o,style:a,color:i,strokeColor:l,strokeWidth:c,className:d,borderRadius:u,shapeRendering:f,selected:g,onClick:p}){const{background:h,backgroundColor:w}=a||{},y=i||h||w;return s.jsx("rect",{className:Ze(["react-flow__minimap-node",{selected:g},d]),x:t,y:r,rx:u,ry:u,width:n,height:o,style:{fill:y,stroke:l,strokeWidth:c},shapeRendering:f,onClick:p?b=>p(b,e):void 0})}const Uv=x.memo(zv),Bv=e=>e.nodes.map(t=>t.id),Jo=e=>e instanceof Function?e:()=>e;function Hv({nodeStrokeColor:e,nodeColor:t,nodeClassName:r="",nodeBorderRadius:n=5,nodeStrokeWidth:o,nodeComponent:a=Uv,onClick:i}){const l=Re(Bv,Xe),c=Jo(t),d=Jo(e),u=Jo(r),f=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return s.jsx(s.Fragment,{children:l.map(g=>s.jsx(Wv,{id:g,nodeColorFunc:c,nodeStrokeColorFunc:d,nodeClassNameFunc:u,nodeBorderRadius:n,nodeStrokeWidth:o,NodeComponent:a,onClick:i,shapeRendering:f},g))})}function Vv({id:e,nodeColorFunc:t,nodeStrokeColorFunc:r,nodeClassNameFunc:n,nodeBorderRadius:o,nodeStrokeWidth:a,shapeRendering:i,NodeComponent:l,onClick:c}){const{node:d,x:u,y:f,width:g,height:p}=Re(h=>{const{internals:w}=h.nodeLookup.get(e),y=w.userNode,{x:b,y:S}=w.positionAbsolute,{width:m,height:v}=Qt(y);return{node:y,x:b,y:S,width:m,height:v}},Xe);return!d||d.hidden||!ku(d)?null:s.jsx(l,{x:u,y:f,width:g,height:p,style:d.style,selected:!!d.selected,className:n(d),color:t(d),borderRadius:o,strokeColor:r(d),strokeWidth:a,shapeRendering:i,onClick:c,id:d.id})}const Wv=x.memo(Vv);var qv=x.memo(Hv);const Kv=200,Yv=150,Xv=e=>!e.hidden,Jv=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?ju(Xn(e.nodeLookup,{filter:Xv}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},Zv="react-flow__minimap-desc";function Nf({style:e,className:t,nodeStrokeColor:r,nodeColor:n,nodeClassName:o="",nodeBorderRadius:a=5,nodeStrokeWidth:i,nodeComponent:l,bgColor:c,maskColor:d,maskStrokeColor:u,maskStrokeWidth:f,position:g="bottom-right",onClick:p,onNodeClick:h,pannable:w=!1,zoomable:y=!1,ariaLabel:b,inversePan:S,zoomStep:m=10,offsetScale:v=5}){const j=Ye(),k=x.useRef(null),{boundingRect:C,viewBB:A,rfId:T,panZoom:O,translateExtent:$,flowWidth:D,flowHeight:M,ariaLabelConfig:N}=Re(Jv,Xe),L=e?.width??Kv,F=e?.height??Yv,_=C.width/L,I=C.height/F,R=Math.max(_,I),B=R*L,H=R*F,ie=v*R,ge=C.x-(B-C.width)/2-ie,ee=C.y-(H-C.height)/2-ie,J=B+ie*2,G=H+ie*2,oe=`${Zv}-${T}`,te=x.useRef(0),E=x.useRef();te.current=R,x.useEffect(()=>{if(k.current&&O)return E.current=wb({domNode:k.current,panZoom:O,getTransform:()=>j.getState().transform,getViewScale:()=>te.current}),()=>{E.current?.destroy()}},[O]),x.useEffect(()=>{E.current?.update({translateExtent:$,width:D,height:M,inversePan:S,pannable:w,zoomStep:m,zoomable:y})},[w,y,S,m,$,D,M]);const Q=p?ue=>{const[fe,Ee]=E.current?.pointer(ue)||[0,0];p(ue,{x:fe,y:Ee})}:void 0,re=h?x.useCallback((ue,fe)=>{const Ee=j.getState().nodeLookup.get(fe).internals.userNode;h(ue,Ee)},[]):void 0,ce=b??N["minimap.ariaLabel"];return s.jsx(Gr,{position:g,style:{...e,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-stroke-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-stroke-width-props":typeof f=="number"?f*R:void 0,"--xy-minimap-node-background-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-width-props":typeof i=="number"?i:void 0},className:Ze(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:s.jsxs("svg",{width:L,height:F,viewBox:`${ge} ${ee} ${J} ${G}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":oe,ref:k,onClick:Q,children:[ce&&s.jsx("title",{id:oe,children:ce}),s.jsx(qv,{onClick:re,nodeColor:n,nodeStrokeColor:r,nodeBorderRadius:a,nodeClassName:o,nodeStrokeWidth:i,nodeComponent:l}),s.jsx("path",{className:"react-flow__minimap-mask",d:`M${ge-ie},${ee-ie}h${J+ie*2}v${G+ie*2}h${-J-ie*2}z
        M${A.x},${A.y}h${A.width}v${A.height}h${-A.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}Nf.displayName="MiniMap";const Gv=x.memo(Nf),Qv=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,e1={[Zr.Line]:"right",[Zr.Handle]:"bottom-right"};function t1({nodeId:e,position:t,variant:r=Zr.Handle,className:n,style:o=void 0,children:a,color:i,minWidth:l=10,minHeight:c=10,maxWidth:d=Number.MAX_VALUE,maxHeight:u=Number.MAX_VALUE,keepAspectRatio:f=!1,resizeDirection:g,autoScale:p=!0,shouldResize:h,onResizeStart:w,onResize:y,onResizeEnd:b}){const S=tf(),m=typeof e=="string"?e:S,v=Ye(),j=x.useRef(null),k=r===Zr.Handle,C=Re(x.useCallback(Qv(k&&p),[k,p]),Xe),A=x.useRef(null),T=t??e1[r];x.useEffect(()=>{if(!(!j.current||!m))return A.current||(A.current=Ib({domNode:j.current,nodeId:m,getStoreItems:()=>{const{nodeLookup:$,transform:D,snapGrid:M,snapToGrid:N,nodeOrigin:L,domNode:F}=v.getState();return{nodeLookup:$,transform:D,snapGrid:M,snapToGrid:N,nodeOrigin:L,paneDomNode:F}},onChange:($,D)=>{const{triggerNodeChanges:M,nodeLookup:N,parentLookup:L,nodeOrigin:F}=v.getState(),_=[],I={x:$.x,y:$.y},R=N.get(m);if(R&&R.expandParent&&R.parentId){const B=R.origin??F,H=$.width??R.measured.width??0,ie=$.height??R.measured.height??0,ge={id:R.id,parentId:R.parentId,rect:{width:H,height:ie,...Nu({x:$.x??R.position.x,y:$.y??R.position.y},{width:H,height:ie},R.parentId,N,B)}},ee=pi([ge],N,L,F);_.push(...ee),I.x=$.x?Math.max(B[0]*H,$.x):void 0,I.y=$.y?Math.max(B[1]*ie,$.y):void 0}if(I.x!==void 0&&I.y!==void 0){const B={id:m,type:"position",position:{...I}};_.push(B)}if($.width!==void 0&&$.height!==void 0){const H={id:m,type:"dimensions",resizing:!0,setAttributes:g?g==="horizontal"?"width":"height":!0,dimensions:{width:$.width,height:$.height}};_.push(H)}for(const B of D){const H={...B,type:"position"};_.push(H)}M(_)},onEnd:({width:$,height:D})=>{const M={id:m,type:"dimensions",resizing:!1,dimensions:{width:$,height:D}};v.getState().triggerNodeChanges([M])}})),A.current.update({controlPosition:T,boundaries:{minWidth:l,minHeight:c,maxWidth:d,maxHeight:u},keepAspectRatio:f,resizeDirection:g,onResizeStart:w,onResize:y,onResizeEnd:b,shouldResize:h}),()=>{A.current?.destroy()}},[T,l,c,d,u,f,w,y,b,h]);const O=T.split("-");return s.jsx("div",{className:Ze(["react-flow__resize-control","nodrag",...O,r,n]),ref:j,style:{...o,scale:C,...i&&{[k?"backgroundColor":"borderColor"]:i}},children:a})}x.memo(t1);var Zo={exports:{}},Go={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zl;function r1(){if(Zl)return Go;Zl=1;var e=ig();function t(c,d){return c===d&&(c!==0||1/c===1/d)||c!==c&&d!==d}var r=typeof Object.is=="function"?Object.is:t,n=e.useSyncExternalStore,o=e.useRef,a=e.useEffect,i=e.useMemo,l=e.useDebugValue;return Go.useSyncExternalStoreWithSelector=function(c,d,u,f,g){var p=o(null);if(p.current===null){var h={hasValue:!1,value:null};p.current=h}else h=p.current;p=i(function(){function y(j){if(!b){if(b=!0,S=j,j=f(j),g!==void 0&&h.hasValue){var k=h.value;if(g(k,j))return m=k}return m=j}if(k=m,r(S,j))return k;var C=f(j);return g!==void 0&&g(k,C)?(S=j,k):(S=j,m=C)}var b=!1,S,m,v=u===void 0?null:u;return[function(){return y(d())},v===null?void 0:function(){return y(v())}]},[d,u,f,g]);var w=n(c,p[0],p[1]);return a(function(){h.hasValue=!0,h.value=w},[w]),l(w),w},Go}var Gl;function n1(){return Gl||(Gl=1,Zo.exports=r1()),Zo.exports}var s1=n1();function o1(e){e()}function a1(){let e=null,t=null;return{clear(){e=null,t=null},notify(){o1(()=>{let r=e;for(;r;)r.callback(),r=r.next})},get(){const r=[];let n=e;for(;n;)r.push(n),n=n.next;return r},subscribe(r){let n=!0;const o=t={callback:r,next:null,prev:t};return o.prev?o.prev.next=o:e=o,function(){!n||e===null||(n=!1,o.next?o.next.prev=o.prev:t=o.prev,o.prev?o.prev.next=o.next:e=o.next)}}}}var Ql={notify(){},get:()=>[]};function i1(e,t){let r,n=Ql,o=0,a=!1;function i(w){u();const y=n.subscribe(w);let b=!1;return()=>{b||(b=!0,y(),f())}}function l(){n.notify()}function c(){h.onStateChange&&h.onStateChange()}function d(){return a}function u(){o++,r||(r=e.subscribe(c),n=a1())}function f(){o--,r&&o===0&&(r(),r=void 0,n.clear(),n=Ql)}function g(){a||(a=!0,u())}function p(){a&&(a=!1,f())}const h={addNestedSub:i,notifyNestedSubs:l,handleChangeWrapper:c,isSubscribed:d,trySubscribe:g,tryUnsubscribe:p,getListeners:()=>n};return h}var l1=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",c1=l1(),d1=()=>typeof navigator<"u"&&navigator.product==="ReactNative",u1=d1(),f1=()=>c1||u1?x.useLayoutEffect:x.useEffect,g1=f1(),p1=Symbol.for("react-redux-context"),h1=typeof globalThis<"u"?globalThis:{};function m1(){if(!x.createContext)return{};const e=h1[p1]??=new Map;let t=e.get(x.createContext);return t||(t=x.createContext(null),e.set(x.createContext,t)),t}var lr=m1();function x1(e){const{children:t,context:r,serverState:n,store:o}=e,a=x.useMemo(()=>{const c=i1(o);return{store:o,subscription:c,getServerState:n?()=>n:void 0}},[o,n]),i=x.useMemo(()=>o.getState(),[o]);g1(()=>{const{subscription:c}=a;return c.onStateChange=c.notifyNestedSubs,c.trySubscribe(),i!==o.getState()&&c.notifyNestedSubs(),()=>{c.tryUnsubscribe(),c.onStateChange=void 0}},[a,i]);const l=r||lr;return x.createElement(l.Provider,{value:a},t)}var y1=x1;function xi(e=lr){return function(){return x.useContext(e)}}var Sf=xi();function Cf(e=lr){const t=e===lr?Sf:xi(e),r=()=>{const{store:n}=t();return n};return Object.assign(r,{withTypes:()=>r}),r}var b1=Cf();function w1(e=lr){const t=e===lr?b1:Cf(e),r=()=>t().dispatch;return Object.assign(r,{withTypes:()=>r}),r}var v1=w1(),j1=(e,t)=>e===t;function k1(e=lr){const t=e===lr?Sf:xi(e),r=(n,o={})=>{const{equalityFn:a=j1}=typeof o=="function"?{equalityFn:o}:o,i=t(),{store:l,subscription:c,getServerState:d}=i;x.useRef(!0);const u=x.useCallback({[n.name](g){return n(g)}}[n.name],[n]),f=s1.useSyncExternalStoreWithSelector(c.addNestedSub,l.getState,d||l.getState,u,a);return x.useDebugValue(f),f};return Object.assign(r,{withTypes:()=>r}),r}var N1=k1();const yi={Start:{label:"Start",icon:"▶️",color:"bg-green-500 hover:bg-green-600",description:"Start point of the workflow",category:"Flow Control"},End:{label:"End",icon:"⏹️",color:"bg-red-500 hover:bg-red-600",description:"End point of the workflow",category:"Flow Control"},FileRead:{label:"File Read",icon:"📄",color:"bg-teal-300 hover:bg-teal-400",description:"Read files from storage",category:"Data"},FileUpload:{label:"File Upload",icon:"⬆️",color:"bg-teal-500 hover:bg-teal-600",description:"Upload files to workflow",category:"Data"},DataSort:{label:"Sort",icon:"🔢",color:"bg-blue-600 hover:bg-blue-700",description:"Sort data by specific fields",category:"Data"},DataFilter:{label:"Filter",icon:"🔍",color:"bg-blue-300 hover:bg-blue-400",description:"Filter data based on criteria",category:"Data"},Calculation:{label:"Calculate",icon:"🧮",color:"bg-indigo-400 hover:bg-indigo-500",description:"Perform calculations on data",category:"Business Logic"},ChartCreation:{label:"Create Chart",icon:"📈",color:"bg-violet-400 hover:bg-violet-500",description:"Create charts and graphs",category:"Reporting"},ApiCall:{label:"API Call",icon:"🌐",color:"bg-teal-500 hover:bg-teal-600",description:"Make external API calls",category:"Integration"},EmailSend:{label:"Send Email",icon:"📧",color:"bg-orange-500 hover:bg-orange-600",description:"Send email notifications",category:"Communication"}},S1=Object.keys(yi);function C1(e,t=[]){const r={};for(const o of S1){const a=yi[o];if(!a||!a.category)continue;const i=a.category;r[i]||(r[i]={name:e(i),nodes:[]}),r[i].nodes.push({type:o,label:e(a.label||o),icon:a.icon||"❔",color:a.color||"bg-gray-400 hover:bg-gray-500",description:e(a.description||""),category:e(i)})}return t.length>0&&(r["Custom Forms"]={name:e("Custom Forms"),nodes:t.map(o=>({type:`custom_${o.id}`,label:e(o.name),icon:"�",color:"bg-purple-500 hover:bg-purple-600",description:e(o.description||"Custom form node"),category:e("Custom Forms")}))}),["Flow Control","Data","Business Logic","Reporting","E-Commerce","Integration","Communication","Forms","Custom Forms"].map(o=>r[o]).filter(Boolean)}const _1=({type:e,label:t,icon:r,color:n,description:o,category:a})=>{const{darkMode:i}=nt(),l=(c,d)=>{c.dataTransfer.setData("application/reactflow",d),c.dataTransfer.effectAllowed="move",c.dataTransfer.setData("text/plain",d)};return s.jsxs("div",{className:`${n} rounded-lg p-3 cursor-grab active:cursor-grabbing shadow-md border transition-transform hover:scale-105 ${i?"border-gray-600":"border-gray-200"}`,onDragStart:c=>l(c,e),draggable:!0,tabIndex:0,"aria-grabbed":"false",role:"option",title:o,onTouchStart:c=>c.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"text-white text-lg",children:r}),s.jsx("div",{className:"text-white font-medium text-sm",children:t})]}),s.jsx("div",{className:"text-xs text-white/80 mt-1",children:a})]})},E1=()=>{const{t:e}=gt(),{darkMode:t}=nt(),[r,n]=x.useState(""),[o,a]=x.useState(!1),[i,l]=x.useState([]),c=x.useCallback(()=>{je.forms.listAll().then(g=>{if(console.log("✅ API forms result:",g.data),g.data&&Array.isArray(g.data)){const p=g.data.filter(h=>h.category==="custom"||h.category==="CUSTOM");console.log("📝 Custom forms trovati:",p.length),l(p.map(h=>({id:h.id,name:h.name,description:h.description})))}}).catch(g=>{console.error("❌ API forms error:",g),l([])})},[]);x.useEffect(()=>{c()},[c]),x.useEffect(()=>{const g=()=>{console.log("🔄 NodePalette: Ricevuto evento di aggiornamento forms"),c()};return window.addEventListener("formsUpdated",g),()=>{window.removeEventListener("formsUpdated",g)}},[c]);const d=x.useMemo(()=>C1(e,i),[e,i]),[u,f]=x.useState(d);return x.useEffect(()=>{const g=setTimeout(()=>{if(!r.trim())f(d);else{const p=r.toLowerCase();f(d.map(h=>({...h,nodes:h.nodes.filter(w=>w.label.toLowerCase().includes(p)||w.description&&w.description.toLowerCase().includes(p))})).filter(h=>h.nodes.length>0))}},200);return()=>clearTimeout(g)},[r,d]),s.jsxs("div",{className:`fixed top-0 left-0 z-30 h-full bg-white dark:bg-gray-800 shadow-lg border-r border-gray-200 dark:border-gray-700 transition-all duration-200 flex flex-col ${o?"w-16":"w-80"}`,style:{minWidth:o?64:320,maxWidth:o?64:400},children:[s.jsx("button",{className:"absolute -right-4 top-4 w-8 h-8 flex items-center justify-center rounded-full bg-purple-600 hover:bg-purple-700 text-white shadow-lg z-40",onClick:()=>a(g=>!g),"aria-label":e(o?"Espandi palette":"Comprimi palette"),tabIndex:0,children:o?s.jsx(Ad,{}):s.jsx(Td,{})}),o?s.jsx("div",{className:"flex flex-col items-center pt-8 gap-2 overflow-y-auto",children:u.map(g=>s.jsx("div",{className:"flex flex-col items-center gap-2 mb-4",children:g.nodes.map(p=>s.jsx("div",{className:`rounded-lg p-2 cursor-grab active:cursor-grabbing shadow-md border transition-transform hover:scale-110 ${p.color} flex items-center justify-center w-10 h-10`,onDragStart:h=>{h.dataTransfer.setData("application/reactflow",p.type),h.dataTransfer.effectAllowed="move",h.dataTransfer.setData("text/plain",p.type)},draggable:!0,tabIndex:0,"aria-grabbed":"false",role:"option",title:p.label,onTouchStart:h=>h.stopPropagation(),children:s.jsx("span",{className:"text-white text-xl",children:p.icon})},p.type))},g.name))}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`flex items-center gap-3 justify-center py-6 border-b ${t?"border-gray-700":"border-gray-200"}`,children:[s.jsx("img",{src:t?"/dark_logo.png":"/logoGT.png",alt:t?"Dark Logo":"Logo",className:"h-10 w-10 object-contain"}),s.jsx("span",{className:`text-2xl font-bold tracking-tight ${t?"text-white":"text-gray-900"}`,children:e("Node Palette")})]}),s.jsxs("div",{className:`px-4 pt-2 pb-4 border-b ${t?"border-gray-700":"border-gray-200"}`,children:[s.jsx("p",{className:`text-sm ${t?"text-gray-300":"text-gray-600"}`,children:e("Drag nodes to the canvas to build your workflow")}),s.jsxs("div",{className:"relative mt-4",children:[s.jsx("input",{type:"text",value:r,onChange:g=>n(g.target.value),placeholder:e("Search nodes..."),className:"w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 placeholder-gray-500 dark:placeholder-gray-400 transition-colors"}),s.jsx("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500 w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),r&&s.jsx("button",{onClick:()=>n(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 transition-colors",type:"button",children:"✕"})]})]}),s.jsx("div",{className:"p-4 space-y-6 overflow-y-auto",children:u.map(g=>s.jsxs("div",{children:[s.jsx("h4",{className:`text-sm font-medium mb-3 ${t?"text-gray-200":"text-gray-700"}`,children:g.name}),s.jsx("div",{className:"space-y-2",children:g.nodes.map(p=>s.jsx(_1,{type:p.type,label:p.label,icon:p.icon,color:p.color,description:p.description,category:p.category},p.type))})]},g.name))})]})]})},T1=({nodes:e,edges:t,workflowId:r,onValidationResult:n,onSave:o})=>{const[a,i]=x.useState(!1),[l,c]=x.useState(!1),[d,u]=x.useState(!1),[f,g]=x.useState(null),p=x.useCallback(()=>{const m=[],v=[],j=e.filter($=>$.type==="START"||$.type==="startNode");j.length===0?m.push("Il workflow deve avere almeno un nodo Start"):j.length>1&&v.push("Il workflow ha più nodi Start, solo il primo sarà utilizzato"),e.filter($=>$.type==="END"||$.type==="endNode").length===0&&v.push("Il workflow dovrebbe avere almeno un nodo End");const C=new Set;t.forEach($=>{C.add($.source),C.add($.target)});const A=e.filter($=>!C.has($.id)&&$.type!=="START"&&$.type!=="startNode"&&$.type!=="END"&&$.type!=="endNode");A.length>0&&v.push(`Nodi isolati trovati: ${A.map($=>$.data.label).join(", ")}`),e.forEach($=>{const D=$.data,M=D.config||{};($.type==="EMAIL_SEND"||$.type==="emailSendNode")&&((!M.recipients||M.recipients.length===0)&&v.push(`Nodo Email "${D.label}": mancano i destinatari`),M.subject||v.push(`Nodo Email "${D.label}": manca l'oggetto`)),($.type==="API_CALL"||$.type==="apiCallNode")&&(M.url||v.push(`Nodo API "${D.label}": manca l'URL`)),($.type==="DELAY"||$.type==="delayNode")&&(!M.duration||M.duration<=0)&&v.push(`Nodo Delay "${D.label}": durata non valida`),($.type==="APPROVAL"||$.type==="approvalNode")&&(!M.approvers||M.approvers.length===0)&&v.push(`Nodo Approval "${D.label}": mancano gli approvatori`)}),h(e,t)&&m.push("Il workflow contiene cicli non permessi");const O={isValid:m.length===0,errors:m,warnings:v};return g(O),n&&n(O),O},[e,t,n]),h=(m,v)=>{try{const j={},k=new Set,C=new Set;m.forEach(T=>{j[T.id]=[]}),v.forEach(T=>{j[T.source]&&j[T.source].push(T.target)});const A=T=>{k.add(T),C.add(T);for(const O of j[T]||[])if(k.has(O)){if(C.has(O))return!0}else if(A(O))return!0;return C.delete(T),!1};for(const T of Object.keys(j))if(!k.has(T)&&A(T))return!0;return!1}catch(j){return console.warn("Errore durante la verifica dei cicli:",j),!1}};return{validateWorkflow:p,validateWorkflowRemote:async()=>{if(!r)return null;try{i(!0);const m={isValid:!0,errors:[],warnings:[]};return g(m),n&&n(m),m}catch(m){return console.error("Errore durante la validazione remota:",m),null}finally{i(!1)}},saveWorkflow:async()=>{try{console.log("🚀 saveWorkflow called in WorkflowManager"),console.log("📊 onSave callback available:",!!o),console.log("📊 workflowId:",r),console.log("📊 nodes count:",e.length),console.log("📊 edges count:",t.length),c(!0);const m=p();if(!m.isValid)return alert(`Impossibile salvare il workflow:
${m.errors.join(`
`)}`),!1;if(m.warnings.length>0&&!confirm(`Avvertenze trovate:
${m.warnings.join(`
`)}

Vuoi continuare comunque?`))return!1;if(o)return console.log("📤 Using parent onSave callback..."),await o(e,t),console.log("✅ Parent onSave completed successfully"),!0;const v=e.map(T=>{const O=T.data;if(T.type==="CUSTOM"||O?.type&&String(O.type).startsWith("custom_")){const $={...T,data:{...T.data,form_metadata:{created_at:new Date().toISOString(),form_type:"workflow_custom",version:1}}};return console.log("💾 Processing custom form node:",$),$}return T});console.log("📤 Saving via direct API call...");const j=je;let k={};try{if(r&&r.length>10&&r.includes("-")){console.log("🔍 Recupero settings esistenti per workflow:",r);const T=await j.workflows.list(),$=(T.data?.workflows||(Array.isArray(T.data)?T.data:T.data.items||[])).find(D=>D.id===r);console.log("📦 Workflow corrente trovato:",$?"SI":"NO"),console.log("📦 Current workflow object keys:",$?Object.keys($):"N/A"),console.log("📦 Current settings value:",$?.settings),console.log("📦 Current settings type:",typeof $?.settings),$&&$.settings?(k=typeof $.settings=="string"?JSON.parse($.settings):$.settings||{},console.log("✅ Settings esistenti recuperate:",k),console.log("📊 Settings keys:",Object.keys(k))):console.log("⚠️ Settings non presenti nel workflow corrente o workflow non trovato")}}catch(T){console.warn("⚠️ Impossibile recuperare le impostazioni esistenti, procederò senza merge:",T)}const C={id:r||`workflow_${Date.now()}`,name:`Workflow ${new Date().toLocaleDateString()}`,description:"Workflow creato con il builder visuale",category:"CUSTOM",priority:"medium",status:"draft",visual_nodes:JSON.stringify(v.map(T=>({...T,data:{...T.data,...T?.data&&T.data.fieldMapping?{fieldMapping:T.data.fieldMapping}:{}}}))),visual_edges:JSON.stringify(t),tags:JSON.stringify([]),settings:JSON.stringify(k||{}),steps:JSON.stringify([]),created_by:"user",version:1};console.log("🚀 [WORKFLOW SAVE] workflowData.settings BEFORE sending:",C.settings),console.log("🚀 [WORKFLOW SAVE] existingSettings object:",k),console.log("🚀 [WORKFLOW SAVE] existingSettings stringified:",JSON.stringify(k||{}));let A;if(r&&r.length>10&&r.includes("-"))console.log("📝 Updating existing workflow:",r),A=await j.workflows.update(C);else{console.log("➕ Creating new workflow...");const{id:T,...O}=C;A=await j.workflows.create(O)}return console.log("✅ Workflow salvato:",A),alert("Workflow salvato con successo!"),!0}catch(m){return console.error("❌ Errore nel salvataggio:",m),alert("Errore nel salvataggio del workflow. Controlla la console per dettagli."),!1}finally{c(!1)}},executeWorkflow:async()=>{try{u(!0);const m=p();return m.isValid?(console.warn("⚠️ API di esecuzione workflow temporaneamente disabilitata per debug"),console.log("🚀 Workflow che sarebbe stato eseguito:",{workflowId:r,nodes:e.length,edges:t.length}),alert(`Esecuzione simulata completata!

Nodi: ${e.length}
Connessioni: ${t.length}`),!0):(alert(`Impossibile eseguire il workflow:
${m.errors.join(`
`)}`),!1)}catch(m){return console.error("❌ Errore nell'esecuzione:",m),alert("Errore durante l'esecuzione del workflow. Controlla la console per dettagli."),!1}finally{u(!1)}},loadWorkflow:async m=>{try{console.log("🔄 Loading workflow with ID:",m);const v=await je.workflows.list(),k=(v.data?.workflows||(Array.isArray(v.data)?v.data:v.data.items||[])).find(T=>T.id===m);if(!k)return console.error("❌ Workflow not found:",m),null;console.log("✅ Workflow found:",k.name);let C=[],A=[];try{if(k.visual_nodes){const T=typeof k.visual_nodes=="string"?JSON.parse(k.visual_nodes):k.visual_nodes;C=Array.isArray(T)?T:[],console.log(`📊 Loaded ${C.length} nodes`)}if(k.visual_edges){const T=typeof k.visual_edges=="string"?JSON.parse(k.visual_edges):k.visual_edges;A=Array.isArray(T)?T:[],console.log(`📊 Loaded ${A.length} edges`)}return C.length===0&&(console.log("📝 No nodes found, creating default nodes"),C=[{id:"start_default",type:"START",position:{x:100,y:100},data:{label:"Start",type:"START",category:"Flow Control",status:"configured"}},{id:"end_default",type:"END",position:{x:400,y:100},data:{label:"End",type:"END",category:"Flow Control",status:"configured"}}],A=[{id:"edge_default",source:"start_default",target:"end_default",type:"default"}]),{nodes:C,edges:A}}catch(T){return console.error("❌ Error parsing workflow visual data:",T),null}}catch(v){return console.error("❌ Error loading workflow:",v),null}},isValidating:a,isSaving:l,isExecuting:d,lastValidation:f}};class A1 extends x.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){console.error("WorkflowBuilder Error Boundary caught an error:",t,r),this.setState({error:t,errorInfo:r})}render(){return this.state.hasError?s.jsx("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-100 p-8",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-2xl w-full",children:[s.jsxs("div",{className:"flex items-center mb-6",children:[s.jsx("div",{className:"text-red-500 text-4xl mr-4",children:"⚠️"}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Errore nel Workflow Builder"}),s.jsx("p",{className:"text-gray-600",children:"Si è verificato un errore inaspettato."})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Dettagli dell'errore:"}),s.jsx("div",{className:"bg-gray-100 p-4 rounded-lg text-sm text-gray-700 font-mono",children:this.state.error?.message||"Errore sconosciuto"})]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Ricarica la pagina"}),s.jsx("button",{onClick:()=>this.setState({hasError:!1,error:void 0,errorInfo:void 0}),className:"px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Riprova"})]}),!1]})}):this.props.children}}zc.config({placement:"bottomRight",bottom:16,maxCount:4});const _f=()=>typeof document<"u"&&document.documentElement.classList.contains("dark"),P1=()=>typeof navigator<"u"&&/windows/i.test(navigator.userAgent),L1=()=>{if(typeof document>"u")return!1;const e=document.visibilityState&&document.visibilityState!=="visible",t=typeof document.hasFocus=="function"?!document.hasFocus():!1;return!!(e||t)},Ef=()=>typeof window<"u"&&typeof document<"u"&&"Notification"in window&&L1()&&P1(),Xs=e=>e==null||typeof e=="boolean"?"":typeof e=="string"||typeof e=="number"?String(e):Array.isArray(e)?e.map(Xs).join(" "):he.isValidElement(e)?Xs(e.props?.children):"";let hs=null;const F1=()=>typeof window>"u"||!("Notification"in window)?Promise.resolve("denied"):Notification.permission!=="default"?Promise.resolve(Notification.permission):(hs||(hs=Notification.requestPermission().finally(()=>{hs=null})),hs),$1=async(e,t)=>{if(!Ef()||await F1()!=="granted")return;const n=Xs(e)||"Secure Portal",o=Xs(t)||void 0,a=_f()?"/logoGT.png":"/dark_logo.png";try{const i=new Notification(n,{body:o,icon:a,badge:"/favicon.ico",tag:"secure-portal-toast",silent:!1});i.onclick=()=>{window.focus(),i.close()}}catch(i){console.warn("Desktop notification failed",i)}};function ms(e,t,r,n=3.5){const o=_f(),a=`app-notification ${o?"app-notification--dark":"app-notification--light"} app-notification-${e||"default"}`,i=o?"/logoGT.png":"/dark_logo.png",l=s.jsx("img",{src:i,alt:"logo",style:{width:22,height:22,borderRadius:4,objectFit:"contain"}});zc.open({message:t,description:r,icon:l,className:a,duration:n,closeIcon:null,placement:"bottomRight"}),Ef()&&$1(t,r).catch(()=>{})}const me={success(e,t,r){ms("success",e,t,r)},error(e,t,r){ms("error",e,t,r??5)},info(e,t,r){ms("info",e,t,r)},warning(e,t,r){ms("warning",e,t,r)}},{TabPane:R1}=Uc;if(typeof document<"u"){const e="field-mapping-dark-mode-styles";if(!document.getElementById(e)){const t=document.createElement("style");t.id=e,t.textContent=`
      .dark .ant-select-dropdown {
        background-color: #111827 !important;
        border: 1px solid #1a1d23 !important;
      }
      .dark .ant-select-item {
        color: #d1d5db !important;
        background-color: #111827 !important;
      }
      .dark .ant-select-item-option-selected {
        background-color: #1a1d23 !important;
        color: white !important;
      }
      .dark .ant-select-item-option-active {
        background-color: #1a1d23 !important;
      }
      .dark .ant-select-item-option:hover {
        background-color: #1a1d23 !important;
      }
      .dark .ant-tag {
        background-color: rgba(139, 92, 246, 0.2) !important;
        border-color: rgba(139, 92, 246, 0.3) !important;
        color: #c4b5fd !important;
      }
      .dark .ant-empty-description {
        color: #9ca3af !important;
      }
    `,document.head.appendChild(t)}}const I1=[{label:"Interazione umana",options:[{label:"Manuale",value:"manual"},{label:"Calendario",value:"calendar"}]},{label:"Automazioni e integrazioni",options:[{label:"Webhook HTTP",value:"webhook"},{label:"Scheduler",value:"schedule"},{label:"WebSocket",value:"websocket"},{label:"Database",value:"database"}]}],M1=["POST","GET","PUT","PATCH","DELETE"],ec=[{label:"UTC",value:"UTC"},{label:"Europe/Rome",value:"Europe/Rome"},{label:"Europe/London",value:"Europe/London"},{label:"America/New_York",value:"America/New_York"},{label:"Asia/Singapore",value:"Asia/Singapore"}],O1=[{label:"PostgreSQL",value:"postgres"},{label:"MySQL",value:"mysql"},{label:"SQL Server",value:"mssql"},{label:"SQLite",value:"sqlite"},{label:"Oracle",value:"oracle"}],Qr=e=>{if(!e)return;const t=e.trim();if(t)return t.startsWith("/")?t:`/${t}`},xs=e=>{if(e==null||e==="")return;const t=Number(e);return Number.isFinite(t)?t:void 0},_t=(e="manual",t)=>{const r={type:e,enabled:t?.enabled??!0,label:t?.label,id:t?.id};switch(e){case"manual":return{...r,mode:t?.mode??"manual"};case"webhook":return{...r,method:(t?.method||"POST").toUpperCase(),path:Qr(t?.path)||"/webhook",secret:t?.secret,bearerToken:t?.bearerToken,allowedIps:t?.allowedIps||[]};case"schedule":return{...r,scheduleMode:t?.scheduleMode||"interval",intervalSeconds:t?.intervalSeconds??300,cron:t?.cron,timezone:t?.timezone||"UTC"};case"websocket":return{...r,path:Qr(t?.path)||"/ws"};case"database":return{...r,databaseType:t?.databaseType||"postgres",table:t?.table||"",pollInterval:t?.pollInterval??60,connection:t?.connection};case"calendar":return{...r,startAt:t?.startAt||"",timezone:t?.timezone||"UTC",repeatType:t?.repeatType||"none",repeatIntervalSeconds:t?.repeatIntervalSeconds,repeatCron:t?.repeatCron,repeatCount:t?.repeatCount,repeatUntil:t?.repeatUntil};default:return r}},D1=e=>{const t=typeof e=="string"?e.trim().toLowerCase():"manual";return["manual","webhook","schedule","websocket","database","calendar"].includes(t)?t:"manual"},z1=e=>{if(!e||typeof e!="object")return null;const t=D1(e.type),r=_t(t);switch(r.id=e.id?String(e.id):void 0,r.label=e.label?String(e.label):void 0,r.enabled=e.enabled===void 0?!0:!!e.enabled,t){case"manual":r.mode=e.mode?String(e.mode):r.mode;break;case"webhook":r.method=e.method?String(e.method).toUpperCase():r.method,r.path=Qr(e.path)||r.path,r.secret=e.secret?String(e.secret):void 0,r.bearerToken=e.bearerToken?String(e.bearerToken):void 0,r.allowedIps=Array.isArray(e.allowedIps)?e.allowedIps.map(n=>String(n).trim()).filter(Boolean):[];break;case"schedule":r.timezone=e.timezone?String(e.timezone):r.timezone,e.cron?(r.scheduleMode="cron",r.cron=String(e.cron)):(r.scheduleMode="interval",r.intervalSeconds=xs(e.intervalSeconds)??r.intervalSeconds);break;case"websocket":r.path=Qr(e.path)||r.path;break;case"database":r.databaseType=e.databaseType?String(e.databaseType):r.databaseType,r.table=e.table?String(e.table):r.table,r.pollInterval=xs(e.pollInterval)??r.pollInterval,r.connection=e.connection?String(e.connection):void 0;break;case"calendar":if(r.startAt=e.startAt?String(e.startAt):r.startAt,r.timezone=e.timezone?String(e.timezone):r.timezone,e.repeat){const n=e.repeat;n.cron?(r.repeatType="cron",r.repeatCron=String(n.cron)):n.intervalSeconds&&(r.repeatType="interval",r.repeatIntervalSeconds=xs(n.intervalSeconds)),n.count!==void 0&&(r.repeatCount=xs(n.count)),n.until&&(r.repeatUntil=String(n.until))}break}return r},U1=e=>{if(e==null)return[_t("manual")];let t=e;if(typeof e=="string"){const o=e.trim();if(!o)return[_t("manual")];try{t=JSON.parse(o)}catch{return[_t("manual")]}}const n=(Array.isArray(t)?t:[t]).map(z1).filter(o=>o!==null);return n.length>0?n:[_t("manual")]},tc=e=>{const t={type:e.type,enabled:e.enabled};switch(e.id&&e.id.trim()&&(t.id=e.id.trim()),e.label&&e.label.trim()&&(t.label=e.label.trim()),e.type){case"manual":e.mode&&e.mode.trim()&&(t.mode=e.mode.trim());break;case"webhook":if(t.method=(e.method||"POST").toUpperCase(),t.path=Qr(e.path)||"/",e.secret&&e.secret.trim()&&(t.secret=e.secret.trim()),e.bearerToken&&e.bearerToken.trim()&&(t.bearerToken=e.bearerToken.trim()),e.allowedIps&&e.allowedIps.length>0){const r=e.allowedIps.map(n=>n.trim()).filter(Boolean);r.length>0&&(t.allowedIps=r)}break;case"schedule":t.timezone=e.timezone||"UTC",e.scheduleMode==="cron"?t.cron=(e.cron||"").trim()||"* * * * *":t.intervalSeconds=e.intervalSeconds&&e.intervalSeconds>0?Math.floor(e.intervalSeconds):60;break;case"websocket":t.path=Qr(e.path)||"/ws";break;case"database":t.databaseType=e.databaseType||"postgres",t.table=e.table||"",t.pollInterval=e.pollInterval&&e.pollInterval>0?Math.floor(e.pollInterval):60,e.connection&&e.connection.trim()&&(t.connection=e.connection.trim());break;case"calendar":t.startAt=e.startAt||"",t.timezone=e.timezone||"UTC",e.repeatType==="interval"&&e.repeatIntervalSeconds&&e.repeatIntervalSeconds>0?t.repeat={intervalSeconds:Math.floor(e.repeatIntervalSeconds)}:e.repeatType==="cron"&&e.repeatCron&&e.repeatCron.trim()&&(t.repeat={cron:e.repeatCron.trim()}),t.repeat&&e.repeatCount&&e.repeatCount>0&&(t.repeat.count=Math.floor(e.repeatCount)),t.repeat&&e.repeatUntil&&e.repeatUntil.trim()&&(t.repeat.until=e.repeatUntil.trim());break}return t},B1=(e,t)=>{const r=`Trigger #${t+1}`;switch(e.type){case"manual":return null;case"webhook":return!e.path||!e.path.trim()?`${r}: specifica un percorso per il webhook`:null;case"schedule":if(e.scheduleMode==="cron"){if(!e.cron||!e.cron.trim())return`${r}: inserisci un'espressione CRON`}else if(!e.intervalSeconds||e.intervalSeconds<=0)return`${r}: l'intervallo deve essere maggiore di zero secondi`;return null;case"websocket":return!e.path||!e.path.trim()?`${r}: specifica un percorso WebSocket`:null;case"database":return!e.table||!e.table.trim()?`${r}: indica la tabella da monitorare`:null;case"calendar":return!e.startAt||!e.startAt.trim()?`${r}: definisci la data/ora di avvio`:e.repeatType==="interval"&&(!e.repeatIntervalSeconds||e.repeatIntervalSeconds<=0)?`${r}: l'intervallo di ripetizione deve essere maggiore di zero`:e.repeatType==="cron"&&(!e.repeatCron||!e.repeatCron.trim())?`${r}: inserisci l'espressione CRON della ripetizione`:null;default:return null}},H1=({visible:e,onClose:t,targetNode:r,onSave:n,existingMappings:o=[],existingSourceFormId:a=null,existingSources:i=null,workflowId:l})=>{const[c,d]=x.useState([]),[u,f]=x.useState(0),[g,p]=x.useState([]),[h,w]=x.useState([]),[y,b]=x.useState(!1),[S,m]=x.useState([]),[v,j]=x.useState(!1),k=x.useMemo(()=>new Map,[]),C=x.useMemo(()=>new Map,[]),A=x.useMemo(()=>new Map,[]),[T,O]=x.useState(!1),[$,D]=x.useState([]),M=x.useMemo(()=>(r?.type||"").toString().toLowerCase().includes("start"),[r?.type]),[N,L]=x.useState([]),[F,_]=x.useState(null),[I,R]=x.useState(null),B=x.useCallback(V=>Array.isArray(V)?V.map(q=>({sourceFormId:q?.sourceFormId??"",sourceFormName:q?.sourceFormName??"",mappings:Array.isArray(q?.mappings)?q.mappings.map(K=>({...K,editable:K?.editable??!1,required:K?.required??!1,output:K?.output??!1})):[]})):[],[]),H=x.useCallback(V=>{const q=B(V);if(!M){d(q),L([]),_(null);return}let K=null;const Y=[];q.forEach(le=>{if(le.sourceFormId==="__start_triggers__"){const z=le.mappings.find(se=>se.nodeFieldName==="triggers");z&&K===null&&z.constantValue!==void 0&&(K=z.constantValue);return}const U=le.mappings.filter(z=>z.nodeFieldName==="triggers"?(K===null&&z.constantValue!==void 0&&(K=z.constantValue),!1):!0);Y.push({...le,mappings:U})}),d(Y),L(K!==null?U1(K):le=>le.length>0?le:[_t("manual")]),_(null)},[M,B]);x.useEffect(()=>{(async()=>{if(!e||!r?.id)return;const q=()=>{i&&i.length>0?H(i):a&&o.length>0?H([{sourceFormId:a,sourceFormName:"",mappings:o}]):H([]),f(0)};if(!l){q();return}try{const K=await je.workflows.getFieldMapping(l,r.id),Y=Array.isArray(K.data?.sources)?K.data.sources:[];H(Y),f(0)}catch{q()}})()},[e,l,r?.id,H,i,o,a]),x.useEffect(()=>{if(!e)return;(async()=>{j(!0);try{const q=await je.forms.listAll();q.data?.forms&&Array.isArray(q.data.forms)?m(q.data.forms):m([])}catch(q){console.error("Errore caricamento form disponibili:",q),me.error("Errore nel caricamento dei form disponibili"),m([])}finally{j(!1)}})()},[e]),x.useEffect(()=>{if(!r){p([]),R(null),L(M?[_t("manual")]:[]),_(null),H([]);return}p([]),f(0),R(null),L(M?[_t("manual")]:[]),_(null),H([]),(async()=>{const q=`${r.id}|${r.type}`;console.log("🔍 [FieldMapping] === START loadNodeFields ==="),console.log("   targetNode:",r);try{if(!r||!r.type){console.error("❌ targetNode o targetNode.type è undefined!"),me.error("Nodo non valido");return}const K=r.type,Y=r.type.toLowerCase().replace(/node$/,"").replace(/_/g,"");console.log("   Original type:",K),console.log("   Normalized type:",Y);const le=`/api/nodes/fields/${Y}`;if(console.log("   📡 Calling API:",le),k.has(Y)){console.log("   💾 Cache hit per",Y),M&&Y==="start"&&(R(C.get(Y)||null),L(ke=>ke.length>0?ke:[_t("manual")]),_(null)),p(k.get(Y)||[]);return}const U=await fetch(le);if(console.log("   📥 Response status:",U.status),!U.ok){const ke=await U.text();throw console.error("   ❌ API Error Response:",ke),new Error(`HTTP ${U.status}: ${U.statusText}`)}const z=await U.json();if(console.log("   📦 API Response:",{node_type:z.node_type,field_count:z.fields?.length}),!z.fields||!Array.isArray(z.fields)){console.error(`❌ Response per ${Y} non contiene fields validi:`,z),me.error(`Il nodo "${r.type}" non ha campi configurati`),p([]);return}let se=z.fields.map(ke=>({name:ke.name,label:ke.label||ke.name,type:ke.type,required:ke.required||!1,options:Array.isArray(ke.options)?ke.options:Array.isArray(ke.choices)?ke.choices:void 0,meta:ke}));if(M&&Y==="start"){const ke=se.find(Fe=>Fe.name==="triggers");R(ke||null),C.set(Y,ke||null),se=se.filter(Fe=>Fe.name!=="triggers")}console.log("✅ Loaded",se.length,"fields"),console.log("   Sample fields:",se.slice(0,3).map(ke=>ke.name)),q===`${r.id}|${r.type}`&&(p(se),k.set(Y,se))}catch(K){console.error("❌ Errore caricamento campi:",K),me.error(`Impossibile caricare i campi per "${r?.type||"nodo sconosciuto"}"`),p([])}})()},[r?.id,r?.type,e,k,C,M,H]),x.useEffect(()=>{(async()=>{if(!e||!l||!r?.id){D([]);return}try{const K=(await je.get(`/workflows/${l}/nodes/${encodeURIComponent(r.id)}/propagation-candidates`)).data?.candidates;Array.isArray(K)?D(K):D([])}catch(q){console.error("Errore caricamento candidati propagazione:",q),D([])}})()},[e,l,r?.id]);const ie=()=>{const V={sourceFormId:"",sourceFormName:"",mappings:[]};d([...c,V]),f(c.length)},ge=V=>{const q=c[V],K=q?.mappings?.some(le=>le.formFieldName||le.nodeFieldName),Y=()=>{const le=c.filter((U,z)=>z!==V);d(le),le.length===0?(w([]),f(0),me.info("Sorgente rimossa")):u>=le.length&&f(Math.max(0,le.length-1))};if(K){const le=q.mappings.filter(U=>U.formFieldName||U.nodeFieldName).map(U=>`• ${U.formFieldName||"(form vuoto)"} → ${U.nodeFieldName||"(target vuoto)"}`).join(`
`);br.confirm({title:"Rimuovere questa sorgente form?",content:s.jsxs("div",{children:[s.jsx("p",{children:"Questa sorgente ha dei mapping configurati che andranno persi:"}),s.jsx("pre",{style:{background:"#fafafa",padding:8,borderRadius:4,maxHeight:180,overflow:"auto"},children:le})]}),okText:"Rimuovi",okType:"danger",cancelText:"Annulla",onOk:Y})}else Y()},ee=V=>{const q=S.find(z=>z.id===V),K=c[u],Y=K?.sourceFormId&&K?.sourceFormId!==V,le=K?.mappings?.some(z=>z.formFieldName),U=()=>{const z=[...c];z[u]={...z[u],sourceFormId:V||"",sourceFormName:q?.name||"",mappings:z[u].mappings.map(se=>({...se,formFieldName:""}))},d(z)};if(Y&&le){const z=K.mappings.filter(se=>se.formFieldName).map(se=>`• ${se.formFieldName}`).join(`
`);br.confirm({title:"Cambiare il form sorgente?",content:s.jsxs("div",{children:[s.jsx("p",{children:"Cambiando form, i campi selezionati andranno sbiancati:"}),s.jsx("pre",{style:{background:"#fafafa",padding:8,borderRadius:4,maxHeight:180,overflow:"auto"},children:z})]}),okText:"Cambia form",cancelText:"Annulla",onOk:U})}else U()},J=()=>{const V=[...c];V[u]&&(V[u]={...V[u],sourceFormId:"",sourceFormName:"",mappings:V[u].mappings.map(q=>({...q,formFieldName:""}))},d(V),w([]))},G=()=>{const V=[...c];V[u]&&(V[u].mappings=[...V[u].mappings,{formFieldName:"",nodeFieldName:"",propagationType:"manual",editable:!1,required:!1,output:!1}],d(V))},oe=V=>{const q=[...c];q[u].mappings=q[u].mappings.filter((K,Y)=>Y!==V),d(q)},te=(V,q,K)=>{const Y=[...c];if(!Y[u])return;const le=[...Y[u].mappings];if(q==="propagationType"?K==="flow"?le[V]={...le[V],propagationType:"flow",formFieldName:"",constantValue:void 0}:le[V]={...le[V],propagationType:"manual",flowSourcePath:void 0,flowSourceLabel:void 0}:le[V]={...le[V],[q]:K},q==="nodeFieldName"&&(le[V]={...le[V],constantValue:void 0,targetFieldType:(g.find(U=>U.name===K)?.type||"").toLowerCase()}),q==="formFieldName"&&typeof K=="string")if(K.includes("__")){const[U,z]=K.split("__");le[V]={...le[V],formFieldName:U,jsonKey:z}}else le[V]={...le[V],formFieldName:K,jsonKey:void 0};Y[u].mappings=le,d(Y)},E=async()=>{if(c.some(U=>U.mappings.some(se=>se.propagationType==="manual")&&!U.sourceFormId)){me.error("Sorgenti con mapping Manual richiedono la selezione di un form");return}const q={};c.forEach(U=>{U.mappings.forEach(z=>{if(!z.nodeFieldName)return;const we=(g.find(Te=>Te.name===z.nodeFieldName)?.type||"").toLowerCase();if(we==="textarea"||we==="select")return;const Fe=z.nodeFieldName.trim().toLowerCase();q[Fe]=(q[Fe]||0)+1})});const K=Object.entries(q).filter(([,U])=>U>1);if(K.length>0){me.error(`Collisione: campi target duplicati (${K.map(U=>U[0]).join(", ")})`);return}if(c.some(U=>U.mappings.some(z=>{if(!z.nodeFieldName)return!0;const we=(g.find(ke=>ke.name===z.nodeFieldName)?.type||"").toLowerCase();if(z.propagationType==="flow")return!z.flowSourcePath;if(we==="select"||we==="trigger"){const ke=!!z.formFieldName,Fe=z.constantValue!==void 0&&z.constantValue!==""&&z.constantValue!==null;return!(ke||Fe)}return!z.formFieldName}))){me.error("Completa tutti i mapping prima di salvare");return}let le=null;if(M){if(!N||N.length===0){const z="Configura almeno un trigger per il nodo Start";_(z),me.error(z);return}const U=N.map((z,se)=>B1(z,se)).find(z=>z!==null);if(U){_(U),me.error(U);return}if(le=N.map(tc),!Array.isArray(le)||le.length===0){const z="Definisci almeno un trigger per il nodo Start";_(z),me.error(z);return}_(null)}try{O(!0);const z=c.map(se=>({...se,mappings:se.mappings.map(we=>({...we}))})).map(se=>({...se,mappings:se.mappings.filter(we=>we.nodeFieldName)})).filter(se=>se.mappings.length>0||se.sourceFormId);M&&z.push({sourceFormId:"__start_triggers__",sourceFormName:"StartNodeTriggers",mappings:[{formFieldName:"",nodeFieldName:"triggers",propagationType:"manual",editable:!1,required:!0,output:!1,constantValue:le,targetFieldType:I?.type||"trigger"}]}),await n(r.id,z),me.success("Field mapping salvato con successo"),t()}catch(U){console.error("Errore durante il salvataggio:",U),me.error("Errore durante il salvataggio del mapping")}finally{O(!1)}},Q=x.useMemo(()=>N.map(tc),[N]),re=(V,q)=>{L(K=>K.map((Y,le)=>le===V?{...Y,...q}:Y)),F&&_(null)},ce=(V,q)=>{L(K=>K.map((Y,le)=>le===V?_t(q,Y):Y)),_(null)},ue=()=>{L(V=>[...V,_t("manual")]),_(null)},fe=V=>{L(q=>q.filter((K,Y)=>Y!==V)),_(null)},Ee=(V,q)=>{const K={color:"#94a3b8",fontSize:12};switch(V.type){case"manual":return s.jsxs(We,{direction:"vertical",size:"small",style:{width:"100%"},children:[s.jsx(Ue,{style:{minWidth:220},value:V.mode||"manual",onChange:Y=>re(q,{mode:Y}),options:[{value:"manual",label:"Avvio manuale da console"},{value:"auto",label:"Avvio automatico immediato"},{value:"form",label:"Avvio su invio form esterno"}],dropdownMatchSelectWidth:!1}),s.jsx("span",{style:K,children:"Il trigger manuale richiede l’approvazione di un operatore."})]});case"webhook":return s.jsxs(We,{direction:"vertical",size:"small",style:{width:"100%"},children:[s.jsxs(We,{wrap:!0,style:{width:"100%"},children:[s.jsx(Ue,{value:(V.method||"POST").toUpperCase(),options:M1.map(Y=>({value:Y,label:Y})),onChange:Y=>re(q,{method:Y}),style:{minWidth:110}}),s.jsx($e,{style:{minWidth:240,flex:"1 1 240px"},placeholder:"/workflows/payroll",value:V.path||"",onChange:Y=>re(q,{path:Y.target.value})})]}),s.jsx($e,{placeholder:"Segreto condiviso (opzionale)",value:V.secret||"",onChange:Y=>re(q,{secret:Y.target.value})}),s.jsx($e,{placeholder:"Bearer token (opzionale)",value:V.bearerToken||"",onChange:Y=>re(q,{bearerToken:Y.target.value})}),s.jsx(Ue,{mode:"tags",style:{width:"100%"},placeholder:"Limita agli IP indicati (opzionale)",value:V.allowedIps||[],onChange:Y=>re(q,{allowedIps:Y}),dropdownMatchSelectWidth:!1}),s.jsx("span",{style:K,children:"Il webhook espone un endpoint HTTPS autenticabile."})]});case"schedule":return s.jsxs(We,{direction:"vertical",size:"small",style:{width:"100%"},children:[s.jsxs(We,{wrap:!0,style:{width:"100%"},children:[s.jsx(Ue,{value:V.scheduleMode||"interval",options:[{value:"interval",label:"Intervallo fisso"},{value:"cron",label:"Espressione CRON"}],onChange:Y=>re(q,{scheduleMode:Y})}),s.jsx(Ue,{value:V.timezone||"UTC",options:ec,onChange:Y=>re(q,{timezone:Y}),dropdownMatchSelectWidth:!1,style:{minWidth:180}})]}),V.scheduleMode==="cron"?s.jsx($e,{placeholder:"0 8 * * 1-5",value:V.cron||"",onChange:Y=>re(q,{cron:Y.target.value})}):s.jsx(mn,{style:{width:220},min:30,step:30,value:V.intervalSeconds,onChange:Y=>re(q,{intervalSeconds:Y===null?void 0:Y})}),s.jsx("span",{style:K,children:"Il planner può usare un cron oppure un intervallo ripetuto."})]});case"websocket":return s.jsxs(We,{direction:"vertical",size:"small",style:{width:"100%"},children:[s.jsx($e,{placeholder:"/ws/events",value:V.path||"",onChange:Y=>re(q,{path:Y.target.value})}),s.jsx("span",{style:K,children:"Apre un endpoint WebSocket per notifiche in tempo reale."})]});case"database":return s.jsxs(We,{direction:"vertical",size:"small",style:{width:"100%"},children:[s.jsxs(We,{wrap:!0,children:[s.jsx(Ue,{value:V.databaseType||"postgres",options:O1,onChange:Y=>re(q,{databaseType:Y}),dropdownMatchSelectWidth:!1,style:{minWidth:160}}),s.jsx($e,{placeholder:"Nome tabella",value:V.table||"",onChange:Y=>re(q,{table:Y.target.value}),style:{minWidth:200}}),s.jsx(mn,{style:{width:200},min:10,step:10,value:V.pollInterval,onChange:Y=>re(q,{pollInterval:Y===null?void 0:Y}),placeholder:"Polling (s)"})]}),s.jsx($e,{placeholder:"Stringa connessione (opzionale)",value:V.connection||"",onChange:Y=>re(q,{connection:Y.target.value})}),s.jsx("span",{style:K,children:"Interroga periodicamente la tabella indicata per nuove righe."})]});case"calendar":return s.jsxs(We,{direction:"vertical",size:"small",style:{width:"100%"},children:[s.jsx($e,{type:"datetime-local",value:V.startAt||"",onChange:Y=>re(q,{startAt:Y.target.value})}),s.jsxs(We,{wrap:!0,children:[s.jsx(Ue,{value:V.timezone||"UTC",options:ec,onChange:Y=>re(q,{timezone:Y}),dropdownMatchSelectWidth:!1,style:{minWidth:180}}),s.jsx(Ue,{value:V.repeatType||"none",options:[{value:"none",label:"Senza ripetizione"},{value:"interval",label:"Ripeti ogni X secondi"},{value:"cron",label:"Ripeti con CRON"}],onChange:Y=>re(q,{repeatType:Y})})]}),V.repeatType==="interval"&&s.jsx(mn,{style:{width:220},min:60,step:60,value:V.repeatIntervalSeconds,onChange:Y=>re(q,{repeatIntervalSeconds:Y===null?void 0:Y}),placeholder:"Ogni X secondi"}),V.repeatType==="cron"&&s.jsx($e,{placeholder:"0 9 * * MON",value:V.repeatCron||"",onChange:Y=>re(q,{repeatCron:Y.target.value})}),V.repeatType!=="none"&&s.jsxs(We,{wrap:!0,children:[s.jsx(mn,{min:1,value:V.repeatCount,onChange:Y=>re(q,{repeatCount:Y===null?void 0:Y}),placeholder:"Numero massimo di ripetizioni",style:{width:220}}),s.jsx($e,{type:"datetime-local",value:V.repeatUntil||"",onChange:Y=>re(q,{repeatUntil:Y.target.value}),style:{minWidth:220}})]}),s.jsx("span",{style:K,children:"Programma avvii puntuali o ricorrenti con timezone dedicato."})]});default:return null}};x.useEffect(()=>{const q=c[u]?.sourceFormId;if(!q){w([]);return}let K=!1;return(async()=>{if(A.has(q)){w(A.get(q)||[]);return}b(!0);try{const le=await je.forms.get(q);if(le.data?.fields&&Array.isArray(le.data.fields)){const U=le.data.fields.map(z=>({name:z.name,label:z.label||z.name,type:z.type||"text",required:z.required||!1,placeholder:z.placeholder||""}));K||(w(U),A.set(q,U),d(z=>{const se=[...z],we=se[u];if(!we)return z;const ke=new Set(U.map(be=>be.name));let Fe=!1;const Te=we.mappings.map(be=>be.formFieldName&&!ke.has(be.formFieldName)?(Fe=!0,{...be,formFieldName:""}):be);return Fe?(se[u]={...we,mappings:Te},se):z}))}else me.warning("Il form selezionato non ha campi configurati"),K||w([])}catch(le){console.error("Errore caricamento campi form:",le),me.error("Errore nel caricamento dei campi del form"),K||w([])}finally{K||b(!1)}})(),()=>{K=!0}},[u,c[u]?.sourceFormId,A]);const De=()=>{const V=[...h];try{return h.forEach(q=>{if((q.type||"").toLowerCase()==="textarea"&&typeof q.placeholder=="string"){const K=q.placeholder.trim();if(K.startsWith("{")&&K.endsWith("}"))try{const Y=JSON.parse(K);Y&&typeof Y=="object"&&!Array.isArray(Y)&&Object.keys(Y).forEach(le=>{if(!le)return;const U=le.replace(/[_\-]+/g," ").replace(/\s+/g," ").trim().replace(/\b\w/g,z=>z.toUpperCase());V.push({name:`${q.name}__${le}`,label:`${q.label}.${U}`,type:"text",required:!1,placeholder:"",meta:{parentJsonField:q.name,jsonKey:le}})})}catch{}}}),V}catch{return h}},qe=V=>{if(!V)return h;const q=g.find(U=>U.name===V);if(!q)return h;const K=(q.type||"").toLowerCase(),le={select:["select"],trigger:["select"],file:["file"],number:["number"],email:["email"],password:["password","text"],text:["text","string","textarea"]}[K];return le?h.filter(U=>le.includes((U.type||"").toLowerCase())):h},Ke=[{title:"Tipo",dataIndex:"propagationType",key:"propagationType",width:120,render:(V,q,K)=>s.jsxs(Ue,{value:V,onChange:Y=>te(K,"propagationType",Y),style:{width:"100%"},children:[s.jsxs(Ue.Option,{value:"manual",children:[s.jsx(Vt,{color:"blue",children:"Manual"})," Da Form"]}),s.jsxs(Ue.Option,{value:"flow",children:[s.jsx(Vt,{color:"green",children:"Flow"})," Da Propagazione"]})]})},{title:"Campo Sorgente",dataIndex:"formFieldName",key:"formFieldName",render:(V,q,K)=>{const le=(g.find(Te=>Te.name===q.nodeFieldName)?.type||"").toLowerCase(),U=["text","textarea","string"].includes(le);if(q.propagationType==="flow"){const Te=s.jsx(Ue,{value:q.flowSourcePath?q.jsonKey?`${q.flowSourcePath}.${q.jsonKey}`:q.flowSourcePath:void 0,placeholder:$.length?"Seleziona sorgente dal flusso":"Nessun candidato dal flusso",style:{width:"100%"},onChange:(be,Me)=>{try{const kt=String(be||""),wt=kt.split(".");if(wt.length>=2){const Ie=wt.slice(0,2).join("."),et=wt.length>2?wt.slice(2).join("."):void 0;te(K,"flowSourcePath",Ie),te(K,"jsonKey",et)}else te(K,"flowSourcePath",kt||void 0),te(K,"jsonKey",void 0)}catch{te(K,"flowSourcePath",be),te(K,"jsonKey",void 0)}const Oe=Me?.label??Me?.children??"";te(K,"flowSourceLabel",typeof Oe=="string"?Oe:void 0)},disabled:$.length===0,showSearch:!0,optionFilterProp:"children",children:$.map(be=>s.jsxs(Ue.Option,{value:be.path,children:[be.label," ",s.jsxs("span",{style:{color:"#999",marginLeft:8},children:["(",be.path,")"]})]},be.path))});if(q.flowSourcePath){const be=q.flowSourcePath.split(".").slice(0,2).join("."),Me=Array.from(new Set($.filter(Oe=>Oe.path.startsWith(be+".")).map(Oe=>Oe.path.substring(be.length+1).split(".")[0]).filter(Oe=>Oe&&!Oe.includes("."))));return s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[Te,Me.length>0?s.jsx(Ue,{value:q.jsonKey,placeholder:"Seleziona chiave JSON",onChange:Oe=>te(K,"jsonKey",Oe),allowClear:!0,showSearch:!0,optionFilterProp:"children",children:Me.map(Oe=>s.jsx(Ue.Option,{value:Oe,children:Oe},Oe))}):s.jsx($e,{value:q.jsonKey||"",placeholder:"Chiave JSON (es. payment_link)",onChange:Oe=>te(K,"jsonKey",Oe.target.value||void 0)})]})}return Te}const se=De(),we=qe(q.nodeFieldName).filter(Te=>se.some(be=>be.name===Te.name));let ke=we;if(U){const Te=se.filter(be=>be.meta?.parentJsonField&&be.name.startsWith(be.meta.parentJsonField+"__"));ke=[...we,...Te]}const Fe=c[u];return s.jsx(Ue,{value:q.jsonKey?`${q.formFieldName}__${q.jsonKey}`:V,onChange:Te=>te(K,"formFieldName",Te),placeholder:y?"Caricamento campi...":"Seleziona campo form",style:{width:"100%"},disabled:!Fe?.sourceFormId||y,loading:y,children:ke.map(Te=>s.jsxs(Ue.Option,{value:Te.name,children:[s.jsx("span",{children:Te.label}),s.jsxs("span",{style:{color:"#999",marginLeft:8},children:["(",Te.type,")"]}),Te.required&&s.jsx("span",{style:{color:"red",marginLeft:4},children:"*"})]},Te.name))})}},{title:s.jsx(ug,{}),key:"arrow",width:50,align:"center",render:()=>s.jsx("span",{style:{fontSize:18},children:"→"})},{title:"Campo Nodo Target",dataIndex:"nodeFieldName",key:"nodeFieldName",render:(V,q,K)=>s.jsx(Ue,{value:V,onChange:Y=>te(K,"nodeFieldName",Y),placeholder:"Seleziona campo nodo",style:{width:"100%"},children:g.map(Y=>s.jsxs(Ue.Option,{value:Y.name,children:[s.jsx("span",{children:Y.label}),s.jsxs("span",{style:{color:"#999",marginLeft:8},children:["(",Y.type,")"]})]},Y.name))},`node-target-${r?.id||r?.type}-${K}`)},{title:"Valore Costante",dataIndex:"constantValue",key:"constantValue",width:180,render:(V,q,K)=>{const Y=g.find(z=>z.name===q.nodeFieldName);if((Y?.type||"").toLowerCase()!=="select")return s.jsx("span",{style:{color:"#999"},children:"—"});const U=Y?.options||[];return s.jsx(Ue,{value:V,onChange:z=>te(K,"constantValue",z),placeholder:"Scegli valore",style:{width:"100%"},allowClear:!0,children:U.map(z=>s.jsx(Ue.Option,{value:z.value||z,children:z.label||z.value||z},z.value||z))})}},{title:s.jsxs("span",{children:["Output"," ",s.jsx(mr,{title:"Se attivo, il valore sarà aggiunto al context.inout per i nodi successivi",children:s.jsx(zr,{style:{color:"#999"}})})]}),dataIndex:"output",key:"output",width:100,align:"center",render:(V,q,K)=>s.jsx(hn,{checked:V===!0,onChange:Y=>te(K,"output",Y)})},{title:s.jsxs("span",{children:["Editabile"," ",s.jsx(mr,{title:"Campo richiede input utente durante esecuzione workflow",children:s.jsx(zr,{style:{color:"#999"}})})]}),dataIndex:"editable",key:"editable",width:100,align:"center",render:(V,q,K)=>s.jsx(hn,{checked:V===!0,onChange:Y=>te(K,"editable",Y)})},{title:s.jsxs("span",{children:["Richiesto"," ",s.jsx(mr,{title:"Campo obbligatorio - l'utente deve fornire un valore",children:s.jsx(zr,{style:{color:"#999"}})})]}),dataIndex:"required",key:"required",width:100,align:"center",render:(V,q,K)=>s.jsx(hn,{checked:V===!0,onChange:Y=>te(K,"required",Y)})},{title:"Azioni",key:"actions",width:80,align:"center",render:(V,q,K)=>s.jsx(He,{type:"text",danger:!0,icon:s.jsx(fa,{}),onClick:()=>oe(K)})}];return s.jsxs(br,{title:s.jsxs("div",{children:[s.jsx("h3",{style:{margin:0},children:"Field Mapping Configuration"}),s.jsxs("p",{style:{fontSize:14,color:"#666",margin:"8px 0 0 0"},children:["Nodo Target: ",s.jsx("strong",{children:r?.data?.label||r?.type})]})]}),open:e,onCancel:t,width:Math.min(1024,window.innerWidth*.95),bodyStyle:{maxHeight:"70vh",overflow:"auto"},className:"[&_.ant-modal-content]:dark:bg-gray-900 [&_.ant-modal-content]:dark:border-gray-850 [&_.ant-modal-header]:dark:bg-gray-900 [&_.ant-modal-header]:dark:border-gray-850 [&_.ant-modal-footer]:dark:bg-gray-900 [&_.ant-modal-footer]:dark:border-gray-850 [&_.ant-modal-title]:dark:text-white [&_.ant-select-selector]:dark:!bg-gray-950 [&_.ant-select-selector]:dark:!border-gray-800 [&_.ant-select-selection-item]:dark:!text-white [&_.ant-select-selection-placeholder]:dark:!text-gray-400 [&_.ant-select-arrow]:dark:!text-gray-400 [&_.ant-input]:dark:!bg-gray-950 [&_.ant-input]:dark:!border-gray-800 [&_.ant-input]:dark:!text-white [&_.ant-input]:dark:placeholder:text-gray-500 [&_.ant-table]:dark:bg-gray-900 [&_.ant-table-thead>tr>th]:dark:!bg-gray-850 [&_.ant-table-thead>tr>th]:dark:!text-gray-300 [&_.ant-table-thead>tr>th]:dark:!border-gray-800 [&_.ant-table-tbody>tr>td]:dark:!bg-gray-900 [&_.ant-table-tbody>tr>td]:dark:!text-gray-300 [&_.ant-table-tbody>tr>td]:dark:!border-gray-850 [&_.ant-table-tbody>tr:hover>td]:dark:!bg-gray-850 [&_.ant-tabs-nav]:dark:bg-gray-900 [&_.ant-tabs-nav]:dark:border-gray-850 [&_.ant-tabs-tab]:dark:!text-gray-400 [&_.ant-tabs-tab]:dark:!bg-gray-900 [&_.ant-tabs-tab:hover]:dark:!text-gray-300 [&_.ant-tabs-tab-active]:dark:!text-white [&_.ant-tabs-tab-active]:dark:!bg-gray-850 [&_.ant-tabs-ink-bar]:dark:!bg-purple-600 [&_.ant-tabs-content]:dark:bg-gray-900 [&_.ant-tabs-content-holder]:dark:bg-gray-900 [&_.ant-switch]:dark:!bg-gray-700 [&_.ant-switch-checked]:dark:!bg-purple-600 [&_.ant-btn]:dark:!border-gray-800 [&_.ant-btn]:dark:!text-gray-300 [&_.ant-btn]:dark:!bg-gray-850 [&_.ant-btn:hover]:dark:!border-purple-600 [&_.ant-btn:hover]:dark:!text-purple-400 [&_.ant-btn-primary]:dark:!bg-purple-600 [&_.ant-btn-primary]:dark:!border-purple-600 [&_.ant-btn-primary]:dark:!text-white [&_.ant-btn-dashed]:dark:!border-gray-700 [&_.ant-btn-dashed]:dark:!bg-gray-900",footer:[s.jsx(He,{onClick:t,disabled:T,children:"Annulla"},"cancel"),s.jsx(He,{type:"primary",onClick:E,loading:T,children:"Salva Mapping"},"save")],children:[(()=>{try{const V={};c.forEach(K=>K.mappings.forEach(Y=>{if(!Y.nodeFieldName)return;const U=(g.find(we=>we.name===Y.nodeFieldName)?.type||"").toLowerCase();if(U==="textarea"||U==="select")return;const se=Y.nodeFieldName.trim().toLowerCase();V[se]=(V[se]||0)+1}));const q=Object.entries(V).filter(([,K])=>K>1).map(([K])=>K);return q.length===0?null:s.jsxs("div",{className:"mb-3 p-3 bg-red-50 dark:bg-red-950/50 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-200 rounded-md",children:[s.jsx("strong",{children:"Collisione di campi target:"}),s.jsxs("div",{style:{marginTop:6},children:["I seguenti campi target non possono essere mappati più volte: ",q.join(", "),". Rimuovi o modifica i mapping duplicati per continuare."]})]})}catch{return null}})(),M&&s.jsxs("div",{className:"mb-6 p-4 rounded-md border border-purple-200 dark:border-purple-800 bg-purple-50 dark:bg-purple-950/30",children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[s.jsxs("div",{children:[s.jsx("strong",{children:"Configurazione Trigger Start"}),s.jsx("div",{style:{color:"#6b7280",fontSize:13},children:"Costruisci i trigger di avvio usando i selettori rapidi."})]}),s.jsx(Vt,{color:"purple",children:"Obbligatorio"})]}),s.jsxs(We,{direction:"vertical",size:"large",style:{width:"100%"},children:[N.map((V,q)=>s.jsxs("div",{style:{border:"1px solid rgba(139, 92, 246, 0.25)",borderRadius:10,padding:16,background:"rgba(76, 29, 149, 0.04)"},children:[s.jsxs(We,{size:12,wrap:!0,style:{width:"100%",justifyContent:"space-between"},children:[s.jsx(Ue,{value:V.type,options:I1,onChange:K=>ce(q,K),style:{minWidth:220},dropdownMatchSelectWidth:!1}),s.jsx($e,{style:{minWidth:200,flex:"1 1 200px"},placeholder:"Etichetta visibile (opzionale)",value:V.label||"",onChange:K=>re(q,{label:K.target.value})}),s.jsx($e,{style:{minWidth:160,flex:"0 0 160px"},placeholder:"ID personalizzato",value:V.id||"",onChange:K=>re(q,{id:K.target.value})}),s.jsxs(We,{size:6,align:"center",children:[s.jsx("span",{style:{color:"#9ca3af",fontSize:12},children:"Attivo"}),s.jsx(hn,{checked:V.enabled,onChange:K=>re(q,{enabled:K})})]}),s.jsx(mr,{title:"Rimuovi trigger",children:s.jsx(He,{type:"text",danger:!0,icon:s.jsx(fa,{}),onClick:()=>fe(q),disabled:N.length<=1})})]}),s.jsx(dg,{style:{margin:"14px 0"}}),s.jsx("div",{children:Ee(V,q)})]},`trigger-${q}`)),s.jsx(He,{type:"dashed",icon:s.jsx(Dr,{}),onClick:ue,block:!0,children:"Aggiungi trigger"})]}),F?s.jsx("div",{style:{color:"#dc2626",marginTop:12},children:F}):s.jsx("div",{style:{color:"#6b7280",marginTop:12,fontSize:12},children:"Suggerimento: combina trigger manuali, webhook e pianificazioni per gestire casi complessi."}),s.jsxs("div",{style:{marginTop:14,padding:12,borderRadius:8,border:"1px dashed rgba(148, 163, 184, 0.35)",background:"rgba(15, 23, 42, 0.18)"},children:[s.jsx("div",{style:{fontSize:12,color:"#94a3b8",marginBottom:6},children:"Anteprima JSON generata:"}),s.jsx("pre",{style:{margin:0,maxHeight:200,overflow:"auto",background:"rgba(30, 41, 59, 0.65)",color:"#e2e8f0",padding:12,borderRadius:6,fontSize:12},children:JSON.stringify(Q,null,2)})]})]}),s.jsx(Uc,{activeKey:u.toString(),onChange:V=>f(Number(V)),type:"editable-card",onEdit:(V,q)=>{q==="add"?ie():q==="remove"&&ge(Number(V))},tabBarExtraContent:{right:c.length===0&&s.jsx(He,{type:"dashed",icon:s.jsx(Dr,{}),onClick:ie,children:"Aggiungi Form Sorgente"})},children:c.map((V,q)=>s.jsxs(R1,{tab:V.sourceFormName||`Form Sorgente ${q+1}`,closable:c.length>1,children:[s.jsxs("div",{style:{marginBottom:16},children:[s.jsx("div",{style:{marginBottom:8},children:s.jsx("strong",{children:"Seleziona Form Sorgente:"})}),s.jsx(Ue,{value:V.sourceFormId||void 0,onChange:ee,allowClear:!0,onClear:J,placeholder:v?"Caricamento form...":"Scegli da quale form prendere i dati",style:{width:"100%"},showSearch:!0,loading:v,disabled:v,optionFilterProp:"children",filterOption:(K,Y)=>(Y?.children?.toString()||"").toLowerCase().includes(K.toLowerCase()),children:S.map(K=>{const Y=K.name||`Form ${K.id.substring(0,8)}`;return s.jsxs(Ue.Option,{value:K.id,children:["📋 ",Y,K.category&&s.jsxs("span",{style:{color:"#999",marginLeft:8,fontSize:12},children:["(",K.category,")"]}),K.fields_count>0&&s.jsxs("span",{style:{color:"#666",marginLeft:8,fontSize:12},children:["• ",K.fields_count," campi"]})]},K.id)})})]}),!v&&S.length===0&&s.jsx("div",{className:"p-6 text-center bg-yellow-50 dark:bg-yellow-950/30 rounded-lg text-yellow-700 dark:text-yellow-200 border border-yellow-200 dark:border-yellow-800",children:"⚠️ Nessun form disponibile nel sistema. Crea prima un form dalla pagina Forms."}),V.sourceFormId&&s.jsxs("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-950/30 rounded-md border border-blue-200 dark:border-blue-800 text-sm text-blue-800 dark:text-blue-200",children:[s.jsxs("strong",{children:[s.jsx(zr,{})," Configurazione Campi:"]}),s.jsxs("ul",{style:{margin:"8px 0 0 0",paddingLeft:20},children:[s.jsxs("li",{children:[s.jsx("strong",{children:"Editabile:"})," Il workflow si ferma e richiede input utente"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Output:"})," Il valore viene propagato per i nodi successivi"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Richiesto:"})," Va fornito un valore obbligatoriamente"]})]})]}),!V.sourceFormId&&S.length>0&&s.jsx("div",{className:"p-6 text-center bg-gray-50 dark:bg-gray-850 rounded-lg text-gray-500 dark:text-gray-400 border dark:border-gray-800",children:"👆 Seleziona un form dalla lista sopra per iniziare il mapping"}),V.sourceFormId&&s.jsxs(s.Fragment,{children:[s.jsx("div",{style:{marginBottom:16},children:s.jsx(He,{type:"dashed",icon:s.jsx(Dr,{}),onClick:G,disabled:y,block:!0,children:"Aggiungi Mapping"})}),s.jsx(Bc,{dataSource:V.mappings,columns:Ke,rowKey:(K,Y)=>`mapping-${Y}`,pagination:!1,locale:{emptyText:"Nessun mapping configurato"},size:"small",scroll:{x:!0}}),(()=>{try{const K=V.mappings.map(le=>{const U=g.find(z=>z.name===le.nodeFieldName);return U&&(U.type||"").toLowerCase()==="select"&&le.constantValue?{field:U,value:String(le.constantValue).toLowerCase()}:null}).filter(Boolean);if(K.length===0)return null;const Y=new Map;return K.forEach(({field:le,value:U})=>{g.forEach(z=>{const se=z.name.toLowerCase();z.name!==le.name&&(se.includes(U)||se.includes(`${U}_`)||se.includes(`_${U}`))&&Y.set(z.name,z)})}),Y.size===0?null:s.jsxs("div",{className:"mt-4 p-3 bg-orange-50 dark:bg-orange-950/30 rounded-lg border border-orange-200 dark:border-orange-800 text-sm text-orange-800 dark:text-orange-200",children:[s.jsx("strong",{children:"🔎 Suggerimenti campi correlati:"}),s.jsx("div",{style:{marginTop:8,display:"flex",flexWrap:"wrap",gap:8},children:Array.from(Y.values()).map(le=>s.jsxs(Vt,{color:"gold",children:[le.label," ",s.jsxs("span",{style:{color:"#999"},children:["(",le.name,")"]})]},le.name))}),s.jsx("div",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Questi campi potrebbero essere necessari in base al valore selezionato nei campi di tipo select."})]})}catch{return null}})(),s.jsxs("div",{className:"mt-4 p-3 bg-cyan-50 dark:bg-cyan-950/30 rounded-lg border border-cyan-200 dark:border-cyan-800 text-sm text-cyan-800 dark:text-cyan-200",children:[s.jsx("strong",{children:"💡 Info:"}),s.jsxs("ul",{style:{marginBottom:0,paddingLeft:20},children:[s.jsxs("li",{children:[s.jsx(Vt,{color:"blue",children:"Manual"})," - Il campo viene compilato dal form utente"]}),s.jsxs("li",{children:[s.jsx(Vt,{color:"green",children:"Flow"})," - Il campo viene compilato automaticamente dal flusso"]}),s.jsxs("li",{children:[s.jsx(Vt,{color:"geekblue",children:"Output"})," - Se attivo, rende il valore disponibile ai nodi successivi"]})]})]})]})]},q.toString()))}),c.length===0&&s.jsxs("div",{style:{padding:48,textAlign:"center",background:"#fafafa",borderRadius:8,border:"2px dashed #d9d9d9"},children:[s.jsx(Dr,{style:{fontSize:32,color:"#999",marginBottom:16}}),s.jsx("div",{style:{fontSize:16,color:"#666",marginBottom:8},children:"Nessuna sorgente form configurata"}),s.jsx(He,{type:"primary",icon:s.jsx(Dr,{}),onClick:ie,children:"Aggiungi Prima Form Sorgente"})]})]})},V1=({visible:e,onClose:t,onSave:r,initialFields:n=[],formId:o})=>{const[a,i]=x.useState(o),[l,c]=x.useState([]),[d,u]=x.useState(!1),[f,g]=x.useState(n);x.useEffect(()=>{e&&p()},[e]),x.useEffect(()=>{a&&h(a)},[a]);const p=async()=>{u(!0);try{const y=await je.forms.listAll();c(y.data||[])}catch(y){console.error("Errore caricamento forms:",y),me.error("Impossibile caricare i forms")}finally{u(!1)}},h=async y=>{u(!0);try{const m=((await je.forms.getFormSchema(y)).data?.fields||[]).map(v=>({id:v.id||v.name,name:v.name,label:v.label||v.name,type:v.type||"text",required:v.required!==void 0?v.required:!1,visible:v.visible!==void 0?v.visible:!0,editable:v.editable!==void 0?v.editable:!0,placeholder:v.placeholder||"",description:v.description||""}));g(m)}catch(b){console.error("Errore caricamento campi form:",b),me.error("Impossibile caricare i campi del form")}finally{u(!1)}},w=()=>{if(!a){me.error("Seleziona un form");return}if(f.length===0){me.error("Il form selezionato non ha campi");return}r(f),me.success("Configurazione salvata"),t()};return s.jsx(br,{title:"Configura Custom Form Node",open:e,onCancel:t,width:800,footer:[s.jsx(He,{onClick:t,children:"Annulla"},"cancel"),s.jsx(He,{type:"primary",onClick:w,disabled:!a||f.length===0,children:"Salva Configurazione"},"save")],children:s.jsxs(so,{spinning:d,children:[s.jsxs("div",{style:{marginBottom:24},children:[s.jsx("div",{style:{marginBottom:8,fontWeight:500},children:"Seleziona Form da Associare:"}),s.jsx(Ue,{value:a,onChange:i,placeholder:"Scegli un form creato nel Form Builder",style:{width:"100%"},size:"large",children:l.map(y=>s.jsx(Ue.Option,{value:y.id,children:y.name},y.id))})]}),a&&f.length>0&&s.jsxs("div",{children:[s.jsxs("div",{style:{marginBottom:12,fontWeight:500,fontSize:16},children:["Campi del Form (",f.length,"):"]}),s.jsx("div",{style:{maxHeight:400,overflowY:"auto",border:"1px solid #d9d9d9",borderRadius:8,padding:12},children:f.map((y,b)=>s.jsx("div",{style:{padding:12,marginBottom:8,background:"#f5f5f5",borderRadius:6,border:"1px solid #e0e0e0"},children:s.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:s.jsxs("div",{style:{flex:1},children:[s.jsxs("div",{style:{fontWeight:600,marginBottom:4},children:[y.label,s.jsxs("span",{style:{marginLeft:8,fontSize:12,color:"#666",fontWeight:"normal"},children:["(",y.type,")"]})]}),s.jsx("div",{style:{fontSize:13,color:"#666",marginBottom:8},children:s.jsx("code",{style:{background:"#fff",padding:"2px 6px",borderRadius:4},children:y.name})}),s.jsxs("div",{style:{display:"flex",gap:12,fontSize:12},children:[s.jsx("span",{style:{color:y.required?"#f5222d":"#999"},children:y.required?"✓ Obbligatorio":"○ Opzionale"}),s.jsx("span",{style:{color:y.visible?"#52c41a":"#999"},children:y.visible?"👁 Visibile":"🚫 Nascosto"}),s.jsx("span",{style:{color:y.editable?"#1890ff":"#999"},children:y.editable?"✏️ Modificabile":"🔒 Read-only"})]})]})})},y.id))}),s.jsxs("div",{style:{marginTop:16,padding:12,background:"#e6f7ff",borderRadius:8,fontSize:13},children:[s.jsx("strong",{children:"💡 Info:"})," Questi campi saranno disponibili per il mapping con i nodi successivi nel workflow. Le proprietà ",s.jsx("strong",{children:"visible"}),", ",s.jsx("strong",{children:"editable"}),", e ",s.jsx("strong",{children:"required"})," sono state configurate nel Form Builder."]})]}),a&&f.length===0&&!d&&s.jsx("div",{style:{padding:32,textAlign:"center",color:"#999",background:"#f5f5f5",borderRadius:8},children:"Il form selezionato non ha campi configurati"}),!a&&s.jsx("div",{style:{padding:32,textAlign:"center",color:"#999",background:"#f5f5f5",borderRadius:8},children:"Seleziona un form per visualizzare i campi disponibili"})]})})},Ce=e=>typeof e=="string",fn=()=>{let e,t;const r=new Promise((n,o)=>{e=n,t=o});return r.resolve=e,r.reject=t,r},rc=e=>e==null?"":""+e,W1=(e,t,r)=>{e.forEach(n=>{t[n]&&(r[n]=t[n])})},q1=/###/g,nc=e=>e&&e.indexOf("###")>-1?e.replace(q1,"."):e,sc=e=>!e||Ce(e),jn=(e,t,r)=>{const n=Ce(t)?t.split("."):t;let o=0;for(;o<n.length-1;){if(sc(e))return{};const a=nc(n[o]);!e[a]&&r&&(e[a]=new r),Object.prototype.hasOwnProperty.call(e,a)?e=e[a]:e={},++o}return sc(e)?{}:{obj:e,k:nc(n[o])}},oc=(e,t,r)=>{const{obj:n,k:o}=jn(e,t,Object);if(n!==void 0||t.length===1){n[o]=r;return}let a=t[t.length-1],i=t.slice(0,t.length-1),l=jn(e,i,Object);for(;l.obj===void 0&&i.length;)a=`${i[i.length-1]}.${a}`,i=i.slice(0,i.length-1),l=jn(e,i,Object),l?.obj&&typeof l.obj[`${l.k}.${a}`]<"u"&&(l.obj=void 0);l.obj[`${l.k}.${a}`]=r},K1=(e,t,r,n)=>{const{obj:o,k:a}=jn(e,t,Object);o[a]=o[a]||[],o[a].push(r)},Js=(e,t)=>{const{obj:r,k:n}=jn(e,t);if(r&&Object.prototype.hasOwnProperty.call(r,n))return r[n]},Y1=(e,t,r)=>{const n=Js(e,r);return n!==void 0?n:Js(t,r)},Tf=(e,t,r)=>{for(const n in t)n!=="__proto__"&&n!=="constructor"&&(n in e?Ce(e[n])||e[n]instanceof String||Ce(t[n])||t[n]instanceof String?r&&(e[n]=t[n]):Tf(e[n],t[n],r):e[n]=t[n]);return e},Rr=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var X1={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const J1=e=>Ce(e)?e.replace(/[&<>"'\/]/g,t=>X1[t]):e;class Z1{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){const r=this.regExpMap.get(t);if(r!==void 0)return r;const n=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,n),this.regExpQueue.push(t),n}}const G1=[" ",",","?","!",";"],Q1=new Z1(20),e2=(e,t,r)=>{t=t||"",r=r||"";const n=G1.filter(i=>t.indexOf(i)<0&&r.indexOf(i)<0);if(n.length===0)return!0;const o=Q1.getRegExp(`(${n.map(i=>i==="?"?"\\?":i).join("|")})`);let a=!o.test(e);if(!a){const i=e.indexOf(r);i>0&&!o.test(e.substring(0,i))&&(a=!0)}return a},Ua=(e,t,r=".")=>{if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const n=t.split(r);let o=e;for(let a=0;a<n.length;){if(!o||typeof o!="object")return;let i,l="";for(let c=a;c<n.length;++c)if(c!==a&&(l+=r),l+=n[c],i=o[l],i!==void 0){if(["string","number","boolean"].indexOf(typeof i)>-1&&c<n.length-1)continue;a+=c-a+1;break}o=i}return o},On=e=>e?.replace("_","-"),t2={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console?.[e]?.apply?.(console,t)}};class Zs{constructor(t,r={}){this.init(t,r)}init(t,r={}){this.prefix=r.prefix||"i18next:",this.logger=t||t2,this.options=r,this.debug=r.debug}log(...t){return this.forward(t,"log","",!0)}warn(...t){return this.forward(t,"warn","",!0)}error(...t){return this.forward(t,"error","")}deprecate(...t){return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(t,r,n,o){return o&&!this.debug?null:(Ce(t[0])&&(t[0]=`${n}${this.prefix} ${t[0]}`),this.logger[r](t))}create(t){return new Zs(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new Zs(this.logger,t)}}var Mt=new Zs;class So{constructor(){this.observers={}}on(t,r){return t.split(" ").forEach(n=>{this.observers[n]||(this.observers[n]=new Map);const o=this.observers[n].get(r)||0;this.observers[n].set(r,o+1)}),this}off(t,r){if(this.observers[t]){if(!r){delete this.observers[t];return}this.observers[t].delete(r)}}emit(t,...r){this.observers[t]&&Array.from(this.observers[t].entries()).forEach(([o,a])=>{for(let i=0;i<a;i++)o(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([o,a])=>{for(let i=0;i<a;i++)o.apply(o,[t,...r])})}}class ac extends So{constructor(t,r={ns:["translation"],defaultNS:"translation"}){super(),this.data=t||{},this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}removeNamespaces(t){const r=this.options.ns.indexOf(t);r>-1&&this.options.ns.splice(r,1)}getResource(t,r,n,o={}){const a=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator,i=o.ignoreJSONStructure!==void 0?o.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;t.indexOf(".")>-1?l=t.split("."):(l=[t,r],n&&(Array.isArray(n)?l.push(...n):Ce(n)&&a?l.push(...n.split(a)):l.push(n)));const c=Js(this.data,l);return!c&&!r&&!n&&t.indexOf(".")>-1&&(t=l[0],r=l[1],n=l.slice(2).join(".")),c||!i||!Ce(n)?c:Ua(this.data?.[t]?.[r],n,a)}addResource(t,r,n,o,a={silent:!1}){const i=a.keySeparator!==void 0?a.keySeparator:this.options.keySeparator;let l=[t,r];n&&(l=l.concat(i?n.split(i):n)),t.indexOf(".")>-1&&(l=t.split("."),o=r,r=l[1]),this.addNamespaces(r),oc(this.data,l,o),a.silent||this.emit("added",t,r,n,o)}addResources(t,r,n,o={silent:!1}){for(const a in n)(Ce(n[a])||Array.isArray(n[a]))&&this.addResource(t,r,a,n[a],{silent:!0});o.silent||this.emit("added",t,r,n)}addResourceBundle(t,r,n,o,a,i={silent:!1,skipCopy:!1}){let l=[t,r];t.indexOf(".")>-1&&(l=t.split("."),o=n,n=r,r=l[1]),this.addNamespaces(r);let c=Js(this.data,l)||{};i.skipCopy||(n=JSON.parse(JSON.stringify(n))),o?Tf(c,n,a):c={...c,...n},oc(this.data,l,c),i.silent||this.emit("added",t,r,n)}removeResourceBundle(t,r){this.hasResourceBundle(t,r)&&delete this.data[t][r],this.removeNamespaces(r),this.emit("removed",t,r)}hasResourceBundle(t,r){return this.getResource(t,r)!==void 0}getResourceBundle(t,r){return r||(r=this.options.defaultNS),this.getResource(t,r)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){const r=this.getDataByLanguage(t);return!!(r&&Object.keys(r)||[]).find(o=>r[o]&&Object.keys(r[o]).length>0)}toJSON(){return this.data}}var Af={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,r,n,o){return e.forEach(a=>{t=this.processors[a]?.process(t,r,n,o)??t}),t}};const ic={},lc=e=>!Ce(e)&&typeof e!="boolean"&&typeof e!="number";class Gs extends So{constructor(t,r={}){super(),W1(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Mt.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t,r={interpolation:{}}){const n={...r};return t==null?!1:this.resolve(t,n)?.res!==void 0}extractFromKey(t,r){let n=r.nsSeparator!==void 0?r.nsSeparator:this.options.nsSeparator;n===void 0&&(n=":");const o=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator;let a=r.ns||this.options.defaultNS||[];const i=n&&t.indexOf(n)>-1,l=!this.options.userDefinedKeySeparator&&!r.keySeparator&&!this.options.userDefinedNsSeparator&&!r.nsSeparator&&!e2(t,n,o);if(i&&!l){const c=t.match(this.interpolator.nestingRegexp);if(c&&c.length>0)return{key:t,namespaces:Ce(a)?[a]:a};const d=t.split(n);(n!==o||n===o&&this.options.ns.indexOf(d[0])>-1)&&(a=d.shift()),t=d.join(o)}return{key:t,namespaces:Ce(a)?[a]:a}}translate(t,r,n){let o=typeof r=="object"?{...r}:r;if(typeof o!="object"&&this.options.overloadTranslationOptionHandler&&(o=this.options.overloadTranslationOptionHandler(arguments)),typeof options=="object"&&(o={...o}),o||(o={}),t==null)return"";Array.isArray(t)||(t=[String(t)]);const a=o.returnDetails!==void 0?o.returnDetails:this.options.returnDetails,i=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator,{key:l,namespaces:c}=this.extractFromKey(t[t.length-1],o),d=c[c.length-1];let u=o.nsSeparator!==void 0?o.nsSeparator:this.options.nsSeparator;u===void 0&&(u=":");const f=o.lng||this.language,g=o.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(f?.toLowerCase()==="cimode")return g?a?{res:`${d}${u}${l}`,usedKey:l,exactUsedKey:l,usedLng:f,usedNS:d,usedParams:this.getUsedParamsDetails(o)}:`${d}${u}${l}`:a?{res:l,usedKey:l,exactUsedKey:l,usedLng:f,usedNS:d,usedParams:this.getUsedParamsDetails(o)}:l;const p=this.resolve(t,o);let h=p?.res;const w=p?.usedKey||l,y=p?.exactUsedKey||l,b=["[object Number]","[object Function]","[object RegExp]"],S=o.joinArrays!==void 0?o.joinArrays:this.options.joinArrays,m=!this.i18nFormat||this.i18nFormat.handleAsObject,v=o.count!==void 0&&!Ce(o.count),j=Gs.hasDefaultValue(o),k=v?this.pluralResolver.getSuffix(f,o.count,o):"",C=o.ordinal&&v?this.pluralResolver.getSuffix(f,o.count,{ordinal:!1}):"",A=v&&!o.ordinal&&o.count===0,T=A&&o[`defaultValue${this.options.pluralSeparator}zero`]||o[`defaultValue${k}`]||o[`defaultValue${C}`]||o.defaultValue;let O=h;m&&!h&&j&&(O=T);const $=lc(O),D=Object.prototype.toString.apply(O);if(m&&O&&$&&b.indexOf(D)<0&&!(Ce(S)&&Array.isArray(O))){if(!o.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const M=this.options.returnedObjectHandler?this.options.returnedObjectHandler(w,O,{...o,ns:c}):`key '${l} (${this.language})' returned an object instead of string.`;return a?(p.res=M,p.usedParams=this.getUsedParamsDetails(o),p):M}if(i){const M=Array.isArray(O),N=M?[]:{},L=M?y:w;for(const F in O)if(Object.prototype.hasOwnProperty.call(O,F)){const _=`${L}${i}${F}`;j&&!h?N[F]=this.translate(_,{...o,defaultValue:lc(T)?T[F]:void 0,joinArrays:!1,ns:c}):N[F]=this.translate(_,{...o,joinArrays:!1,ns:c}),N[F]===_&&(N[F]=O[F])}h=N}}else if(m&&Ce(S)&&Array.isArray(h))h=h.join(S),h&&(h=this.extendTranslation(h,t,o,n));else{let M=!1,N=!1;!this.isValidLookup(h)&&j&&(M=!0,h=T),this.isValidLookup(h)||(N=!0,h=l);const F=(o.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&N?void 0:h,_=j&&T!==h&&this.options.updateMissing;if(N||M||_){if(this.logger.log(_?"updateKey":"missingKey",f,d,l,_?T:h),i){const H=this.resolve(l,{...o,keySeparator:!1});H&&H.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let I=[];const R=this.languageUtils.getFallbackCodes(this.options.fallbackLng,o.lng||this.language);if(this.options.saveMissingTo==="fallback"&&R&&R[0])for(let H=0;H<R.length;H++)I.push(R[H]);else this.options.saveMissingTo==="all"?I=this.languageUtils.toResolveHierarchy(o.lng||this.language):I.push(o.lng||this.language);const B=(H,ie,ge)=>{const ee=j&&ge!==h?ge:F;this.options.missingKeyHandler?this.options.missingKeyHandler(H,d,ie,ee,_,o):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(H,d,ie,ee,_,o),this.emit("missingKey",H,d,ie,h)};this.options.saveMissing&&(this.options.saveMissingPlurals&&v?I.forEach(H=>{const ie=this.pluralResolver.getSuffixes(H,o);A&&o[`defaultValue${this.options.pluralSeparator}zero`]&&ie.indexOf(`${this.options.pluralSeparator}zero`)<0&&ie.push(`${this.options.pluralSeparator}zero`),ie.forEach(ge=>{B([H],l+ge,o[`defaultValue${ge}`]||T)})}):B(I,l,T))}h=this.extendTranslation(h,t,o,p,n),N&&h===l&&this.options.appendNamespaceToMissingKey&&(h=`${d}${u}${l}`),(N||M)&&this.options.parseMissingKeyHandler&&(h=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${d}${u}${l}`:l,M?h:void 0,o))}return a?(p.res=h,p.usedParams=this.getUsedParamsDetails(o),p):h}extendTranslation(t,r,n,o,a){if(this.i18nFormat?.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||o.usedLng,o.usedNS,o.usedKey,{resolved:o});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const c=Ce(t)&&(n?.interpolation?.skipOnVariables!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let d;if(c){const f=t.match(this.interpolator.nestingRegexp);d=f&&f.length}let u=n.replace&&!Ce(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(u={...this.options.interpolation.defaultVariables,...u}),t=this.interpolator.interpolate(t,u,n.lng||this.language||o.usedLng,n),c){const f=t.match(this.interpolator.nestingRegexp),g=f&&f.length;d<g&&(n.nest=!1)}!n.lng&&o&&o.res&&(n.lng=this.language||o.usedLng),n.nest!==!1&&(t=this.interpolator.nest(t,(...f)=>a?.[0]===f[0]&&!n.context?(this.logger.warn(`It seems you are nesting recursively key: ${f[0]} in key: ${r[0]}`),null):this.translate(...f,r),n)),n.interpolation&&this.interpolator.reset()}const i=n.postProcess||this.options.postProcess,l=Ce(i)?[i]:i;return t!=null&&l?.length&&n.applyPostProcessor!==!1&&(t=Af.handle(l,t,r,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...o,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),t}resolve(t,r={}){let n,o,a,i,l;return Ce(t)&&(t=[t]),t.forEach(c=>{if(this.isValidLookup(n))return;const d=this.extractFromKey(c,r),u=d.key;o=u;let f=d.namespaces;this.options.fallbackNS&&(f=f.concat(this.options.fallbackNS));const g=r.count!==void 0&&!Ce(r.count),p=g&&!r.ordinal&&r.count===0,h=r.context!==void 0&&(Ce(r.context)||typeof r.context=="number")&&r.context!=="",w=r.lngs?r.lngs:this.languageUtils.toResolveHierarchy(r.lng||this.language,r.fallbackLng);f.forEach(y=>{this.isValidLookup(n)||(l=y,!ic[`${w[0]}-${y}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(l)&&(ic[`${w[0]}-${y}`]=!0,this.logger.warn(`key "${o}" for languages "${w.join(", ")}" won't get resolved as namespace "${l}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),w.forEach(b=>{if(this.isValidLookup(n))return;i=b;const S=[u];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(S,u,b,y,r);else{let v;g&&(v=this.pluralResolver.getSuffix(b,r.count,r));const j=`${this.options.pluralSeparator}zero`,k=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(g&&(S.push(u+v),r.ordinal&&v.indexOf(k)===0&&S.push(u+v.replace(k,this.options.pluralSeparator)),p&&S.push(u+j)),h){const C=`${u}${this.options.contextSeparator}${r.context}`;S.push(C),g&&(S.push(C+v),r.ordinal&&v.indexOf(k)===0&&S.push(C+v.replace(k,this.options.pluralSeparator)),p&&S.push(C+j))}}let m;for(;m=S.pop();)this.isValidLookup(n)||(a=m,n=this.getResource(b,y,m,r))}))})}),{res:n,usedKey:o,exactUsedKey:a,usedLng:i,usedNS:l}}isValidLookup(t){return t!==void 0&&!(!this.options.returnNull&&t===null)&&!(!this.options.returnEmptyString&&t==="")}getResource(t,r,n,o={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(t,r,n,o):this.resourceStore.getResource(t,r,n,o)}getUsedParamsDetails(t={}){const r=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=t.replace&&!Ce(t.replace);let o=n?t.replace:t;if(n&&typeof t.count<"u"&&(o.count=t.count),this.options.interpolation.defaultVariables&&(o={...this.options.interpolation.defaultVariables,...o}),!n){o={...o};for(const a of r)delete o[a]}return o}static hasDefaultValue(t){const r="defaultValue";for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&r===n.substring(0,r.length)&&t[n]!==void 0)return!0;return!1}}class cc{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Mt.create("languageUtils")}getScriptPartFromCode(t){if(t=On(t),!t||t.indexOf("-")<0)return null;const r=t.split("-");return r.length===2||(r.pop(),r[r.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(r.join("-"))}getLanguagePartFromCode(t){if(t=On(t),!t||t.indexOf("-")<0)return t;const r=t.split("-");return this.formatLanguageCode(r[0])}formatLanguageCode(t){if(Ce(t)&&t.indexOf("-")>-1){let r;try{r=Intl.getCanonicalLocales(t)[0]}catch{}return r&&this.options.lowerCaseLng&&(r=r.toLowerCase()),r||(this.options.lowerCaseLng?t.toLowerCase():t)}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){if(!t)return null;let r;return t.forEach(n=>{if(r)return;const o=this.formatLanguageCode(n);(!this.options.supportedLngs||this.isSupportedCode(o))&&(r=o)}),!r&&this.options.supportedLngs&&t.forEach(n=>{if(r)return;const o=this.getScriptPartFromCode(n);if(this.isSupportedCode(o))return r=o;const a=this.getLanguagePartFromCode(n);if(this.isSupportedCode(a))return r=a;r=this.options.supportedLngs.find(i=>{if(i===a)return i;if(!(i.indexOf("-")<0&&a.indexOf("-")<0)&&(i.indexOf("-")>0&&a.indexOf("-")<0&&i.substring(0,i.indexOf("-"))===a||i.indexOf(a)===0&&a.length>1))return i})}),r||(r=this.getFallbackCodes(this.options.fallbackLng)[0]),r}getFallbackCodes(t,r){if(!t)return[];if(typeof t=="function"&&(t=t(r)),Ce(t)&&(t=[t]),Array.isArray(t))return t;if(!r)return t.default||[];let n=t[r];return n||(n=t[this.getScriptPartFromCode(r)]),n||(n=t[this.formatLanguageCode(r)]),n||(n=t[this.getLanguagePartFromCode(r)]),n||(n=t.default),n||[]}toResolveHierarchy(t,r){const n=this.getFallbackCodes((r===!1?[]:r)||this.options.fallbackLng||[],t),o=[],a=i=>{i&&(this.isSupportedCode(i)?o.push(i):this.logger.warn(`rejecting language code not found in supportedLngs: ${i}`))};return Ce(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&a(this.formatLanguageCode(t)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&a(this.getScriptPartFromCode(t)),this.options.load!=="currentOnly"&&a(this.getLanguagePartFromCode(t))):Ce(t)&&a(this.formatLanguageCode(t)),n.forEach(i=>{o.indexOf(i)<0&&a(this.formatLanguageCode(i))}),o}}const dc={zero:0,one:1,two:2,few:3,many:4,other:5},uc={select:e=>e===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class r2{constructor(t,r={}){this.languageUtils=t,this.options=r,this.logger=Mt.create("pluralResolver"),this.pluralRulesCache={}}addRule(t,r){this.rules[t]=r}clearCache(){this.pluralRulesCache={}}getRule(t,r={}){const n=On(t==="dev"?"en":t),o=r.ordinal?"ordinal":"cardinal",a=JSON.stringify({cleanedCode:n,type:o});if(a in this.pluralRulesCache)return this.pluralRulesCache[a];let i;try{i=new Intl.PluralRules(n,{type:o})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),uc;if(!t.match(/-|_/))return uc;const c=this.languageUtils.getLanguagePartFromCode(t);i=this.getRule(c,r)}return this.pluralRulesCache[a]=i,i}needsPlural(t,r={}){let n=this.getRule(t,r);return n||(n=this.getRule("dev",r)),n?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(t,r,n={}){return this.getSuffixes(t,n).map(o=>`${r}${o}`)}getSuffixes(t,r={}){let n=this.getRule(t,r);return n||(n=this.getRule("dev",r)),n?n.resolvedOptions().pluralCategories.sort((o,a)=>dc[o]-dc[a]).map(o=>`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${o}`):[]}getSuffix(t,r,n={}){const o=this.getRule(t,n);return o?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${o.select(r)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",r,n))}}const fc=(e,t,r,n=".",o=!0)=>{let a=Y1(e,t,r);return!a&&o&&Ce(r)&&(a=Ua(e,r,n),a===void 0&&(a=Ua(t,r,n))),a},Qo=e=>e.replace(/\$/g,"$$$$");class n2{constructor(t={}){this.logger=Mt.create("interpolator"),this.options=t,this.format=t?.interpolation?.format||(r=>r),this.init(t)}init(t={}){t.interpolation||(t.interpolation={escapeValue:!0});const{escape:r,escapeValue:n,useRawValueToEscape:o,prefix:a,prefixEscaped:i,suffix:l,suffixEscaped:c,formatSeparator:d,unescapeSuffix:u,unescapePrefix:f,nestingPrefix:g,nestingPrefixEscaped:p,nestingSuffix:h,nestingSuffixEscaped:w,nestingOptionsSeparator:y,maxReplaces:b,alwaysFormat:S}=t.interpolation;this.escape=r!==void 0?r:J1,this.escapeValue=n!==void 0?n:!0,this.useRawValueToEscape=o!==void 0?o:!1,this.prefix=a?Rr(a):i||"{{",this.suffix=l?Rr(l):c||"}}",this.formatSeparator=d||",",this.unescapePrefix=u?"":f||"-",this.unescapeSuffix=this.unescapePrefix?"":u||"",this.nestingPrefix=g?Rr(g):p||Rr("$t("),this.nestingSuffix=h?Rr(h):w||Rr(")"),this.nestingOptionsSeparator=y||",",this.maxReplaces=b||1e3,this.alwaysFormat=S!==void 0?S:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const t=(r,n)=>r?.source===n?(r.lastIndex=0,r):new RegExp(n,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(t,r,n,o){let a,i,l;const c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},d=p=>{if(p.indexOf(this.formatSeparator)<0){const b=fc(r,c,p,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(b,void 0,n,{...o,...r,interpolationkey:p}):b}const h=p.split(this.formatSeparator),w=h.shift().trim(),y=h.join(this.formatSeparator).trim();return this.format(fc(r,c,w,this.options.keySeparator,this.options.ignoreJSONStructure),y,n,{...o,...r,interpolationkey:w})};this.resetRegExp();const u=o?.missingInterpolationHandler||this.options.missingInterpolationHandler,f=o?.interpolation?.skipOnVariables!==void 0?o.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:p=>Qo(p)},{regex:this.regexp,safeValue:p=>this.escapeValue?Qo(this.escape(p)):Qo(p)}].forEach(p=>{for(l=0;a=p.regex.exec(t);){const h=a[1].trim();if(i=d(h),i===void 0)if(typeof u=="function"){const y=u(t,a,o);i=Ce(y)?y:""}else if(o&&Object.prototype.hasOwnProperty.call(o,h))i="";else if(f){i=a[0];continue}else this.logger.warn(`missed to pass in variable ${h} for interpolating ${t}`),i="";else!Ce(i)&&!this.useRawValueToEscape&&(i=rc(i));const w=p.safeValue(i);if(t=t.replace(a[0],w),f?(p.regex.lastIndex+=i.length,p.regex.lastIndex-=a[0].length):p.regex.lastIndex=0,l++,l>=this.maxReplaces)break}}),t}nest(t,r,n={}){let o,a,i;const l=(c,d)=>{const u=this.nestingOptionsSeparator;if(c.indexOf(u)<0)return c;const f=c.split(new RegExp(`${u}[ ]*{`));let g=`{${f[1]}`;c=f[0],g=this.interpolate(g,i);const p=g.match(/'/g),h=g.match(/"/g);((p?.length??0)%2===0&&!h||h.length%2!==0)&&(g=g.replace(/'/g,'"'));try{i=JSON.parse(g),d&&(i={...d,...i})}catch(w){return this.logger.warn(`failed parsing options string in nesting for key ${c}`,w),`${c}${u}${g}`}return i.defaultValue&&i.defaultValue.indexOf(this.prefix)>-1&&delete i.defaultValue,c};for(;o=this.nestingRegexp.exec(t);){let c=[];i={...n},i=i.replace&&!Ce(i.replace)?i.replace:i,i.applyPostProcessor=!1,delete i.defaultValue;let d=!1;if(o[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(o[1])){const u=o[1].split(this.formatSeparator).map(f=>f.trim());o[1]=u.shift(),c=u,d=!0}if(a=r(l.call(this,o[1].trim(),i),i),a&&o[0]===t&&!Ce(a))return a;Ce(a)||(a=rc(a)),a||(this.logger.warn(`missed to resolve ${o[1]} for nesting ${t}`),a=""),d&&(a=c.reduce((u,f)=>this.format(u,f,n.lng,{...n,interpolationkey:o[1].trim()}),a.trim())),t=t.replace(o[0],a),this.regexp.lastIndex=0}return t}}const s2=e=>{let t=e.toLowerCase().trim();const r={};if(e.indexOf("(")>-1){const n=e.split("(");t=n[0].toLowerCase().trim();const o=n[1].substring(0,n[1].length-1);t==="currency"&&o.indexOf(":")<0?r.currency||(r.currency=o.trim()):t==="relativetime"&&o.indexOf(":")<0?r.range||(r.range=o.trim()):o.split(";").forEach(i=>{if(i){const[l,...c]=i.split(":"),d=c.join(":").trim().replace(/^'+|'+$/g,""),u=l.trim();r[u]||(r[u]=d),d==="false"&&(r[u]=!1),d==="true"&&(r[u]=!0),isNaN(d)||(r[u]=parseInt(d,10))}})}return{formatName:t,formatOptions:r}},gc=e=>{const t={};return(r,n,o)=>{let a=o;o&&o.interpolationkey&&o.formatParams&&o.formatParams[o.interpolationkey]&&o[o.interpolationkey]&&(a={...a,[o.interpolationkey]:void 0});const i=n+JSON.stringify(a);let l=t[i];return l||(l=e(On(n),o),t[i]=l),l(r)}},o2=e=>(t,r,n)=>e(On(r),n)(t);class a2{constructor(t={}){this.logger=Mt.create("formatter"),this.options=t,this.init(t)}init(t,r={interpolation:{}}){this.formatSeparator=r.interpolation.formatSeparator||",";const n=r.cacheInBuiltFormats?gc:o2;this.formats={number:n((o,a)=>{const i=new Intl.NumberFormat(o,{...a});return l=>i.format(l)}),currency:n((o,a)=>{const i=new Intl.NumberFormat(o,{...a,style:"currency"});return l=>i.format(l)}),datetime:n((o,a)=>{const i=new Intl.DateTimeFormat(o,{...a});return l=>i.format(l)}),relativetime:n((o,a)=>{const i=new Intl.RelativeTimeFormat(o,{...a});return l=>i.format(l,a.range||"day")}),list:n((o,a)=>{const i=new Intl.ListFormat(o,{...a});return l=>i.format(l)})}}add(t,r){this.formats[t.toLowerCase().trim()]=r}addCached(t,r){this.formats[t.toLowerCase().trim()]=gc(r)}format(t,r,n,o={}){const a=r.split(this.formatSeparator);if(a.length>1&&a[0].indexOf("(")>1&&a[0].indexOf(")")<0&&a.find(l=>l.indexOf(")")>-1)){const l=a.findIndex(c=>c.indexOf(")")>-1);a[0]=[a[0],...a.splice(1,l)].join(this.formatSeparator)}return a.reduce((l,c)=>{const{formatName:d,formatOptions:u}=s2(c);if(this.formats[d]){let f=l;try{const g=o?.formatParams?.[o.interpolationkey]||{},p=g.locale||g.lng||o.locale||o.lng||n;f=this.formats[d](l,p,{...u,...o,...g})}catch(g){this.logger.warn(g)}return f}else this.logger.warn(`there was no format function for ${d}`);return l},t)}}const i2=(e,t)=>{e.pending[t]!==void 0&&(delete e.pending[t],e.pendingCount--)};class l2 extends So{constructor(t,r,n,o={}){super(),this.backend=t,this.store=r,this.services=n,this.languageUtils=n.languageUtils,this.options=o,this.logger=Mt.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=o.maxParallelReads||10,this.readingCalls=0,this.maxRetries=o.maxRetries>=0?o.maxRetries:5,this.retryTimeout=o.retryTimeout>=1?o.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(n,o.backend,o)}queueLoad(t,r,n,o){const a={},i={},l={},c={};return t.forEach(d=>{let u=!0;r.forEach(f=>{const g=`${d}|${f}`;!n.reload&&this.store.hasResourceBundle(d,f)?this.state[g]=2:this.state[g]<0||(this.state[g]===1?i[g]===void 0&&(i[g]=!0):(this.state[g]=1,u=!1,i[g]===void 0&&(i[g]=!0),a[g]===void 0&&(a[g]=!0),c[f]===void 0&&(c[f]=!0)))}),u||(l[d]=!0)}),(Object.keys(a).length||Object.keys(i).length)&&this.queue.push({pending:i,pendingCount:Object.keys(i).length,loaded:{},errors:[],callback:o}),{toLoad:Object.keys(a),pending:Object.keys(i),toLoadLanguages:Object.keys(l),toLoadNamespaces:Object.keys(c)}}loaded(t,r,n){const o=t.split("|"),a=o[0],i=o[1];r&&this.emit("failedLoading",a,i,r),!r&&n&&this.store.addResourceBundle(a,i,n,void 0,void 0,{skipCopy:!0}),this.state[t]=r?-1:2,r&&n&&(this.state[t]=0);const l={};this.queue.forEach(c=>{K1(c.loaded,[a],i),i2(c,t),r&&c.errors.push(r),c.pendingCount===0&&!c.done&&(Object.keys(c.loaded).forEach(d=>{l[d]||(l[d]={});const u=c.loaded[d];u.length&&u.forEach(f=>{l[d][f]===void 0&&(l[d][f]=!0)})}),c.done=!0,c.errors.length?c.callback(c.errors):c.callback())}),this.emit("loaded",l),this.queue=this.queue.filter(c=>!c.done)}read(t,r,n,o=0,a=this.retryTimeout,i){if(!t.length)return i(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:t,ns:r,fcName:n,tried:o,wait:a,callback:i});return}this.readingCalls++;const l=(d,u)=>{if(this.readingCalls--,this.waitingReads.length>0){const f=this.waitingReads.shift();this.read(f.lng,f.ns,f.fcName,f.tried,f.wait,f.callback)}if(d&&u&&o<this.maxRetries){setTimeout(()=>{this.read.call(this,t,r,n,o+1,a*2,i)},a);return}i(d,u)},c=this.backend[n].bind(this.backend);if(c.length===2){try{const d=c(t,r);d&&typeof d.then=="function"?d.then(u=>l(null,u)).catch(l):l(null,d)}catch(d){l(d)}return}return c(t,r,l)}prepareLoading(t,r,n={},o){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),o&&o();Ce(t)&&(t=this.languageUtils.toResolveHierarchy(t)),Ce(r)&&(r=[r]);const a=this.queueLoad(t,r,n,o);if(!a.toLoad.length)return a.pending.length||o(),null;a.toLoad.forEach(i=>{this.loadOne(i)})}load(t,r,n){this.prepareLoading(t,r,{},n)}reload(t,r,n){this.prepareLoading(t,r,{reload:!0},n)}loadOne(t,r=""){const n=t.split("|"),o=n[0],a=n[1];this.read(o,a,"read",void 0,void 0,(i,l)=>{i&&this.logger.warn(`${r}loading namespace ${a} for language ${o} failed`,i),!i&&l&&this.logger.log(`${r}loaded namespace ${a} for language ${o}`,l),this.loaded(t,i,l)})}saveMissing(t,r,n,o,a,i={},l=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(r)){this.logger.warn(`did not save key "${n}" as the namespace "${r}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(n==null||n==="")){if(this.backend?.create){const c={...i,isUpdate:a},d=this.backend.create.bind(this.backend);if(d.length<6)try{let u;d.length===5?u=d(t,r,n,o,c):u=d(t,r,n,o),u&&typeof u.then=="function"?u.then(f=>l(null,f)).catch(l):l(null,u)}catch(u){l(u)}else d(t,r,n,o,l,c)}!t||!t[0]||this.store.addResource(t[0],r,n,o)}}}const pc=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if(typeof e[1]=="object"&&(t=e[1]),Ce(e[1])&&(t.defaultValue=e[1]),Ce(e[2])&&(t.tDescription=e[2]),typeof e[2]=="object"||typeof e[3]=="object"){const r=e[3]||e[2];Object.keys(r).forEach(n=>{t[n]=r[n]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),hc=e=>(Ce(e.ns)&&(e.ns=[e.ns]),Ce(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),Ce(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs?.indexOf?.("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),typeof e.initImmediate=="boolean"&&(e.initAsync=e.initImmediate),e),ys=()=>{},c2=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(r=>{typeof e[r]=="function"&&(e[r]=e[r].bind(e))})};class Dn extends So{constructor(t={},r){if(super(),this.options=hc(t),this.services={},this.logger=Mt,this.modules={external:[]},c2(this),r&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,r),this;setTimeout(()=>{this.init(t,r)},0)}}init(t={},r){this.isInitializing=!0,typeof t=="function"&&(r=t,t={}),t.defaultNS==null&&t.ns&&(Ce(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const n=pc();this.options={...n,...this.options,...hc(t)},this.options.interpolation={...n.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const o=d=>d?typeof d=="function"?new d:d:null;if(!this.options.isClone){this.modules.logger?Mt.init(o(this.modules.logger),this.options):Mt.init(null,this.options);let d;this.modules.formatter?d=this.modules.formatter:d=a2;const u=new cc(this.options);this.store=new ac(this.options.resources,this.options);const f=this.services;f.logger=Mt,f.resourceStore=this.store,f.languageUtils=u,f.pluralResolver=new r2(u,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),d&&(!this.options.interpolation.format||this.options.interpolation.format===n.interpolation.format)&&(f.formatter=o(d),f.formatter.init(f,this.options),this.options.interpolation.format=f.formatter.format.bind(f.formatter)),f.interpolator=new n2(this.options),f.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},f.backendConnector=new l2(o(this.modules.backend),f.resourceStore,f,this.options),f.backendConnector.on("*",(g,...p)=>{this.emit(g,...p)}),this.modules.languageDetector&&(f.languageDetector=o(this.modules.languageDetector),f.languageDetector.init&&f.languageDetector.init(f,this.options.detection,this.options)),this.modules.i18nFormat&&(f.i18nFormat=o(this.modules.i18nFormat),f.i18nFormat.init&&f.i18nFormat.init(this)),this.translator=new Gs(this.services,this.options),this.translator.on("*",(g,...p)=>{this.emit(g,...p)}),this.modules.external.forEach(g=>{g.init&&g.init(this)})}if(this.format=this.options.interpolation.format,r||(r=ys),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const d=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);d.length>0&&d[0]!=="dev"&&(this.options.lng=d[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(d=>{this[d]=(...u)=>this.store[d](...u)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(d=>{this[d]=(...u)=>(this.store[d](...u),this)});const l=fn(),c=()=>{const d=(u,f)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(f),r(u,f)};if(this.languages&&!this.isInitialized)return d(null,this.t.bind(this));this.changeLanguage(this.options.lng,d)};return this.options.resources||!this.options.initAsync?c():setTimeout(c,0),l}loadResources(t,r=ys){let n=r;const o=Ce(t)?t:this.language;if(typeof t=="function"&&(n=t),!this.options.resources||this.options.partialBundledLanguages){if(o?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return n();const a=[],i=l=>{if(!l||l==="cimode")return;this.services.languageUtils.toResolveHierarchy(l).forEach(d=>{d!=="cimode"&&a.indexOf(d)<0&&a.push(d)})};o?i(o):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(c=>i(c)),this.options.preload?.forEach?.(l=>i(l)),this.services.backendConnector.load(a,this.options.ns,l=>{!l&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),n(l)})}else n(null)}reloadResources(t,r,n){const o=fn();return typeof t=="function"&&(n=t,t=void 0),typeof r=="function"&&(n=r,r=void 0),t||(t=this.languages),r||(r=this.options.ns),n||(n=ys),this.services.backendConnector.reload(t,r,a=>{o.resolve(),n(a)}),o}use(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return t.type==="backend"&&(this.modules.backend=t),(t.type==="logger"||t.log&&t.warn&&t.error)&&(this.modules.logger=t),t.type==="languageDetector"&&(this.modules.languageDetector=t),t.type==="i18nFormat"&&(this.modules.i18nFormat=t),t.type==="postProcessor"&&Af.addPostProcessor(t),t.type==="formatter"&&(this.modules.formatter=t),t.type==="3rdParty"&&this.modules.external.push(t),this}setResolvedLanguage(t){if(!(!t||!this.languages)&&!(["cimode","dev"].indexOf(t)>-1)){for(let r=0;r<this.languages.length;r++){const n=this.languages[r];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}!this.resolvedLanguage&&this.languages.indexOf(t)<0&&this.store.hasLanguageSomeTranslations(t)&&(this.resolvedLanguage=t,this.languages.unshift(t))}}changeLanguage(t,r){this.isLanguageChangingTo=t;const n=fn();this.emit("languageChanging",t);const o=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},a=(l,c)=>{c?this.isLanguageChangingTo===t&&(o(c),this.translator.changeLanguage(c),this.isLanguageChangingTo=void 0,this.emit("languageChanged",c),this.logger.log("languageChanged",c)):this.isLanguageChangingTo=void 0,n.resolve((...d)=>this.t(...d)),r&&r(l,(...d)=>this.t(...d))},i=l=>{!t&&!l&&this.services.languageDetector&&(l=[]);const c=Ce(l)?l:l&&l[0],d=this.store.hasLanguageSomeTranslations(c)?c:this.services.languageUtils.getBestMatchFromCodes(Ce(l)?[l]:l);d&&(this.language||o(d),this.translator.language||this.translator.changeLanguage(d),this.services.languageDetector?.cacheUserLanguage?.(d)),this.loadResources(d,u=>{a(u,d)})};return!t&&this.services.languageDetector&&!this.services.languageDetector.async?i(this.services.languageDetector.detect()):!t&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(i):this.services.languageDetector.detect(i):i(t),n}getFixedT(t,r,n){const o=(a,i,...l)=>{let c;typeof i!="object"?c=this.options.overloadTranslationOptionHandler([a,i].concat(l)):c={...i},c.lng=c.lng||o.lng,c.lngs=c.lngs||o.lngs,c.ns=c.ns||o.ns,c.keyPrefix!==""&&(c.keyPrefix=c.keyPrefix||n||o.keyPrefix);const d=this.options.keySeparator||".";let u;return c.keyPrefix&&Array.isArray(a)?u=a.map(f=>`${c.keyPrefix}${d}${f}`):u=c.keyPrefix?`${c.keyPrefix}${d}${a}`:a,this.t(u,c)};return Ce(t)?o.lng=t:o.lngs=t,o.ns=r,o.keyPrefix=n,o}t(...t){return this.translator?.translate(...t)}exists(...t){return this.translator?.exists(...t)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t,r={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=r.lng||this.resolvedLanguage||this.languages[0],o=this.options?this.options.fallbackLng:!1,a=this.languages[this.languages.length-1];if(n.toLowerCase()==="cimode")return!0;const i=(l,c)=>{const d=this.services.backendConnector.state[`${l}|${c}`];return d===-1||d===0||d===2};if(r.precheck){const l=r.precheck(this,i);if(l!==void 0)return l}return!!(this.hasResourceBundle(n,t)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||i(n,t)&&(!o||i(a,t)))}loadNamespaces(t,r){const n=fn();return this.options.ns?(Ce(t)&&(t=[t]),t.forEach(o=>{this.options.ns.indexOf(o)<0&&this.options.ns.push(o)}),this.loadResources(o=>{n.resolve(),r&&r(o)}),n):(r&&r(),Promise.resolve())}loadLanguages(t,r){const n=fn();Ce(t)&&(t=[t]);const o=this.options.preload||[],a=t.filter(i=>o.indexOf(i)<0&&this.services.languageUtils.isSupportedCode(i));return a.length?(this.options.preload=o.concat(a),this.loadResources(i=>{n.resolve(),r&&r(i)}),n):(r&&r(),Promise.resolve())}dir(t){if(t||(t=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!t)return"rtl";const r=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],n=this.services?.languageUtils||new cc(pc());return r.indexOf(n.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(t={},r){return new Dn(t,r)}cloneInstance(t={},r=ys){const n=t.forkResourceStore;n&&delete t.forkResourceStore;const o={...this.options,...t,isClone:!0},a=new Dn(o);if((t.debug!==void 0||t.prefix!==void 0)&&(a.logger=a.logger.clone(t)),["store","services","language"].forEach(l=>{a[l]=this[l]}),a.services={...this.services},a.services.utils={hasLoadedNamespace:a.hasLoadedNamespace.bind(a)},n){const l=Object.keys(this.store.data).reduce((c,d)=>(c[d]={...this.store.data[d]},c[d]=Object.keys(c[d]).reduce((u,f)=>(u[f]={...c[d][f]},u),c[d]),c),{});a.store=new ac(l,o),a.services.resourceStore=a.store}return a.translator=new Gs(a.services,o),a.translator.on("*",(l,...c)=>{a.emit(l,...c)}),a.init(o,r),a.translator.options=o,a.translator.backendConnector.services.utils={hasLoadedNamespace:a.hasLoadedNamespace.bind(a)},a}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Je=Dn.createInstance();Je.createInstance=Dn.createInstance;Je.createInstance;Je.dir;Je.init;Je.loadResources;Je.reloadResources;Je.use;Je.changeLanguage;Je.getFixedT;Je.t;Je.exists;Je.setDefaultNamespace;Je.hasLoadedNamespace;Je.loadNamespaces;Je.loadLanguages;const{slice:d2,forEach:u2}=[];function f2(e){return u2.call(d2.call(arguments,1),t=>{if(t)for(const r in t)e[r]===void 0&&(e[r]=t[r])}),e}function g2(e){return typeof e!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(r=>r.test(e))}const mc=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,p2=function(e,t){const n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},o=encodeURIComponent(t);let a=`${e}=${o}`;if(n.maxAge>0){const i=n.maxAge-0;if(Number.isNaN(i))throw new Error("maxAge should be a Number");a+=`; Max-Age=${Math.floor(i)}`}if(n.domain){if(!mc.test(n.domain))throw new TypeError("option domain is invalid");a+=`; Domain=${n.domain}`}if(n.path){if(!mc.test(n.path))throw new TypeError("option path is invalid");a+=`; Path=${n.path}`}if(n.expires){if(typeof n.expires.toUTCString!="function")throw new TypeError("option expires is invalid");a+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(a+="; HttpOnly"),n.secure&&(a+="; Secure"),n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return n.partitioned&&(a+="; Partitioned"),a},xc={create(e,t,r,n){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};r&&(o.expires=new Date,o.expires.setTime(o.expires.getTime()+r*60*1e3)),n&&(o.domain=n),document.cookie=p2(e,t,o)},read(e){const t=`${e}=`,r=document.cookie.split(";");for(let n=0;n<r.length;n++){let o=r[n];for(;o.charAt(0)===" ";)o=o.substring(1,o.length);if(o.indexOf(t)===0)return o.substring(t.length,o.length)}return null},remove(e,t){this.create(e,"",-1,t)}};var h2={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&typeof document<"u")return xc.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:r,cookieMinutes:n,cookieDomain:o,cookieOptions:a}=t;r&&typeof document<"u"&&xc.create(r,e,n,o,a)}},m2={name:"querystring",lookup(e){let{lookupQuerystring:t}=e,r;if(typeof window<"u"){let{search:n}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(n=window.location.hash.substring(window.location.hash.indexOf("?")));const a=n.substring(1).split("&");for(let i=0;i<a.length;i++){const l=a[i].indexOf("=");l>0&&a[i].substring(0,l)===t&&(r=a[i].substring(l+1))}}return r}},x2={name:"hash",lookup(e){let{lookupHash:t,lookupFromHashIndex:r}=e,n;if(typeof window<"u"){const{hash:o}=window.location;if(o&&o.length>2){const a=o.substring(1);if(t){const i=a.split("&");for(let l=0;l<i.length;l++){const c=i[l].indexOf("=");c>0&&i[l].substring(0,c)===t&&(n=i[l].substring(c+1))}}if(n)return n;if(!n&&r>-1){const i=o.match(/\/([a-zA-Z-]*)/g);return Array.isArray(i)?i[typeof r=="number"?r:0]?.replace("/",""):void 0}}}return n}};let Ir=null;const yc=()=>{if(Ir!==null)return Ir;try{if(Ir=typeof window<"u"&&window.localStorage!==null,!Ir)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch{Ir=!1}return Ir};var y2={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&yc())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:r}=t;r&&yc()&&window.localStorage.setItem(r,e)}};let Mr=null;const bc=()=>{if(Mr!==null)return Mr;try{if(Mr=typeof window<"u"&&window.sessionStorage!==null,!Mr)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch{Mr=!1}return Mr};var b2={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&bc())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:r}=t;r&&bc()&&window.sessionStorage.setItem(r,e)}},w2={name:"navigator",lookup(e){const t=[];if(typeof navigator<"u"){const{languages:r,userLanguage:n,language:o}=navigator;if(r)for(let a=0;a<r.length;a++)t.push(r[a]);n&&t.push(n),o&&t.push(o)}return t.length>0?t:void 0}},v2={name:"htmlTag",lookup(e){let{htmlTag:t}=e,r;const n=t||(typeof document<"u"?document.documentElement:null);return n&&typeof n.getAttribute=="function"&&(r=n.getAttribute("lang")),r}},j2={name:"path",lookup(e){let{lookupFromPathIndex:t}=e;if(typeof window>"u")return;const r=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(r)?r[typeof t=="number"?t:0]?.replace("/",""):void 0}},k2={name:"subdomain",lookup(e){let{lookupFromSubdomainIndex:t}=e;const r=typeof t=="number"?t+1:1,n=typeof window<"u"&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(n)return n[r]}};let Pf=!1;try{document.cookie,Pf=!0}catch{}const Lf=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];Pf||Lf.splice(1,1);const N2=()=>({order:Lf,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e});class Ff{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(t,r)}init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=t,this.options=f2(r,this.options||{},N2()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=o=>o.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(h2),this.addDetector(m2),this.addDetector(y2),this.addDetector(b2),this.addDetector(w2),this.addDetector(v2),this.addDetector(j2),this.addDetector(k2),this.addDetector(x2)}addDetector(t){return this.detectors[t.name]=t,this}detect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,r=[];return t.forEach(n=>{if(this.detectors[n]){let o=this.detectors[n].lookup(this.options);o&&typeof o=="string"&&(o=[o]),o&&(r=r.concat(o))}}),r=r.filter(n=>n!=null&&!g2(n)).map(n=>this.options.convertDetectedLanguage(n)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?r:r.length>0?r[0]:null}cacheUserLanguage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;r&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(t)>-1||r.forEach(n=>{this.detectors[n]&&this.detectors[n].cacheUserLanguage(t,this.options)}))}}Ff.type="languageDetector";const S2={en:{translation:{}},it:{translation:{}},es:{translation:{}},fr:{translation:{}},de:{translation:{}}};Je.use(Ff).use($g).init({debug:!1,fallbackLng:"it",lng:"it",interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator","htmlTag"],caches:["localStorage"]},resources:S2});Je.changeLanguage("it");const ea={it:{"Crea nuovo form":"Crea nuovo form","Configurazioni nodi workflow":"Configurazioni nodi workflow"}},$f=x.createContext(void 0),bi=()=>{const e=x.useContext($f);if(e===void 0)throw new Error("useLanguage must be used within a LanguageProvider");return e},C2=({children:e})=>{const[t,r]=x.useState("it"),[n,o]=x.useState(!1);x.useEffect(()=>{Je.changeLanguage("it"),localStorage.setItem("language","it")},[]);const l={currentLanguage:"it",changeLanguage:async c=>{},t:(c,d)=>ea.it&&ea.it[c]?ea.it[c]:Je.exists(c)?Je.t(c):d||c,isLoading:n};return s.jsx($f.Provider,{value:l,children:e})},_2=(e,t=!1)=>{const r="px-4 py-2 shadow-lg rounded-lg border-2 text-sm font-medium min-w-[120px] text-center",n={Start:"bg-green-500 text-white border-green-600",START:"bg-green-500 text-white border-green-600",End:"bg-red-500 text-white border-red-600",END:"bg-red-500 text-white border-red-600",DataFilter:"bg-blue-300 text-white border-blue-400",DATA_FILTER:"bg-blue-300 text-white border-blue-400",DataSort:"bg-blue-600 text-white border-blue-700",DATA_SORT:"bg-blue-600 text-white border-blue-700",EmailSend:"bg-orange-500 text-white border-orange-600",EMAIL_SEND:"bg-orange-500 text-white border-orange-600",ApiCall:"bg-teal-500 text-white border-teal-600",API_CALL:"bg-teal-500 text-white border-teal-600",FileRead:"bg-teal-400 text-white border-teal-500",FILE_READ:"bg-teal-400 text-white border-teal-500",FileUpload:"bg-teal-600 text-white border-teal-700",FILE_UPLOAD:"bg-teal-600 text-white border-teal-700",Calculation:"bg-indigo-300 text-white border-indigo-400",CALCULATION:"bg-indigo-300 text-white border-indigo-400",ChartCreation:"bg-purple-500 text-white border-purple-600",CHART_CREATION:"bg-purple-500 text-white border-purple-600",PaymentRequest:"bg-yellow-600 text-white border-yellow-700",PAYMENT_REQUEST:"bg-yellow-600 text-white border-yellow-700"},o=t?" ring-4 ring-blue-300":"";return`${r} ${n[e]||"bg-gray-400 text-white border-gray-500"}${o}`},lt=({data:e,id:t,selected:r})=>{const{t:n}=bi(),o=e,a=c=>{window.dispatchEvent(new CustomEvent("openNodeConfig",{detail:{nodeId:t,nodeData:o}}))},i=o.type==="Start"||o.type==="START",l=o.type==="End"||o.type==="END";return s.jsxs("div",{className:`${_2(o.type,r)} cursor-pointer hover:shadow-xl transition-all`,onClick:a,children:[!i&&s.jsx(zt,{type:"target",position:ye.Top,className:"w-3 h-3 bg-gray-800 border-white border-2"}),s.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[s.jsx("div",{className:"text-xs opacity-75",children:o.category||n("Action")}),s.jsx("div",{className:"font-semibold",children:n(o.label)}),o.description&&s.jsx("div",{className:"text-xs opacity-90 max-w-[100px] truncate",children:n(o.description)}),o.status&&s.jsx("div",{className:`text-xs px-2 py-0.5 rounded-full ${o.status==="configured"?"bg-green-200 text-green-800":o.status==="error"?"bg-red-200 text-red-800":"bg-yellow-200 text-yellow-800"}`,children:n(o.status)})]}),!l&&s.jsx(zt,{type:"source",position:ye.Bottom,className:"w-3 h-3 bg-gray-800 border-white border-2"})]})},wc=({data:e,id:t,selected:r})=>{const{t:n}=bi(),o=e,a=i=>{window.dispatchEvent(new CustomEvent("openNodeConfig",{detail:{nodeId:t,nodeData:o}}))};return s.jsxs("div",{className:`px-4 py-3 shadow-lg rounded-lg bg-purple-500 text-white border-2 border-purple-600 min-w-[150px] cursor-pointer hover:shadow-xl transition-all ${r?"ring-4 ring-blue-300":""}`,onClick:a,children:[s.jsx(zt,{type:"target",position:ye.Top,className:"w-3 h-3 bg-gray-800 border-white border-2"}),s.jsxs("div",{className:"flex items-center justify-center mb-1",children:[s.jsxs("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:[s.jsx("path",{d:"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"}),s.jsx("path",{d:"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"})]}),s.jsx("div",{className:"font-semibold",children:n(o?.label||"Send Email")})]}),o?.config?.recipients?.length>0&&s.jsxs("div",{className:"text-xs text-purple-100 mt-1 text-center",children:["To: ",o.config.recipients.slice(0,2).join(", "),o.config.recipients.length>2&&"..."]}),o.status&&s.jsx("div",{className:`text-xs px-2 py-0.5 rounded-full mt-2 text-center ${o.status==="configured"?"bg-green-200 text-green-800":o.status==="error"?"bg-red-200 text-red-800":"bg-yellow-200 text-yellow-800"}`,children:n(o.status)}),s.jsx(zt,{type:"source",position:ye.Bottom,className:"w-3 h-3 bg-gray-800 border-white border-2"})]})},vc=({data:e,id:t,selected:r})=>{const{t:n}=bi(),o=e,a=i=>{window.dispatchEvent(new CustomEvent("openNodeConfig",{detail:{nodeId:t,nodeData:o}}))};return s.jsxs("div",{className:`px-4 py-3 shadow-lg rounded-lg bg-orange-500 text-white border-2 border-orange-600 min-w-[150px] cursor-pointer hover:shadow-xl transition-all ${r?"ring-4 ring-blue-300":""}`,onClick:a,children:[s.jsx(zt,{type:"target",position:ye.Top,className:"w-3 h-3 bg-gray-800 border-white border-2"}),s.jsxs("div",{className:"flex items-center justify-center mb-1",children:[s.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),s.jsx("div",{className:"font-semibold",children:n(o?.label||"API Call")})]}),o?.config?.method&&s.jsxs("div",{className:"text-xs text-orange-100 mt-1 text-center",children:[o.config.method," ",o.config.url?new URL(o.config.url).pathname:""]}),o.status&&s.jsx("div",{className:`text-xs px-2 py-0.5 rounded-full mt-2 text-center ${o.status==="configured"?"bg-green-200 text-green-800":o.status==="error"?"bg-red-200 text-red-800":"bg-yellow-200 text-yellow-800"}`,children:n(o.status)}),s.jsx(zt,{type:"source",position:ye.Bottom,className:"w-3 h-3 bg-gray-800 border-white border-2"})]})},ct={START:"Start",END:"End",DATA_FILTER:"DataFilter",DATA_SORT:"DataSort",FILE_READ:"FileRead",FILE_UPLOAD:"FileUpload",CALCULATION:"Calculation",CHART_CREATION:"ChartCreation",EMAIL_SEND:"EmailSend",API_CALL:"ApiCall"},E2=()=>{const e={[ct.START]:lt,[ct.END]:lt,[ct.EMAIL_SEND]:wc,[ct.API_CALL]:vc,[ct.DATA_FILTER]:lt,[ct.DATA_SORT]:lt,[ct.FILE_READ]:lt,[ct.FILE_UPLOAD]:lt,[ct.CALCULATION]:lt,[ct.CHART_CREATION]:lt,CUSTOM:lt,Start:lt,End:lt,START:lt,END:lt,EmailSend:wc,ApiCall:vc};return new Proxy(e,{get(t,r){return t[r]||lt}})},T2=E2(),Or={Start:{label:"Start",category:"Flow Control"},START:{label:"Start",category:"Flow Control"},End:{label:"End",category:"Flow Control"},END:{label:"End",category:"Flow Control"},FileRead:{label:"File Read",category:"Data"},FILE_READ:{label:"File Read",category:"Data"},FileUpload:{label:"File Upload",category:"Data"},FILE_UPLOAD:{label:"File Upload",category:"Data"},DataUpload:{label:"Data Upload",category:"Data"},DataSort:{label:"Data Sort",category:"Data"},DATA_SORT:{label:"Data Sort",category:"Data"},DataFilter:{label:"Data Filter",category:"Data"},DATA_FILTER:{label:"Data Filter",category:"Data"},Calculation:{label:"Calculation",category:"Business Logic"},CALCULATION:{label:"Calculation",category:"Business Logic"},ChartCreation:{label:"Chart Creation",category:"Reporting"},CHART_CREATION:{label:"Chart Creation",category:"Reporting"},PaymentProcessing:{label:"Payment Processing",category:"E-Commerce"},PAYMENT_PROCESSING:{label:"Payment Processing",category:"E-Commerce"},PaymentRequest:{label:"Payment Request",category:"E-Commerce"},PAYMENT_REQUEST:{label:"Payment Request",category:"E-Commerce"},ApiCall:{label:"API Call",category:"Integration"},API_CALL:{label:"API Call",category:"Integration"},EmailSend:{label:"Send Email",category:"Communication"},EMAIL_SEND:{label:"Send Email",category:"Communication"},NOTIFICATION:{label:"Notification",category:"Communication"}},gn=[],A2=[],P2=({workflowId:e,onSave:t,onClose:r})=>{const{t:n}=gt(),{darkMode:o}=nt(),[a,i,l]=Cv(gn),[c,d,u]=_v(A2),[f,g]=x.useState(null),[p,h]=x.useState(!1),[w,y]=x.useState(!1),b=x.useRef(null),[S,m]=x.useState(null),[v,j]=x.useState(!1),[k,C]=x.useState(null),[A,T]=x.useState(!1),[O,$]=x.useState(!1);v1();const[D,M]=x.useState(!1),[N,L]=x.useState(null),[F,_]=x.useState({}),[I,R]=x.useState(!1),[B,H]=x.useState(null),{saveWorkflow:ie,executeWorkflow:ge,loadWorkflow:ee,isSaving:J,isExecuting:G}=T1({nodes:a,edges:c,workflowId:e,onSave:t});function oe(U){let z=100;return U.map((se,we)=>{const ke=se.type;let Fe=se.position;(!Fe||typeof Fe.x!="number"||typeof Fe.y!="number")&&(Fe={x:100+we*40,y:z},z+=60);const Te={label:se.label||se.data?.label||Or[ke]?.label||"Unknown",type:ke,config:se.config||se.data?.config||{},category:se.category||se.data?.category||Or[ke]?.category||"Other",status:se.status||se.data?.status||"pending",...se.data&&typeof se.data=="object"?se.data:{}};return{...se,type:ke,position:Fe,data:Te}})}x.useEffect(()=>{(async()=>{if(!e){i(gn),d([]);return}try{y(!0);const z=await ee(e);if(z){const{nodes:se,edges:we}=z,ke=oe(se);console.log("✅ Loaded workflow nodes:",ke.length),i(ke),d(we||[])}else i(gn),d([])}catch(z){console.error("Errore nel caricamento del workflow:",z),i(gn),d([])}finally{y(!1)}})()},[e]);const te=x.useCallback(U=>{if(U.target&&a.find(we=>we.id===U.target)?.type===ct.START){console.warn("❌ Il nodo START non può avere connessioni in ingresso");return}if(U.source&&a.find(we=>we.id===U.source)?.type===ct.END){console.warn("❌ Il nodo END non può avere connessioni in uscita");return}const z=Pu(U,c);d(z)},[d,c,a]),E=x.useCallback(U=>{U.preventDefault(),U.stopPropagation(),U.dataTransfer.dropEffect="move"},[]),Q=x.useCallback(U=>{try{U.preventDefault(),U.stopPropagation(),console.log("🎯 Drop event triggered in WorkflowBuilder");const z=b.current?.getBoundingClientRect();let se=U.dataTransfer.getData("text/plain");if(console.log("🎯 Raw node type from drag data (text/plain):",se),se||(se=U.dataTransfer.getData("application/reactflow"),console.log("🎯 Fallback to reactflow data:",se)),se||(se=U.dataTransfer.getData("text"),console.log("🎯 Fallback to text data:",se)),!se){console.error("🎯 No drag data found in any format"),console.log("🎯 Available data types:",U.dataTransfer.types);return}let we=se;if(console.log("🎯 Node type:",we),!we){console.warn("🎯 Unknown node type, skipping");return}if(!Object.values(ct).includes(we)&&!we.startsWith("custom_")){console.warn("🎯 Node type not supported:",we);return}if(!z){console.error("🎯 ReactFlow bounds not found");return}if(!S){console.error("🎯 ReactFlow instance not initialized");return}const Fe=S.screenToFlowPosition({x:U.clientX-z.left,y:U.clientY-z.top});console.log("🎯 Calculated position:",Fe);let Te,be=we;if(we==="CUSTOM"||se==="custom"||se.startsWith("custom_"))if(se.startsWith("custom_"))Te=se,be=se,console.log("🎯 Using real custom form ID:",Te);else{const Ie=`form_${Date.now()}_${Math.floor(Math.random()*1e4)}`;Te=`custom_${Ie}`,be=`custom_${Ie}`,console.log("🎯 Creating custom node with generated ID:",Te)}else Te=`${we}_${Date.now()}_${Math.floor(Math.random()*1e4)}`;const Me=Ie=>Ie.startsWith("custom_")?`Custom Form ${Ie.replace("custom_","")}`:Ie==="CUSTOM"?"Custom Form":Or[Ie]?.label||Or[se]?.label||"Unknown",Oe=Ie=>Ie.startsWith("custom_")||Ie==="CUSTOM"?"Custom":Or[Ie]?.category||Or[se]?.category||"Other",kt=Ie=>{if(Ie.startsWith("custom_")){const et=Ie.replace("custom_","");return{form_id:et,form_name:`Custom Form ${et}`,form_data:{},validation_enabled:!0,auto_save:!1,fields:[],_needs_field_loading:!0}}if(Ie.startsWith("custom_form_")){const et=Ie.replace("custom_form_","");return{form_id:et,form_name:`Custom Form ${et}`,form_data:{},validation_enabled:!0,auto_save:!1,fields:[],_needs_field_loading:!0}}return Ie==="CUSTOM"?{form_id:"new_form",form_name:"New Custom Form",form_data:{},validation_enabled:!0,auto_save:!1,fields:[],_needs_field_loading:!0}:{}},wt={id:Te,type:we==="CUSTOM"||se==="custom"?"CUSTOM":we,position:Fe,data:{label:Me(be),type:be,config:kt(be),category:Oe(be),status:"pending"}};console.log("🎯 Creating new node:",wt),i(Ie=>Ie.concat(wt))}catch(z){console.error("🎯 Error in onDrop:",z),alert("Errore durante l'aggiunta del nodo. Riprova.")}},[S,i]),re=x.useCallback((U,z)=>{if(g(z),z.type==="START"||z.type==="Start"){L(z),M(!0);return}if(z.type==="END"||z.type==="End"){L(z),M(!0);return}L(z),M(!0)},[]),ce=x.useCallback((U,z)=>{j(!0),C(z.id)},[]),ue=x.useCallback((U,z)=>{j(!1),C(null)},[]),fe=x.useCallback(U=>{if(U==="start"){alert(n("Cannot delete the start node"));return}console.log("🗑️ Deleting node:",U),i(z=>z.filter(se=>se.id!==U)),d(z=>z.filter(se=>se.source!==U&&se.target!==U)),f?.id===U&&(g(null),h(!1)),j(!1),C(null),(async()=>{try{e&&(await je.workflows.deleteFieldMapping(e,U),console.log("🧹 Field mapping rimosso per nodo",U))}catch(z){console.warn("Impossibile rimuovere il field mapping per nodo",U,z)}})()},[f,i,d,n,e]),Ee=x.useCallback(U=>{U.preventDefault(),U.stopPropagation(),console.log("🗑️ Drop on trash detected"),k&&fe(k),T(!1)},[k,fe]),De=x.useCallback(U=>{U.preventDefault(),U.stopPropagation(),U.dataTransfer.dropEffect="move"},[]),qe=x.useCallback(U=>{U.preventDefault(),T(!0)},[]),Ke=x.useCallback(async(U,z,se,we)=>{let ke;const Fe=a.find(be=>be.id===U);if(Array.isArray(z)&&z.length>0&&z[0].sourceFormId!==void 0&&z[0].mappings!==void 0){if(ke={sources:z},z.length>0){const be=z[0];_(Me=>({...Me,[U]:be.mappings}))}}else{if(!se||!we){console.warn("Legacy format requires sourceFormId and sourceFormName");return}ke={sources:[{sourceFormId:se,sourceFormName:we,mappings:z}]},_(be=>({...be,[U]:z}))}i(be=>be.map(Me=>Me.id===U?{...Me,data:{...Me.data,fieldMapping:ke,fieldMappings:ke.sources[0]?.mappings||[],status:"configured"}}:Me)),setTimeout(()=>{i(be=>!be.some(Oe=>Oe.id===U)&&Fe?(console.warn("[FieldMapping][GUARD] Nodo",U,"non presente dopo salvataggio mapping. Reinserisco snapshot."),[...be,Fe]):be)},0);try{if(e){console.log("💾 [STEP 1] Salvando field mapping per nodo",U,"..."),console.log("💾 [STEP 1] workflowId:",e),console.log("💾 [STEP 1] sources:",JSON.stringify(ke.sources,null,2));const be=await je.workflows.upsertFieldMapping(e,U,ke.sources||[]);console.log("✅ [STEP 2] Field mapping salvato con successo per nodo",U),console.log("✅ [STEP 2] Response:",be.status,be.data);try{console.log("🔍 [STEP 3] Verifico mapping appena salvato...");const Me=await je.workflows.getFieldMapping(e,U);console.log("✅ [STEP 3] Mapping verificato:",Me.status,Me.data)}catch(Me){console.error("❌ [STEP 3] Errore verifica mapping:",Me.response?.status,Me.response?.data)}}}catch(be){throw console.error("❌ Errore nel salvataggio dei field mapping:",be),be}},[i,e]),V=x.useCallback(U=>{B&&(i(z=>z.map(se=>se.id===B.id?{...se,data:{...se.data,fields:U,fieldConfig:U,status:"configured"}}:se)),R(!1),H(null))},[B,i]),q=x.useCallback(U=>{U.preventDefault(),T(!1)},[]),K=()=>{confirm(n("Are you sure you want to clear the entire workflow?"))&&(i(gn),d([]),g(null),h(!1))},Y=async()=>{if(e&&confirm(n("Sei sicuro di voler eliminare definitivamente questo workflow?")))try{await je.workflows.delete(e),alert(n("Workflow eliminato con successo!")),r&&r()}catch(U){console.error("❌ Errore durante l'eliminazione del workflow:",U),alert(n("Errore durante l'eliminazione del workflow."))}};x.useEffect(()=>{const U=z=>{(z.key==="Delete"||z.key==="Backspace")&&f&&f.id!=="start"&&(z.preventDefault(),fe(f.id)),z.ctrlKey&&z.key==="z"&&console.log("🔄 Undo requested (not implemented yet)"),z.key==="Escape"&&(g(null),h(!1))};return document.addEventListener("keydown",U),()=>{document.removeEventListener("keydown",U)}},[f,fe]);const le=N1(U=>U.workflow.currentWorkflow);return x.useEffect(()=>{le&&console.log("🟢 [Redux] currentWorkflow:",le)},[le]),s.jsx(A1,{children:s.jsxs("div",{className:`flex flex-col h-screen ${o?"bg-gray-900":"bg-gray-100"}`,style:{position:"relative"},children:[w&&s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 flex items-center space-x-3",children:[s.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600"}),s.jsx("span",{className:"text-gray-900",children:"Caricamento workflow..."})]})}),s.jsx(E1,{}),s.jsx("div",{className:"flex-1 relative",ref:b,style:{minHeight:"600px",width:"100%",marginLeft:O?"64px":"320px",transition:"margin-left 0.2s ease",border:"2px dashed transparent"},onDrop:Q,onDragOver:E,onDragEnter:U=>{U.preventDefault(),U.currentTarget.style.borderColor="#8b5cf6",console.log("🎯 Drag entered canvas area")},onDragLeave:U=>{U.preventDefault(),U.currentTarget.style.borderColor="transparent",console.log("🎯 Drag left canvas area")},children:s.jsxs(Sv,{nodes:a,edges:c,onNodesChange:l,onEdgesChange:u,onConnect:te,nodeTypes:T2,onNodeClick:re,onNodeDragStart:ce,onNodeDragStop:ue,onDrop:Q,onDragOver:E,fitView:!0,style:{minHeight:"600px",width:"100%"},onInit:m,children:[s.jsx(Dv,{className:o?"react-flow__controls-dark":""}),s.jsx(Gv,{className:o?"react-flow__minimap-dark":"",nodeColor:o?"#374151":"#e5e7eb"}),s.jsx(Lv,{variant:Yt.Dots,gap:12,size:1,color:o?"#374151":"#e5e7eb"}),s.jsxs(Gr,{position:"top-right",className:"flex gap-2",style:{zIndex:20,right:"2rem",top:"2rem",maxWidth:"calc(100vw - 320px)",flexWrap:"wrap"},children:[s.jsx("button",{onClick:()=>{const U=a.find(z=>z.type===ct.START);g(U||a[0]||null),h(!0)},className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg shadow transition-colors",children:n("Debug Panel")}),s.jsx("button",{onClick:ge,disabled:G,className:`px-4 py-2 rounded-lg shadow transition-colors text-white ${G?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:n(G?"Testing...":"Test Run")}),s.jsx("button",{onClick:ie,disabled:J,className:`px-4 py-2 rounded-lg shadow transition-colors text-white ${J?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:n(J?"Saving...":"Save Workflow")}),s.jsx("button",{onClick:K,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg shadow transition-colors",children:n("Clear")}),f&&f.id!=="start"&&s.jsx("button",{onClick:()=>fe(f.id),className:"px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg shadow transition-colors",children:n("Delete Node")}),e&&s.jsx("button",{onClick:Y,className:"px-4 py-2 bg-red-800 hover:bg-red-900 text-white rounded-lg shadow transition-colors",children:n("Delete Workflow")}),r&&s.jsx("button",{onClick:r,className:`px-4 py-2 rounded-lg shadow transition-colors ${o?"bg-gray-600 hover:bg-gray-700 text-white":"bg-gray-500 hover:bg-gray-600 text-white"}`,children:n("Close")})]}),v&&s.jsx(Gr,{position:"bottom-center",children:s.jsxs("div",{className:`relative rounded-lg shadow-lg border-2 border-dashed p-6 transition-all duration-200 transform ${A?"scale-110":"scale-100"} ${o?`${A?"bg-red-800 border-red-500":"bg-red-900 border-red-600"} text-red-100`:`${A?"bg-red-200 border-red-500":"bg-red-100 border-red-400"} text-red-800`}`,onDrop:Ee,onDragOver:De,onDragEnter:qe,onDragLeave:q,children:[s.jsx("div",{className:"flex items-center gap-3",children:s.jsx("svg",{className:`w-8 h-8 transition-transform duration-200 ${A?"scale-125":"scale-100"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),A&&s.jsx("div",{className:"absolute inset-0 rounded-lg border-2 border-red-500 animate-pulse opacity-50"})]})})]})}),s.jsx(H1,{visible:D,onClose:()=>{M(!1),L(null)},targetNode:N,onSave:Ke,workflowId:e,existingSources:N&&N?.data?.fieldMapping?.sources?N.data.fieldMapping.sources:void 0,existingMappings:N&&Array.isArray(N?.data?.fieldMapping?.mappings)?N.data.fieldMapping.mappings:N&&Array.isArray(N?.data?.fieldMappings)?N.data.fieldMappings:[],existingSourceFormId:N?N?.data?.fieldMapping?.sourceFormId:void 0}),s.jsx(V1,{visible:I,onClose:()=>{R(!1),H(null)},onSave:V,initialFields:B?.data?.fields||B?.data?.fieldConfig||[],formId:B?.data?.form_id})]})})},L2=({isMobile:e})=>{const{t,i18n:r}=gt(),{darkMode:n}=nt(),{getCardClasses:o}=it(),[a,i]=x.useState([]),[l,c]=x.useState(!1),[d,u]=x.useState(null),[f,g]=x.useState(!0),[p,h]=x.useState(null),[w,y]=x.useState(null),[b,S]=x.useState(!1),[m,v]=x.useState(null),[j,k]=x.useState(""),[C,A]=x.useState(""),[T,O]=x.useState([]),[$,D]=x.useState(""),[M,N]=x.useState(1),[L,F]=x.useState(0),[_,I]=x.useState(10),[R,B]=x.useState(!1);function H(E){return{id:E.id,name:E.name,status:E.status,description:E.description,category:E.category,created_at:E.created_at,visual_nodes:Array.isArray(E.visual_nodes)?E.visual_nodes:[],visual_edges:Array.isArray(E.visual_edges)?E.visual_edges:[]}}const ie=async()=>{g(!0),h(null);try{const E=await je.workflows.list();console.log("[DEBUG] Workflows response:",E.data);const Q=E.data?.workflows||(Array.isArray(E.data)?E.data:E.data.items||[]);console.log("[DEBUG] Workflows array:",Q),i(Q.map(H)),F(Q.length)}catch(E){h(E),i([]),console.error("Errore nel caricamento dei workflow:",E)}finally{g(!1)}};x.useEffect(()=>{const E=setTimeout(()=>{ie()},300);return()=>clearTimeout(E)},[$,M,j,C]);const ge=async E=>{try{if(console.log("🔄 Saving workflow:",E),!E.name?.trim()){me.error("Il nome del workflow è obbligatorio");return}if(!E.status||!["active","inactive","draft"].includes(E.status)){me.error("Status del workflow non valido");return}let Q;if(E.id&&!E.id.startsWith("workflow_")){console.log("📝 Updating existing workflow:",E.id);const re={id:E.id,name:E.name.trim(),description:E.description?.trim()||"",status:E.status,category:E.category||"CUSTOM",priority:E.priority||"medium",created_by:E.created_by||"user",version:E.version||1,visual_nodes:JSON.stringify(E.visual_nodes||[]),visual_edges:JSON.stringify(E.visual_edges||[]),tags:JSON.stringify(E.tags||[]),settings:JSON.stringify(E.settings||{}),steps:JSON.stringify(E.steps||[]),created_at:E.created_at||new Date().toISOString(),updated_at:new Date().toISOString()};console.log("📤 UPDATE data:",re),Q=await je.workflows.update(re),me.success(t("Workflow aggiornato! Status: "+E.status))}else{console.log("➕ Creating new workflow...");const re=[{id:"start-node",type:"Start",position:{x:250,y:100},data:{label:"Start",type:"Start",config:{},category:"Flow Control",status:"pending"}},{id:"end-node",type:"End",position:{x:250,y:300},data:{label:"End",type:"End",config:{},category:"Flow Control",status:"pending"}}],ce=[{id:"start-to-end",source:"start-node",target:"end-node",type:"smoothstep",animated:!0}],ue={id:E.id&&E.id.startsWith("workflow_")?E.id:`workflow_${Date.now()}`,name:E.name.trim(),description:E.description?.trim()||"",status:E.status,category:E.category||"CUSTOM",priority:E.priority||"medium",created_by:E.created_by||"user",version:1,visual_nodes:JSON.stringify(E.visual_nodes||re),visual_edges:JSON.stringify(E.visual_edges||ce),tags:JSON.stringify(E.tags||[]),settings:JSON.stringify(E.settings||{}),steps:JSON.stringify(E.steps||[])};console.log("📤 CREATE data:",ue),Q=await je.workflows.create(ue),me.success(t("Workflow creato!"))}console.log("✅ Backend response:",Q),c(!1),u(null),ie()}catch(Q){if(console.error("❌ API Error:",Q),console.error("❌ API Error Details:",Q.response?.data),console.error("❌ API Error Status:",Q.response?.status),Q.response?.status===422){const re=Q.response?.data?.detail||Q.response?.data?.message||"Dati non validi";if(Array.isArray(Q.response?.data?.detail)){const ce=Q.response.data.detail.map(ue=>`Campo: ${ue.loc?.join?.(".")||"unknown"} - ${ue.msg||ue.message||"errore sconosciuto"}`).join("; ");me.error(`Errore di validazione: ${ce}`)}else me.error(`Errore di validazione (422): ${re}`)}else Q.response?.status===400?me.error("Richiesta malformata. Controlla i dati inseriti."):Q.response?.status===404?me.error("Workflow non trovato. Potrebbe essere stato eliminato."):Q.response?.status===500?me.error("Errore interno del server. Riprova più tardi."):me.error(`Errore durante il salvataggio: ${Q.message||"Errore sconosciuto"}`);h(Q)}},ee=async E=>{if(confirm("Are you sure you want to delete this workflow?"))try{await je.workflows.delete(E),me.success(t("Workflow eliminato!")),ie()}catch(Q){h(Q),console.error("API Error:",Q)}},J=(E,Q)=>{y(Q),E.dataTransfer.effectAllowed="move"},G=E=>{E.preventDefault(),E.dataTransfer.dropEffect="move"},oe=(E,Q)=>{if(E.preventDefault(),w===null||w===Q)return;const re=[...a],ce=re.findIndex(fe=>fe.id===w),ue=re.findIndex(fe=>fe.id===Q);if(ce!==-1&&ue!==-1){const[fe]=re.splice(ce,1);re.splice(ue,0,fe),i(re),console.log("✅ Workflow order updated")}y(null)},te=()=>{y(null)};return x.useEffect(()=>{if(b){window.history.pushState({visualBuilder:!0},"Visual Builder");const E=Q=>{S(!1),v(null)};return window.addEventListener("popstate",E),()=>window.removeEventListener("popstate",E)}},[b]),x.useEffect(()=>{R&&(me.success(t("Workflow avviato!")),B(!1))},[R,t]),x.useEffect(()=>{document.title="Flussi di Lavoro"},[]),r.language!=="it"?s.jsx("div",{className:"p-8 text-center text-lg",children:"Caricamento traduzioni..."}):f&&a.length===0?s.jsx("div",{className:"p-6 bg-gray-50 dark:bg-gray-950 min-h-screen",children:s.jsxs("div",{className:"animate-pulse",children:[s.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),s.jsx("div",{className:"space-y-3",children:[...Array(4)].map((E,Q)=>s.jsx("div",{className:"h-20 bg-gray-200 rounded"},Q))})]})}):s.jsxs("div",{className:e?"min-h-screen bg-gray-50 dark:bg-gray-950 p-2":"min-h-screen bg-gray-50 dark:bg-gray-950 p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("div",{className:"flex items-center gap-4",children:s.jsx(ve,{as:"h1",variant:"primary",size:"3xl",weight:"bold",className:"text-purple-700 dark:text-purple-400",children:t("Workflows")})}),s.jsx("button",{onClick:()=>{u(null),c(!0)},className:"bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 text-white px-4 py-2 rounded-md font-medium transition-colors",children:t("Create Workflow")})]}),p&&s.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900 border border-amber-200 dark:border-amber-600 text-amber-700 dark:text-amber-200 px-4 py-3 rounded mb-4",children:[s.jsxs("div",{children:[s.jsx("b",{children:t("Errore")}),":"]}),s.jsx("div",{style:{wordBreak:"break-all",fontSize:"0.95em"},children:typeof p=="string"?p:p?.message||JSON.stringify(p)}),p?.stack&&s.jsxs("details",{style:{marginTop:8},children:[s.jsx("summary",{children:"Stack trace"}),s.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:"0.85em"},children:p.stack})]})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-850 shadow-sm dark:shadow-gray-900/50 p-4 mb-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx("div",{className:"md:col-span-2",children:s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",value:$,onChange:E=>D(E.target.value),placeholder:t("Search workflows..."),className:"w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-800 bg-white dark:bg-gray-950 text-gray-900 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 placeholder-gray-500 dark:placeholder-gray-400 transition-colors"}),s.jsx("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500 w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),$&&s.jsx("button",{onClick:()=>D(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 transition-colors",type:"button",children:"✕"})]})}),s.jsx("div",{children:s.jsxs("select",{value:j,onChange:E=>k(E.target.value),className:"w-full px-4 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none",children:[s.jsx("option",{value:"",children:t("All Status")}),s.jsx("option",{value:"active",children:t("Active")}),s.jsx("option",{value:"inactive",children:t("Inactive")}),s.jsx("option",{value:"draft",children:t("Draft")})]})}),s.jsx("div",{children:s.jsxs("select",{value:C,onChange:E=>A(E.target.value),className:"w-full px-4 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none",children:[s.jsx("option",{value:"",children:t("All Categories")}),s.jsx("option",{value:"HR",children:t("HR")}),s.jsx("option",{value:"IT",children:t("IT")}),s.jsx("option",{value:"Finance",children:t("Finance")}),s.jsx("option",{value:"Operations",children:t("Operations")})]})})]}),($||j||C)&&s.jsx("div",{className:"flex justify-end mt-4",children:s.jsx("button",{onClick:()=>{D(""),k(""),A("")},className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg border border-gray-300 dark:border-gray-600 transition-colors",children:t("Clear Filters")})})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f?s.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-12 space-y-4",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t("Loading workflows...")})]}):a.length===0?s.jsxs("div",{className:"col-span-full text-center py-12",children:[s.jsx("div",{className:"text-gray-400 dark:text-gray-500 mb-4",children:s.jsx("svg",{className:"mx-auto h-16 w-16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:t($||j||C?"No workflows match your filters":"No workflows found")}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:t($||j||C?"Try adjusting your search criteria or clear the filters.":"Get started by creating your first workflow.")}),($||j||C)&&s.jsx("button",{onClick:()=>{D(""),k(""),A("")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:t("Clear Filters")})]}):a.map(E=>s.jsx("div",{className:`bg-white dark:bg-gray-900 shadow-sm dark:shadow-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-850 hover:shadow-md dark:hover:shadow-gray-900/70 transition-all cursor-move ${w===E.id?"opacity-50 scale-95":""}`,draggable:!0,onDragStart:Q=>J(Q,E.id),onDragOver:G,onDrop:Q=>oe(Q,E.id),onDragEnd:te,children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-start mb-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:E.name}),E.description&&s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:E.description})]}),s.jsx($s,{variant:E.status==="active"?"success":"secondary",size:"sm",children:E.status})]}),E.category&&s.jsx("div",{className:"mb-4",children:s.jsx($s,{variant:"info",size:"sm",children:E.category})}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:E.created_at&&`${t("Created")} ${new Date(E.created_at).toLocaleDateString()}`}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>{u(E),c(!0)},className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 text-sm transition-colors",children:t("Edit")}),s.jsx("button",{onClick:()=>{v(E.id.toString()),S(!0)},className:"text-purple-600 dark:text-purple-400 hover:text-purple-800 dark:hover:text-purple-300 text-sm transition-colors",children:t("Visual Builder")}),s.jsx("button",{onClick:()=>ee(E.id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 text-sm transition-colors",children:t("Delete")})]})]})]})},E.id))}),!f&&a.length>0&&s.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row items-center justify-between space-y-4 sm:space-y-0",children:[s.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:[t("Showing")," ",(M-1)*_+1," ",t("to")," ",Math.min(M*_,L)," ",t("of")," ",L," ",t("workflows")]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("select",{value:_,onChange:E=>{I(Number(E.target.value)),N(1)},className:"px-2 py-1 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded text-sm",children:[s.jsx("option",{value:10,children:"10"}),s.jsx("option",{value:20,children:"20"}),s.jsx("option",{value:50,children:"50"})]}),s.jsx("button",{onClick:()=>N(E=>Math.max(E-1,1)),disabled:M===1,className:"px-3 py-1 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-600",children:t("Previous")}),Array.from({length:Math.min(5,Math.ceil(L/_))},(E,Q)=>{const re=M-2+Q,ce=Math.ceil(L/_);return re<1||re>ce?null:s.jsx("button",{onClick:()=>N(re),className:`px-3 py-1 border text-sm rounded ${M===re?"bg-blue-600 text-white border-blue-600":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600"}`,children:re},re)}),s.jsx("button",{onClick:()=>N(E=>Math.min(E+1,Math.ceil(L/_))),disabled:M>=Math.ceil(L/_),className:"px-3 py-1 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-600",children:t("Next")})]})]}),l&&s.jsx("div",{className:"fixed inset-0 bg-gray-900 dark:bg-black bg-opacity-50 dark:bg-opacity-80 overflow-y-auto h-full w-full z-50",children:s.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-2xl dark:shadow-gray-950/90 rounded-md bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-800",children:s.jsxs("div",{className:"mt-3",children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:t(d?"Edit Workflow":"Create Workflow")})}),s.jsxs("form",{onSubmit:E=>{E.preventDefault();const Q=E.target,re={id:d?.id||`workflow_${Date.now()}`,name:Q.workflowName.value,status:Q.workflowStatus.value||"draft",description:Q.workflowDescription.value||"",category:d?Q.workflowCategory.value:"CUSTOM",priority:d?.priority||"medium",created_by:d?.created_by||"user",version:d?.version||1,created_at:d?.created_at,tags:d?.tags||[],settings:d?.settings||{},steps:d?.steps||[],visual_nodes:d?.visual_nodes||[],visual_edges:d?.visual_edges||[]};ge(re)},children:[s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t("Name")," *"]}),s.jsx("input",{name:"workflowName",defaultValue:d?.name||"",placeholder:t("Workflow Name"),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-500 dark:placeholder-gray-400",required:!0})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("Description")}),s.jsx("textarea",{name:"workflowDescription",defaultValue:d?.description||"",placeholder:t("Workflow Description"),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-500 dark:placeholder-gray-400"})]}),d?s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("Category")}),s.jsxs("select",{name:"workflowCategory",defaultValue:d?.category||"",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:t("Select Category")}),s.jsx("option",{value:"HR",children:t("HR")}),s.jsx("option",{value:"IT",children:t("IT")}),s.jsx("option",{value:"Finance",children:t("Finance")}),s.jsx("option",{value:"Operations",children:t("Operations")}),s.jsx("option",{value:"CUSTOM",children:"CUSTOM"})]})]}):s.jsx("input",{type:"hidden",name:"workflowCategory",value:"CUSTOM"}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t("Status")," *"]}),s.jsxs("select",{name:"workflowStatus",defaultValue:d?.status||"active",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[s.jsx("option",{value:"active",children:t("Active")}),s.jsx("option",{value:"inactive",children:t("Inactive")}),s.jsx("option",{value:"draft",children:t("Draft")})]})]}),s.jsxs("div",{className:"flex justify-end space-x-4",children:[s.jsx("button",{type:"button",onClick:()=>{c(!1),u(null)},className:"px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:t("Cancel")}),s.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 dark:bg-blue-700 text-white rounded-md hover:bg-blue-700 dark:hover:bg-blue-800 transition-colors",children:t(d?"Update":"Create")})]})]})]})})}),b&&s.jsx("div",{className:e?"fixed inset-0 z-50 bg-white dark:bg-gray-900 p-2":"fixed inset-0 z-50 bg-white dark:bg-gray-900 p-8",children:s.jsx(P2,{workflowId:m||void 0,onSave:async(E,Q)=>{try{console.log("🔄 Visual Builder onSave called with:",{nodes:E.length,edges:Q.length});const re=a.find(ce=>ce.id.toString()===(m||""));if(re&&m){let ce=re.settings||{};try{console.log("🔍 [Workflows.tsx] Recupero settings aggiornate dal backend...");const fe=await je.workflows.list(),De=(fe.data?.workflows||(Array.isArray(fe.data)?fe.data:fe.data.items||[])).find(qe=>qe.id===m);De&&De.settings?(ce=typeof De.settings=="string"?JSON.parse(De.settings):De.settings||{},console.log("✅ [Workflows.tsx] Settings aggiornate recuperate:",ce)):console.log("⚠️ [Workflows.tsx] Settings non trovate, uso quelle in memoria")}catch(fe){console.warn("⚠️ [Workflows.tsx] Errore recupero settings, uso quelle in memoria:",fe)}const ue={id:re.id,name:re.name,description:re.description,category:re.category,priority:re.priority||"medium",status:re.status,tags:JSON.stringify(re.tags||[]),settings:JSON.stringify(ce),steps:JSON.stringify(re.steps||[]),visual_nodes:JSON.stringify(E),visual_edges:JSON.stringify(Q)};console.log("📤 Sending update to backend:",{id:ue.id,visual_nodes_length:E.length,visual_edges_length:Q.length,settings_keys:Object.keys(ce)}),console.log("📤 [STEP 4] Settings che sto per inviare:",JSON.stringify(ce,null,2)),await je.workflows.update(ue),console.log("✅ [STEP 5] Workflow aggiornato! Verifico che i mapping siano ancora presenti...");try{const fe=E.find(Ee=>Ee.data?.fieldMapping);if(fe){console.log("🔍 [STEP 6] Verifico mapping per nodo:",fe.id);const Ee=await je.workflows.getFieldMapping(m,fe.id);console.log("✅ [STEP 6] Mapping DOPO workflow save:",Ee.status,Ee.data)}else console.log("⚠️ [STEP 6] Nessun nodo con fieldMapping trovato per verificare")}catch(fe){console.error("❌ [STEP 6] PROBLEMA: Mapping NON trovato dopo workflow save!",fe.response?.status,fe.response?.data)}me.success(t("Workflow aggiornato dal Visual Builder!")),ie(),S(!1),v(null)}else alert(t("Workflow not found")),console.error("❌ Workflow not found")}catch(re){console.error("❌ Error saving workflow from Visual Builder:",re),me.error(t("Errore nel salvataggio del workflow"))}},onClose:()=>{S(!1),v(null),window.history.state&&window.history.state.visualBuilder&&window.history.back()}})})]})},tt=[];for(let e=0;e<256;++e)tt.push((e+256).toString(16).slice(1));function F2(e,t=0){return(tt[e[t+0]]+tt[e[t+1]]+tt[e[t+2]]+tt[e[t+3]]+"-"+tt[e[t+4]]+tt[e[t+5]]+"-"+tt[e[t+6]]+tt[e[t+7]]+"-"+tt[e[t+8]]+tt[e[t+9]]+"-"+tt[e[t+10]]+tt[e[t+11]]+tt[e[t+12]]+tt[e[t+13]]+tt[e[t+14]]+tt[e[t+15]]).toLowerCase()}let ta;const $2=new Uint8Array(16);function R2(){if(!ta){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ta=crypto.getRandomValues.bind(crypto)}return ta($2)}const I2=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),jc={randomUUID:I2};function ra(e,t,r){if(jc.randomUUID&&!e)return jc.randomUUID();e=e||{};const n=e.random??e.rng?.()??R2();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,F2(n)}const M2=[{value:"text",label:"Testo"},{value:"number",label:"Numero"},{value:"email",label:"Email"},{value:"tel",label:"Telefono"},{value:"date",label:"Data"},{value:"datetime-local",label:"Data e Ora"},{value:"time",label:"Ora"},{value:"textarea",label:"Area di Testo"},{value:"select",label:"Selezione"},{value:"checkbox",label:"Checkbox"},{value:"radio",label:"Radio Button"},{value:"file",label:"File"},{value:"url",label:"URL"},{value:"password",label:"Password"}],O2=({isOpen:e,onClose:t,onSave:r,initialData:n})=>{const{darkMode:o,toggleDarkMode:a}=nt(),[i,l]=x.useState(""),[c,d]=x.useState(""),[u,f]=x.useState([]),[g,p]=x.useState(!1),[h,w]=x.useState(""),[y,b]=x.useState([]),[S,m]=x.useState([]),[v,j]=x.useState(!1),[k,C]=x.useState(null),A=x.useRef(new Map),T=x.useMemo(()=>{const _=Object.entries(yi),I=new Map;return _.forEach(([R,B])=>{I.has(R)||I.set(R,B||{})}),Array.from(I.entries()).map(([R,B])=>({value:R,label:typeof B?.label=="string"?B.label:R,category:typeof B?.category=="string"?B.category:"Workflow",description:typeof B?.description=="string"?B.description:""})).sort((R,B)=>R.label.localeCompare(B.label))},[]);x.useEffect(()=>{!h&&T.length>0&&w(T[0].value)},[T,h]),x.useEffect(()=>{let _=!1;return(async R=>{if(!R){b([]),m([]);return}if(A.current.has(R)){const B=A.current.get(R);b(B.fields),m(B.outputs),C(null);return}j(!0),C(null);try{const B=await je.get(`/nodes/fields/${encodeURIComponent(R)}`);if(_)return;const H=B.data||{},ie=Array.isArray(H.fields)?H.fields.map(ee=>{const J=String(ee?.label||ee?.name||"Campo").trim(),G=ee?.type||ee?.field_type||ee?.input_type,oe=ee?.description||ee?.help_text||ee?.hint,te=ee?.section||ee?.group||ee?.category||ee?.meta&&ee.meta.section,E=Array.isArray(ee?.options)?ee.options:Array.isArray(ee?.choices)?ee.choices:void 0;return{name:String(ee?.name||J).trim(),label:J,type:G?String(G):"string",required:!!ee?.required,description:oe?String(oe):void 0,section:te?String(te):void 0,options:E,raw:ee}}):[],ge=Array.isArray(H.outputs)?H.outputs.map(ee=>{const J=String(ee?.label||ee?.name||ee?.key||"Output").trim();return{name:String(ee?.name||ee?.key||ee?.path||J).trim(),label:J,type:ee?.type?String(ee.type):"string",description:ee?.description?String(ee.description):void 0,path:ee?.path?String(ee.path):ee?.json_path?String(ee.json_path):void 0,raw:ee}}):[];A.current.set(R,{fields:ie,outputs:ge}),b(ie),m(ge),C(null)}catch(B){if(_)return;console.error("Errore caricamento campi nodo:",B);const H=B?.response?.data?.detail||"Impossibile caricare i campi del nodo selezionato";C(H),b([]),m([])}finally{_||j(!1)}})(h),()=>{_=!0}},[h]);const O=x.useMemo(()=>{if(!y.length)return[];const _=new Map;return y.forEach(I=>{const R=I.section||"Campi principali";_.has(R)||_.set(R,[]),_.get(R).push(I)}),Array.from(_.entries()).map(([I,R])=>({groupName:I,fields:R.sort((B,H)=>B.label.localeCompare(H.label))}))},[y]);x.useEffect(()=>{n&&(l(n.name||""),d(n.category||""),Array.isArray(n.fields)&&f(n.fields.map(_=>({id:_.id||ra(),name:_.name||"",label:_.label||"",type:_.type||"text",placeholder:_.placeholder||"",options:_.options||[]}))))},[n]);const $=()=>{f([...u,{id:ra(),name:"",label:"",type:"text",placeholder:"",options:[]}])},D=_=>{f(u.filter(I=>I.id!==_))},M=(_,I)=>{f(u.map(R=>R.id===_?{...R,...I}:R))},N=_=>{if(_===0)return;const I=[...u];[I[_-1],I[_]]=[I[_],I[_-1]],f(I)},L=_=>{if(_===u.length-1)return;const I=[...u];[I[_],I[_+1]]=[I[_+1],I[_]],f(I)},F=async()=>{if(!i.trim()){me.error("Inserisci il nome del form");return}if(u.length===0){me.error("Aggiungi almeno un campo");return}for(const _ of u){if(!_.name.trim()){me.error("Tutti i campi devono avere un nome");return}if(!_.label.trim()){me.error("Tutti i campi devono avere un'etichetta");return}}p(!0);try{const _={id:n?.id||ra(),name:i,category:c,fields:u.map((I,R)=>({id:I.id,name:I.name,label:I.label,type:I.type,placeholder:I.placeholder,options:I.options,display_order:R})),is_active:!0,version:n?.version||1};n?.id?(await je.forms.update(_),me.success("Form aggiornato con successo")):(await je.forms.create(_),me.success("Form creato con successo")),r(),t()}catch(_){console.error("Errore salvataggio form:",_),me.error(_.response?.data?.detail||"Errore nel salvataggio del form")}finally{p(!1)}};return e?s.jsx("div",{className:"fixed inset-0 z-50 overflow-auto bg-black/50 backdrop-blur-sm",children:s.jsx("div",{className:`min-h-screen ${o?"bg-gray-950":"bg-gray-50"}`,children:s.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h1",{className:`text-3xl font-bold ${o?"text-white":"text-gray-800"}`,children:n?"Modifica Form":"Crea Nuovo Form"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:a,className:`p-2 rounded-lg transition ${o?"bg-gray-850 hover:bg-gray-800 text-yellow-400":"bg-gray-200 hover:bg-gray-300 text-gray-800"}`,title:o?"Light Mode":"Dark Mode",children:o?s.jsx(Hh,{className:"w-5 h-5"}):s.jsx(Mh,{className:"w-5 h-5"})}),s.jsx("button",{onClick:t,className:`px-4 py-2 rounded-lg transition ${o?"bg-gray-850 hover:bg-gray-800 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-800"}`,children:"✕ Chiudi"})]})]}),s.jsxs("div",{className:`p-6 rounded-xl mb-6 shadow-sm ${o?"bg-gray-900 border border-gray-850":"bg-white border border-gray-200"}`,children:[s.jsx("h2",{className:`text-xl font-bold mb-4 ${o?"text-white":"text-gray-800"}`,children:"Configurazione Form"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-semibold mb-2 ${o?"text-gray-300":"text-gray-700"}`,children:"Nome Form *"}),s.jsx("input",{type:"text",value:i,onChange:_=>l(_.target.value),placeholder:"Inserisci il nome del form",className:`w-full px-4 py-2 rounded-lg border transition ${o?"bg-gray-950 border-gray-800 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"}`})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-semibold mb-2 ${o?"text-gray-300":"text-gray-700"}`,children:"Categoria"}),s.jsx("input",{type:"text",value:c,onChange:_=>d(_.target.value),placeholder:"Categoria del form",className:`w-full px-4 py-2 rounded-lg border transition ${o?"bg-gray-950 border-gray-800 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"}`})]})]})]}),s.jsxs("div",{className:`p-6 rounded-xl mb-6 shadow-sm ${o?"bg-gray-900 border border-gray-850":"bg-white border border-gray-200"}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{className:`text-xl font-bold ${o?"text-white":"text-gray-800"}`,children:["Campi del Form (",u.length,")"]}),s.jsx("button",{onClick:$,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition font-semibold",children:"+ Aggiungi Campo"})]}),u.length===0?s.jsx("div",{className:`text-center py-12 rounded-lg ${o?"bg-gray-850 border border-gray-800":"bg-gray-50"}`,children:s.jsx("p",{className:`text-lg ${o?"text-gray-400":"text-gray-600"}`,children:'Nessun campo aggiunto. Clicca su "Aggiungi Campo" per iniziare.'})}):s.jsx("div",{className:"space-y-4",children:u.map((_,I)=>s.jsx("div",{className:`p-4 rounded-lg border ${o?"bg-gray-850 border-gray-800":"bg-gray-50 border-gray-300"}`,children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("button",{onClick:()=>N(I),disabled:I===0,className:`px-2 py-1 rounded transition ${I===0?"opacity-30 cursor-not-allowed":o?"hover:bg-gray-800":"hover:bg-gray-300"} ${o?"text-gray-300":"text-gray-600"}`,children:"▲"}),s.jsx("button",{onClick:()=>L(I),disabled:I===u.length-1,className:`px-2 py-1 rounded transition ${I===u.length-1?"opacity-30 cursor-not-allowed":o?"hover:bg-gray-800":"hover:bg-gray-300"} ${o?"text-gray-300":"text-gray-600"}`,children:"▼"})]}),s.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs font-semibold mb-1 ${o?"text-gray-400":"text-gray-600"}`,children:"Nome Campo *"}),s.jsx("input",{type:"text",value:_.name,onChange:R=>M(_.id,{name:R.target.value}),placeholder:"es: email, nome, cognome",className:`w-full px-3 py-2 rounded border text-sm ${o?"bg-gray-900 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"}`})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs font-semibold mb-1 ${o?"text-gray-400":"text-gray-600"}`,children:"Etichetta *"}),s.jsx("input",{type:"text",value:_.label,onChange:R=>M(_.id,{label:R.target.value}),placeholder:"es: Email, Nome, Cognome",className:`w-full px-3 py-2 rounded border text-sm ${o?"bg-gray-900 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"}`})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs font-semibold mb-1 ${o?"text-gray-400":"text-gray-600"}`,children:"Tipo Campo *"}),s.jsx("select",{value:_.type,onChange:R=>M(_.id,{type:R.target.value}),className:`w-full px-3 py-2 rounded border text-sm ${o?"bg-gray-900 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"}`,children:M2.map(R=>s.jsx("option",{value:R.value,children:R.label},R.value))})]}),_.type!=="select"&&_.type!=="dropdown"&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs font-semibold mb-1 ${o?"text-gray-400":"text-gray-600"}`,children:"Placeholder"}),s.jsx("input",{type:"text",value:_.placeholder,onChange:R=>M(_.id,{placeholder:R.target.value}),placeholder:"Testo suggerimento",className:`w-full px-3 py-2 rounded border text-sm ${o?"bg-gray-900 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"}`})]}),s.jsx("div",{className:"md:col-span-2"})]}),s.jsx("button",{onClick:()=>D(_.id),className:"px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded transition",children:"🗑️"})]})},_.id))})]}),s.jsxs("div",{className:"flex justify-end gap-4",children:[s.jsx("button",{onClick:t,className:`px-6 py-3 rounded-lg font-semibold transition ${o?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-800"}`,children:"Annulla"}),s.jsx("button",{onClick:F,disabled:g,className:"px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Salvataggio...":n?"Aggiorna Form":"Crea Form"})]}),s.jsxs("div",{className:`mt-8 p-6 rounded-xl shadow-sm ${o?"bg-gray-900 border border-gray-850":"bg-white border border-gray-200"}`,children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:`text-xl font-bold ${o?"text-white":"text-gray-800"}`,children:"Anteprima campi per nodo workflow"}),s.jsx("p",{className:`text-sm ${o?"text-gray-400":"text-gray-600"}`,children:"Seleziona un nodo per consultare i campi disponibili e prevedere gli accoppiamenti durante il mapping."})]}),s.jsxs("div",{className:"w-full md:w-64",children:[s.jsx("label",{className:`block text-xs font-semibold mb-1 ${o?"text-gray-400":"text-gray-600"}`,children:"Nodo Workflow"}),s.jsx("select",{value:h,onChange:_=>w(_.target.value),className:`w-full px-3 py-2 rounded border text-sm transition ${o?"bg-gray-900 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"}`,children:T.map(_=>s.jsx("option",{value:_.value,children:_.label},_.value))})]})]}),v&&s.jsx("div",{className:`py-6 text-center text-sm ${o?"text-gray-400":"text-gray-600"}`,children:"Caricamento campi nodo..."}),!v&&k&&s.jsx("div",{className:`py-4 px-4 rounded-lg border ${o?"border-red-700 bg-red-900/30 text-red-200":"border-red-200 bg-red-50 text-red-700"}`,children:k}),!v&&!k&&s.jsxs("div",{className:"space-y-4",children:[O.length===0?s.jsx("div",{className:`py-4 px-4 rounded-lg border ${o?"border-gray-800 bg-gray-900 text-gray-400":"border-gray-200 bg-gray-50 text-gray-600"}`,children:"Nessun campo configurato per questo nodo."}):O.map(_=>s.jsxs("details",{open:!0,className:`${o?"bg-gray-900 border border-gray-850":"bg-white border border-gray-200"} rounded-lg`,children:[s.jsxs("summary",{className:`cursor-pointer select-none px-4 py-3 flex items-center justify-between ${o?"text-gray-200":"text-gray-800"}`,children:[s.jsx("span",{className:"font-semibold",children:_.groupName}),s.jsxs("span",{className:`text-xs px-2 py-1 rounded-full ${o?"bg-gray-800 text-gray-300":"bg-gray-100 text-gray-600"}`,children:[_.fields.length," campi"]})]}),s.jsx("div",{className:"px-4 pb-4 space-y-3",children:_.fields.map(I=>s.jsxs("div",{className:`rounded-lg border px-4 py-3 ${o?"border-gray-800 bg-gray-950":"border-gray-200 bg-gray-50"}`,children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[s.jsxs("div",{children:[s.jsx("div",{className:`text-sm font-semibold ${o?"text-white":"text-gray-900"}`,children:I.label}),s.jsx("div",{className:`text-xs ${o?"text-gray-400":"text-gray-600"}`,children:I.name})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${o?"bg-purple-900/50 text-purple-200 border border-purple-800":"bg-purple-100 text-purple-700 border border-purple-200"}`,children:I.type}),I.required&&s.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${o?"bg-red-900/50 text-red-200 border border-red-800":"bg-red-100 text-red-700 border border-red-200"}`,children:"Obbligatorio"})]})]}),I.description&&s.jsx("p",{className:`mt-2 text-sm ${o?"text-gray-400":"text-gray-600"}`,children:I.description}),I.options&&I.options.length>0&&s.jsxs("div",{className:"mt-3",children:[s.jsx("div",{className:`text-xs font-semibold mb-1 ${o?"text-gray-300":"text-gray-600"}`,children:"Opzioni disponibili"}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[I.options.slice(0,6).map((R,B)=>s.jsx("span",{className:`text-xs px-2 py-1 rounded-full border ${o?"border-gray-800 text-gray-300":"border-gray-200 text-gray-600"}`,children:typeof R=="string"?R:R?.label||R?.value||JSON.stringify(R)},`${I.name}-option-${B}`)),I.options.length>6&&s.jsxs("span",{className:`text-xs px-2 py-1 rounded-full ${o?"bg-gray-800 text-gray-300":"bg-gray-100 text-gray-600"}`,children:["+",I.options.length-6," altre"]})]})]})]},I.name))})]},_.groupName)),S.length>0&&s.jsxs("details",{open:!0,className:`${o?"bg-gray-900 border border-gray-850":"bg-white border border-gray-200"} rounded-lg`,children:[s.jsxs("summary",{className:`cursor-pointer select-none px-4 py-3 flex items-center justify-between ${o?"text-gray-200":"text-gray-800"}`,children:[s.jsx("span",{className:"font-semibold",children:"Valori risultanti"}),s.jsxs("span",{className:`text-xs px-2 py-1 rounded-full ${o?"bg-gray-800 text-gray-300":"bg-gray-100 text-gray-600"}`,children:[S.length," output"]})]}),s.jsx("div",{className:"px-4 pb-4 space-y-3",children:S.map(_=>s.jsxs("div",{className:`rounded-lg border px-4 py-3 ${o?"border-gray-800 bg-gray-950":"border-gray-200 bg-gray-50"}`,children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[s.jsxs("div",{children:[s.jsx("div",{className:`text-sm font-semibold ${o?"text-white":"text-gray-900"}`,children:_.label}),s.jsx("div",{className:`text-xs ${o?"text-gray-400":"text-gray-600"}`,children:_.name})]}),s.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${o?"bg-emerald-900/40 text-emerald-200 border border-emerald-800":"bg-emerald-100 text-emerald-700 border border-emerald-200"}`,children:_.type})]}),_.description&&s.jsx("p",{className:`mt-2 text-sm ${o?"text-gray-400":"text-gray-600"}`,children:_.description}),_.path&&s.jsxs("div",{className:`mt-2 text-xs ${o?"text-purple-300":"text-purple-700"}`,children:["Path: ",_.path]})]},_.name))})]})]})]})]})})}):null},D2=({isMobile:e})=>{const{t,i18n:r}=gt(),{darkMode:n}=nt(),{getButtonClasses:o,getInputClasses:a}=it(),[i,l]=x.useState([]),[c,d]=x.useState(!1),[u,f]=x.useState(""),[g,p]=x.useState(!1),[h,w]=x.useState(null);he.useEffect(()=>{r.language!=="it"&&r.changeLanguage("it")},[r]);const y=async()=>{d(!0);try{const k=await je.forms.listAll();console.log("[DEBUG] Forms response:",k.data);const C=k.data?.forms||(Array.isArray(k.data)?k.data:[]);console.log("[DEBUG] Forms data:",C),l(C)}catch(k){console.error("Errore caricamento forms:",k),me.error("Errore nel caricamento dei form")}finally{d(!1)}};x.useEffect(()=>{y()},[]);const b=()=>{w(null),p(!0)},S=async k=>{try{const C=await je.forms.get(k.id);console.log("[DEBUG] Form detail loaded:",C.data),w(C.data),p(!0)}catch(C){console.error("Errore caricamento form:",C),me.error("Errore nel caricamento del form")}},m=async k=>{if(window.confirm("Sei sicuro di voler eliminare questo form?"))try{await je.forms.delete(k),me.success("Form eliminato con successo"),y(),window.dispatchEvent(new Event("formsUpdated")),console.log("🔔 Forms: Evento formsUpdated emesso dopo eliminazione")}catch(C){console.error("Errore eliminazione form:",C),me.error("Errore nell'eliminazione del form")}},v=()=>{p(!1),w(null),y(),window.dispatchEvent(new Event("formsUpdated")),console.log("🔔 Forms: Evento formsUpdated emesso dopo salvataggio")},j=i.filter(k=>k.name.toLowerCase().includes(u.toLowerCase())||k.description?.toLowerCase().includes(u.toLowerCase()));return g?s.jsx(O2,{isOpen:g,onClose:()=>{p(!1),w(null)},onSave:v,initialData:h}):s.jsx("div",{className:`p-6 min-h-screen ${n?"bg-gray-950 text-white":"bg-gray-50 text-gray-900"}`,children:s.jsxs("div",{className:"max-w-7xl mx-auto",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h1",{className:`text-3xl font-bold ${n?"text-white":"text-gray-800"}`,children:"Visual Form Builder"}),s.jsx("button",{onClick:b,className:o("primary")+(e?" px-3 py-1 text-sm rounded-full shadow-md":" px-4 py-2 text-base rounded-full shadow-lg"),children:"✨ Crea Form"})]}),s.jsx("div",{className:"mb-6",children:s.jsx(wh,{value:u,onChange:k=>f(k.target.value),placeholder:t("Cerca per nome o descrizione..."),className:a()+" text-lg px-4 py-2 rounded-full"})}),c&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),s.jsx("p",{className:"mt-4 text-gray-600",children:"Caricamento forms..."})]}),!c&&j.length===0&&s.jsxs("div",{className:`text-center p-12 rounded-2xl shadow-sm ${n?"bg-gray-900 border border-gray-850":"bg-gray-50"}`,children:[s.jsx("div",{className:"text-6xl mb-4",children:"📋"}),s.jsx("h3",{className:`text-2xl font-bold mb-2 ${n?"text-white":"text-gray-800"}`,children:i.length===0?"Nessun form trovato":"Nessun risultato"}),s.jsx("p",{className:`text-lg mb-6 ${n?"text-gray-400":"text-gray-600"}`,children:i.length===0?"Crea il tuo primo Generic Form Node aggiungendo campi personalizzati!":"Nessun form corrisponde ai criteri di ricerca."}),i.length===0&&s.jsx("button",{onClick:b,className:o("primary")+" px-8 py-3 text-lg rounded-full shadow-lg",children:"✨ Crea Form"})]}),!c&&j.length>0&&s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:j.map(k=>s.jsxs("div",{className:`p-6 rounded-2xl shadow-lg border transition-all duration-300 hover:scale-[1.02] ${n?"bg-gray-900 border-gray-850 hover:bg-gray-850 shadow-gray-900/50":"bg-white border-gray-200 hover:bg-gray-50"}`,children:[s.jsx("div",{className:"flex items-start justify-between mb-3",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-purple-600",children:s.jsx("span",{className:"text-white font-bold text-lg",children:"📋"})}),s.jsxs("div",{children:[s.jsx("h2",{className:`text-xl font-bold ${n?"text-white":"text-gray-800"}`,children:k.name}),s.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${k.is_active?"bg-green-100 text-green-800 dark:bg-green-950/60 dark:text-green-200 dark:border dark:border-green-800":"bg-red-100 text-red-800 dark:bg-red-950/60 dark:text-red-200 dark:border dark:border-red-800"}`,children:k.is_active?"Attivo":"Inattivo"})]})]})}),k.description&&s.jsx("p",{className:`text-sm mb-3 ${n?"text-gray-400":"text-gray-600"}`,children:k.description}),s.jsxs("div",{className:`text-sm mb-4 ${n?"text-gray-400":"text-gray-600"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("span",{className:"font-semibold",children:"Campi:"}),s.jsx("span",{children:k.fields_count??k.fields?.length??0})]}),k.category&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-semibold",children:"Categoria:"}),s.jsx("span",{children:k.category})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>S(k),className:`flex-1 px-3 py-2 rounded-lg transition ${n?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-500 hover:bg-blue-600 text-white"}`,children:"✏️ Modifica"}),s.jsx("button",{onClick:()=>m(k.id),className:`flex-1 px-3 py-2 rounded-lg transition ${n?"bg-red-600 hover:bg-red-700 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,children:"🗑️ Elimina"})]})]},k.id))})]})})},kc="https://deemed-copyright-opportunity-signed.trycloudflare.com",Nc=()=>kc.includes("__VITE_API")?"http://localhost:8888":kc,jt=Be.create({baseURL:"https://links.acme.it"});jt.interceptors.request.use(e=>e);const z2=({isMobile:e})=>{const{t,i18n:r}=gt(),{darkMode:n}=nt(),{getCardClasses:o}=it(),[a,i]=x.useState({system:{},user:{},categories:{}}),[l,c]=x.useState(!0),[d,u]=x.useState("api-specs"),[f,g]=x.useState(null),[p,h]=x.useState({}),[w,y]=x.useState([]),[b,S]=x.useState(!1),[m,v]=x.useState(!1),[j,k]=x.useState(null),[C]=Se.useForm();if(he.useEffect(()=>{r.language!=="it"&&r.changeLanguage("it")},[r]),r.language!=="it")return s.jsx("div",{className:"p-8 text-center text-lg",children:"Caricamento traduzioni..."});x.useEffect(()=>{(async()=>{try{const G=await jt.get("/settings/");i(G.data),console.log("✅ Loaded settings from API:",G.data)}catch(G){console.error("❌ Failed to load settings from API:",G),i({system:{},user:{},categories:{}})}finally{c(!1)}})(),d==="api-specs"&&A()},[d]);const A=async()=>{S(!0);try{const J=await jt.get("/api/specs");y(J.data),console.log("✅ Loaded API specs:",J.data)}catch(J){console.error("❌ Failed to load API specs:",J),fr.error("Failed to load API specifications")}finally{S(!1)}},T=async J=>{try{await jt.post("/api/specs",J),fr.success("API specification registered successfully"),v(!1),C.resetFields(),A()}catch(G){console.error("❌ Failed to add API spec:",G),fr.error(G.response?.data?.detail||"Failed to register API specification")}},O=async J=>{k(J);try{const G=await jt.post(`/api/specs/${J}/sync`);fr.success(`Swagger synced: ${G.data.version||"unknown version"}`),A()}catch(G){console.error("❌ Failed to sync spec:",G),fr.error(G.response?.data?.detail||"Failed to sync specification")}finally{k(null)}},$=async J=>{try{await jt.delete(`/api/specs/${J}`),fr.success("API specification deleted"),A()}catch(G){console.error("❌ Failed to delete spec:",G),fr.error(G.response?.data?.detail||"Failed to delete specification")}},D=async(J,G,oe=!1)=>{try{oe?(await jt.put(`/settings/user/${J}`,{value:String(G)}),i(te=>({...te,user:{...te.user,[J]:G}})),console.log(`✅ Updated user setting ${J}:`,G)):(await jt.put(`/settings/system/${J}`,{value:String(G)}),i(te=>({...te,system:{...te.system,[J]:G}})),console.log(`✅ Updated system setting ${J}:`,G))}catch(te){console.warn("⚠️ Failed to save to API, updating locally:",te),i(oe?E=>({...E,user:{...E.user,[J]:G}}):E=>({...E,system:{...E.system,[J]:G}}))}},M=(J,G,oe=!1)=>{D(J,!G,oe)},N=(J,G)=>{h(oe=>({...oe,[J]:G}))},L=(J,G=!1)=>{const oe=p[J];oe!==void 0&&(D(J,oe,G),g(null),h(te=>{const E={...te};return delete E[J],E}))},F=(J,G)=>{g(J),h(oe=>({...oe,[J]:String(G)}))},_=()=>{g(null),h({})},I=(J,G,oe=!1)=>{const te=G.value!==void 0?G.value:oe?a.user[J]:a.system[J];return typeof te=="boolean"?s.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",className:"sr-only peer",checked:te,onChange:()=>M(J,te,oe)}),s.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]}):f===J?s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"text",value:p[J]||"",onChange:E=>N(J,E.target.value),className:"px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyDown:E=>{E.key==="Enter"&&L(J,oe),E.key==="Escape"&&_()},autoFocus:!0}),s.jsx("button",{onClick:()=>L(J,oe),className:"px-3 py-1 bg-green-500 dark:bg-green-600 text-white rounded-md hover:bg-green-600 dark:hover:bg-green-700 transition-colors",children:"Save"}),s.jsx("button",{onClick:_,className:"px-3 py-1 bg-gray-500 dark:bg-gray-600 text-white rounded-md hover:bg-gray-600 dark:hover:bg-gray-700 transition-colors",children:"Cancel"})]}):s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{className:"text-gray-900",children:String(te)}),s.jsx("button",{onClick:()=>F(J,te),className:"text-blue-500 hover:text-blue-700",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})},R=(J,G)=>s.jsx("div",{className:"space-y-6",children:Object.entries(G).map(([oe,te])=>{const E=a.user.hasOwnProperty(oe);return s.jsx("div",{className:"bg-white dark:bg-gray-900 p-6 rounded-lg shadow-sm dark:shadow-gray-900/50 border border-gray-200 dark:border-gray-850",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white capitalize",children:oe.replace(/_/g," ")}),te.description&&s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:te.description}),s.jsx("div",{className:"flex items-center mt-2",children:s.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${E?"bg-blue-100 dark:bg-blue-950/60 text-blue-800 dark:text-blue-200 border dark:border-blue-800":"bg-green-100 dark:bg-green-950/60 text-green-800 dark:text-green-200 border dark:border-green-800"}`,children:t(E?"User Setting":"System Setting")})})]}),s.jsx("div",{className:"ml-4",children:I(oe,te,E)})]})},oe)})}),B=()=>{const J={system_settings:a.system,user_settings:a.user,exported_at:new Date().toISOString()},G=new Blob([JSON.stringify(J,null,2)],{type:"application/json"}),oe=URL.createObjectURL(G),te=document.createElement("a");te.href=oe,te.download=`secure-portal-settings-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(te),te.click(),document.body.removeChild(te),URL.revokeObjectURL(oe),console.log("✅ Settings exported successfully")},H=async()=>{if(window.confirm(t("Are you sure you want to reset all settings to defaults? This action cannot be undone.")))try{await jt.post("/settings/reset-defaults");const J=await jt.get("/settings/");i(J.data),console.log("✅ Settings reset to defaults")}catch(J){console.error("❌ Failed to reset settings:",J),i({system:{},user:{},categories:{}})}},ie=()=>{const J={database:"healthy",api:"healthy",storage:"healthy",memory_usage:"65%",cpu_usage:"23%",uptime:"7 days, 14 hours",last_backup:"2 hours ago"};alert(t(`System Health Check Results:

`)+Object.entries(J).map(([G,oe])=>`${G.replace("_"," ")}: ${oe}`).join(`
`)),console.log("✅ System health check completed",J)},ge=()=>{const J=[{title:"Name",dataIndex:"name",key:"name",render:(G,oe)=>s.jsxs(We,{children:[s.jsx(Ci,{className:n?"text-blue-400":"text-blue-600"}),s.jsx("span",{className:n?"text-white":"text-gray-900",children:G})]})},{title:"Base URL",dataIndex:"base_url",key:"base_url",ellipsis:!0,render:G=>s.jsx(mr,{title:G,children:s.jsx("code",{className:`text-xs ${n?"text-gray-300":"text-gray-700"}`,children:G})})},{title:"Status",dataIndex:"sync_status",key:"sync_status",render:(G,oe)=>{const E={synced:{icon:s.jsx(Ps,{}),color:"success",text:"Synced"},pending:{icon:s.jsx(gg,{}),color:"warning",text:"Pending"},failed:{icon:s.jsx(As,{}),color:"error",text:"Failed"}}[G];return s.jsx(Vt,{icon:E.icon,color:E.color,children:E.text})}},{title:"Version",dataIndex:"version",key:"version",render:G=>s.jsx("span",{className:n?"text-gray-400":"text-gray-600",children:G||"N/A"})},{title:"Last Synced",dataIndex:"last_synced_at",key:"last_synced_at",render:G=>s.jsx("span",{className:n?"text-gray-400":"text-gray-600",children:G?new Date(G).toLocaleString("it-IT"):"Never"})},{title:"Actions",key:"actions",render:(G,oe)=>s.jsxs(We,{children:[s.jsx(mr,{title:"Sync Swagger",children:s.jsx(Qe,{variant:"ghost",size:"sm",onClick:()=>O(oe.id),disabled:j===oe.id,className:"!p-1",children:s.jsx(ga,{spin:j===oe.id})})}),s.jsx(fg,{title:"Delete this API specification?",onConfirm:()=>$(oe.id),okText:"Yes",cancelText:"No",children:s.jsx(mr,{title:"Delete",children:s.jsx(Qe,{variant:"ghost",size:"sm",className:"!p-1 text-red-500 hover:text-red-700",children:s.jsx(fa,{})})})})]})}];return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx(ve,{variant:"secondary",size:"sm",children:t("Register external API specifications for workflow compilation")}),s.jsxs(Qe,{variant:"primary",onClick:()=>v(!0),className:"flex items-center gap-2",children:[s.jsx(Dr,{}),t("Add API Spec")]})]}),s.jsx("div",{className:`rounded-lg overflow-hidden ${n?"bg-gray-900 text-white":"bg-white text-gray-900"}`,children:s.jsx(Bc,{dataSource:w,columns:J,rowKey:"id",loading:b,pagination:{pageSize:10},className:n?"dark-table [&_.ant-table]:!bg-gray-900 [&_.ant-table]:!text-white [&_.ant-table-thead>tr>th]:!bg-gray-800 [&_.ant-table-thead>tr>th]:!text-white [&_.ant-table-tbody>tr>td]:!bg-gray-900 [&_.ant-table-tbody>tr>td]:!text-white [&_.ant-table-tbody>tr]:!bg-gray-900 [&_.ant-table-tbody>tr:hover>td]:!bg-gray-800 [&_.ant-empty-description]:!text-gray-400":""})}),s.jsx(br,{title:s.jsx("span",{className:n?"text-white":"text-gray-900",children:"Register API Specification"}),open:m,onCancel:()=>{v(!1),C.resetFields()},footer:null,className:n?"[&_.ant-modal-content]:!bg-gray-800 [&_.ant-modal-header]:!bg-gray-800 [&_.ant-modal-body]:!bg-gray-800 [&_.ant-form-item-label>label]:!text-white [&_.ant-input]:!bg-gray-700 [&_.ant-input]:!text-white [&_.ant-input]:!border-gray-600":"",children:s.jsxs(Se,{form:C,layout:"vertical",onFinish:T,className:`mt-4 ${n?"[&_.ant-form-item-label>label]:!text-white [&_.ant-input]:!bg-gray-700 [&_.ant-input]:!text-white [&_.ant-input]:!border-gray-600 [&_.ant-input::placeholder]:!text-gray-400":""}`,children:[s.jsx(Se.Item,{label:"API Name",name:"name",rules:[{required:!0,message:"Please enter API name"}],children:s.jsx($e,{placeholder:"e.g., Payment Gateway API"})}),s.jsx(Se.Item,{label:"Base URL",name:"base_url",rules:[{required:!0,message:"Please enter base URL"},{type:"url",message:"Please enter a valid URL"}],children:s.jsx($e,{placeholder:"https://api.example.com"})}),s.jsx(Se.Item,{label:"Swagger Spec URL",name:"spec_url",rules:[{required:!0,message:"Please enter swagger spec URL"},{type:"url",message:"Please enter a valid URL"}],children:s.jsx($e,{placeholder:"https://api.example.com/swagger.json"})}),s.jsx(Se.Item,{label:"Auth Type (Optional)",name:"auth_type",children:s.jsx($e,{placeholder:"e.g., Bearer, API Key"})}),s.jsx(Se.Item,{className:"mb-0",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(Qe,{variant:"ghost",onClick:()=>{v(!1),C.resetFields()},children:t("Cancel")}),s.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:t("Register")})]})})]})})]})};if(l)return s.jsx("div",{className:"p-6",children:s.jsxs("div",{className:"animate-pulse",children:[s.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),s.jsx("div",{className:"space-y-4",children:[1,2,3].map(J=>s.jsx("div",{className:"h-24 bg-gray-200 rounded"},J))})]})});const ee=[...a.categories?Object.keys(a.categories):[],"api-specs"];return s.jsxs("div",{className:e?"p-2 bg-gray-50 dark:bg-gray-950 min-h-screen":"p-6 bg-gray-50 dark:bg-gray-950 min-h-screen",children:[s.jsx("div",{className:"flex justify-between items-center mb-6",children:s.jsx(ve,{as:"h1",variant:"primary",size:"3xl",weight:"bold",className:"text-purple-700 dark:text-purple-400",children:t("Settings")})}),s.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-8",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:ee.map(J=>s.jsx(Qe,{variant:d===J?"primary":"ghost",size:"sm",onClick:()=>u(J),className:`py-2 px-1 border-b-2 font-medium text-sm capitalize ${d===J?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent"}`,children:J==="api-specs"?s.jsxs(We,{children:[s.jsx(Ci,{}),"API Specs"]}):J.replace(/_/g," ")},J))})}),s.jsx("div",{className:d==="api-specs"?"":"max-w-4xl",children:d==="api-specs"?ge():a.categories?.[d]?R(d,a.categories[d]):s.jsx("div",{className:"text-center py-12",children:s.jsx(ve,{variant:"secondary",children:"No settings available. Configure system settings via API."})})}),s.jsxs("div",{className:`mt-12 p-6 rounded-lg ${o()}`,children:[s.jsx(ve,{as:"h2",variant:"primary",size:"xl",weight:"semibold",className:"mb-4",children:t("Quick Actions")}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs(Qe,{variant:"secondary",onClick:B,className:"p-4 h-auto flex flex-col items-start text-left space-y-2",children:[s.jsx(ve,{variant:"primary",weight:"medium",children:t("Export Settings")}),s.jsx(ve,{variant:"secondary",size:"sm",children:t("Download your configuration")})]}),s.jsxs(Qe,{variant:"warning",onClick:H,className:"p-4 h-auto flex flex-col items-start text-left space-y-2",children:[s.jsx(ve,{variant:"primary",weight:"medium",children:t("Reset to Defaults")}),s.jsx(ve,{variant:"secondary",size:"sm",children:t("Restore default settings")})]}),s.jsxs(Qe,{variant:"ghost",onClick:ie,className:"p-4 h-auto flex flex-col items-start text-left space-y-2",children:[s.jsx(ve,{variant:"primary",weight:"medium",children:t("System Health Check")}),s.jsx(ve,{variant:"secondary",size:"sm",children:t("Verify system configuration")})]})]})]})]})},U2=()=>{const{t:e,i18n:t}=gt(),{darkMode:r}=nt(),{getCardClasses:n}=it(),[o,a]=x.useState(null),[i,l]=x.useState(""),[c,d]=x.useState(!0),[u,f]=x.useState(!1),[g,p]=x.useState({});if(he.useEffect(()=>{t.language!=="it"&&t.changeLanguage("it")},[t]),t.language!=="it")return s.jsx("div",{className:"p-8 text-center text-lg",children:"Caricamento traduzioni..."});x.useEffect(()=>{(async()=>{try{d(!0);const b=await je.get("/auth/me");a(b.data),p(b.data),l(""),console.log("✅ Loaded user profile from /auth/me:",b.data)}catch(b){console.error("Failed to fetch profile:",b),l(b.response?.data?.detail||"Failed to load profile")}finally{d(!1)}})()},[]);const h=async()=>{try{const y=await je.put("/auth/me",g);a(y.data),p(y.data),f(!1),l(""),console.log("✅ Profile saved successfully:",y.data)}catch(y){console.error("Failed to save profile:",y),l(y.response?.data?.detail||"Failed to save profile")}},w=()=>{p(o||{}),f(!1)};return c?s.jsx("div",{className:"p-6 bg-gray-50 dark:bg-gray-950 min-h-screen",children:s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"}),s.jsx(ve,{variant:"secondary",className:"text-center",children:e("Loading profile...")})]})}):s.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950 relative overflow-hidden",children:[s.jsxs("div",{className:"absolute inset-0 z-0",children:[r?s.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover opacity-20",children:s.jsx("source",{src:"/videos/starry-night.mp4",type:"video/mp4"})}):s.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover opacity-20",children:s.jsx("source",{src:"/videos/sky-clouds.mp4",type:"video/mp4"})}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-gray-50/50 dark:via-gray-950/50 to-gray-50 dark:to-gray-950"})]}),s.jsxs("div",{className:"relative z-10 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-8",children:[s.jsxs("div",{className:"flex items-center gap-6",children:[s.jsx("div",{className:"relative",children:s.jsxs("div",{className:"w-24 h-24 rounded-full overflow-hidden border-4 border-purple-500 dark:border-purple-600 shadow-xl bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center",children:[o?.avatar&&s.jsx("img",{src:o.avatar,alt:`${o.first_name} ${o.last_name}`,className:"w-full h-full object-cover"}),!o?.avatar&&s.jsxs(ve,{variant:"primary",size:"3xl",weight:"bold",className:"text-white",children:[o?.first_name?.[0],o?.last_name?.[0]]})]})}),s.jsxs("div",{children:[s.jsxs(ve,{as:"h1",variant:"primary",size:"3xl",weight:"bold",className:"text-gray-900 dark:text-white mb-2",children:[o?.first_name," ",o?.last_name]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs(ve,{variant:"secondary",className:"text-lg",children:["@",o?.username]}),s.jsx($s,{variant:o?.role==="designer"?"warning":"info",size:"md",children:o?.role==="designer"?"✨ Designer":o?.role})]})]})]}),s.jsx("div",{className:"flex gap-2",children:u?s.jsxs("div",{className:"space-x-2",children:[s.jsx(Qe,{variant:"success",onClick:h,children:e("Save")}),s.jsx(Qe,{variant:"secondary",onClick:w,children:e("Cancel")})]}):s.jsx(Qe,{variant:"primary",onClick:()=>f(!0),children:e("Edit Profile")})})]}),i&&s.jsx("div",{className:"bg-orange-100 dark:bg-orange-900 border border-orange-400 dark:border-orange-600 text-orange-700 dark:text-orange-200 px-4 py-3 rounded mb-6",children:s.jsx(ve,{variant:"primary",children:i})}),o&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:n(),children:s.jsx("div",{className:"p-6",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-32 h-32 bg-gray-300 dark:bg-gray-600 rounded-full mx-auto mb-4 flex items-center justify-center overflow-hidden",children:o.avatar?s.jsx("img",{src:o.avatar,alt:`${o.first_name} ${o.last_name}`,className:"w-32 h-32 rounded-full object-cover",onError:y=>{const b=y.target;b.style.display="none";const S=b.parentElement;S&&(S.innerHTML=`
                              <div class="w-32 h-32 bg-purple-600 dark:bg-purple-700 rounded-full flex items-center justify-center">
                                <span class="text-white text-2xl font-bold">${o.first_name?.[0]||""}${o.last_name?.[0]||""}</span>
                              </div>
                            `)}}):s.jsx("div",{className:"w-32 h-32 bg-purple-600 dark:bg-purple-700 rounded-full flex items-center justify-center",children:s.jsxs(ve,{variant:"primary",size:"2xl",weight:"bold",className:"text-white",children:[o.first_name?.[0],o.last_name?.[0]]})})}),s.jsxs(ve,{as:"h3",variant:"primary",size:"xl",weight:"semibold",className:"mb-2",children:[o.first_name," ",o.last_name]}),s.jsxs(ve,{variant:"secondary",className:"mb-2",children:["@",o.username]}),s.jsx("div",{className:"flex items-center justify-center gap-2",children:s.jsx($s,{variant:o.role==="designer"?"warning":"info",size:"sm",children:o.role==="designer"?"✨ Designer":o.role})})]})})}),s.jsx("div",{className:n(),children:s.jsxs("div",{className:"p-6",children:[s.jsx(ve,{as:"h4",variant:"primary",size:"lg",weight:"semibold",className:"mb-4",children:e("Personal Information")}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx(ve,{variant:"secondary",size:"sm",weight:"medium",className:"mb-1",children:"First Name"}),u?s.jsx("input",{type:"text",value:g.first_name||"",onChange:y=>p({...g,first_name:y.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none"}):s.jsx(ve,{variant:"primary",children:o.first_name})]}),s.jsxs("div",{children:[s.jsx(ve,{variant:"secondary",size:"sm",weight:"medium",className:"mb-1",children:"Last Name"}),u?s.jsx("input",{type:"text",value:g.last_name||"",onChange:y=>p({...g,last_name:y.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none"}):s.jsx(ve,{variant:"primary",children:o.last_name})]}),s.jsxs("div",{children:[s.jsx(ve,{variant:"secondary",size:"sm",weight:"medium",className:"mb-1",children:e("Email")}),u?s.jsx("input",{type:"email",value:g.email||"",onChange:y=>p({...g,email:y.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none"}):s.jsx(ve,{variant:"primary",children:o.email})]}),s.jsxs("div",{children:[s.jsx(ve,{variant:"secondary",size:"sm",weight:"medium",className:"mb-1",children:e("Phone")}),u?s.jsx("input",{type:"tel",value:g.phone||"",onChange:y=>p({...g,phone:y.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none"}):s.jsx(ve,{variant:"primary",children:o.phone||e("Not specified")})]}),s.jsxs("div",{children:[s.jsx(ve,{variant:"secondary",size:"sm",weight:"medium",className:"mb-1",children:e("Department")}),u?s.jsx("input",{type:"text",value:g.department||"",onChange:y=>p({...g,department:y.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none"}):s.jsx(ve,{variant:"primary",children:o.department||e("Not specified")})]})]})]})}),s.jsx("div",{className:n(),children:s.jsxs("div",{className:"p-6",children:[s.jsx(ve,{as:"h4",variant:"primary",size:"lg",weight:"semibold",className:"mb-4",children:e("Availability")}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),s.jsx(ve,{variant:"primary",weight:"medium",children:o.preferences?.availability||"Disponibile tutto il giorno"})]}),s.jsxs("div",{children:[s.jsx(ve,{variant:"secondary",size:"sm",weight:"medium",className:"mb-1",children:e("Working Hours")}),s.jsx(ve,{variant:"primary",children:o.preferences?.working_hours||"08:00 - 17:00"})]}),s.jsxs("div",{children:[s.jsx(ve,{variant:"secondary",size:"sm",weight:"medium",className:"mb-1",children:e("Time Zone")}),s.jsx(ve,{variant:"primary",children:"Europe/Rome (UTC+1)"})]})]})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsx("div",{className:n(),children:s.jsxs("div",{className:"p-6",children:[s.jsx(ve,{as:"h4",variant:"primary",size:"lg",weight:"semibold",className:"mb-4",children:e("Account Details")}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsxs(ve,{variant:"secondary",size:"sm",children:[e("User ID"),":"]}),s.jsx(ve,{variant:"primary",className:"font-mono text-sm",children:o.id})]}),s.jsxs("div",{children:[s.jsxs(ve,{variant:"secondary",size:"sm",children:[e("Created"),":"]}),s.jsx(ve,{variant:"primary",size:"sm",children:new Date(o.created_at).toLocaleDateString()})]}),s.jsxs("div",{children:[s.jsxs(ve,{variant:"secondary",size:"sm",children:[e("Last Login"),":"]}),s.jsx(ve,{variant:"primary",size:"sm",children:o.last_login?new Date(o.last_login).toLocaleString():e("Never")})]})]})]})}),s.jsx("div",{className:n(),children:s.jsxs("div",{className:"p-6",children:[s.jsx(ve,{as:"h4",variant:"primary",size:"lg",weight:"semibold",className:"mb-4",children:e("Preferences")}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(ve,{variant:"primary",children:e("Notifications")}),s.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:u?g.preferences?.notifications:o.preferences?.notifications,onChange:y=>{u&&p({...g,preferences:{...g.preferences,notifications:y.target.checked}})},disabled:!u,className:"sr-only peer"}),s.jsx("div",{className:"w-11 h-6 bg-gray-300 dark:bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(ve,{variant:"primary",children:e("Dark Mode")}),s.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:u?g.preferences?.dark_mode:o.preferences?.dark_mode,onChange:y=>{u&&p({...g,preferences:{...g.preferences,dark_mode:y.target.checked}})},disabled:!u,className:"sr-only peer"}),s.jsx("div",{className:"w-11 h-6 bg-gray-300 dark:bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]})})]})]})]})]})},na=({children:e,variant:t="default",className:r=""})=>{const{darkMode:n}=it(),i=`relative w-full rounded-lg border p-4 flex items-center gap-3 ${{default:n?"bg-blue-950/50 border-blue-800 text-blue-200":"bg-blue-50 border-blue-200 text-blue-800",destructive:n?"bg-red-950/50 border-red-800 text-red-200":"bg-red-50 border-red-200 text-red-800",warning:n?"bg-yellow-950/50 border-yellow-800 text-yellow-200":"bg-yellow-50 border-yellow-200 text-yellow-800",success:n?"bg-green-950/50 border-green-800 text-green-200":"bg-green-50 border-green-200 text-green-800"}[t]} ${r}`,l=()=>{switch(t){case"destructive":return s.jsx(kd,{className:"h-4 w-4 shrink-0"});case"warning":return s.jsx(Ht,{className:"h-4 w-4 shrink-0"});case"success":return s.jsx(jd,{className:"h-4 w-4 shrink-0"});default:return s.jsx(Rh,{className:"h-4 w-4 shrink-0"})}};return s.jsxs("div",{className:i,role:"alert",children:[l(),s.jsx("div",{className:"flex-1",children:e})]})},sa=({children:e,className:t=""})=>s.jsx("div",{className:`text-sm ${t}`,children:e}),Rf=x.createContext(void 0),If=()=>{const e=x.useContext(Rf);if(!e)throw new Error("useTabs must be used within a Tabs component");return e},B2=({children:e,defaultValue:t="",value:r,onValueChange:n,className:o=""})=>{const[a,i]=x.useState(t),l=r!==void 0?r:a,c=d=>{n?n(d):i(d)};return s.jsx(Rf.Provider,{value:{activeTab:l,setActiveTab:c},children:s.jsx("div",{className:`w-full ${o}`,children:e})})},H2=({children:e,className:t=""})=>{const{getCardClasses:r}=it();return s.jsx("div",{className:`inline-flex h-10 items-center justify-center rounded-md ${r()} p-1 ${t}`,children:e})},oa=({children:e,value:t,className:r=""})=>{const{activeTab:n,setActiveTab:o}=If(),{getButtonClasses:a,darkMode:i}=it(),c=n===t?i?"bg-gray-850 text-white shadow-sm":"bg-white text-gray-900 shadow-sm":i?"text-gray-400 hover:text-gray-200 hover:bg-gray-900":"text-gray-500 hover:text-gray-900";return s.jsx("button",{onClick:()=>o(t),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 ${c} ${r}`,type:"button",children:e})},Sc=({children:e,value:t,className:r=""})=>{const{activeTab:n}=If();return n!==t?null:s.jsx("div",{className:`mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ${r}`,children:e})},kn=({children:e,className:t=""})=>{const{getCardClasses:r}=it();return s.jsx("div",{className:`${r()} ${t}`,children:e})},Nn=({children:e,className:t=""})=>s.jsx("div",{className:`flex flex-col space-y-1.5 p-6 ${t}`,children:e}),Sn=({children:e,className:t=""})=>{const{getTextClasses:r}=it();return s.jsx("h3",{className:`text-2xl font-semibold leading-none tracking-tight ${r()} ${t}`,children:e})},Cn=({children:e,className:t=""})=>s.jsx("div",{className:`p-6 pt-0 ${t}`,children:e}),{Dragger:V2}=pa,Cc=({value:e,onChange:t,uploadEndpoint:r,acceptedTypes:n=".pdf,.doc,.docx,.txt,.xlsx,.xls,.csv,.png,.jpg,.jpeg,.gif,.zip,.rar,.7z,.ppt,.pptx",maxSize:o=100,multiple:a=!1,executionId:i,workflowId:l,label:c="Carica file"})=>{const[d,u]=x.useState([]),[f,g]=x.useState(!1);console.log("[FileUploadField] 🎬 Component render:",{value:e,fileListLength:d.length,uploadEndpoint:r,executionId:i,workflowId:l,multiple:a,onChangeExists:!!t});const p=async b=>{const{file:S,onSuccess:m,onError:v,onProgress:j}=b;console.log("[FileUploadField] 🚀 Starting upload for:",S.name),console.log("[FileUploadField] 📦 File size:",(S.size/1024/1024).toFixed(2),"MB"),g(!0);try{me.info(`Caricamento di "${S.name}" avviato`)}catch{}const k=new FormData;k.append("file",S);let C=r||"/api/workflow-file-upload/upload";i?(C=`/api/workflow-file-upload/workflows/${i}/upload-file`,console.log("[FileUploadField] 🔧 Using executionId as workflow_id")):l&&(C=`/api/workflow-file-upload/workflows/${l}/upload-file`,console.log("[FileUploadField] 🔧 Using workflowId"));const A=sessionStorage.getItem("access_token")||localStorage.getItem("access_token");console.log("[FileUploadField] 📍 Final Upload URL:",C),console.log("[FileUploadField] 🔑 Token exists:",!!A);try{const T={"Content-Type":"multipart/form-data"};A&&(T.Authorization=`Bearer ${A}`);const O=await Be.post(C,k,{headers:T,onUploadProgress:M=>{const N=M.total?Math.round(M.loaded*100/M.total):0;j?.({percent:N}),console.log("[FileUploadField] 📊 Upload progress:",N+"%")}});console.log("[FileUploadField] ✅ Upload response:",O.data);const $=O.data.file_info?.saved_path||O.data.file_info?.unique_filename||O.data.saved_path||O.data.url||O.data.file_path||O.data;console.log("[FileUploadField] 📁 Extracted file path:",$),m?.($,S),console.log("[FileUploadField] ✅ onSuccess called");const D=a?[...Array.isArray(e)?e:[],$]:$;console.log("[FileUploadField] 📤 Calling onChange with value:",D),console.log("[FileUploadField] 📤 onChange exists:",!!t),console.log("[FileUploadField] 📤 Value type:",typeof D),console.log("[FileUploadField] 📤 Value content:",D),t?(t(D),console.log("[FileUploadField] ✅ onChange called successfully!"),setTimeout(()=>{console.log("[FileUploadField] 🔄 Calling onChange again to ensure form validation"),t(D)},100)):console.error("[FileUploadField] ❌ onChange is undefined!"),me.success(`${S.name} caricato con successo`)}catch(T){console.error("[FileUploadField] ❌ Upload error:",T),console.error("[FileUploadField] ❌ Error response:",T.response?.data);const O=T.response?.data?.error||T.response?.data?.detail||T.message||"Errore upload";v?.(T),me.error(`Errore caricamento ${S.name}`,O)}finally{g(!1),console.log("[FileUploadField] 🏁 Upload finished, uploading flag reset")}},y={name:"file",multiple:a,fileList:d,customRequest:p,action:"dummy",onChange:b=>{console.log("[FileUploadField] � handleChange triggered:",{status:b.file.status,fileListLength:b.fileList.length,fileName:b.file.name,response:b.file.response,hasOriginFileObj:!!b.file.originFileObj,fileObject:b.file});let S=[...b.fileList];a||(S=S.slice(-1),console.log("[FileUploadField] 🔒 Multiple=false, limited to 1 file")),u(S),console.log("[FileUploadField] 📋 FileList updated, length:",S.length);const m=b.file.originFileObj||S[0]?.originFileObj;if(!b.file.status&&m?(console.log("[FileUploadField] 🎯 NEW FILE DETECTED - Manually triggering upload"),console.log("[FileUploadField] 📦 File to upload:",m),p({file:m,onSuccess:v=>{console.log("[FileUploadField] ✅ Manual upload success:",v),u(j=>j.map(k=>k.uid===b.file.uid?{...k,status:"done",response:v}:k))},onError:v=>{console.error("[FileUploadField] ❌ Manual upload error:",v),u(j=>j.map(k=>k.uid===b.file.uid?{...k,status:"error",error:v}:k))},onProgress:v=>{console.log("[FileUploadField] 📊 Manual upload progress:",v.percent),u(j=>j.map(k=>k.uid===b.file.uid?{...k,status:"uploading",percent:v.percent}:k))}})):console.log("[FileUploadField] ⏭️ Skipping manual upload - status:",b.file.status,"fileToUpload:",!!m),b.file.status==="done"&&b.file.response){console.log("[FileUploadField] 🔄 File done in handleChange, response:",b.file.response);const v=S.filter(k=>k.status==="done"&&k.response).map(k=>k.response),j=a?v:v[0];console.log("[FileUploadField] 📤 Backup onChange call with:",j),t&&(t(j),console.log("[FileUploadField] ✅ Backup onChange called"))}},onRemove:b=>{console.log("[FileUploadField] 🗑️ Removing file:",b.name);const S=d.filter(m=>m.uid!==b.uid);if(u(S),console.log("[FileUploadField] 📋 FileList after remove, length:",S.length),a&&Array.isArray(e)){const m=d.findIndex(v=>v.uid===b.uid);if(m>-1&&m<e.length){const v=e.filter((j,k)=>k!==m);console.log("[FileUploadField] 📤 Calling onChange after remove:",v),t?.(v)}}else console.log("[FileUploadField] 📤 Calling onChange after remove: undefined"),t?.(void 0)},accept:n,showUploadList:{showPreviewIcon:!0,showRemoveIcon:!0,showDownloadIcon:!1},disabled:f,beforeUpload:b=>{if(console.log("[FileUploadField] 🔍 beforeUpload - Validating file:",{name:b.name,size:(b.size/1024/1024).toFixed(2)+"MB",type:b.type}),!n.split(",").some(v=>b.name.toLowerCase().endsWith(v.trim().toLowerCase())))return console.error("[FileUploadField] ❌ Invalid file type:",b.name),me.error("Tipo file non supportato",`${b.name} non è tra i tipi accettati: ${n}`),pa.LIST_IGNORE;const m=b.size/1024/1024;return m>o?(console.error("[FileUploadField] ❌ File too large:",m.toFixed(2),"MB"),me.warning("File troppo grande",`${b.name} supera ${o}MB (attuale: ${m.toFixed(2)}MB)`),pa.LIST_IGNORE):(console.log("[FileUploadField] ✅ File validation passed - proceeding with upload"),!0)}};return s.jsxs("div",{className:"file-upload-field",children:[s.jsxs(V2,{...y,children:[s.jsx("p",{className:"ant-upload-drag-icon",children:s.jsx(pg,{style:{fontSize:64,color:f?"#999":"#8b5cf6"}})}),s.jsx("p",{className:"ant-upload-text",style:{fontSize:16,fontWeight:500},children:f?"Caricamento in corso...":c||"Carica file"}),s.jsxs("p",{className:"ant-upload-hint",style:{fontSize:14},children:["Trascina file qui o clicca per selezionare",s.jsx("br",{}),s.jsxs("span",{style:{fontSize:12},children:[a?"File multipli supportati":"File singolo"," • Max ",o,"MB"]})]}),d.length>0&&s.jsxs("p",{style:{color:"#8b5cf6",fontSize:14,marginTop:8},children:["📎 ",d.length," file caricato/i"]})]}),s.jsx("style",{children:`
        .file-upload-field {
          width: 100%;
        }
        .file-upload-field .ant-upload-drag {
          background: var(--upload-bg, #fafafa);
          border: 2px dashed var(--upload-border, #d9d9d9) !important;
          border-radius: 8px;
          transition: all 0.3s ease;
        }
        .file-upload-field .ant-upload-drag:hover {
          border-color: #8b5cf6 !important;
          background: rgba(139, 92, 246, 0.05);
        }
        .file-upload-field .ant-upload-drag.ant-upload-drag-hover {
          border-color: #8b5cf6 !important;
          background: rgba(139, 92, 246, 0.1) !important;
        }
        .file-upload-field .ant-upload-text {
          color: var(--text-color, rgba(0, 0, 0, 0.85));
          margin: 8px 0 4px;
        }
        .file-upload-field .ant-upload-hint {
          color: var(--text-color-secondary, rgba(0, 0, 0, 0.45));
        }
        .file-upload-field .ant-upload-list {
          margin-top: 16px;
        }
        .file-upload-field .ant-upload-list-item {
          background: var(--background-primary, #fff);
          border-color: var(--border-color, #d9d9d9);
        }
        .file-upload-field .ant-upload-list-item:hover {
          background: var(--background-hover, #f5f5f5);
        }
        
        /* Dark mode support via CSS variables */
        [data-theme="dark"] .file-upload-field .ant-upload-drag {
          --upload-bg: #141414;
          --upload-border: #434343;
          --text-color: rgba(255, 255, 255, 0.85);
          --text-color-secondary: rgba(255, 255, 255, 0.45);
          --background-primary: #1f1f1f;
          --background-hover: #2a2a2a;
          --border-color: #434343;
        }
      `})]})};if(typeof document<"u"){const e="user-input-modal-dark-mode-styles";if(!document.getElementById(e)){const t=document.createElement("style");t.id=e,t.textContent=`
      .dark .ant-modal-content {
        background-color: #1f2937 !important;
        color: #f3f4f6 !important;
      }
      .dark .ant-modal-header {
        background-color: #1f2937 !important;
        border-bottom-color: #374151 !important;
      }
      .dark .ant-modal-title {
        color: #f3f4f6 !important;
      }
      .dark .ant-modal-close-x {
        color: #9ca3af !important;
      }
      .dark .ant-modal-close-x:hover {
        color: #f3f4f6 !important;
      }
      .dark .ant-modal-footer {
        border-top-color: #374151 !important;
        background-color: #1f2937 !important;
      }
      .dark .ant-form-item-label > label {
        color: #d1d5db !important;
      }
      .dark .ant-input,
      .dark .ant-input-number,
      .dark .ant-picker {
        background-color: #374151 !important;
        border-color: #4b5563 !important;
        color: #f3f4f6 !important;
      }
      .dark .ant-input:hover,
      .dark .ant-input-number:hover,
      .dark .ant-picker:hover {
        border-color: #6b7280 !important;
      }
      .dark .ant-input:focus,
      .dark .ant-input-number:focus,
      .dark .ant-picker:focus,
      .dark .ant-input-focused,
      .dark .ant-input-number-focused,
      .dark .ant-picker-focused {
        border-color: #8b5cf6 !important;
        box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2) !important;
      }
      .dark .ant-input::placeholder,
      .dark .ant-input-number input::placeholder {
        color: #6b7280 !important;
      }
      .dark .ant-select:not(.ant-select-customize-input) .ant-select-selector {
        background-color: #374151 !important;
        border-color: #4b5563 !important;
        color: #f3f4f6 !important;
      }
      .dark .ant-select:not(.ant-select-customize-input):hover .ant-select-selector {
        border-color: #6b7280 !important;
      }
      .dark .ant-select-focused:not(.ant-select-customize-input) .ant-select-selector {
        border-color: #8b5cf6 !important;
        box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2) !important;
      }
      .dark .ant-select-arrow {
        color: #9ca3af !important;
      }
      .dark .ant-select-dropdown {
        background-color: #1f2937 !important;
        border: 1px solid #374151 !important;
      }
      .dark .ant-select-item {
        color: #d1d5db !important;
        background-color: #1f2937 !important;
      }
      .dark .ant-select-item-option-selected {
        background-color: #374151 !important;
        color: white !important;
      }
      .dark .ant-select-item-option-active {
        background-color: #374151 !important;
      }
      .dark .ant-select-item-option:hover {
        background-color: #374151 !important;
      }
      .dark .ant-picker-panel-container {
        background-color: #1f2937 !important;
        border-color: #374151 !important;
      }
      .dark .ant-picker-panel {
        background-color: #1f2937 !important;
        border-color: #374151 !important;
      }
      .dark .ant-picker-header,
      .dark .ant-picker-content th,
      .dark .ant-picker-cell {
        color: #d1d5db !important;
      }
      .dark .ant-picker-cell:hover:not(.ant-picker-cell-selected):not(.ant-picker-cell-disabled) .ant-picker-cell-inner {
        background-color: #374151 !important;
      }
      .dark .ant-picker-cell-in-view.ant-picker-cell-selected .ant-picker-cell-inner {
        background-color: #8b5cf6 !important;
      }
      .dark .ant-picker-time-panel-column {
        border-left-color: #374151 !important;
      }
      .dark .ant-picker-time-panel-cell-inner {
        color: #d1d5db !important;
      }
      .dark .ant-picker-time-panel-cell-inner:hover {
        background-color: #374151 !important;
      }
      .dark .ant-picker-time-panel-cell-selected .ant-picker-time-panel-cell-inner {
        background-color: #8b5cf6 !important;
      }
      .dark .ant-switch {
        background-color: #4b5563 !important;
      }
      .dark .ant-switch-checked {
        background-color: #8b5cf6 !important;
      }
      .dark .ant-btn-default {
        background-color: #374151 !important;
        border-color: #4b5563 !important;
        color: #f3f4f6 !important;
      }
      .dark .ant-btn-default:hover {
        background-color: #4b5563 !important;
        border-color: #6b7280 !important;
        color: #ffffff !important;
      }
      .dark .ant-btn-primary {
        background-color: #8b5cf6 !important;
        border-color: #8b5cf6 !important;
      }
      .dark .ant-btn-primary:hover {
        background-color: #7c3aed !important;
        border-color: #7c3aed !important;
      }
      .dark .ant-btn-dangerous {
        background-color: #dc2626 !important;
        border-color: #dc2626 !important;
      }
      .dark .ant-btn-dangerous:hover {
        background-color: #b91c1c !important;
        border-color: #b91c1c !important;
      }
      .dark .ant-upload.ant-upload-drag {
        background-color: #374151 !important;
        border-color: #4b5563 !important;
      }
      .dark .ant-upload.ant-upload-drag:hover {
        border-color: #8b5cf6 !important;
      }
      .dark .ant-upload.ant-upload-drag .ant-upload-drag-container {
        color: #f3f4f6 !important;
      }
      .dark .ant-upload-list {
        color: #f3f4f6 !important;
      }
      .dark .ant-upload-list-item {
        background-color: #374151 !important;
        border-color: #4b5563 !important;
      }
      .dark .ant-upload-list-item:hover {
        background-color: #4b5563 !important;
      }
      .dark .ant-upload-list-item-name {
        color: #f3f4f6 !important;
      }
      .dark .ant-upload-list-item-card-actions .anticon {
        color: #9ca3af !important;
      }
      .dark .ant-upload-list-item-card-actions .anticon:hover {
        color: #f3f4f6 !important;
      }
    `,document.head.appendChild(t)}}const W2=({visible:e,executionId:t,editableFields:r,onSubmit:n,onCancel:o,onMinimize:a,onStop:i})=>{const{darkMode:l}=nt(),[c]=Se.useForm(),[d,u]=x.useState(!1),f=x.useMemo(()=>{const j=(r||[]).filter(k=>k.fieldDefinition?.editable===!0).filter(k=>{if((k.fieldDefinition?.type||"").toLowerCase()!=="textarea")return!0;const A=k.fieldDefinition?.placeholder;if(typeof A!="string")return!0;const T=A.trim();return!(T.startsWith("{")&&T.endsWith("}")||T.startsWith("[")&&T.endsWith("]"))});return console.log("[UserInputModal] 📋 Fields for modal:",j.map(k=>({formFieldName:k.formFieldName,nodeFieldName:k.nodeFieldName,type:k.fieldDefinition?.type,canUpload:k.canUpload,isAttachment:k.isAttachment}))),j},[r]),g=x.useRef(!1),p=x.useRef(""),h=x.useRef(0),w=x.useRef(!1),y=j=>JSON.stringify(j.map(k=>({n:k.nodeFieldName,v:k.currentValue}))),b=j=>{const k=j.fieldDefinition&&j.fieldDefinition.name;if(console.log("[UserInputModal] getItemName - field:",{formFieldName:j.formFieldName,nodeFieldName:j.nodeFieldName,fdName:k,jsonKey:j.jsonKey,canUpload:j.canUpload}),k&&typeof k=="string")return k;const C=j.jsonKey||j.fieldDefinition?.jsonKey;return C?`${j.nodeFieldName}__${C}`:j.nodeFieldName};x.useEffect(()=>{if(!e||f.length===0)return;const j=y(f);if(c.isFieldsTouched(!0)||w.current,!g.current){const k={};f.forEach(C=>{const A=(C.fieldDefinition.type||"").toLowerCase(),T=b(C);switch(A){case"number":case"integer":case"date":case"datetime":k[T]=void 0;break;case"boolean":case"checkbox":k[T]=!1;break;case"select":case"dropdown":k[T]=void 0;break;default:k[T]=""}}),c.setFieldsValue(k),g.current=!0,p.current=j;return}p.current=j},[e,f,c]);const S=async()=>{try{u(!0),w.current=!1;const j=c.getFieldsValue();console.log("[UserInputModal] 🔍 Current form values BEFORE validation:",j);const k=await c.validateFields();console.log("[UserInputModal] ✅ Form values AFTER validation:",k);const C={};f.forEach(A=>{const T=b(A);let O=k[T];console.log("[UserInputModal] Processing field:",T,"value:",O,"type:",A.fieldDefinition.type),(A.fieldDefinition.type==="date"||A.fieldDefinition.type==="datetime")&&xg.isDayjs(O)&&(O=O.toDate().toISOString()),C[T]=O}),console.log("[UserInputModal] 📤 Sending processed values:",C),await n(C),me.success("Valori inviati con successo"),c.resetFields()}catch(j){console.error("Errore validazione form:",j),j.errorFields?me.error("Completa tutti i campi obbligatori"):me.error("Errore durante l'invio",j.message||"Unknown error")}finally{u(!1)}},m=()=>{c.resetFields(),w.current=!1,o()},v=j=>{const{fieldDefinition:k,nodeFieldName:C}=j,{type:A,label:T,required:O,placeholder:$,options:D,min:M,max:N}=k;console.log("[UserInputModal] 🎨 renderField:",{formFieldName:j.formFieldName,nodeFieldName:C,type:A,canUpload:j.canUpload,uploadEndpoint:j.uploadEndpoint,acceptedTypes:j.acceptedTypes,isAttachment:j.isAttachment,fieldDefinition:k});const L={placeholder:$||`Inserisci ${T}`};switch(A){case"text":case"email":case"url":return s.jsx(Se.Item,{name:b(j),label:T,rules:[{required:O,message:`${T} è obbligatorio`},A==="email"?{type:"email",message:"Email non valida"}:{},A==="url"?{type:"url",message:"URL non valido"}:{}],children:s.jsx($e,{...L,onChange:()=>{w.current=!0,h.current=Date.now()+5e3}})},b(j));case"textarea":return s.jsx(Se.Item,{name:b(j),label:T,rules:[{required:O,message:`${T} è obbligatorio`}],children:s.jsx($e.TextArea,{rows:6,placeholder:L.placeholder,onChange:()=>{w.current=!0,h.current=Date.now()+5e3}})},b(j));case"number":case"integer":return s.jsx(Se.Item,{name:b(j),label:T,rules:[{required:O,message:`${T} è obbligatorio`}],children:s.jsx(mn,{style:{width:"100%"},min:M,max:N,precision:A==="integer"?0:2,...L,onChange:()=>{w.current=!0}})},b(j));case"select":case"dropdown":return s.jsx(Se.Item,{name:b(j),label:T,rules:[{required:O,message:`${T} è obbligatorio`}],children:s.jsx(Ue,{...L,onChange:()=>{w.current=!0,h.current=Date.now()+5e3},children:D?.map(F=>s.jsx(Ue.Option,{value:F.value,children:F.label},F.value))})},b(j));case"boolean":case"checkbox":return s.jsx(Se.Item,{name:b(j),label:T,valuePropName:"checked",children:s.jsx(hn,{checkedChildren:s.jsx(mg,{}),unCheckedChildren:s.jsx(hg,{}),onChange:()=>{w.current=!0}})},b(j));case"date":return s.jsx(Se.Item,{name:b(j),label:T,rules:[{required:O,message:`${T} è obbligatorio`}],children:s.jsx(_i,{style:{width:"100%"},format:"DD/MM/YYYY",onChange:()=>{w.current=!0}})},b(j));case"datetime":return s.jsx(Se.Item,{name:b(j),label:T,rules:[{required:O,message:`${T} è obbligatorio`}],children:s.jsx(_i,{showTime:!0,style:{width:"100%"},format:"DD/MM/YYYY HH:mm",onChange:()=>{w.current=!0}})},b(j));case"file":return s.jsx(Se.Item,{name:b(j),label:T,rules:[{required:O,message:`${T} è obbligatorio`,validator:(F,_)=>!O||_&&typeof _=="string"&&_.trim()!==""?Promise.resolve():Promise.reject(new Error(`${T} è obbligatorio`))}],valuePropName:"value",trigger:"onChange",children:s.jsx(Cc,{uploadEndpoint:j.uploadEndpoint,acceptedTypes:j.acceptedTypes,executionId:t,multiple:!1})},b(j));default:return j.canUpload?s.jsx(Se.Item,{name:b(j),label:T,rules:[{required:O,message:`${T} è obbligatorio`}],valuePropName:"value",trigger:"onChange",children:s.jsx(Cc,{uploadEndpoint:j.uploadEndpoint,acceptedTypes:j.acceptedTypes||".pdf,.doc,.docx,.txt,.xlsx,.xls,.csv,.png,.jpg,.jpeg,.gif",executionId:t,multiple:j.isAttachment!==!1})},b(j)):s.jsx(Se.Item,{name:b(j),label:T,rules:[{required:O,message:`${T} è obbligatorio`}],children:s.jsx($e,{...L})},b(j))}};return s.jsxs(br,{title:s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingRight:40},children:[s.jsx("span",{children:"Input Richiesto"}),a&&s.jsx(He,{size:"small",onClick:a,style:{marginLeft:"auto",marginRight:8},title:"Minimizza",children:s.jsx("span",{style:{fontSize:16,lineHeight:1},children:"−"})})]}),open:e,onCancel:m,width:600,footer:[i&&s.jsx(He,{danger:!0,onClick:i,disabled:d,children:"⏹ Arresta Workflow"},"stop"),s.jsx(He,{onClick:m,disabled:d,children:"Annulla"},"cancel"),s.jsx(He,{type:"primary",onClick:S,loading:d,children:"Invia e Continua"},"submit")],maskClosable:!1,closable:!d,children:[s.jsx("div",{style:{marginBottom:16},children:s.jsx("p",{style:{color:l?"#9ca3af":"#666"},children:"Il workflow richiede i seguenti valori per continuare l'esecuzione:"})}),s.jsx(Se,{form:c,layout:"vertical",autoComplete:"off",children:f.map(j=>v(j))}),f.length===0&&s.jsx("div",{style:{textAlign:"center",padding:"20px",color:l?"#6b7280":"#999"},children:"Nessun campo da compilare"})]})},{Panel:aa}=vs,q2=({executionId:e,isModal:t=!1})=>{const{i18n:r}=gt(),{executionId:n}=Dc(),o=Pt(),a=e||n,[i,l]=x.useState(null),[c,d]=x.useState([]),[u,f]=x.useState(!0),[g,p]=x.useState(null);x.useEffect(()=>{a&&h()},[a]);const h=async()=>{f(!0),p(null);try{const b=await je.workflows.getExecution(a);b.data?l(b.data):p("Esecuzione non trovata");try{const S=await je.workflows.getExecutionLogs(a);S.data&&Array.isArray(S.data)?d(S.data):d([])}catch(S){console.warn("Could not load logs:",S),d([])}}catch(b){console.error("Error loading execution details:",b),p(b.response?.data?.detail||b.message||"Errore nel caricamento dei dettagli")}finally{f(!1)}},w=b=>{const m={completed:{color:"success",icon:s.jsx(Ps,{}),text:"Completato"},running:{color:"processing",icon:s.jsx(ga,{spin:!0}),text:"In esecuzione"},waiting_user_input:{color:"warning",icon:s.jsx(os,{}),text:"In attesa input"},waiting_form:{color:"warning",icon:s.jsx(os,{}),text:"In attesa form"},failed:{color:"error",icon:s.jsx(As,{}),text:"Fallito"},pending:{color:"default",icon:s.jsx(os,{}),text:"In attesa"}}[b]||{color:"default",icon:s.jsx(zr,{}),text:b};return s.jsx(wg,{status:m.color,text:s.jsxs("span",{children:[m.icon," ",m.text]})})},y=(b,S)=>{if(!b)return"N/A";const m=new Date(b),j=(S?new Date(S):new Date).getTime()-m.getTime(),k=Math.floor(j/1e3),C=Math.floor(k/60),A=Math.floor(C/60);return A>0?`${A}h ${C%60}m`:C>0?`${C}m ${k%60}s`:`${k}s`};return he.useEffect(()=>{r.language!=="it"&&r.changeLanguage("it")},[r]),r.language!=="it"?s.jsx("div",{className:"p-8 text-center text-lg",children:"Caricamento traduzioni..."}):u?s.jsx("div",{className:"flex items-center justify-center min-h-screen",children:s.jsx(so,{size:"large",tip:"Caricamento dettagli esecuzione..."})}):g||!i?s.jsx("div",{className:"max-w-4xl mx-auto mt-8 p-4",children:s.jsx(Wt,{message:"Errore",description:g||"Esecuzione non trovata",type:"error",showIcon:!0,action:s.jsx(He,{onClick:()=>o("/workflows/executions"),children:"Torna alla lista"})})}):s.jsxs("div",{className:"max-w-6xl mx-auto mt-8 p-4 bg-gray-100 dark:bg-gray-950 min-h-screen",children:[!t&&s.jsx("div",{className:"mb-4",children:s.jsx(He,{icon:s.jsx(yg,{}),onClick:()=>o("/workflows/executions"),className:"dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700",children:"Torna alla lista"})}),s.jsxs(kn,{className:"mb-6 dark:bg-gray-900 dark:border-gray-800",children:[s.jsx(Nn,{children:s.jsx(Sn,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{children:[s.jsx(bg,{className:"mr-2"}),"Dettagli Esecuzione"]}),w(i.status)]})})}),s.jsxs(Cn,{children:[s.jsxs(vt,{bordered:!0,column:2,size:"small",className:"dark:bg-gray-900 [&_.ant-descriptions-item-label]:dark:bg-gray-800 [&_.ant-descriptions-item-label]:dark:text-gray-300 [&_.ant-descriptions-item-content]:dark:bg-gray-900 [&_.ant-descriptions-item-content]:dark:text-gray-200 [&_.ant-descriptions-bordered]:dark:border-gray-700",children:[s.jsx(vt.Item,{label:"ID Esecuzione",span:2,children:s.jsx("code",{className:"bg-gray-100 dark:bg-gray-800 dark:text-gray-200 px-2 py-1 rounded",children:i.id})}),s.jsx(vt.Item,{label:"Workflow",children:i.workflow_name||i.workflow_id}),s.jsx(vt.Item,{label:"Workflow ID",children:s.jsx("code",{className:"bg-gray-100 dark:bg-gray-800 dark:text-gray-200 px-2 py-1 rounded text-xs",children:i.workflow_id})}),s.jsx(vt.Item,{label:"Iniziato da",children:i.trigger_user||"Sistema"}),s.jsx(vt.Item,{label:"Data inizio",children:new Date(i.started_at).toLocaleString("it-IT")}),i.completed_at&&s.jsxs(s.Fragment,{children:[s.jsx(vt.Item,{label:"Data completamento",children:new Date(i.completed_at).toLocaleString("it-IT")}),s.jsx(vt.Item,{label:"Durata",children:y(i.started_at,i.completed_at)})]}),!i.completed_at&&i.status==="running"&&s.jsx(vt.Item,{label:"Durata (in corso)",children:y(i.started_at)}),i.error_message&&s.jsx(vt.Item,{label:"Errore",span:2,children:s.jsx(Wt,{message:i.error_message,type:"error",showIcon:!0})})]}),i.result&&s.jsx(vs,{className:"mt-4 dark:bg-gray-800 dark:border-gray-700 [&_.ant-collapse-header]:dark:bg-gray-800 [&_.ant-collapse-header]:dark:text-gray-200 [&_.ant-collapse-content]:dark:bg-gray-850",defaultActiveKey:[],children:s.jsx(aa,{header:"📊 Risultato Esecuzione",children:s.jsx("pre",{className:"bg-gray-50 dark:bg-gray-950 dark:text-gray-200 rounded p-4 text-xs overflow-auto max-h-96",children:JSON.stringify(i.result,null,2)})},"result")}),i.context&&s.jsx(vs,{className:"mt-2 dark:bg-gray-800 dark:border-gray-700 [&_.ant-collapse-header]:dark:bg-gray-800 [&_.ant-collapse-header]:dark:text-gray-200 [&_.ant-collapse-content]:dark:bg-gray-850",defaultActiveKey:[],children:s.jsx(aa,{header:"🔧 Contesto Esecuzione",children:s.jsx("pre",{className:"bg-gray-50 dark:bg-gray-950 dark:text-gray-200 rounded p-4 text-xs overflow-auto max-h-96",children:JSON.stringify(i.context,null,2)})},"context")})]})]}),s.jsxs(kn,{className:"dark:bg-gray-900 dark:border-gray-800",children:[s.jsx(Nn,{children:s.jsx(Sn,{children:"📝 Log Esecuzione Step"})}),s.jsx(Cn,{children:c.length===0?s.jsx(Wt,{message:"Nessun log disponibile",description:"I log dettagliati degli step non sono disponibili per questa esecuzione.",type:"info",showIcon:!0,className:"dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200"}):s.jsx(Ei,{mode:"left",className:"dark:[&_.ant-timeline-item-content]:text-gray-200",children:c.map((b,S)=>{const m=b.status==="completed"||b.status==="success",v=b.status==="failed"||b.status==="error",j=b.status==="pending"||b.status==="running";return s.jsx(Ei.Item,{color:m?"green":v?"red":j?"blue":"gray",dot:m?s.jsx(Ps,{}):v?s.jsx(As,{}):j?s.jsx(ga,{spin:!0}):s.jsx(os,{}),children:s.jsxs("div",{className:"bg-white dark:bg-gray-850 dark:border-gray-700 border rounded-lg p-4 shadow-sm",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"font-semibold dark:text-gray-200",children:["Step ",b.step_index+1,": ",b.step_name||b.step_type]}),s.jsx(Vt,{color:m?"success":v?"error":j?"processing":"default",children:b.status})]}),s.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:[s.jsxs("div",{children:["Tipo: ",s.jsx("code",{className:"bg-gray-100 dark:bg-gray-800 dark:text-gray-200 px-1 rounded",children:b.step_type})]}),s.jsxs("div",{children:["Inizio: ",new Date(b.started_at).toLocaleString("it-IT")]}),b.completed_at&&s.jsxs("div",{children:["Completato: ",new Date(b.completed_at).toLocaleString("it-IT")," ",s.jsxs("span",{className:"text-blue-600",children:["(",y(b.started_at,b.completed_at),")"]})]})]}),b.error_message&&s.jsx(Wt,{message:"Errore",description:b.error_message,type:"error",showIcon:!0,className:"mb-2"}),b.output_data&&s.jsx(vs,{size:"small",className:"dark:bg-gray-800 dark:border-gray-700 [&_.ant-collapse-header]:dark:bg-gray-800 [&_.ant-collapse-header]:dark:text-gray-200",children:s.jsx(aa,{header:"📤 Output Data",children:s.jsx("pre",{className:"bg-gray-50 dark:bg-gray-950 dark:text-gray-200 rounded p-2 text-xs overflow-auto max-h-64",children:JSON.stringify(b.output_data,null,2)})},"output")})]})},b.id||S)})})})]})]})},K2=({isMobile:e})=>{const{i18n:t}=gt(),[r,n]=x.useState([]),[o,a]=x.useState([]),[i,l]=x.useState([]),[c,d]=x.useState([]),[u,f]=x.useState([]),[g,p]=x.useState("{}"),[h,w]=x.useState(!1),[y,b]=x.useState(""),[S,m]=x.useState(null),[v,j]=x.useState(null),[k,C]=x.useState("workflows"),[A,T]=x.useState(1),[O,$]=x.useState(0),[D,M]=x.useState(1),[N]=x.useState(10),[L,F]=x.useState(0),[_,I]=x.useState(1),[R]=x.useState(6),[B,H]=x.useState(!1),[ie,ge]=x.useState([]),[ee,J]=x.useState(null),[G,oe]=x.useState(!1),[te,E]=x.useState(null),[Q,re]=x.useState(!1),[ce,ue]=x.useState(null),[fe,Ee]=x.useState([]),[De,qe]=x.useState({}),Ke=x.useRef({}),V=x.useRef({}),[q,K]=x.useState({}),[Y,le]=x.useState({}),[U,z]=x.useState({}),[se,we]=x.useState({}),[ke,Fe]=x.useState({}),Te=x.useRef({}),be=x.useRef({}),Me=x.useRef(new Map),Oe=x.useRef(null),kt=x.useRef(!0);x.useRef(!1);const wt=x.useCallback((P,W)=>{try{return JSON.stringify(P)===JSON.stringify(W)}catch{return!1}},[]);if(he.useEffect(()=>{t.language!=="it"&&t.changeLanguage("it")},[t]),x.useEffect(()=>{Te.current=U},[U]),x.useEffect(()=>{be.current=q},[q]),x.useEffect(()=>{Object.keys(se).length===0&&Oe.current&&(clearInterval(Oe.current),Oe.current=null)},[se]),x.useEffect(()=>()=>{kt.current=!1,Object.values(Ke.current).forEach(clearInterval),Oe.current&&(clearInterval(Oe.current),Oe.current=null)},[]),t.language!=="it")return s.jsx("div",{className:"p-8 text-center text-lg",children:"Caricamento traduzioni..."});x.useEffect(()=>{Lo(_,y)},[_,y]);const Ie=x.useCallback(P=>{if(P==null)return null;if(typeof P=="object")return P;if(typeof P=="string"){const W=P.trim();if(!W)return null;try{return JSON.parse(W)}catch(Z){return console.warn("Impossibile fare il parse del JSON",Z),null}}return null},[]),et=x.useCallback(P=>{if(!P)return[];if(Array.isArray(P))return P;const W=Ie(P);return Array.isArray(W)?W:[]},[Ie]),Ar=P=>Math.min(100,Math.max(0,Math.round(P))),Ao=P=>{if(!Number.isFinite(P))return"";if(P<=0)return"ora";const W=Math.floor(P/1e3),Z=Math.floor(W/86400),ne=Math.floor(W%86400/3600),ae=Math.floor(W%3600/60),pe=W%60,de=[];return Z&&de.push(`${Z}g`),ne&&de.length<2&&de.push(`${ne}h`),ae&&de.length<2&&de.push(`${ae}m`),de.length||de.push(`${pe}s`),de.join(" ")},Pr=x.useCallback((P,W,Z=0)=>{const ne=Ie(P?.result)||P?.result||{},ae=Ie(P?.context)||P?.context||{};let pe=0,de=0;if(typeof ne.total_steps=="number"&&ne.total_steps>0&&(pe=ne.total_steps),Array.isArray(ne.steps_results)){const Pe=ne.steps_results.filter(xe=>xe?typeof xe.success=="boolean"?xe.success:typeof xe.status=="string"?!["pending","skipped"].includes(xe.status):!0:!1);de=Math.max(de,Pe.length),pe||(pe=ne.steps_results.length)}if(Array.isArray(ne.completed_steps)&&(de=Math.max(de,ne.completed_steps.length),pe||(pe=Math.max(pe,ne.completed_steps.length))),typeof ne.completed_steps_count=="number"&&(de=Math.max(de,ne.completed_steps_count)),!pe&&typeof ne.pending_step_index=="number"&&(pe=Math.max(pe,ne.pending_step_index+1)),!pe&&typeof ae.total_steps=="number"&&ae.total_steps>0&&(pe=ae.total_steps),!pe&&Array.isArray(ae.steps)&&(pe=ae.steps.length),!pe&&Array.isArray(ae.workflow_steps)&&(pe=ae.workflow_steps.length),!pe&&W?.totalSteps&&(pe=W.totalSteps),typeof ne.pending_steps_count=="number"&&pe&&(de=Math.max(de,pe-ne.pending_steps_count)),P?.status==="completed"&&(pe||(pe=W?.totalSteps||de||(Array.isArray(ae.steps)?ae.steps.length:0)),de||(de=pe||W?.totalSteps||0)),P?.status==="failed"&&pe&&de>=pe&&(de=Math.max(0,pe-1)),pe&&de>pe&&(de=pe),!pe){let Pe=Z||0;return P?.status==="running"?Pe=Math.min(90,Pe?Math.max(Pe,10):10):P?.status==="waiting_user_input"?Pe=Math.max(Pe,60):P?.status==="waiting_condition"?Pe=Math.max(Pe,85):["completed","failed","cancelled"].includes(P?.status)&&(Pe=100),{percent:Ar(Pe),completed:de||0,total:0}}return{percent:Ar(de/Math.max(pe,1)*100),completed:de,total:pe}},[Ie]),sn=x.useCallback(P=>{const W=Te.current?.[P];return W?W.triggers.some(Z=>Z&&["schedule","calendar"].includes(Z.type)&&Z.enabled!==!1):!1},[]),Zn=x.useCallback(async P=>{if(Me.current.has(P))return Me.current.get(P)??null;try{const W=await je.workflows.listExecutions({workflow_ids:[P],size:1,page:1,sort:"started_at",order:"desc"}),Z=Array.isArray(W.data?.executions)?W.data.executions[0]:null,ne=Z?.started_at?Date.parse(Z.started_at):null;return Me.current.set(P,ne),ne}catch(W){return console.warn("Impossibile recuperare l'ultima esecuzione",W),Me.current.set(P,null),null}},[]),cr=x.useCallback(async(P,W)=>{if(!Array.isArray(W)||!W.length)return null;const Z=W.find(st=>st&&["schedule","calendar"].includes(st.type)&&st.enabled!==!1);if(!Z)return null;const ne=Date.now(),ae=await Zn(P),pe=Z.next_run_at||Z.nextRunAt||Z.next_execution_at||Z.nextExecutionAt;let de=typeof pe=="string"?Date.parse(pe):Number(pe)||0,Le=0;typeof Z.interval_ms=="number"&&Z.interval_ms>0?Le=Z.interval_ms:typeof Z.interval_minutes=="number"?Le=Z.interval_minutes*60*1e3:typeof Z.interval_hours=="number"?Le=Z.interval_hours*60*60*1e3:typeof Z.interval_days=="number"&&(Le=Z.interval_days*24*60*60*1e3),!Le&&Z.type==="calendar"&&(typeof Z.frequency_minutes=="number"?Le=Z.frequency_minutes*60*1e3:typeof Z.frequency_hours=="number"&&(Le=Z.frequency_hours*60*60*1e3)),Le||(Le=24*60*60*1e3),(!de||Number.isNaN(de)||de<=ne)&&(de=ae?ae+Le:ne+Le);const Pe=Math.max(0,de-ne),xe=Le-Pe,_e=Ar(xe/Le*100);return{type:Z.type,nextRunAt:de,windowMs:Le,lastRunAt:ae??void 0,timeLeft:Pe,percent:_e,timezone:Z.timezone||Z.timezone_id||Z.time_zone||void 0,triggerLabel:Z.label||Z.name||void 0}},[Zn]),Gn=x.useCallback(()=>{we(P=>{const W=Date.now(),Z={};return Object.entries(P).forEach(([ne,ae])=>{const pe=Math.max(0,ae.nextRunAt-W),de=ae.windowMs-pe,Le=Ar(de/Math.max(ae.windowMs,1)*100);Z[ne]={...ae,timeLeft:pe,percent:Le}}),Z})},[]),er=x.useCallback(()=>{Oe.current||(Oe.current=setInterval(Gn,1e3))},[Gn]),Po=x.useCallback(async P=>{const W={},Z={};for(const ne of P){const ae=Ie(ne.workflow_definition)||ne.workflow_definition||{},pe=et(ae?.nodes||ne.visual_nodes),de=pe.find(Ve=>{if(!Ve)return!1;const ht=Ve.type||Ve.nodeType||Ve?.data?.nodeType;return typeof ht=="string"&&ht.toLowerCase()==="start"});let Le=0;Array.isArray(ae?.steps)?Le=ae.steps.length:Array.isArray(pe)&&(Le=pe.filter(Ve=>{const ht=Ve?.type||Ve?.data?.nodeType;return ht&&typeof ht=="string"&&ht.toLowerCase()!=="start"}).length);const xe=(ne.settings||ae?.settings||{})?.node_field_mappings||ae?.node_field_mappings||{},_e=de?.data?.fieldMapping?.sources||xe?.[de?.id];let st=[];const ot=et(_e||xe?.[de?.id]).find(Ve=>Ve?.sourceFormId==="__start_triggers__");if(ot){const Ve=Array.isArray(ot.mappings)?ot.mappings.find(Fr=>(Fr?.nodeFieldName||"").toLowerCase()==="triggers"):null,ht=Ve?.constantValue??Ve?.placeholder??null;st=et(ht).filter(Fr=>Fr&&typeof Fr.type=="string")}if(W[ne.id]={totalSteps:Le,startNodeId:de?.id,triggers:st},st.some(Ve=>Ve&&["schedule","calendar"].includes(Ve.type)&&Ve.enabled!==!1))try{const Ve=await cr(ne.id,st);Ve&&(Z[ne.id]=Ve)}catch(Ve){console.warn("Errore nel calcolo della schedule",Ve)}}kt.current&&(z(ne=>({...ne,...W})),we(ne=>{const ae={...ne};return Object.keys(W).forEach(pe=>{Z[pe]||delete ae[pe]}),{...ae,...Z}}),Object.keys(Z).length>0&&er())},[cr,er,et,Ie]),Qn=x.useCallback(P=>{const W=new Set;P.forEach(Z=>{if(!Z?.workflow_id||!Z?.started_at)return;const ne=Date.parse(Z.started_at);if(Number.isNaN(ne))return;const ae=Me.current.get(Z.workflow_id)??0;ne>ae&&(Me.current.set(Z.workflow_id,ne),sn(Z.workflow_id)&&W.add(Z.workflow_id))}),W.size>0&&W.forEach(async Z=>{const ne=Te.current[Z];if(ne)try{const ae=await cr(Z,ne.triggers);ae&&kt.current&&(we(pe=>({...pe,[Z]:ae})),er())}catch(ae){console.warn("Errore aggiornando la schedule",ae)}})},[cr,er,sn]),es=x.useCallback(P=>{const W={},Z={};P.forEach(ne=>{if(!ne?.execution_id||!["running","waiting_condition","waiting_user_input","pending"].includes(ne.status))return;const ae=Te.current?.[ne.workflow_id],pe=be.current[ne.execution_id]??0,de=Pr(ne,ae,pe);W[ne.execution_id]=de.percent,Z[ne.execution_id]={completed:de.completed,total:de.total}}),Object.keys(W).length>0&&K(ne=>({...ne,...W})),Object.keys(Z).length>0&&Fe(ne=>({...ne,...Z}))},[Pr]),Lo=async(P=1,W="")=>{w(!0);try{const Z={page:P,size:R};W.trim()&&(Z.search=W.trim());const ne=await je.workflows.list(Z),pe=(ne.data?.workflows||ne.data||[]).map(de=>{const Le=Ie(de.workflow_definition)||de.workflow_definition||{},Pe=Ie(de.settings)||de.settings||{};return{...de,workflow_definition:Le,settings:Pe,visual_nodes:et(de.visual_nodes),visual_edges:et(de.visual_edges)}});n(pe),$(ne.data?.total||0),a(pe),m(null),await Po(pe)}catch(Z){console.error("Error loading workflows:",Z),m("Failed to load workflows")}finally{w(!1)}},Nt=async(P,W=1)=>{try{const Z={page:W,size:N};P.length>0&&(Z.workflow_ids=P);const ne=await je.workflows.listExecutions(Z),ae=ne.data.executions||[];d(ae),F(ne.data.total||0),M(1),Qn(ae),es(ae),m(null)}catch(Z){console.error("Error loading executions:",Z),m("Failed to load executions")}},tr=async()=>{console.log("🔄 loadAllExecutions called");try{const P={page:D,size:N},W=await je.workflows.listExecutions(P);console.log("✅ Loaded executions:",W.data.executions?.length||0);const Z=W.data.executions||[];d(Z),F(W.data.total||0),M(1),Qn(Z),es(Z),m(null)}catch(P){console.error("❌ Error loading all executions:",P),m("Errore nel caricamento di tutte le execution"),d([])}},ts=async P=>{try{await je.workflows.cancelExecution(P,"Cancelled from UI"),me.success("Esecuzione annullata"),dr(P),le(W=>{const Z={...W};return delete Z[P],Z}),K(W=>{const Z={...W};return delete Z[P],Z}),Fe(W=>{const Z={...W};return delete Z[P],Z}),i.length>0?await Nt(i.map(W=>W.id)):await tr()}catch(W){console.error("Errore annullamento execution:",W),me.error("Impossibile annullare",W?.response?.data?.detail||W.message||"errore sconosciuto")}};x.useEffect(()=>{console.log("📊 Executions tab effect triggered:",{activeTab:k,selectedWorkflowsCount:i.length}),k==="executions"&&(i.length>0?(console.log("📋 Loading filtered executions for selected workflows"),Nt(i.map(P=>P.id))):(console.log("📋 Loading all executions (no filter)"),tr()))},[k,i.length]),x.useEffect(()=>{c.forEach(P=>{const W=P.execution_id||P.id;W&&(P.status==="running"||P.status==="waiting_condition")&&!Ke.current[W]&&(console.log(`🔄 Auto-starting polling for execution ${W} in status ${P.status}`),on(W))})},[c]);const Fo=async P=>{H(!0),J(P),oe(!0),E(null),ge([]);try{const W=await je.workflows.getExecutionLogs(P);ge(W.data.logs||[])}catch(W){console.error("Error loading execution logs:",W),E("Errore nel caricamento dei log")}finally{oe(!1)}},$o=async P=>{console.log("Execute workflow clicked for:",P),w(!0),m(null);try{let W={};try{W=JSON.parse(g)}catch{console.warn("⚠️ Invalid JSON in execution context, using empty object"),W={}}console.log("📤 Sending execution request:",{workflowId:P,context:W});const ne=(await je.workflows.execute(P,{context:W,trigger_user:"admin"})).data;console.log("✅ Workflow execution response:",ne);const ae=ne?.execution_id,pe=ne?.editable_fields||ne?.result?.editable_fields;if(ne?.status==="waiting_user_input"&&(console.log("⏸️ Workflow paused for user input"),ae&&ue(ae),pe&&Ee(de=>wt(de,pe)?de:pe),re(!0)),ae){const de=Te.current?.[P],Le=Pr(ne,de,0);Fe(Pe=>({...Pe,[ae]:{completed:Le.completed,total:Le.total}})),ne?.status!=="waiting_user_input"?(le(Pe=>({...Pe,[ae]:{execution_id:ae,workflow_id:P,status:ne?.status||"running"}})),K(Pe=>({...Pe,[ae]:Le.percent})),on(ae)):(le(Pe=>({...Pe,[ae]:{execution_id:ae,workflow_id:P,status:"waiting_user_input"}})),K(Pe=>({...Pe,[ae]:Le.percent||60})))}else console.error("❌ execution_id mancante nella risposta di avvio (status="+ne?.status+")",ne);if(i.length>0&&(console.log("🔄 Reloading executions for selected workflows"),await Nt(i.map(de=>de.id))),ne?.status==="completed")m(null),console.log("✅ Workflow completed successfully");else if(ne?.status==="failed"){const de=`Workflow execution failed: ${ne.error}`;m(de),console.error("❌ Workflow failed:",de)}else console.log("ℹ️ Workflow status:",ne?.status)}catch(W){console.error("Error executing workflow:",W),m("Failed to execute workflow")}finally{w(!1)}},on=P=>{Ke.current[P]&&clearInterval(Ke.current[P]),console.log("🔄 Starting polling for execution:",P);const W=async()=>{try{const ae=(await je.workflows.getExecution(P)).data,pe=V.current[P];console.log("📊 Polling status:",ae.status),le(xe=>({...xe,[P]:{execution_id:P,workflow_id:ae.workflow_id,status:ae.status}}));const de=Te.current?.[ae.workflow_id],Le=be.current[P]??0,Pe=Pr(ae,de,Le);if(K(xe=>({...xe,[P]:Pe.percent})),Fe(xe=>({...xe,[P]:{completed:Pe.completed,total:Pe.total}})),ae.status==="waiting_condition"&&pe!=="waiting_condition"&&me.info("Workflow in attesa del Sentinel","L'esecuzione è in pausa e il Sentinel sta monitorando gli eventi esterni."),pe==="waiting_condition"&&ae.status==="running"&&me.success("Workflow ripreso dal Sentinel","Il polling ha rilevato l'evento richiesto e il workflow sta ripartendo."),ae.status==="waiting_user_input")console.log("⏸️ Workflow paused for user input"),dr(P),De[P]?ae.result?.editable_fields&&qe(xe=>({...xe,[P]:{...xe[P],fields:ae.result.editable_fields}})):(ue(P),ae.result?.editable_fields&&Ee(xe=>wt(xe,ae.result.editable_fields)?xe:ae.result.editable_fields),re(!0));else if(ae.status==="waiting_condition")console.log("⏳ Workflow waiting for condition - polling continues");else if(ae.status==="completed"||ae.status==="failed"){if(console.log("✅ Workflow finished:",ae.status),dr(P),ae.status==="completed"&&ae.started_at&&ae.workflow_id){const xe=Date.parse(ae.started_at);if(!Number.isNaN(xe)){const _e=Me.current.get(ae.workflow_id)??0;if(xe>_e&&(Me.current.set(ae.workflow_id,xe),sn(ae.workflow_id))){const st=Te.current[ae.workflow_id];if(st)try{const ze=await cr(ae.workflow_id,st.triggers);ze&&kt.current&&(we(ot=>({...ot,[ae.workflow_id]:ze})),er())}catch(ze){console.warn("Errore aggiornando il countdown della schedule",ze)}}}}i.length>0&&await Nt(i.map(xe=>xe.id)),ae.status==="completed"?(me.success("Workflow completato con successo!"),le(xe=>{const _e={...xe};return delete _e[P],_e}),K(xe=>{const _e={...xe};return delete _e[P],_e}),Fe(xe=>{const _e={...xe};return delete _e[P],_e}),qe(xe=>{const _e={...xe};return delete _e[P],_e}),delete V.current[P]):(me.error("Workflow fallito",ae.error_message||"Unknown error"),le(xe=>{const _e={...xe};return delete _e[P],_e}),K(xe=>{const _e={...xe};return delete _e[P],_e}),Fe(xe=>{const _e={...xe};return delete _e[P],_e}),qe(xe=>{const _e={...xe};return delete _e[P],_e}),delete V.current[P])}else ae.status==="cancelled"&&(console.log("🛑 Workflow cancelled"),dr(P),me.info("Esecuzione annullata"),le(xe=>{const _e={...xe};return delete _e[P],_e}),K(xe=>{const _e={...xe};return delete _e[P],_e}),Fe(xe=>{const _e={...xe};return delete _e[P],_e}),qe(xe=>{const _e={...xe};return delete _e[P],_e}),delete V.current[P],i.length>0&&await Nt(i.map(xe=>xe.id)));V.current[P]=ae.status}catch(ne){console.error("❌ Error polling execution:",ne)}};W();const Z=setInterval(W,2e3);Ke.current[P]=Z},dr=P=>{if(P){const W=Ke.current[P];W&&(console.log("⏹️ Stopping polling for",P),clearInterval(W),delete Ke.current[P]),delete V.current[P];return}Object.keys(Ke.current).forEach(W=>{clearInterval(Ke.current[W]),delete Ke.current[W],delete V.current[W]})};x.useEffect(()=>()=>{dr()},[]);const Ro=async P=>{if(ce)try{console.log("📤 Submitting user input:",P);const Z=(await je.workflows.submitUserInput(ce,P)).data;console.log("✅ User input submitted:",Z),re(!1),ue(null),Ee([]),Z.status==="waiting_user_input"&&Z.result?.editable_fields?(ue(Z.execution_id),Ee(Z.result.editable_fields),re(!0)):on(Z.execution_id),i.length>0&&await Nt(i.map(ne=>ne.id))}catch(W){throw console.error("❌ Error submitting user input:",W),me.error("Errore durante l'invio",W.message||"Unknown error"),W}},Io=()=>{re(!1),ue(null),Ee([]),me.warning("Input utente annullato. Il workflow rimarrà in pausa.")},Mo=()=>{if(!ce)return;const P=c.find(Z=>Z.execution_id===ce),W=r.find(Z=>Z.id===P?.workflow_id);qe(Z=>({...Z,[ce]:{execution_id:ce,workflow_id:P?.workflow_id||"",workflow_name:W?.name,fields:fe}})),re(!1),ue(null),Ee([]),me.info("Modale minimizzata. Clicca sull'indicatore per riaprirla.")},rs=P=>{const W=De[P];W&&(ue(W.execution_id),Ee(W.fields),re(!0),qe(Z=>{const{[P]:ne,...ae}=Z;return ae}))},an=async P=>{try{Ke.current[P]&&(clearInterval(Ke.current[P]),delete Ke.current[P]),await je.workflows.cancelExecution(P,"Arrestato dall'utente"),qe(W=>{const{[P]:Z,...ne}=W;return ne}),ce===P&&(re(!1),ue(null),Ee([])),le(W=>{const{[P]:Z,...ne}=W;return ne}),K(W=>{const{[P]:Z,...ne}=W;return ne}),Fe(W=>{const{[P]:Z,...ne}=W;return ne}),me.success("Esecuzione arrestata con successo"),await tr()}catch(W){console.error("Errore nell'arrestare l'esecuzione:",W),me.error("Errore nell'arrestare l'esecuzione",W.response?.data?.detail||W.message)}},Lr=P=>{const W={completed:{variant:"success",icon:jd},running:{variant:"warning",icon:cn},failed:{variant:"danger",icon:kd},cancelled:{variant:"secondary",icon:Ht},pending:{variant:"secondary",icon:Ht}},Z=W[P]||W.pending,ne=Z.icon;return s.jsxs(rr,{variant:Z.variant,className:"flex items-center gap-1",children:[s.jsx(ne,{className:"w-3 h-3"}),P]})},ur=P=>P?new Date(P).toLocaleString():"N/A",ns=P=>{const W=q[P.execution_id]??(["completed","failed","cancelled"].includes(P.status)?100:0),Z=U[P.workflow_id],ne=ke[P.execution_id],ae=ne?.total??Z?.totalSteps??0,pe=ne?.completed??(W===100&&ae?ae:0);if(!["running","waiting_condition","waiting_user_input","pending"].includes(P.status))return null;const Le=P.status==="waiting_user_input"?"In attesa input utente":P.status==="waiting_condition"?"In attesa condizione":P.status==="pending"?"In coda":"In esecuzione";return s.jsxs("div",{className:"flex flex-col items-end gap-1 min-w-[12rem]",children:[s.jsxs("div",{className:"flex items-center gap-2 w-full",children:[s.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-gray-850 rounded-full h-2.5 overflow-hidden",children:s.jsx("div",{className:"bg-blue-600 dark:bg-blue-500 h-2.5 transition-all duration-300 rounded-full",style:{width:`${W}%`}})}),s.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-400 w-10 text-right",children:[W,"%"]})]}),ae>0?s.jsxs("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[pe,"/",ae," nodi • ",Le]}):s.jsx("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:Le})]})};return s.jsxs("div",{className:e?"p-2 bg-gray-50 dark:bg-gray-950 min-h-screen":"p-6 bg-gray-50 dark:bg-gray-950 min-h-screen",children:[s.jsx("div",{className:"flex justify-between items-center mb-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(ve,{as:"h1",variant:"primary",size:"3xl",weight:"bold",className:"text-purple-700 dark:text-purple-400",children:"Workflow Execution"}),Object.keys(De).length>0&&s.jsxs(rr,{variant:"warning",className:"flex items-center gap-1",children:[s.jsx(cn,{className:"w-3 h-3"}),Object.keys(De).length," in attesa"]})]})}),S&&s.jsxs(na,{variant:"destructive",children:[s.jsx(Ht,{className:"h-4 w-4"}),s.jsx(sa,{children:S})]}),s.jsxs(B2,{value:k,onValueChange:C,className:"w-full",children:[s.jsxs(H2,{children:[s.jsx(oa,{value:"workflows",children:"Workflows"}),s.jsx(oa,{value:"executions",children:"Executions"}),v&&s.jsx(oa,{value:"logs",children:"Execution Logs"})]}),s.jsxs(Sc,{value:"workflows",className:"space-y-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",value:y,onChange:P=>b(P.target.value),placeholder:"Search workflows by name or description...",className:"w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-800 bg-white dark:bg-gray-900 text-gray-900 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 placeholder-gray-500 dark:placeholder-gray-400 transition-colors"}),s.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500 w-4 h-4"}),y&&s.jsx("button",{onClick:()=>b(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 transition-colors",type:"button",children:"✕"})]}),s.jsxs("div",{className:"grid gap-4",children:[o.map(P=>{const W=i.some(ze=>ze.id===P.id),Z=U[P.id],ne=Z?.triggers??[],ae=ne.some(ze=>ze?.type==="manual"&&ze.enabled!==!1),pe=ne.filter(ze=>ze?.type&&ze.type!=="manual"),de=se[P.id],Le=de?Ao(de.timeLeft):"",Pe=de?new Date(de.nextRunAt):null,xe=Pe?Pe.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",_e=Pe?Pe.toLocaleString():"",st=de?.lastRunAt?new Date(de.lastRunAt).toLocaleString():null;return s.jsxs(kn,{className:`hover:shadow-md transition-all ${W?"ring-2 ring-purple-500 border-purple-500":""}`,children:[s.jsx(Nn,{children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Sn,{className:"text-lg",children:P.name}),W&&s.jsx(rr,{variant:"success",className:"text-xs",children:"Selezionato"})]}),s.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",P.id]}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:P.description}),Z?.totalSteps?s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Totale nodi: ",Z.totalSteps]}):null]}),Lr(P.status)]})}),s.jsxs(Cn,{children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-400 mb-3",children:[ae?s.jsxs(rr,{variant:"success",className:"flex items-center gap-1",children:[s.jsx(Ki,{className:"w-3 h-3"}),"Trigger manuale"]}):s.jsxs(rr,{variant:"secondary",className:"flex items-center gap-1",children:[s.jsx(Ht,{className:"w-3 h-3"}),"Solo trigger automatici"]}),pe.map((ze,ot)=>{const Ve=`${ze.type||"unknown"}-${ot}`,ht=ze.type==="schedule"||ze.type==="calendar";return s.jsxs(rr,{variant:ht?"warning":"info",className:"flex items-center gap-1",children:[ht?s.jsx(cn,{className:"w-3 h-3"}):s.jsx(Ht,{className:"w-3 h-3"}),ze.label||ze.type]},Ve)}),ne.length===0&&s.jsxs(rr,{variant:"warning",className:"flex items-center gap-1",children:[s.jsx(Ht,{className:"w-3 h-3"}),"Nessun trigger configurato"]})]}),de&&s.jsxs("div",{className:"mb-3",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs text-amber-600 dark:text-amber-300 mb-1",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(cn,{className:"w-3 h-3"}),"Prossima esecuzione",de.triggerLabel?` (${de.triggerLabel})`:""]}),s.jsxs("span",{className:"font-medium",children:[Le,xe?` • ${xe}`:""]})]}),s.jsx("div",{className:"h-1.5 w-full bg-amber-100 dark:bg-amber-900/40 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-amber-500 dark:bg-amber-400 transition-all duration-500",style:{width:`${de.percent}%`}})}),s.jsxs("p",{className:"text-[11px] text-gray-500 dark:text-gray-400 mt-1",children:["Prossima finestra il ",_e,de.timezone?` (${de.timezone})`:"",st?` • Ultima esecuzione: ${st}`:""]})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx("div",{title:ae?void 0:"Configura un trigger manuale nel nodo Start per abilitare l'avvio manuale",children:s.jsxs(Qe,{variant:"success",disabled:!ae||h,onClick:ae?async()=>{await $o(P.id)}:void 0,children:[s.jsx(Ki,{className:"w-4 h-4 mr-2"}),"Avvia manualmente"]})}),s.jsxs(Qe,{variant:"secondary",onClick:async()=>{if(W){const ze=i.filter(ot=>ot.id!==P.id);l(ze),ze.length>0?await Nt(ze.map(ot=>ot.id)):await tr()}else{const ze=[...i,P];l(ze),await Nt(ze.map(ot=>ot.id))}C("executions")},children:[s.jsx(qi,{className:"w-4 h-4 mr-2"}),W?"Deseleziona":"View Executions"]})]}),!ae&&s.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 flex items-center gap-1",children:[s.jsx(Ht,{className:"w-3 h-3"}),"Avvio manuale disabilitato: attiva un trigger manuale nello Start."]})]})]},P.id)}),o.length===0&&r.length>0&&s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(Yi,{className:"mx-auto h-12 w-12 text-gray-300 mb-4"}),s.jsxs("p",{children:['No workflows found matching "',y,'"']}),s.jsx("p",{className:"text-sm",children:"Try adjusting your search terms"})]}),r.length===0&&s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(Ht,{className:"mx-auto h-12 w-12 text-gray-300 mb-4"}),s.jsx("p",{children:"No workflows available"}),s.jsx("p",{className:"text-sm",children:"Create some workflows to get started"})]})]}),s.jsxs("div",{className:"flex justify-center items-center gap-4 mt-4",children:[s.jsx("button",{className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-850 text-gray-800 dark:text-gray-200 disabled:opacity-50 transition-colors",onClick:()=>I(_-1),disabled:_===1,children:"Previous"}),s.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:["Page ",_," of ",Math.max(1,Math.ceil(O/R))," ",s.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:["(Totale workflow: ",O,")"]})]}),s.jsx("button",{className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-850 text-gray-800 dark:text-gray-200 disabled:opacity-50 transition-colors",onClick:()=>I(_+1),disabled:_>=Math.ceil(O/R),children:"Next"})]})]}),s.jsxs(Sc,{value:"executions",className:"space-y-4",children:[i.length>0?s.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-700 rounded-lg p-4 flex justify-between items-center",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("p",{className:"font-semibold text-purple-700 dark:text-purple-300",children:["Visualizzazione esecuzioni di ",i.length," workflow",i.length>1?"s":"",":"]}),s.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:i.map(P=>s.jsxs(rr,{variant:"secondary",className:"flex items-center gap-1",children:[P.name,s.jsx("button",{onClick:async()=>{const W=i.filter(Z=>Z.id!==P.id);l(W),W.length>0?await Nt(W.map(Z=>Z.id)):await tr()},className:"ml-1 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-full w-4 h-4 flex items-center justify-center text-xs",children:"✕"})]},P.id))})]}),s.jsx(Qe,{variant:"secondary",onClick:async()=>{l([]),await tr()},children:"Mostra tutte le esecuzioni"})]}):s.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg p-4",children:[s.jsx("p",{className:"font-semibold text-blue-700 dark:text-blue-300",children:"Visualizzazione di tutte le esecuzioni"}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:'Clicca "View Executions" su una o più card workflow per filtrare le esecuzioni'})]}),i.length===0&&s.jsxs(kn,{children:[s.jsx(Nn,{children:s.jsx(Sn,{children:"Tutte le Executions"})}),s.jsxs(Cn,{children:[s.jsxs("div",{className:"space-y-3",children:[c.slice((D-1)*N,D*N).map(P=>{const W=ns(P);return s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("p",{className:"font-medium",children:["Workflow: ",P.workflow_name||P.workflow_id,P.workflow_name&&s.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",P.workflow_id,")"]})]}),s.jsxs("p",{className:"font-medium",children:["Execution ID: ",P.execution_id]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Started: ",ur(P.started_at)]}),P.completed_at&&s.jsxs("p",{className:"text-sm text-gray-600",children:["Completed: ",ur(P.completed_at)]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[W,Lr(P.status)]})]}),P.error_message&&s.jsx(na,{variant:"destructive",className:"mb-2",children:s.jsx(sa,{children:P.error_message})}),(P.status==="running"||P.status==="waiting_user_input"||P.status==="waiting_condition"||P.status==="pending")&&s.jsx("div",{className:"mt-2 flex gap-2 justify-end",children:s.jsx(Qe,{variant:"danger",onClick:()=>ts(P.execution_id),children:"Annulla"})})]},P.execution_id)}),c.length===0&&s.jsx("p",{className:"text-gray-500 text-center py-4",children:"No executions found"})]}),c.length>N&&s.jsxs("div",{className:"flex justify-center items-center gap-4 mt-4",children:[s.jsx("button",{className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-850 text-gray-800 dark:text-gray-200 disabled:opacity-50 transition-colors",onClick:()=>M(D-1),disabled:D===1,children:"Previous"}),s.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:["Page ",D," of ",Math.ceil(c.length/N)]}),s.jsx("button",{className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-850 text-gray-800 dark:text-gray-200 disabled:opacity-50 transition-colors",onClick:()=>M(D+1),disabled:D>=Math.ceil(c.length/N),children:"Next"})]})]})]}),i.length>0&&s.jsxs(kn,{children:[s.jsx(Nn,{children:s.jsx(Sn,{children:"Executions filtrate per workflow selezionati"})}),s.jsxs(Cn,{children:[s.jsxs("div",{className:"space-y-3",children:[c.slice((D-1)*N,D*N).map(P=>{const W=r.find(ne=>ne.id===P.workflow_id),Z=ns(P);return s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("p",{className:"font-medium",children:["Workflow: ",W?`${W.name} (${W.id})`:P.workflow_id]}),s.jsxs("p",{className:"font-medium",children:["Execution ID: ",P.execution_id]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Started: ",ur(P.started_at)]}),P.completed_at&&s.jsxs("p",{className:"text-sm text-gray-600",children:["Completed: ",ur(P.completed_at)]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[Z,Lr(P.status)]})]}),P.error_message&&s.jsx(na,{variant:"destructive",className:"mb-2",children:s.jsx(sa,{children:P.error_message})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(Qe,{variant:"secondary",onClick:()=>Fo(P.execution_id),children:[s.jsx(qi,{className:"w-4 h-4 mr-2"}),"View Logs"]}),(P.status==="running"||P.status==="waiting_user_input"||P.status==="waiting_condition"||P.status==="pending")&&s.jsx(Qe,{variant:"danger",onClick:()=>ts(P.execution_id),children:"Annulla"})]})]},P.execution_id)}),c.length===0&&s.jsx("p",{className:"text-gray-500 text-center py-4",children:"No executions found"})]}),c.length>N&&s.jsxs("div",{className:"flex justify-center items-center gap-4 mt-4",children:[s.jsx("button",{className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-850 text-gray-800 dark:text-gray-200 disabled:opacity-50 transition-colors",onClick:()=>M(D-1),disabled:D===1,children:"Previous"}),s.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:["Page ",D," of ",Math.ceil(c.length/N)]}),s.jsx("button",{className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-850 text-gray-800 dark:text-gray-200 disabled:opacity-50 transition-colors",onClick:()=>M(D+1),disabled:D>=Math.ceil(c.length/N),children:"Next"})]})]})]}),s.jsx(br,{title:"Execution Logs",open:B,onCancel:()=>H(!1),footer:null,width:"90%",style:{top:20},bodyStyle:{maxHeight:"calc(100vh - 200px)",overflow:"auto"},children:ee&&s.jsx(q2,{executionId:ee,isModal:!0})})]})]}),s.jsx(W2,{visible:Q,executionId:ce||"",editableFields:fe,onSubmit:Ro,onCancel:Io,onMinimize:Mo,onStop:()=>ce&&an(ce)}),Object.keys(De).length>0&&s.jsxs("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col gap-2 max-w-sm",children:[s.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 text-right mb-1 px-2",children:"Workflow in attesa di input"}),Object.entries(De).map(([P,W])=>s.jsxs("div",{className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-lg shadow-lg transition-all hover:scale-105 flex items-center gap-3 animate-pulse hover:animate-none group",children:[s.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>rs(P),title:"Clicca per riaprire",children:[s.jsx("div",{className:"text-sm font-semibold truncate",children:W.workflow_name||"Workflow"}),s.jsx("div",{className:"text-xs opacity-90 truncate",children:"In attesa input utente • Clicca per aprire"})]}),s.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[s.jsx("button",{onClick:()=>rs(P),className:"bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full w-8 h-8 flex items-center justify-center transition-all",title:"Ripristina modale",children:s.jsx(cn,{className:"w-4 h-4"})}),s.jsx("button",{onClick:Z=>{Z.stopPropagation(),an(P)},className:"bg-red-500 bg-opacity-80 hover:bg-opacity-100 rounded-full w-8 h-8 flex items-center justify-center transition-all",title:"Arresta esecuzione",children:s.jsx("span",{className:"text-sm",children:"⏹"})}),s.jsx("button",{onClick:Z=>{Z.stopPropagation(),qe(ne=>{const{[P]:ae,...pe}=ne;return pe}),me.info("Modale rimossa. Il workflow rimarrà in pausa.")},className:"bg-red-500 bg-opacity-60 hover:bg-opacity-100 rounded-full w-6 h-6 flex items-center justify-center transition-all opacity-0 group-hover:opacity-100",title:"Rimuovi dalla lista (workflow resta in pausa)",children:s.jsx("span",{className:"text-xs font-bold",children:"✕"})})]})]},P))]})]})},_c=e=>{if(typeof e=="boolean")return e;if(typeof e=="string"){const t=e.trim().toLowerCase();if(["true","1","yes","y","on"].includes(t))return!0;if(["false","0","no","n","off",""].includes(t))return!1}return typeof e=="number"?e!==0:!!e},Ec=()=>{const[e]=tn(),t=e.get("workflow_execution_id"),r=e.get("link_token"),n=r?r.trim():null,[o,a]=x.useState(!0),[i,l]=x.useState(null),[c,d]=x.useState(!1),[u,f]=x.useState(!1),[g,p]=x.useState(!1),[h,w]=x.useState(null),[y,b]=x.useState("loading"),[S,m]=x.useState(""),[v,j]=x.useState(""),[k,C]=x.useState(!1);x.useEffect(()=>{if(!t||!n){w("Link non valido - parametri mancanti"),a(!1);return}A()},[t,n]);const A=async()=>{try{const N=(await je.get("/payment-link-info",{params:{workflow_execution_id:t,link_token:n}})).data.payment_details||{},L=_c(N.paid),F=_c(N.has_password),_=typeof N.amount=="number"?N.amount:parseFloat(N.amount||"0"),I={id:t||"",title:N.title||"Pagamento",amount:Number.isFinite(_)?_:0,due_date:N.due_date||new Date().toISOString(),iban:N.iban||"",customer_email:N.customer_email||"",paid:L,paid_at:N.paid_at||null,created_at:new Date().toISOString()};l(I),C(F),L?(d(!0),b("authenticated")):b(F?"verify_password":"set_password")}catch(M){w(M.response?.data?.detail||"Errore caricamento dati pagamento"),b("authenticated")}finally{a(!1)}},T=async()=>{if(S.length<6){w("La password deve essere di almeno 6 caratteri");return}if(S!==v){w("Le password non coincidono");return}p(!0),w(null);try{await je.post("/payment-set-password",{workflow_execution_id:t,link_token:n,password:S}),b("authenticated"),C(!0)}catch(M){console.error("Errore set password:",M);const N=M.response?.data?.detail;typeof N=="string"?w(N):Array.isArray(N)?w(N.map(L=>L.msg||JSON.stringify(L)).join(", ")):w("Errore durante l'impostazione della password")}finally{p(!1)}},O=async()=>{if(!S){w("Inserisci la password");return}p(!0),w(null);try{await je.post("/payment-verify-password",{workflow_execution_id:t,link_token:n,password:S}),b("authenticated")}catch(M){console.error("Errore verify password:",M);const N=M.response?.data?.detail;if(M.response?.status===400&&typeof N=="string"&&N.includes("non ancora impostata")){w("Password non ancora impostata. Procedi con la registrazione."),setTimeout(()=>{b("set_password"),m(""),w(null)},2e3);return}typeof N=="string"?w(N):Array.isArray(N)?w(N.map(F=>F.msg||JSON.stringify(F)).join(", ")):w("Password errata")}finally{p(!1)}},$=async()=>{p(!0),w(null);try{await je.post("/payment-reset-password",{workflow_execution_id:t,link_token:n}),w("✅ Email di recupero inviata! Controlla la tua casella di posta.")}catch(M){console.error("Errore richiesta reset:",M);const N=M.response?.data?.detail;if(M.response?.status===400&&typeof N=="string"&&N.includes("Nessuna password impostata")){w("Non hai ancora impostato una password. Procedi con la registrazione."),setTimeout(()=>{b("set_password"),m(""),w(null)},2e3);return}typeof N=="string"?w(N):Array.isArray(N)?w(N.map(F=>F.msg||JSON.stringify(F)).join(", ")):w("Errore durante l'invio dell'email di recupero")}finally{p(!1)}},D=async()=>{if(!u){w("Devi confermare di aver effettuato il pagamento");return}p(!0),w(null);try{(await je.get("/payment-confirm",{params:{workflow_execution_id:t,link_token:n,paid:!0}})).data.success&&d(!0)}catch(M){w(M.response?.data?.detail||"Errore durante la conferma")}finally{p(!1)}};return o||y==="loading"?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:s.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"mt-4 text-gray-600",children:"Caricamento..."})]})}):y==="set_password"?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:s.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4",children:s.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Primo Accesso"}),s.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Imposta una password per proteggere questo link di pagamento"})]}),h&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:s.jsx("p",{className:"text-sm text-red-700",children:h})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),s.jsx("input",{type:"password",value:S,onChange:M=>m(M.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Almeno 6 caratteri"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Conferma Password"}),s.jsx("input",{type:"password",value:v,onChange:M=>j(M.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ripeti la password"})]}),s.jsx("button",{onClick:T,disabled:g,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Impostazione...":"Imposta Password"})]})]})}):y==="verify_password"?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:s.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4",children:s.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Accesso Protetto"}),s.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Inserisci la password per accedere alla pagina di pagamento"})]}),h&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:s.jsx("p",{className:"text-sm text-red-700",children:h})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),s.jsx("input",{type:"password",value:S,onChange:M=>m(M.target.value),onKeyPress:M=>M.key==="Enter"&&O(),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Inserisci la password",autoFocus:!0})]}),s.jsx("button",{onClick:O,disabled:g,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Verifica...":"Accedi"}),s.jsx("div",{className:"text-center mt-4",children:s.jsx("button",{onClick:$,disabled:g,className:"text-xs text-blue-600 hover:text-blue-700 hover:underline disabled:opacity-50",children:"Password dimenticata? Clicca qui per recuperarla"})})]})]})}):c?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:s.jsx("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100",children:s.jsx("svg",{className:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"Pagamento Confermato! ✅"}),s.jsxs("p",{className:"mt-2 text-sm text-gray-500",children:["Il pagamento è stato confermato con successo.",s.jsx("br",{}),"Il workflow è stato completato e una notifica è stata inviata al richiedente."]}),i&&s.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:s.jsxs("p",{className:"text-xs text-gray-600",children:[s.jsx("strong",{children:"ID Richiesta:"})," ",i.id,s.jsx("br",{}),s.jsx("strong",{children:"Confermato il:"})," ",new Date().toLocaleString("it-IT")]})})]})})}):h&&!i?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:s.jsx("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:s.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"Errore"}),s.jsx("p",{className:"mt-2 text-sm text-gray-500",children:h})]})})}):s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:s.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4",children:s.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Conferma Pagamento"}),s.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Verifica i dettagli e conferma il bonifico effettuato"})]}),h&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:s.jsx("p",{className:"text-sm text-red-700",children:h})}),i&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:i.title||"Dettagli Pagamento"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Importo:"}),s.jsxs("span",{className:"font-medium text-green-600",children:["€",Number(i.amount||0).toFixed(2)]})]}),s.jsxs("div",{className:"border-t pt-2 mt-3",children:[s.jsx("div",{className:"flex justify-between items-center",children:s.jsx("span",{className:"text-gray-600",children:"IBAN Beneficiario:"})}),s.jsx("div",{className:"mt-1 p-2 bg-blue-50 border border-blue-200 rounded font-mono text-sm break-all",children:i.iban||"N/D"})]}),i.due_date&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Scadenza:"}),s.jsx("span",{className:"font-medium",children:i.due_date})]})]})]}),s.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"📋 Istruzioni"}),s.jsxs("ol",{className:"text-sm text-yellow-700 space-y-1",children:[s.jsx("li",{children:"1. Effettua il bonifico all'IBAN sopra indicato"}),s.jsxs("li",{children:['2. Inserisci come causale: "',s.jsx("strong",{children:i.title||"Pagamento"}),'"']}),s.jsx("li",{children:"3. Conferma il pagamento spuntando la checkbox qui sotto"})]})]}),s.jsx("div",{className:"border-t pt-4",children:s.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:u,onChange:M=>f(M.target.checked),className:"mt-1 h-5 w-5 text-green-600 border-gray-300 rounded focus:ring-green-500"}),s.jsxs("span",{className:"text-sm text-gray-700",children:["✅ ",s.jsx("strong",{children:"Confermo di aver effettuato il bonifico bancario"})," per l'importo di €",Number(i.amount||0).toFixed(2),"all'IBAN indicato. Sono consapevole che il richiedente riceverà una notifica automatica."]})]})}),s.jsx("button",{onClick:D,disabled:!u||g,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:g?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Confermando..."]}):"✓ Conferma Pagamento"}),s.jsx("p",{className:"text-xs text-gray-500 text-center",children:"La conferma del pagamento completerà automaticamente il workflow associato."})]})]})})},Y2=()=>{const[e]=tn(),t=Pt(),r=e.get("workflow_execution_id"),n=e.get("reset_token"),o=e.get("link_token"),a=o?o.trim():null,[i,l]=x.useState(""),[c,d]=x.useState(""),[u,f]=x.useState(!1),[g,p]=x.useState(null),[h,w]=x.useState(!1);x.useEffect(()=>{(!r||!n)&&p("Link di reset non valido. Parametri mancanti.")},[r,n]);const y=async()=>{if(p(null),i.length<6){p("La password deve essere di almeno 6 caratteri");return}if(i!==c){p("Le password non coincidono");return}f(!0);try{await je.post("/payment-confirm-reset",{workflow_execution_id:r,reset_token:n,new_password:i}),w(!0),setTimeout(()=>{a?t(`/payment-confirm?workflow_execution_id=${r}&link_token=${a}`):p("Password reimpostata. Torna alla pagina di pagamento per accedere.")},3e3)}catch(b){console.error("Errore reset password:",b),p(b.response?.data?.detail||"Errore durante il reset della password")}finally{f(!1)}};return h?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:s.jsx("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4",children:s.jsx("svg",{className:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Password Reimpostata!"}),s.jsxs("p",{className:"text-sm text-gray-500",children:["La tua password è stata reimpostata con successo.",s.jsx("br",{}),"Verrai reindirizzato alla pagina di pagamento..."]}),s.jsx("div",{className:"mt-4",children:s.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})})]})})}):!r||!n?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:s.jsx("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:s.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Link Non Valido"}),s.jsx("p",{className:"text-sm text-gray-500",children:g})]})})}):s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:s.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4",children:s.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Reimposta Password"}),s.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Inserisci la tua nuova password"})]}),g&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:s.jsx("p",{className:"text-sm text-red-700",children:g})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nuova Password"}),s.jsx("input",{type:"password",value:i,onChange:b=>l(b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Almeno 6 caratteri",disabled:u})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Conferma Password"}),s.jsx("input",{type:"password",value:c,onChange:b=>d(b.target.value),onKeyPress:b=>b.key==="Enter"&&!u&&y(),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ripeti la password",disabled:u})]}),s.jsx("button",{onClick:y,disabled:u,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:u?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Reimpostazione..."]}):"Reimposta Password"}),s.jsx("p",{className:"text-xs text-gray-500 text-center mt-4",children:"Il link di reset è valido per 1 ora"})]})]})})},X2=()=>{const{paymentId:e}=Dc(),[t]=tn(),r=Pt(),n=t.get("token"),o=t.get("payment_token"),[a,i]=x.useState("verifying"),[l,c]=x.useState("");x.useEffect(()=>{if(!e||!n||!o){i("error"),c("Link di verifica non valido");return}d()},[e,n,o]);const d=async()=>{try{const f=await je.get(`/api/payments/${e}/verify-email?token=${n}&payment_token=${o}`);i("success"),c(f.data.message),setTimeout(()=>{r(`/payment/confirm/${e}?token=${o}`)},3e3)}catch(f){i("error"),c(f.response?.data?.detail||"Errore durante la verifica")}},u=()=>{r(`/payment/confirm/${e}?token=${o}`)};return a==="verifying"?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:s.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),s.jsx("h2",{className:"mt-4 text-xl font-semibold text-gray-900",children:"Verifica Email"}),s.jsx("p",{className:"mt-2 text-gray-600",children:"Stiamo verificando la tua email..."})]})}):a==="success"?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:s.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full text-center",children:[s.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100",children:s.jsx("svg",{className:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h2",{className:"mt-4 text-xl font-semibold text-gray-900",children:"Email Verificata! ✅"}),s.jsx("p",{className:"mt-2 text-gray-600",children:l}),s.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"Verrai reindirizzato automaticamente alla pagina del pagamento tra 3 secondi..."}),s.jsx("button",{onClick:u,className:"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Vai al Pagamento →"})]})}):s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:s.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full text-center",children:[s.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:s.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h2",{className:"mt-4 text-xl font-semibold text-gray-900",children:"Errore Verifica"}),s.jsx("p",{className:"mt-2 text-gray-600",children:l}),s.jsx("button",{onClick:()=>window.location.href="/login",className:"mt-4 inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Torna alla Home"})]})})};function zn({isDark:e}){const[t,r]=x.useState(!1);return t?s.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e?s.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:"url(https://images.unsplash.com/photo-1419242902214-272b3f66ee7a?w=1920&q=80)",filter:"brightness(0.7)"}}):s.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:"url(https://images.unsplash.com/photo-1534088568595-a066f410bcda?w=1920&q=80)"}}),s.jsx("div",{className:`absolute inset-0 ${e?"bg-black/20":"bg-white/10"}`})]}):s.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e?s.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,onError:()=>r(!0),className:"absolute min-w-full min-h-full w-auto h-auto top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 object-cover",style:{filter:"brightness(0.8)"},children:s.jsx("source",{src:"/videos/starry-night.mp4",type:"video/mp4"})}):s.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,onError:()=>r(!0),className:"absolute min-w-full min-h-full w-auto h-auto top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 object-cover",children:s.jsx("source",{src:"/videos/sky-clouds.mp4",type:"video/mp4"})}),s.jsx("div",{className:`absolute inset-0 ${e?"bg-black/20":"bg-white/10"}`})]})}const{Title:mk,Text:xk}=Ya,J2=()=>{const[e,t]=x.useState(!1),[r,n]=x.useState(null),o=Pt(),a=Hn(),{login:i}=Id(),{darkMode:l}=nt(),c=async d=>{t(!0),n(null);try{await i(d.email,d.password);const u=a.state?.from?.pathname||"/dashboard";o(u,{replace:!0})}catch(u){console.error("Login error:",u),n(u.response?.data?.detail||"Login failed. Please check your credentials and try again.")}finally{t(!1)}};return s.jsxs("div",{className:"min-h-screen flex items-center justify-center p-5 relative overflow-hidden",children:[s.jsx(zn,{isDark:l}),s.jsx("div",{className:"relative z-10 w-full max-w-md",children:s.jsx("div",{className:`rounded-2xl shadow-2xl overflow-hidden backdrop-blur-md transition-all duration-700 ${l?"bg-[#2d1b4e] backdrop-blur-xl border-2 border-[#8b5cf6] shadow-[0_0_50px_rgba(139,92,246,0.5)]":"bg-white/95 border-2 border-purple-400/30 shadow-xl"}`,children:s.jsx("div",{className:"p-10",children:s.jsxs("div",{className:"flex flex-col gap-6 w-full",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("img",{src:l?"/dark_logo.png":"/logoGT.png",alt:"Logo",className:"h-16 w-16 mx-auto mb-4 transition-transform hover:scale-110 duration-300"}),s.jsx("h1",{className:`text-3xl font-bold mb-2 transition-colors duration-300 ${l?"text-white":"text-gray-900"}`,children:"Secure Portal"}),s.jsx("p",{className:`text-base transition-colors duration-300 ${l?"text-gray-400":"text-gray-600"}`,children:"Sign in to your account"})]}),r&&s.jsx("div",{className:`rounded-lg p-4 border ${l?"bg-red-950/30 border-red-800/50 text-red-200":"bg-red-50 border-red-200 text-red-800"}`,children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("svg",{className:"w-5 h-5 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-semibold",children:"Login Failed"}),s.jsx("p",{className:"text-sm mt-1 opacity-90",children:r})]}),s.jsx("button",{onClick:()=>n(null),className:"text-current opacity-70 hover:opacity-100 transition-opacity",children:s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),s.jsxs(Se,{name:"login",onFinish:c,layout:"vertical",className:"w-full",children:[s.jsx(Se.Item,{name:"email",rules:[{required:!0,message:"Please input your email!"},{type:"email",message:"Please enter a valid email!"}],className:"mb-5",children:s.jsx($e,{prefix:s.jsx(Xa,{className:`text-lg ${l?"text-purple-400":"text-gray-500"}`}),placeholder:"Email",autoComplete:"email",className:`h-12 text-base rounded-lg ${l?"bg-[#1a1525] border-purple-500/50 text-white placeholder:text-purple-300/40 hover:border-purple-500/50 focus:border-purple-500/50 [&_input]:bg-[#1a1525] [&_input]:text-white [&_input::placeholder]:text-purple-300/40 [&_input:focus]:bg-[#1a1525] [&_input:hover]:bg-[#1a1525]":"bg-white border-gray-300 hover:border-purple-400 focus:border-purple-500 focus:shadow-lg focus:shadow-purple-500/10"}`,styles:l?{input:{backgroundColor:"#1a1525 !important",color:"white !important"}}:{},style:{paddingLeft:"40px",...l&&{backgroundColor:"#1a1525"}}})}),s.jsx(Se.Item,{name:"password",rules:[{required:!0,message:"Please input your password!"}],className:"mb-6",children:s.jsx($e.Password,{prefix:s.jsx(_n,{className:`text-lg ${l?"text-purple-400":"text-gray-500"}`}),placeholder:"Password",autoComplete:"current-password",className:`h-12 text-base rounded-lg ${l?"bg-[#1a1525] border-purple-500/50 text-white placeholder:text-purple-300/40 hover:border-purple-500/50 focus:border-purple-500/50 [&_input]:bg-[#1a1525] [&_input]:text-white [&_input::placeholder]:text-purple-300/40 [&_.ant-input-password-icon]:text-purple-400 [&_.ant-input-password-icon]:hover:text-purple-300 [&_input]:tracking-[0.25em] [&_input:focus]:bg-[#1a1525] [&_input:hover]:bg-[#1a1525]":"bg-white border-gray-300 hover:border-purple-400 focus:border-purple-500 focus:shadow-lg focus:shadow-purple-500/10 [&_input]:tracking-[0.15em]"}`,styles:l?{input:{backgroundColor:"#1a1525 !important",color:"white !important"}}:{},style:{paddingLeft:"40px",...l&&{backgroundColor:"#1a1525"}}})}),s.jsxs(Se.Item,{className:"mb-0",children:[s.jsx(He,{type:"primary",htmlType:"submit",loading:e,block:!0,className:`h-12 text-base font-semibold rounded-lg transition-all duration-300 shadow-lg ${l?"bg-purple-600 hover:bg-purple-700 border-purple-600 hover:shadow-purple-600/50 hover:scale-[1.02]":"bg-purple-600 hover:bg-purple-700 hover:shadow-purple-600/40 hover:scale-[1.02]"}`,children:"Sign In"}),s.jsx("div",{className:"text-center mt-4",children:s.jsx(Kt,{to:"/forgot-password",className:`text-sm font-medium transition-colors duration-300 ${l?"text-purple-400 hover:text-purple-300":"text-purple-600 hover:text-purple-700"}`,children:"Forgot Password?"})}),s.jsx("div",{className:"text-center mt-6 pt-6 border-t",style:{borderColor:l?"rgba(139, 92, 246, 0.2)":"rgba(0, 0, 0, 0.1)"},children:s.jsxs("span",{className:`text-sm transition-colors duration-300 ${l?"text-gray-400":"text-gray-600"}`,children:["Don't have an account?"," ",s.jsx(Kt,{to:"/register",className:`font-semibold transition-colors duration-300 ${l?"text-purple-400 hover:text-purple-300":"text-purple-600 hover:text-purple-700"}`,children:"Sign Up"})]})})]})]})]})})})})]})},{Title:Tc,Text:ia}=Ya,Z2=()=>{const[e,t]=x.useState(!1),[r,n]=x.useState(null),[o,a]=x.useState(!1),[i,l]=x.useState(0),c=Pt(),d=p=>{let h=0;return p?(p.length>=8&&(h+=25),p.length>=12&&(h+=15),/[a-z]/.test(p)&&/[A-Z]/.test(p)&&(h+=20),/\d/.test(p)&&(h+=20),/[^A-Za-z0-9]/.test(p)&&(h+=20),Math.min(h,100)):0},u=p=>{const h=p.target.value;l(d(h))},f=()=>i<40?"#ff4d4f":i<70?"#faad14":"#52c41a",g=async p=>{t(!0),n(null);try{const h=await Ne.post("/auth/register",{email:p.email,password:p.password,confirm_password:p.confirm_password,first_name:p.first_name,last_name:p.last_name});a(!0),setTimeout(()=>{c("/login")},3e3)}catch(h){console.error("Registration error:",h);let w="Registration failed. Please try again.";h.response?.data?.detail&&(Array.isArray(h.response.data.detail)?w=h.response.data.detail.map(y=>y.msg||y.message).join(", "):w=h.response.data.detail),n(w)}finally{t(!1)}};return o?s.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px"},children:s.jsx(ir,{style:{width:"100%",maxWidth:450,textAlign:"center"},children:s.jsxs(We,{direction:"vertical",size:"large",children:[s.jsx("div",{style:{fontSize:64,color:"#52c41a"},children:"✓"}),s.jsx(Tc,{level:3,children:"Registration Successful!"}),s.jsx(ia,{children:"Please check your email to verify your account. You will be redirected to login page shortly..."})]})})}):s.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px"},children:s.jsx(ir,{style:{width:"100%",maxWidth:500,boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:s.jsxs(We,{direction:"vertical",size:"large",style:{width:"100%"},children:[s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx(Tc,{level:2,style:{marginBottom:8},children:"Create Account"}),s.jsx(ia,{type:"secondary",children:"Sign up to get started"})]}),r&&s.jsx(Wt,{message:"Registration Failed",description:r,type:"error",showIcon:!0,closable:!0,onClose:()=>n(null)}),s.jsxs(Se,{name:"register",onFinish:g,layout:"vertical",size:"large",children:[s.jsx(Se.Item,{name:"first_name",rules:[{required:!0,message:"Please input your first name!"},{min:2,message:"First name must be at least 2 characters"}],children:s.jsx($e,{prefix:s.jsx(Ti,{}),placeholder:"First Name",autoComplete:"given-name"})}),s.jsx(Se.Item,{name:"last_name",rules:[{required:!0,message:"Please input your last name!"},{min:2,message:"Last name must be at least 2 characters"}],children:s.jsx($e,{prefix:s.jsx(Ti,{}),placeholder:"Last Name",autoComplete:"family-name"})}),s.jsx(Se.Item,{name:"email",rules:[{required:!0,message:"Please input your email!"},{type:"email",message:"Please enter a valid email!"}],children:s.jsx($e,{prefix:s.jsx(Xa,{}),placeholder:"Email",autoComplete:"email"})}),s.jsx(Se.Item,{name:"password",rules:[{required:!0,message:"Please input your password!"},{min:8,message:"Password must be at least 8 characters"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,message:"Password must contain uppercase, lowercase, and number"}],children:s.jsxs("div",{children:[s.jsx($e.Password,{prefix:s.jsx(_n,{}),placeholder:"Password",autoComplete:"new-password",onChange:u}),i>0&&s.jsx(vg,{percent:i,showInfo:!1,strokeColor:f(),style:{marginTop:8}})]})}),s.jsx(Se.Item,{name:"confirm_password",dependencies:["password"],rules:[{required:!0,message:"Please confirm your password!"},({getFieldValue:p})=>({validator(h,w){return!w||p("password")===w?Promise.resolve():Promise.reject(new Error("Passwords do not match!"))}})],children:s.jsx($e.Password,{prefix:s.jsx(_n,{}),placeholder:"Confirm Password",autoComplete:"new-password"})}),s.jsxs(Se.Item,{style:{marginBottom:0},children:[s.jsx(He,{type:"primary",htmlType:"submit",loading:e,block:!0,style:{marginBottom:16},children:"Sign Up"}),s.jsx("div",{style:{textAlign:"center"},children:s.jsxs(ia,{type:"secondary",children:["Already have an account? ",s.jsx(Kt,{to:"/login",children:"Sign In"})]})})]})]})]})})})},G2=()=>{const[e]=tn(),t=Pt(),[r,n]=x.useState("loading"),[o,a]=x.useState("");return x.useEffect(()=>{(async()=>{const l=e.get("token");if(!l){n("error"),a("Invalid verification link. No token provided.");return}try{await Ne.post("/auth/verify-email",{token:l}),n("success"),a("Your email has been verified successfully!")}catch(c){n("error"),a(c.response?.data?.detail||"Email verification failed. The link may be invalid or expired.")}})()},[e]),r==="loading"?s.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:s.jsxs(ir,{style:{width:400,textAlign:"center"},children:[s.jsx(so,{size:"large"}),s.jsx("p",{style:{marginTop:20},children:"Verifying your email..."})]})}):s.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px"},children:s.jsx(ir,{style:{width:"100%",maxWidth:500},children:s.jsx(jg,{status:r==="success"?"success":"error",title:r==="success"?"Email Verified!":"Verification Failed",subTitle:o,extra:[s.jsx(He,{type:"primary",onClick:()=>t("/login"),children:"Go to Login"},"login")]})})})},Q2=()=>{const[e,t]=x.useState(!1),[r,n]=x.useState(null),[o,a]=x.useState(!1),i=Pt(),{darkMode:l}=nt(),[c]=Se.useForm(),d=async u=>{t(!0),n(null);try{await jt.post("/auth/forgot-password",{email:u.email}),a(!0),console.log("✅ Password reset email sent")}catch(f){console.error("Forgot password error:",f),n(f.response?.data?.detail||"Failed to send reset email. Please try again.")}finally{t(!1)}};return o?s.jsxs("div",{className:"min-h-screen flex items-center justify-center p-5 relative overflow-hidden",children:[s.jsx(zn,{isDark:l}),s.jsx("div",{className:"relative z-10 w-full max-w-md",children:s.jsx("div",{className:`rounded-2xl shadow-2xl overflow-hidden backdrop-blur-md transition-all duration-700 ${l?"bg-[#2d1b4e] backdrop-blur-xl border-2 border-green-500 shadow-[0_0_50px_rgba(34,197,94,0.5)]":"bg-white/95 border-2 border-green-400/30 shadow-xl"}`,children:s.jsx("div",{className:"p-10",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-20 h-20 bg-green-500 rounded-full mx-auto mb-6 flex items-center justify-center",children:s.jsx("svg",{className:"w-10 h-10 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),s.jsx("h1",{className:`text-2xl font-bold mb-4 ${l?"text-white":"text-gray-900"}`,children:"Email Inviata!"}),s.jsx("p",{className:`text-base mb-6 ${l?"text-gray-300":"text-gray-600"}`,children:"Se l'email esiste nel nostro sistema, riceverai le istruzioni per reimpostare la tua password."}),s.jsx("div",{className:`p-4 rounded-lg mb-6 ${l?"bg-blue-900/30 border border-blue-500/50":"bg-blue-50 border border-blue-200"}`,children:s.jsxs("p",{className:`text-sm ${l?"text-blue-200":"text-blue-800"}`,children:["💡 ",s.jsx("strong",{children:"Suggerimento:"})," Il link sarà valido per 1 ora. Controlla anche la cartella spam."]})}),s.jsx(He,{type:"primary",onClick:()=>i("/login"),block:!0,className:`h-12 text-base font-semibold rounded-lg transition-all duration-300 shadow-lg ${l?"bg-purple-600 hover:bg-purple-700 border-purple-600":"bg-purple-600 hover:bg-purple-700"}`,children:"Torna al Login"})]})})})})]}):s.jsxs("div",{className:"min-h-screen flex items-center justify-center p-5 relative overflow-hidden",children:[s.jsx(zn,{isDark:l}),s.jsx("div",{className:"relative z-10 w-full max-w-md",children:s.jsx("div",{className:`rounded-2xl shadow-2xl overflow-hidden backdrop-blur-md transition-all duration-700 ${l?"bg-[#2d1b4e] backdrop-blur-xl border-2 border-[#8b5cf6] shadow-[0_0_50px_rgba(139,92,246,0.5)]":"bg-white/95 border-2 border-purple-400/30 shadow-xl"}`,children:s.jsx("div",{className:"p-10",children:s.jsxs("div",{className:"flex flex-col gap-6 w-full",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-20 h-20 bg-purple-600 rounded-full mx-auto mb-4 flex items-center justify-center",children:s.jsx("svg",{className:"w-10 h-10 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),s.jsx("h1",{className:`text-3xl font-bold mb-2 transition-colors duration-300 ${l?"text-white":"text-gray-900"}`,children:"Recupero Password"}),s.jsx("p",{className:`text-base transition-colors duration-300 ${l?"text-gray-400":"text-gray-600"}`,children:"Inserisci la tua email per ricevere le istruzioni"})]}),r&&s.jsx("div",{className:`rounded-lg p-4 border ${l?"bg-red-950/30 border-red-800/50 text-red-200":"bg-red-50 border-red-200 text-red-800"}`,children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("svg",{className:"w-5 h-5 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-semibold",children:"Error"}),s.jsx("p",{className:"text-sm mt-1 opacity-90",children:r})]}),s.jsx("button",{onClick:()=>n(null),className:"text-current opacity-70 hover:opacity-100 transition-opacity",children:s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),s.jsxs(Se,{form:c,name:"forgot-password",onFinish:d,layout:"vertical",className:"w-full",children:[s.jsx(Se.Item,{name:"email",rules:[{required:!0,message:"Please input your email!"},{type:"email",message:"Please enter a valid email!"}],className:"mb-6",children:s.jsx($e,{prefix:s.jsx(Xa,{className:`text-lg ${l?"text-purple-400":"text-gray-500"}`}),placeholder:"Email",autoComplete:"email",className:`h-12 text-base rounded-lg ${l?"bg-[#1a1525] border-purple-500/50 text-white placeholder:text-purple-300/40 [&_input]:bg-[#1a1525] [&_input]:text-white":"bg-white border-gray-300"}`})}),s.jsxs(Se.Item,{className:"mb-0",children:[s.jsx(He,{type:"primary",htmlType:"submit",loading:e,block:!0,className:`h-12 text-base font-semibold rounded-lg transition-all duration-300 shadow-lg ${l?"bg-purple-600 hover:bg-purple-700 border-purple-600 hover:shadow-purple-600/50 hover:scale-[1.02]":"bg-purple-600 hover:bg-purple-700 hover:shadow-purple-600/40 hover:scale-[1.02]"}`,children:"Invia Email di Recupero"}),s.jsx("div",{className:"text-center mt-6",children:s.jsx(Kt,{to:"/login",className:`text-sm font-medium transition-colors duration-300 ${l?"text-purple-400 hover:text-purple-300":"text-purple-600 hover:text-purple-700"}`,children:"← Torna al Login"})})]})]})]})})})})]})},ej=()=>{const[e,t]=x.useState(!1),[r,n]=x.useState(null),[o,a]=x.useState(!1),i=Pt(),{darkMode:l}=nt(),[c]=tn(),[d]=Se.useForm(),u=c.get("token");x.useEffect(()=>{u||n("Token mancante o non valido")},[u]);const f=async g=>{if(!u){n("Token mancante");return}t(!0),n(null);try{await jt.post("/auth/reset-password",{token:u,new_password:g.password}),a(!0),console.log("✅ Password reset successful"),setTimeout(()=>{i("/login")},3e3)}catch(p){console.error("Reset password error:",p),n(p.response?.data?.detail||"Failed to reset password. The link may be expired or invalid.")}finally{t(!1)}};return o?s.jsxs("div",{className:"min-h-screen flex items-center justify-center p-5 relative overflow-hidden",children:[s.jsx(zn,{isDark:l}),s.jsx("div",{className:"relative z-10 w-full max-w-md",children:s.jsx("div",{className:`rounded-2xl shadow-2xl overflow-hidden backdrop-blur-md transition-all duration-700 ${l?"bg-[#2d1b4e] backdrop-blur-xl border-2 border-green-500 shadow-[0_0_50px_rgba(34,197,94,0.5)]":"bg-white/95 border-2 border-green-400/30 shadow-xl"}`,children:s.jsx("div",{className:"p-10",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-20 h-20 bg-green-500 rounded-full mx-auto mb-6 flex items-center justify-center",children:s.jsx("svg",{className:"w-10 h-10 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h1",{className:`text-2xl font-bold mb-4 ${l?"text-white":"text-gray-900"}`,children:"Password Reimpostata!"}),s.jsx("p",{className:`text-base mb-6 ${l?"text-gray-300":"text-gray-600"}`,children:"La tua password è stata reimpostata con successo. Ora puoi effettuare il login con la nuova password."}),s.jsx("p",{className:`text-sm ${l?"text-gray-400":"text-gray-500"}`,children:"Verrai reindirizzato al login tra pochi secondi..."})]})})})})]}):s.jsxs("div",{className:"min-h-screen flex items-center justify-center p-5 relative overflow-hidden",children:[s.jsx(zn,{isDark:l}),s.jsx("div",{className:"relative z-10 w-full max-w-md",children:s.jsx("div",{className:`rounded-2xl shadow-2xl overflow-hidden backdrop-blur-md transition-all duration-700 ${l?"bg-[#2d1b4e] backdrop-blur-xl border-2 border-[#8b5cf6] shadow-[0_0_50px_rgba(139,92,246,0.5)]":"bg-white/95 border-2 border-purple-400/30 shadow-xl"}`,children:s.jsx("div",{className:"p-10",children:s.jsxs("div",{className:"flex flex-col gap-6 w-full",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-20 h-20 bg-purple-600 rounded-full mx-auto mb-4 flex items-center justify-center",children:s.jsx("svg",{className:"w-10 h-10 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),s.jsx("h1",{className:`text-3xl font-bold mb-2 transition-colors duration-300 ${l?"text-white":"text-gray-900"}`,children:"Nuova Password"}),s.jsx("p",{className:`text-base transition-colors duration-300 ${l?"text-gray-400":"text-gray-600"}`,children:"Inserisci la tua nuova password"})]}),r&&s.jsx("div",{className:`rounded-lg p-4 border ${l?"bg-red-950/30 border-red-800/50 text-red-200":"bg-red-50 border-red-200 text-red-800"}`,children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("svg",{className:"w-5 h-5 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-semibold",children:"Error"}),s.jsx("p",{className:"text-sm mt-1 opacity-90",children:r})]}),s.jsx("button",{onClick:()=>n(null),className:"text-current opacity-70 hover:opacity-100 transition-opacity",children:s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),s.jsxs(Se,{form:d,name:"reset-password",onFinish:f,layout:"vertical",className:"w-full",children:[s.jsx(Se.Item,{name:"password",rules:[{required:!0,message:"Please input your new password!"},{min:8,message:"Password must be at least 8 characters!"}],className:"mb-4",children:s.jsx($e.Password,{prefix:s.jsx(_n,{className:`text-lg ${l?"text-purple-400":"text-gray-500"}`}),placeholder:"New Password",autoComplete:"new-password",className:`h-12 text-base rounded-lg ${l?"bg-[#1a1525] border-purple-500/50 text-white placeholder:text-purple-300/40 [&_input]:bg-[#1a1525] [&_input]:text-white":"bg-white border-gray-300"}`})}),s.jsx(Se.Item,{name:"confirmPassword",dependencies:["password"],rules:[{required:!0,message:"Please confirm your password!"},({getFieldValue:g})=>({validator(p,h){return!h||g("password")===h?Promise.resolve():Promise.reject(new Error("Passwords do not match!"))}})],className:"mb-6",children:s.jsx($e.Password,{prefix:s.jsx(_n,{className:`text-lg ${l?"text-purple-400":"text-gray-500"}`}),placeholder:"Confirm New Password",autoComplete:"new-password",className:`h-12 text-base rounded-lg ${l?"bg-[#1a1525] border-purple-500/50 text-white placeholder:text-purple-300/40 [&_input]:bg-[#1a1525] [&_input]:text-white":"bg-white border-gray-300"}`})}),s.jsx(Se.Item,{className:"mb-0",children:s.jsx(He,{type:"primary",htmlType:"submit",loading:e,disabled:!u,block:!0,className:`h-12 text-base font-semibold rounded-lg transition-all duration-300 shadow-lg ${l?"bg-purple-600 hover:bg-purple-700 border-purple-600 hover:shadow-purple-600/50 hover:scale-[1.02]":"bg-purple-600 hover:bg-purple-700 hover:shadow-purple-600/40 hover:scale-[1.02]"}`,children:"Reimposta Password"})})]})]})})})})]})},{Title:tj,Text:pn,Paragraph:la}=Ya;function rj(){const[e]=tn();Pt();const t=e.get("token"),[r,n]=x.useState(!0),[o,a]=x.useState(!1),[i,l]=x.useState(null),[c,d]=x.useState(null),[u,f]=x.useState(!1),[g,p]=x.useState(null),[h,w]=x.useState(null),[y]=Se.useForm();x.useEffect(()=>{if(!t){d("Token mancante nell'URL"),n(!1);return}b(t)},[t]);const b=async k=>{try{n(!0);const C=Nc(),A=await Be.get(`${C}/api/workflow-approval/validate-token/${k}`);if(A.data.valid)if(l(A.data),A.data.form_fields&&A.data.form_fields.length>0){const T={};A.data.form_fields.forEach(O=>{T[O.name]=O.currentValue||""}),T.rejection_comment="",y.setFieldsValue(T)}else y.setFieldsValue({rejection_comment:""});else d(A.data.error||"Token non valido")}catch(C){console.error("Errore validazione token:",C),d(C.response?.data?.detail||"Errore durante la validazione del token")}finally{n(!1)}},S=async(k,C=!0,A)=>{if(t)try{a(!0),d(null);const T=Nc();(await Be.post(`${T}/api/workflow-approval/submit-approval`,{token:t,approved:C,submitted_values:k,rejection_reason:C?void 0:A})).data.success&&(f(!0),p(C?"approved":"rejected"),w(C?null:A||null),y.resetFields())}catch(T){console.error("Errore submit:",T),d(T.response?.data?.detail||"Errore durante l'invio")}finally{a(!1)}},m=()=>{y.setFields([{name:"rejection_comment",errors:[]}]),y.validateFields().then(k=>{const{rejection_comment:C,...A}=k;S(A,!0)}).catch(k=>{console.error("Errori di validazione:",k)})},v=()=>{const k=y.getFieldValue("rejection_comment"),C=typeof k=="string"?k.trim():"";if(!C){y.setFields([{name:"rejection_comment",errors:["Fornisci una motivazione per il rifiuto"]}]);return}const A=y.getFieldsValue(),{rejection_comment:T,...O}=A;S(O,!1,C)},j=k=>k.split("_").map(C=>C.charAt(0).toUpperCase()+C.slice(1)).join(" ");return r?s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:s.jsxs(We,{direction:"vertical",align:"center",size:"large",children:[s.jsx(so,{size:"large"}),s.jsx(pn,{type:"secondary",children:"Caricamento in corso..."})]})}):c?s.jsx("div",{style:{maxWidth:600,margin:"50px auto",padding:"0 20px"},children:s.jsx(ir,{children:s.jsxs(We,{direction:"vertical",style:{width:"100%"},size:"large",children:[s.jsx("div",{style:{textAlign:"center"},children:s.jsx(As,{style:{fontSize:64,color:"#ff4d4f"}})}),s.jsx(Wt,{message:"Link non valido",description:c,type:"error",showIcon:!0}),s.jsx(la,{type:"secondary",style:{textAlign:"center"},children:"Il link potrebbe essere scaduto, già utilizzato o non valido. Contatta l'amministratore se ritieni sia un errore."})]})})}):u?s.jsx("div",{style:{maxWidth:600,margin:"50px auto",padding:"0 20px"},children:s.jsx(ir,{children:s.jsxs(We,{direction:"vertical",style:{width:"100%"},size:"large",children:[s.jsx("div",{style:{textAlign:"center"},children:s.jsx(Ps,{style:{fontSize:64,color:g==="rejected"?"#faad14":"#52c41a"}})}),s.jsx(Wt,{message:g==="rejected"?"Rifiuto registrato":"Operazione completata con successo!",description:g==="rejected"?"Il workflow è stato contrassegnato come fallito e il richiedente è stato avvisato.":"La tua conferma è stata registrata e il workflow riprenderà l'esecuzione.",type:g==="rejected"?"warning":"success",showIcon:!0}),g==="rejected"&&h&&s.jsxs(la,{children:[s.jsx(pn,{strong:!0,children:"Motivazione fornita:"}),s.jsx("br",{}),s.jsx(pn,{children:h})]}),s.jsx(la,{style:{textAlign:"center"},children:"Puoi chiudere questa pagina."})]})})}):s.jsx("div",{style:{maxWidth:700,margin:"50px auto",padding:"0 20px"},children:s.jsx(ir,{children:s.jsxs(We,{direction:"vertical",style:{width:"100%"},size:"large",children:[s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx(zr,{style:{fontSize:48,color:"#1890ff",marginBottom:16}}),s.jsx(tj,{level:3,style:{marginBottom:8},children:i&&j(i.action_type)}),s.jsx(pn,{type:"secondary",children:"È richiesta la tua approvazione per procedere"})]}),i?.metadata&&Object.keys(i.metadata).length>0&&s.jsx(ir,{type:"inner",title:"Informazioni",size:"small",children:s.jsx(vt,{column:1,size:"small",children:Object.entries(i.metadata).map(([k,C])=>s.jsx(vt.Item,{label:k.replace(/_/g," ").replace(/\b\w/g,A=>A.toUpperCase()),children:typeof C=="object"?JSON.stringify(C):String(C)},k))})}),i?.form_fields&&i.form_fields.length>0?s.jsxs(s.Fragment,{children:[s.jsx(Wt,{message:"Compila i seguenti campi",description:"I campi contrassegnati con * sono obbligatori",type:"info",showIcon:!0}),s.jsxs(Se,{form:y,layout:"vertical",autoComplete:"off",children:[i.form_fields.map(k=>{const C=!k.editable;return s.jsx(Se.Item,{name:k.name,label:k.label,rules:[{required:k.required&&k.editable,message:`${k.label} è obbligatorio`}],tooltip:C?"Questo campo è di sola lettura":void 0,children:k.type==="textarea"?s.jsx($e.TextArea,{rows:4,disabled:C,placeholder:C?"":`Inserisci ${k.label.toLowerCase()}`}):k.type==="select"&&k.options?s.jsxs("select",{className:"ant-input",disabled:C,style:{width:"100%",padding:"4px 11px"},children:[s.jsx("option",{value:"",children:"Seleziona..."}),k.options.map(A=>s.jsx("option",{value:A,children:A},A))]}):s.jsx($e,{disabled:C,placeholder:C?"":`Inserisci ${k.label.toLowerCase()}`})},k.name)}),s.jsx(Se.Item,{name:"rejection_comment",label:"Motivazione del rifiuto",extra:"Questo campo è obbligatorio solo in caso di rifiuto.",children:s.jsx($e.TextArea,{rows:4,placeholder:"Spiega brevemente il motivo del rifiuto",disabled:o,onChange:()=>{y.getFieldError("rejection_comment").length&&y.setFields([{name:"rejection_comment",errors:[]}])}})}),s.jsx(Se.Item,{style:{marginTop:24},children:s.jsxs(We,{direction:"vertical",style:{width:"100%"},size:"middle",children:[s.jsx(He,{type:"primary",size:"large",block:!0,loading:o,onClick:m,children:o?"Invio in corso...":"Conferma e Approva"}),s.jsx(He,{danger:!0,size:"large",block:!0,loading:o,onClick:v,children:o?"Invio in corso...":"Rifiuta"})]})})]})]}):s.jsxs(s.Fragment,{children:[s.jsx(Wt,{message:"Azione richiesta",description:"Clicca uno dei pulsanti qui sotto per approvare o rifiutare",type:"info",showIcon:!0}),s.jsxs(Se,{form:y,layout:"vertical",autoComplete:"off",children:[s.jsx(Se.Item,{name:"rejection_comment",label:"Motivazione del rifiuto",extra:"Questo campo è obbligatorio solo in caso di rifiuto.",children:s.jsx($e.TextArea,{rows:4,placeholder:"Spiega brevemente il motivo del rifiuto",disabled:o,onChange:()=>{y.getFieldError("rejection_comment").length&&y.setFields([{name:"rejection_comment",errors:[]}])}})}),s.jsx(Se.Item,{children:s.jsxs(We,{direction:"vertical",style:{width:"100%"},size:"middle",children:[s.jsx(He,{type:"primary",size:"large",block:!0,loading:o,onClick:m,children:o?"Invio in corso...":"Approva"}),s.jsx(He,{danger:!0,size:"large",block:!0,loading:o,onClick:v,children:o?"Invio in corso...":"Rifiuta"})]})})]})]}),s.jsx("div",{style:{textAlign:"center",marginTop:16},children:s.jsxs(pn,{type:"secondary",style:{fontSize:12},children:["Questo link scadrà il ",i&&new Date(i.expires_at).toLocaleString("it-IT")]})})]})})})}const nj=()=>{const e=Pt(),t=Hn();return x.useEffect(()=>{const r=new URLSearchParams(t.search),n=r.get("path"),o=r.get("token");n?e(`/${n}${t.search}`,{replace:!0}):o?e(`/workflow-action${t.search}`,{replace:!0}):e("/login",{replace:!0})},[e,t]),s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:s.jsx("div",{children:"Loading..."})})},St=e=>s.jsx(Md,{children:e}),sj=()=>s.jsx(om,{children:s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Pagina non trovata"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"La pagina che stai cercando non esiste."}),s.jsx("button",{onClick:()=>window.location.href="/login",className:"mt-4 px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition",children:"Torna alla Home"})]})})}),oj=()=>{const[e,t]=x.useState(()=>typeof window<"u"?window.innerWidth<768:!1);return x.useEffect(()=>{function r(){t(window.innerWidth<768)}return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),s.jsx(lg,{children:s.jsxs(cg,{children:[s.jsx(Ge,{path:"/login",element:St(s.jsx(J2,{}))}),s.jsx(Ge,{path:"/register",element:St(s.jsx(Z2,{}))}),s.jsx(Ge,{path:"/verify-email",element:St(s.jsx(G2,{}))}),s.jsx(Ge,{path:"/forgot-password",element:St(s.jsx(Q2,{}))}),s.jsx(Ge,{path:"/reset-password",element:St(s.jsx(ej,{}))}),s.jsx(Ge,{path:"/workflow-action",element:St(s.jsx(rj,{}))}),s.jsx(Ge,{path:"/payment/confirm/:paymentId",element:St(s.jsx(Ec,{}))}),s.jsx(Ge,{path:"/payment-confirm",element:St(s.jsx(Ec,{}))}),s.jsx(Ge,{path:"/payment-reset",element:St(s.jsx(Y2,{}))}),'import RootDispatcher from "../pages/RootDispatcher"; // ... (altro codice) // ... (altro codice)',s.jsx(Ge,{path:"/payment/:paymentId/verify-email",element:St(s.jsx(X2,{}))}),s.jsx(Ge,{path:"/",element:St(s.jsx(nj,{}))}),s.jsx(Ge,{path:"/dashboard",element:s.jsxs("div",{className:"relative min-h-screen bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 flex flex-col",children:[s.jsx("div",{className:"sticky top-0 z-30 bg-white dark:bg-gray-950 shadow-sm dark:shadow-gray-900/50",children:s.jsx(or,{isMobile:e})}),s.jsx("main",{className:"flex-1 w-full px-2 py-2 md:px-4 md:py-4 overflow-auto",style:{minHeight:0},children:s.jsx(gr,{requireDesigner:!0,children:s.jsx(Yh,{isMobile:e})})})]})}),s.jsx(Ge,{path:"/users",element:s.jsxs("div",{className:"relative min-h-screen bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 flex flex-col",children:[s.jsx("div",{className:"sticky top-0 z-30 bg-white dark:bg-gray-950 shadow-sm dark:shadow-gray-900/50",children:s.jsx(or,{isMobile:e})}),s.jsx("main",{className:"flex-1 w-full px-2 py-2 md:px-4 md:py-4 overflow-auto",style:{minHeight:0},children:s.jsx(gr,{children:s.jsx(vh,{isMobile:e})})})]})}),s.jsx(Ge,{path:"/workflows",element:s.jsxs("div",{className:"relative min-h-screen bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 flex flex-col",children:[s.jsx("div",{className:"sticky top-0 z-30 bg-white dark:bg-gray-950 shadow-sm dark:shadow-gray-900/50",children:s.jsx(or,{isMobile:e})}),s.jsx("main",{className:"flex-1 w-full px-2 py-2 md:px-4 md:py-4 overflow-auto",style:{minHeight:0},children:s.jsx(gr,{requireDesigner:!0,children:s.jsx(L2,{isMobile:e})})})]})}),s.jsx(Ge,{path:"/workflow-execution",element:s.jsxs("div",{className:"relative min-h-screen bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 flex flex-col",children:[s.jsx("div",{className:"sticky top-0 z-30 bg-white dark:bg-gray-950 shadow-sm dark:shadow-gray-900/50",children:s.jsx(or,{isMobile:e})}),s.jsx("main",{className:"flex-1 w-full px-2 py-2 md:px-4 md:py-4 overflow-auto",style:{minHeight:0},children:s.jsx(gr,{children:s.jsx(K2,{})})})]})}),s.jsx(Ge,{path:"/forms",element:s.jsxs("div",{className:"relative min-h-screen bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 flex flex-col",children:[s.jsx("div",{className:"sticky top-0 z-30 bg-white dark:bg-gray-950 shadow-sm dark:shadow-gray-900/50",children:s.jsx(or,{isMobile:e})}),s.jsx("main",{className:"flex-1 w-full px-2 py-2 md:px-4 md:py-4 overflow-auto",style:{minHeight:0},children:s.jsx(gr,{requireDesigner:!0,children:s.jsx(D2,{})})})]})}),s.jsx(Ge,{path:"/settings",element:s.jsxs("div",{className:"relative min-h-screen bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 flex flex-col",children:[s.jsx("div",{className:"sticky top-0 z-30 bg-white dark:bg-gray-950 shadow-sm dark:shadow-gray-900/50",children:s.jsx(or,{isMobile:e})}),s.jsx("main",{className:"flex-1 w-full px-2 py-2 md:px-4 md:py-4 overflow-auto",style:{minHeight:0},children:s.jsx(gr,{requireDesigner:!0,children:s.jsx(z2,{isMobile:e})})})]})}),s.jsx(Ge,{path:"/profile",element:s.jsxs("div",{className:"relative min-h-screen bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 flex flex-col",children:[s.jsx("div",{className:"sticky top-0 z-30 bg-white dark:bg-gray-950 shadow-sm dark:shadow-gray-900/50",children:s.jsx(or,{isMobile:e})}),s.jsx("main",{className:"flex-1 w-full px-2 py-2 md:px-4 md:py-4 overflow-auto",style:{minHeight:0},children:s.jsx(gr,{children:s.jsx(U2,{})})})]})}),s.jsx(Ge,{path:"*",element:s.jsx(sj,{})})]})})};function aj({children:e}){const[t,r]=x.useState(null);return x.useEffect(()=>{const n=o=>{o?.reason&&r(o.reason.message||JSON.stringify(o.reason))};return window.addEventListener("unhandledrejection",n),()=>window.removeEventListener("unhandledrejection",n)},[]),s.jsxs(s.Fragment,{children:[t&&s.jsxs("div",{style:{background:"red",color:"white",padding:10,zIndex:9999,position:"fixed",top:0,left:0,right:0},children:[s.jsx("b",{children:"Errore API:"})," ",t]}),e]})}function ij(){const[e,t]=x.useState(()=>typeof window<"u"?window.innerWidth<768:!1);return x.useEffect(()=>{function r(){t(window.innerWidth<768)}return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),s.jsx(Md,{children:s.jsx(aj,{children:s.jsx(C2,{children:s.jsx(yh,{children:s.jsx(bh,{children:s.jsx(Sd,{children:s.jsx(oj,{})})})})})})})}typeof window<"u"&&("serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(function(e){for(const t of e)t.unregister().then(()=>{console.log("🔥 Service worker unregistered")})}),"caches"in window&&caches.keys().then(function(e){for(const t of e)caches.delete(t).then(()=>{console.log(`🗑️ Cache '${t}' deleted`)})}));function rt(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var lj=typeof Symbol=="function"&&Symbol.observable||"@@observable",Ac=lj,ca=()=>Math.random().toString(36).substring(7).split("").join("."),cj={INIT:`@@redux/INIT${ca()}`,REPLACE:`@@redux/REPLACE${ca()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${ca()}`},Qs=cj;function wi(e){if(typeof e!="object"||e===null)return!1;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||Object.getPrototypeOf(e)===null}function Mf(e,t,r){if(typeof e!="function")throw new Error(rt(2));if(typeof t=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(rt(0));if(typeof t=="function"&&typeof r>"u"&&(r=t,t=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(rt(1));return r(Mf)(e,t)}let n=e,o=t,a=new Map,i=a,l=0,c=!1;function d(){i===a&&(i=new Map,a.forEach((y,b)=>{i.set(b,y)}))}function u(){if(c)throw new Error(rt(3));return o}function f(y){if(typeof y!="function")throw new Error(rt(4));if(c)throw new Error(rt(5));let b=!0;d();const S=l++;return i.set(S,y),function(){if(b){if(c)throw new Error(rt(6));b=!1,d(),i.delete(S),a=null}}}function g(y){if(!wi(y))throw new Error(rt(7));if(typeof y.type>"u")throw new Error(rt(8));if(typeof y.type!="string")throw new Error(rt(17));if(c)throw new Error(rt(9));try{c=!0,o=n(o,y)}finally{c=!1}return(a=i).forEach(S=>{S()}),y}function p(y){if(typeof y!="function")throw new Error(rt(10));n=y,g({type:Qs.REPLACE})}function h(){const y=f;return{subscribe(b){if(typeof b!="object"||b===null)throw new Error(rt(11));function S(){const v=b;v.next&&v.next(u())}return S(),{unsubscribe:y(S)}},[Ac](){return this}}}return g({type:Qs.INIT}),{dispatch:g,subscribe:f,getState:u,replaceReducer:p,[Ac]:h}}function dj(e){Object.keys(e).forEach(t=>{const r=e[t];if(typeof r(void 0,{type:Qs.INIT})>"u")throw new Error(rt(12));if(typeof r(void 0,{type:Qs.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(rt(13))})}function uj(e){const t=Object.keys(e),r={};for(let a=0;a<t.length;a++){const i=t[a];typeof e[i]=="function"&&(r[i]=e[i])}const n=Object.keys(r);let o;try{dj(r)}catch(a){o=a}return function(i={},l){if(o)throw o;let c=!1;const d={};for(let u=0;u<n.length;u++){const f=n[u],g=r[f],p=i[f],h=g(p,l);if(typeof h>"u")throw l&&l.type,new Error(rt(14));d[f]=h,c=c||h!==p}return c=c||n.length!==Object.keys(i).length,c?d:i}}function eo(...e){return e.length===0?t=>t:e.length===1?e[0]:e.reduce((t,r)=>(...n)=>t(r(...n)))}function fj(...e){return t=>(r,n)=>{const o=t(r,n);let a=()=>{throw new Error(rt(15))};const i={getState:o.getState,dispatch:(c,...d)=>a(c,...d)},l=e.map(c=>c(i));return a=eo(...l)(o.dispatch),{...o,dispatch:a}}}function gj(e){return wi(e)&&"type"in e&&typeof e.type=="string"}var Of=Symbol.for("immer-nothing"),Pc=Symbol.for("immer-draftable"),yt=Symbol.for("immer-state");function Tt(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var en=Object.getPrototypeOf;function Er(e){return!!e&&!!e[yt]}function Zt(e){return e?Df(e)||Array.isArray(e)||!!e[Pc]||!!e.constructor?.[Pc]||_o(e)||Eo(e):!1}var pj=Object.prototype.constructor.toString();function Df(e){if(!e||typeof e!="object")return!1;const t=en(e);if(t===null)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===pj}function to(e,t){Co(e)===0?Reflect.ownKeys(e).forEach(r=>{t(r,e[r],e)}):e.forEach((r,n)=>t(n,r,e))}function Co(e){const t=e[yt];return t?t.type_:Array.isArray(e)?1:_o(e)?2:Eo(e)?3:0}function Ba(e,t){return Co(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function zf(e,t,r){const n=Co(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function hj(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function _o(e){return e instanceof Map}function Eo(e){return e instanceof Set}function hr(e){return e.copy_||e.base_}function Ha(e,t){if(_o(e))return new Map(e);if(Eo(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const r=Df(e);if(t===!0||t==="class_only"&&!r){const n=Object.getOwnPropertyDescriptors(e);delete n[yt];let o=Reflect.ownKeys(n);for(let a=0;a<o.length;a++){const i=o[a],l=n[i];l.writable===!1&&(l.writable=!0,l.configurable=!0),(l.get||l.set)&&(n[i]={configurable:!0,writable:!0,enumerable:l.enumerable,value:e[i]})}return Object.create(en(e),n)}else{const n=en(e);if(n!==null&&r)return{...e};const o=Object.create(n);return Object.assign(o,e)}}function vi(e,t=!1){return To(e)||Er(e)||!Zt(e)||(Co(e)>1&&(e.set=e.add=e.clear=e.delete=mj),Object.freeze(e),t&&Object.entries(e).forEach(([r,n])=>vi(n,!0))),e}function mj(){Tt(2)}function To(e){return Object.isFrozen(e)}var xj={};function Tr(e){const t=xj[e];return t||Tt(0,e),t}var Un;function Uf(){return Un}function yj(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Lc(e,t){t&&(Tr("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function Va(e){Wa(e),e.drafts_.forEach(bj),e.drafts_=null}function Wa(e){e===Un&&(Un=e.parent_)}function Fc(e){return Un=yj(Un,e)}function bj(e){const t=e[yt];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function $c(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return e!==void 0&&e!==r?(r[yt].modified_&&(Va(t),Tt(4)),Zt(e)&&(e=ro(t,e),t.parent_||no(t,e)),t.patches_&&Tr("Patches").generateReplacementPatches_(r[yt].base_,e,t.patches_,t.inversePatches_)):e=ro(t,r,[]),Va(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==Of?e:void 0}function ro(e,t,r){if(To(t))return t;const n=t[yt];if(!n)return to(t,(o,a)=>Rc(e,n,t,o,a,r)),t;if(n.scope_!==e)return t;if(!n.modified_)return no(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const o=n.copy_;let a=o,i=!1;n.type_===3&&(a=new Set(o),o.clear(),i=!0),to(a,(l,c)=>Rc(e,n,o,l,c,r,i)),no(e,o,!1),r&&e.patches_&&Tr("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function Rc(e,t,r,n,o,a,i){if(Er(o)){const l=a&&t&&t.type_!==3&&!Ba(t.assigned_,n)?a.concat(n):void 0,c=ro(e,o,l);if(zf(r,n,c),Er(c))e.canAutoFreeze_=!1;else return}else i&&r.add(o);if(Zt(o)&&!To(o)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;ro(e,o),(!t||!t.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,n)&&no(e,o)}}function no(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&vi(t,r)}function wj(e,t){const r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:Uf(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let o=n,a=ji;r&&(o=[n],a=Bn);const{revoke:i,proxy:l}=Proxy.revocable(o,a);return n.draft_=l,n.revoke_=i,l}var ji={get(e,t){if(t===yt)return e;const r=hr(e);if(!Ba(r,t))return vj(e,r,t);const n=r[t];return e.finalized_||!Zt(n)?n:n===da(e.base_,t)?(ua(e),e.copy_[t]=Ka(n,e)):n},has(e,t){return t in hr(e)},ownKeys(e){return Reflect.ownKeys(hr(e))},set(e,t,r){const n=Bf(hr(e),t);if(n?.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){const o=da(hr(e),t),a=o?.[yt];if(a&&a.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(hj(r,o)&&(r!==void 0||Ba(e.base_,t)))return!0;ua(e),qa(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return da(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,ua(e),qa(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=hr(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){Tt(11)},getPrototypeOf(e){return en(e.base_)},setPrototypeOf(){Tt(12)}},Bn={};to(ji,(e,t)=>{Bn[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});Bn.deleteProperty=function(e,t){return Bn.set.call(this,e,t,void 0)};Bn.set=function(e,t,r){return ji.set.call(this,e[0],t,r,e[0])};function da(e,t){const r=e[yt];return(r?hr(r):e)[t]}function vj(e,t,r){const n=Bf(t,r);return n?"value"in n?n.value:n.get?.call(e.draft_):void 0}function Bf(e,t){if(!(t in e))return;let r=en(e);for(;r;){const n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=en(r)}}function qa(e){e.modified_||(e.modified_=!0,e.parent_&&qa(e.parent_))}function ua(e){e.copy_||(e.copy_=Ha(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var jj=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){const a=r;r=t;const i=this;return function(c=a,...d){return i.produce(c,u=>r.call(this,u,...d))}}typeof r!="function"&&Tt(6),n!==void 0&&typeof n!="function"&&Tt(7);let o;if(Zt(t)){const a=Fc(this),i=Ka(t,void 0);let l=!0;try{o=r(i),l=!1}finally{l?Va(a):Wa(a)}return Lc(a,n),$c(o,a)}else if(!t||typeof t!="object"){if(o=r(t),o===void 0&&(o=t),o===Of&&(o=void 0),this.autoFreeze_&&vi(o,!0),n){const a=[],i=[];Tr("Patches").generateReplacementPatches_(t,o,a,i),n(a,i)}return o}else Tt(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(i,...l)=>this.produceWithPatches(i,c=>t(c,...l));let n,o;return[this.produce(t,r,(i,l)=>{n=i,o=l}),n,o]},typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof e?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){Zt(e)||Tt(8),Er(e)&&(e=kj(e));const t=Fc(this),r=Ka(e,void 0);return r[yt].isManual_=!0,Wa(t),r}finishDraft(e,t){const r=e&&e[yt];(!r||!r.isManual_)&&Tt(9);const{scope_:n}=r;return Lc(n,t),$c(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const o=t[r];if(o.path.length===0&&o.op==="replace"){e=o.value;break}}r>-1&&(t=t.slice(r+1));const n=Tr("Patches").applyPatches_;return Er(e)?n(e,t):this.produce(e,o=>n(o,t))}};function Ka(e,t){const r=_o(e)?Tr("MapSet").proxyMap_(e,t):Eo(e)?Tr("MapSet").proxySet_(e,t):wj(e,t);return(t?t.scope_:Uf()).drafts_.push(r),r}function kj(e){return Er(e)||Tt(10,e),Hf(e)}function Hf(e){if(!Zt(e)||To(e))return e;const t=e[yt];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=Ha(e,t.scope_.immer_.useStrictShallowCopy_)}else r=Ha(e,!0);return to(r,(n,o)=>{zf(r,n,Hf(o))}),t&&(t.finalized_=!1),r}var bt=new jj,Vf=bt.produce;bt.produceWithPatches.bind(bt);bt.setAutoFreeze.bind(bt);bt.setUseStrictShallowCopy.bind(bt);bt.applyPatches.bind(bt);bt.createDraft.bind(bt);bt.finishDraft.bind(bt);function Wf(e){return({dispatch:r,getState:n})=>o=>a=>typeof a=="function"?a(r,n,e):o(a)}var Nj=Wf(),Sj=Wf,Cj=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?eo:eo.apply(null,arguments)};function Ic(e,t){function r(...n){if(t){let o=t(...n);if(!o)throw new Error(Xt(0));return{type:e,payload:o.payload,..."meta"in o&&{meta:o.meta},..."error"in o&&{error:o.error}}}return{type:e,payload:n[0]}}return r.toString=()=>`${e}`,r.type=e,r.match=n=>gj(n)&&n.type===e,r}var qf=class bn extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,bn.prototype)}static get[Symbol.species](){return bn}concat(...t){return super.concat.apply(this,t)}prepend(...t){return t.length===1&&Array.isArray(t[0])?new bn(...t[0].concat(this)):new bn(...t.concat(this))}};function Mc(e){return Zt(e)?Vf(e,()=>{}):e}function bs(e,t,r){return e.has(t)?e.get(t):e.set(t,r(t)).get(t)}function _j(e){return typeof e=="boolean"}var Ej=()=>function(t){const{thunk:r=!0,immutableCheck:n=!0,serializableCheck:o=!0,actionCreatorCheck:a=!0}=t??{};let i=new qf;return r&&(_j(r)?i.push(Nj):i.push(Sj(r.extraArgument))),i},Tj="RTK_autoBatch",Oc=e=>t=>{setTimeout(t,e)},Aj=(e={type:"raf"})=>t=>(...r)=>{const n=t(...r);let o=!0,a=!1,i=!1;const l=new Set,c=e.type==="tick"?queueMicrotask:e.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:Oc(10):e.type==="callback"?e.queueNotification:Oc(e.timeout),d=()=>{i=!1,a&&(a=!1,l.forEach(u=>u()))};return Object.assign({},n,{subscribe(u){const f=()=>o&&u(),g=n.subscribe(f);return l.add(u),()=>{g(),l.delete(u)}},dispatch(u){try{return o=!u?.meta?.[Tj],a=!o,a&&(i||(i=!0,c(d))),n.dispatch(u)}finally{o=!0}}})},Pj=e=>function(r){const{autoBatch:n=!0}=r??{};let o=new qf(e);return n&&o.push(Aj(typeof n=="object"?n:void 0)),o};function Lj(e){const t=Ej(),{reducer:r=void 0,middleware:n,devTools:o=!0,preloadedState:a=void 0,enhancers:i=void 0}=e||{};let l;if(typeof r=="function")l=r;else if(wi(r))l=uj(r);else throw new Error(Xt(1));let c;typeof n=="function"?c=n(t):c=t();let d=eo;o&&(d=Cj({trace:!1,...typeof o=="object"&&o}));const u=fj(...c),f=Pj(u);let g=typeof i=="function"?i(f):f();const p=d(...g);return Mf(l,a,p)}function Kf(e){const t={},r=[];let n;const o={addCase(a,i){const l=typeof a=="string"?a:a.type;if(!l)throw new Error(Xt(28));if(l in t)throw new Error(Xt(29));return t[l]=i,o},addMatcher(a,i){return r.push({matcher:a,reducer:i}),o},addDefaultCase(a){return n=a,o}};return e(o),[t,r,n]}function Fj(e){return typeof e=="function"}function $j(e,t){let[r,n,o]=Kf(t),a;if(Fj(e))a=()=>Mc(e());else{const l=Mc(e);a=()=>l}function i(l=a(),c){let d=[r[c.type],...n.filter(({matcher:u})=>u(c)).map(({reducer:u})=>u)];return d.filter(u=>!!u).length===0&&(d=[o]),d.reduce((u,f)=>{if(f)if(Er(u)){const p=f(u,c);return p===void 0?u:p}else{if(Zt(u))return Vf(u,g=>f(g,c));{const g=f(u,c);if(g===void 0){if(u===null)return u;throw Error("A case reducer on a non-draftable value must not return undefined")}return g}}return u},l)}return i.getInitialState=a,i}var Rj=Symbol.for("rtk-slice-createasyncthunk");function Ij(e,t){return`${e}/${t}`}function Mj({creators:e}={}){const t=e?.asyncThunk?.[Rj];return function(n){const{name:o,reducerPath:a=o}=n;if(!o)throw new Error(Xt(11));const i=(typeof n.reducers=="function"?n.reducers(zj()):n.reducers)||{},l=Object.keys(i),c={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},d={addCase(m,v){const j=typeof m=="string"?m:m.type;if(!j)throw new Error(Xt(12));if(j in c.sliceCaseReducersByType)throw new Error(Xt(13));return c.sliceCaseReducersByType[j]=v,d},addMatcher(m,v){return c.sliceMatchers.push({matcher:m,reducer:v}),d},exposeAction(m,v){return c.actionCreators[m]=v,d},exposeCaseReducer(m,v){return c.sliceCaseReducersByName[m]=v,d}};l.forEach(m=>{const v=i[m],j={reducerName:m,type:Ij(o,m),createNotation:typeof n.reducers=="function"};Bj(v)?Vj(j,v,d,t):Uj(j,v,d)});function u(){const[m={},v=[],j=void 0]=typeof n.extraReducers=="function"?Kf(n.extraReducers):[n.extraReducers],k={...m,...c.sliceCaseReducersByType};return $j(n.initialState,C=>{for(let A in k)C.addCase(A,k[A]);for(let A of c.sliceMatchers)C.addMatcher(A.matcher,A.reducer);for(let A of v)C.addMatcher(A.matcher,A.reducer);j&&C.addDefaultCase(j)})}const f=m=>m,g=new Map,p=new WeakMap;let h;function w(m,v){return h||(h=u()),h(m,v)}function y(){return h||(h=u()),h.getInitialState()}function b(m,v=!1){function j(C){let A=C[m];return typeof A>"u"&&v&&(A=bs(p,j,y)),A}function k(C=f){const A=bs(g,v,()=>new WeakMap);return bs(A,C,()=>{const T={};for(const[O,$]of Object.entries(n.selectors??{}))T[O]=Oj($,C,()=>bs(p,C,y),v);return T})}return{reducerPath:m,getSelectors:k,get selectors(){return k(j)},selectSlice:j}}const S={name:o,reducer:w,actions:c.actionCreators,caseReducers:c.sliceCaseReducersByName,getInitialState:y,...b(a),injectInto(m,{reducerPath:v,...j}={}){const k=v??a;return m.inject({reducerPath:k,reducer:w},j),{...S,...b(k,!0)}}};return S}}function Oj(e,t,r,n){function o(a,...i){let l=t(a);return typeof l>"u"&&n&&(l=r()),e(l,...i)}return o.unwrapped=e,o}var Dj=Mj();function zj(){function e(t,r){return{_reducerDefinitionType:"asyncThunk",payloadCreator:t,...r}}return e.withTypes=()=>e,{reducer(t){return Object.assign({[t.name](...r){return t(...r)}}[t.name],{_reducerDefinitionType:"reducer"})},preparedReducer(t,r){return{_reducerDefinitionType:"reducerWithPrepare",prepare:t,reducer:r}},asyncThunk:e}}function Uj({type:e,reducerName:t,createNotation:r},n,o){let a,i;if("reducer"in n){if(r&&!Hj(n))throw new Error(Xt(17));a=n.reducer,i=n.prepare}else a=n;o.addCase(e,a).exposeCaseReducer(t,a).exposeAction(t,i?Ic(e,i):Ic(e))}function Bj(e){return e._reducerDefinitionType==="asyncThunk"}function Hj(e){return e._reducerDefinitionType==="reducerWithPrepare"}function Vj({type:e,reducerName:t},r,n,o){if(!o)throw new Error(Xt(18));const{payloadCreator:a,fulfilled:i,pending:l,rejected:c,settled:d,options:u}=r,f=o(e,a,u);n.exposeAction(t,f),i&&n.addCase(f.fulfilled,i),l&&n.addCase(f.pending,l),c&&n.addCase(f.rejected,c),d&&n.addMatcher(f.settled,d),n.exposeCaseReducer(t,{fulfilled:i||ws,pending:l||ws,rejected:c||ws,settled:d||ws})}function ws(){}function Xt(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}const Wj={currentWorkflow:null},Yf=Dj({name:"workflow",initialState:Wj,reducers:{setCurrentWorkflow(e,t){e.currentWorkflow=t.payload}}}),{setCurrentWorkflow:yk}=Yf.actions,qj=Yf.reducer,Kj=(e={},t)=>e,Yj=Lj({reducer:{workflow:qj,dummy:Kj}});Je.init({lng:"it",fallbackLng:"it",debug:!1,interpolation:{escapeValue:!1},backend:{},react:{useSuspense:!1},detection:{order:[],caches:[]}},()=>{ag.createRoot(document.getElementById("root")).render(s.jsx(y1,{store:Yj,children:s.jsx(nm,{children:s.jsx(ij,{})})}))});
