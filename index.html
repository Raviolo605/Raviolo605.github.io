<!DOCTYPE html>
<html>
<head>
  <title>Redirecting to Secure Portal...</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding-top: 50px; }
    #status, #details { font-size: 1.2em; }
    #error-info { 
        margin-top: 20px; 
        padding: 15px; 
        background-color: #fdd; 
        border: 1px solid #f00;
        word-break: break-all;
        text-align: left;
    }
  </style>
</head>
<body>
  <p id="status">Initializing redirect...</p>
  <p>If you are not redirected automatically, 
    <a id="redirect-link" href="#">click here</a>.
  </p>
  <p id="details" style="color: #888; font-size: 0.9em;"></p>

  <script>
    (function() {
        try {
            const params = new URLSearchParams(window.location.search);
            const cfUrl = params.get('cf-url');

            if (!cfUrl) {
                throw new Error("Required 'cf-url' parameter not found in the link.");
            }

            const finalUrl = decodeURIComponent(cfUrl);

            if (!finalUrl || !finalUrl.startsWith('http')) {
                throw new Error("Decoded URL is invalid or not an HTTP link.");
            }
            
            document.getElementById('status').textContent = 'Redirecting...';
            document.getElementById('redirect-link').href = finalUrl;
            
            // Use a temporary URL object just to safely get the hostname for display
            try {
                 document.getElementById('details').textContent = 'To: ' + (new URL(finalUrl)).hostname;
            } catch (e) {
                 document.getElementById('details').textContent = 'To an external secure portal.';
            }

            window.location.replace(finalUrl);

        } catch (e) {
            document.getElementById('status').textContent = 'Critical Error During Redirect';
            document.getElementById('details').textContent = 'The link is malformed. Please check the original email.';
            
            const errorDiv = document.createElement('div');
            errorDiv.id = 'error-info';
            errorDiv.innerText = 'Error details: ' + e.message;
            document.body.appendChild(errorDiv);
        }
    })();
  </script>
</body>
</html>
